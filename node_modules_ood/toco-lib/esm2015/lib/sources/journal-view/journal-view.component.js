/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/journal-view/journal-view.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component, Input } from '@angular/core';
import { MatSnackBar, MatDialog } from '@angular/material';
import { MetadataService, MessageHandler, StatusCode, Environment } from '../../core/public-api';
import { Organization, VocabulariesInmutableNames, JournalVersion } from '../../entities/public-api';
/** @enum {number} */
const JournalDataType = {
    /** is used by default, `Journal` have not that type of data. */
    default: 0,
    title: 1,
    subtitle: 2,
    shortname: 3,
    issnP: 4,
    issnE: 5,
    issnL: 6,
    rnpsP: 7,
    rnpsE: 21,
    url: 8,
    email: 9,
    logo: 10,
    purpose: 11,
    start_year: 12,
    end_year: 13,
    frequency: 14,
    seriadas_cubanas: 15,
    facebook: 16,
    twitter: 17,
    linkedin: 18,
    description: 19,
    term: 20,
    oaiurl: 22,
};
export { JournalDataType };
JournalDataType[JournalDataType.default] = 'default';
JournalDataType[JournalDataType.title] = 'title';
JournalDataType[JournalDataType.subtitle] = 'subtitle';
JournalDataType[JournalDataType.shortname] = 'shortname';
JournalDataType[JournalDataType.issnP] = 'issnP';
JournalDataType[JournalDataType.issnE] = 'issnE';
JournalDataType[JournalDataType.issnL] = 'issnL';
JournalDataType[JournalDataType.rnpsP] = 'rnpsP';
JournalDataType[JournalDataType.rnpsE] = 'rnpsE';
JournalDataType[JournalDataType.url] = 'url';
JournalDataType[JournalDataType.email] = 'email';
JournalDataType[JournalDataType.logo] = 'logo';
JournalDataType[JournalDataType.purpose] = 'purpose';
JournalDataType[JournalDataType.start_year] = 'start_year';
JournalDataType[JournalDataType.end_year] = 'end_year';
JournalDataType[JournalDataType.frequency] = 'frequency';
JournalDataType[JournalDataType.seriadas_cubanas] = 'seriadas_cubanas';
JournalDataType[JournalDataType.facebook] = 'facebook';
JournalDataType[JournalDataType.twitter] = 'twitter';
JournalDataType[JournalDataType.linkedin] = 'linkedin';
JournalDataType[JournalDataType.description] = 'description';
JournalDataType[JournalDataType.term] = 'term';
JournalDataType[JournalDataType.oaiurl] = 'oaiurl';
export class JournalViewComponent {
    /**
     * @param {?} metadata
     * @param {?} env
     * @param {?} _snackBar
     * @param {?} dialog
     */
    constructor(metadata, env, _snackBar, dialog) {
        this.metadata = metadata;
        this.env = env;
        this._snackBar = _snackBar;
        this.dialog = dialog;
        this.topMainOrganization = null;
        /**
         * ************* auxiliary variables ******************
         */
        this.panelOpenState = false;
        this.defaultLogo = this.env.sceibaHost + 'static/favicon.ico';
        /**
         * Inmutables data types of Journal
         */
        this.journalDataType = JournalDataType;
        /**
         * version.is_current = true
         */
        // public currentJournal: JournalVersion;
        this.showVersions = false;
        this.editVersion = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.isDisabledNavigatePrevious = true;
        this.isDisabledNavigateNext = false;
        this.vocabularies = VocabulariesInmutableNames;
        // guardar la cantidad total de versiones
        this.lengthVersion = this.versions.length;
        // guardar la posicion de la version donde este la actual
        this.selectedVersion = this.getSelectedJournalPosition();
        this.SelectJournalVersion();
        this.metadata.setStandardMeta("Revista Científica " + this.editingJournal.data.title, this.editingJournal.data.description, "");
        // if (this.versions){
        //   this.versions.forEach((journalVersion: JournalVersion, index: number) => {
        //     // check if has versions to view and return that position
        //     if (journalVersion.is_current) {
        //         this.currentJournal = new JournalVersion();
        //         this.currentJournal.deepcopy(journalVersion);
        //     }
        //   });
        // }
    }
    /**
     * Changes the selected position to the next one if possible
     * @return {?}
     */
    nextVersion() {
        if (this.selectedVersion < this.lengthVersion - 1) {
            this.isDisabledNavigateNext = false;
            this.isDisabledNavigatePrevious = false;
            this.selectedVersion++;
            this.SelectJournalVersion();
        }
        else {
            this.isDisabledNavigateNext = true;
            /** @type {?} */
            const m = new MessageHandler(this._snackBar);
            m.showMessage(StatusCode.OK, 'No hay más versiones para mostrar');
        }
        if (this.selectedVersion == this.lengthVersion - 1) {
            this.isDisabledNavigateNext = true;
        }
    }
    /**
     * Changes the selected position to the before one if possible
     * @return {?}
     */
    previousVersion() {
        if (this.selectedVersion > 0) {
            this.isDisabledNavigatePrevious = false;
            this.isDisabledNavigateNext = false;
            this.selectedVersion--;
            this.SelectJournalVersion();
        }
        else {
            this.isDisabledNavigatePrevious = true;
            /** @type {?} */
            const m = new MessageHandler(this._snackBar);
            m.showMessage(StatusCode.OK, 'No hay más versiones para mostrar');
        }
        if (this.selectedVersion == 0) {
            this.isDisabledNavigatePrevious = true;
        }
    }
    /**
     * Selects the selected journal as a JournalVersion
     * @return {?}
     */
    SelectJournalVersion() {
        if (this.versions.length >= 0 &&
            this.selectedVersion >= 0 &&
            this.selectedVersion < this.versions.length) {
            // load the selected journal
            /** @type {?} */
            let version = new JournalVersion();
            version.deepcopy(this.versions[this.selectedVersion]);
            this.selectedJournal = version;
            // load if was viewed
            // this.selectedJournalChecked = this.selectedJournal.reviewed;
        }
    }
    /**
     * Returns the position of the unseen version of the journal as JournalVersion
     * @private
     * @return {?}
     */
    getSelectedJournalPosition() {
        /** @type {?} */
        let count = 0;
        this.versions.forEach((/**
         * @param {?} journalVersion
         * @param {?} index
         * @return {?}
         */
        (journalVersion, index) => {
            // check if has versions to view and return that position
            if (journalVersion.reviewed != null && journalVersion.reviewed) {
                count = index;
                return count;
            }
        }));
        return count;
    }
    /**
     * @param {?} version
     * @return {?}
     */
    sourceEditDone(version) {
        this.editVersion = false;
        console.log('AAaAAAAAAAAAAAAAAAAAA');
    }
    /**
     * @return {?}
     */
    toogleShowVersions() {
        this.showVersions = !this.showVersions;
        this.editVersion = false;
    }
}
JournalViewComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-journal-view',
                template: "<div *ngIf=\"editingJournal != undefined\" fxLayout=\"row wrap\" style=\"margin: 1em\">\n  <!-- navigate buttons -->\n  <mat-toolbar>\n    <mat-toolbar-row fxLayoutGap=\"1em\" fxLayoutAlign=\"end center\">\n      <!-- <mat-slide-toggle\n        (change)=\"editVersion = !editVersion\"\n        color=\"primary\"\n        matTooltip=\"Vista Edicion\"\n    >\n    </mat-slide-toggle>\n\n      <mat-slide-toggle\n        *ngIf=\"!editVersion\"\n        (change)=\"showVersions = !showVersions\"\n        color=\"accent\"\n        matTooltip=\"Ver Revisiones\"\n      >\n      </mat-slide-toggle> -->\n\n      <button\n        *ngIf=\"!editVersion\"\n        mat-icon-button\n        aria-label=\"Editar la Revisi\u00F3n actual\"\n        matTooltip=\"Editar la Revisi\u00F3n actual\"\n        (click)=\"editVersion = !editVersion\"\n      >\n        <mat-icon>edit</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"editVersion\"\n        mat-icon-button\n        aria-label=\"Vista Revisiones\"\n        matTooltip=\"Vista Revisiones\"\n        (click)=\"editVersion = !editVersion\"\n      >\n        <mat-icon>visibility</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!editVersion && !showVersions\"\n        mat-icon-button\n        aria-label=\"Ver Revisiones\"\n        matTooltip=\"Ver Revisiones\"\n        (click)=\"showVersions = !showVersions\"\n      >\n        <mat-icon>history</mat-icon>\n      </button>\n\n      <button\n        *ngIf=\"!editVersion && showVersions\"\n        mat-icon-button\n        aria-label=\"Ocultar Revisiones\"\n        matTooltip=\"Ocultar Revisiones\"\n        (click)=\"showVersions = !showVersions\"\n      >\n        <mat-icon>history</mat-icon>\n      </button>\n\n      <div *ngIf=\"!editVersion && showVersions\">\n        <button\n          mat-icon-button\n          aria-label=\"Previous version\"\n          [disabled]=\"isDisabledNavigatePrevious\"\n          matTooltip=\"Revisi\u00F3n Anterior\"\n          (click)=\"previousVersion()\"\n        >\n          <mat-icon>navigate_before</mat-icon>\n        </button>\n        <button\n          mat-icon-button\n          aria-label=\"Next version\"\n          [disabled]=\"isDisabledNavigateNext\"\n          matTooltip=\"Revisi\u00F3n Siguiente\"\n          (click)=\"nextVersion()\"\n        >\n          <mat-icon>navigate_next</mat-icon>\n        </button>\n      </div>\n    </mat-toolbar-row>\n  </mat-toolbar>\n\n  <ng-container *ngIf=\"versions != undefined\">\n    <toco-journal-edit\n      *ngIf=\"editVersion\"\n      [journalVersion]=\"editingJournal\"\n      (journalEditDone)=\"sourceEditDone($event)\"\n      [showEditHeader]=\"false\"\n      [showFinalStep]=\"false\"\n      [topMainOrganization]=\"topMainOrganization\"\n    >\n    </toco-journal-edit>\n    <toco-journal-view-info\n      *ngIf=\"!editVersion && !showVersions\"\n      [journalVersion]=\"editingJournal\"\n      fxFlex=\"1 2 calc(15em + 20px)\"\n      style=\"margin: 0.5em\"\n    >\n    </toco-journal-view-info>\n    <ng-container *ngIf=\"!editVersion && showVersions\">\n      <toco-journal-view-info\n        #journalViewInfo\n        [journalVersion]=\"editingJournal\"\n        fxFlex=\"1 2 calc(15em + 20px)\"\n        style=\"margin: 0.5em\"\n      >\n      </toco-journal-view-info>\n\n      <toco-journal-view-version\n        #versionsPanel\n        [editingJournal]=\"editingJournal\"\n        [currentJournal]=\"selectedJournal\"\n        (editingJournalChange)=\"\n          journalViewInfo.editingJournalChange(editingJournal)\n        \"\n        fxFlex=\"1 2 calc(15em + 20px)\"\n        style=\"margin: 0.5em\"\n      ></toco-journal-view-version>\n    </ng-container>\n  </ng-container>\n\n  <mat-card *ngIf=\"versions == undefined\" style=\"margin: 1em\">\n    <mat-card-content>\n      <h1>Este componente necesita las revisiones de la revista.</h1>\n    </mat-card-content>\n  </mat-card>\n</div>\n\n<mat-card *ngIf=\"editingJournal == undefined\" style=\"margin: 1em\">\n  <mat-card-content>\n    <h1>No se encontr\u00F3 la informaci\u00F3n solicitada</h1>\n  </mat-card-content>\n</mat-card>\n",
                styles: [".text-muted{color:rgba(0,0,0,.54);padding-left:.2em}.text-through{text-decoration:line-through}.notification-position{position:absolute;top:0;right:0}p{padding-top:.8em}.overlay{opacity:.4;background:#000;width:100%;height:100%;z-index:10;top:0;left:0;position:fixed}"]
            }] }
];
/** @nocollapse */
JournalViewComponent.ctorParameters = () => [
    { type: MetadataService },
    { type: Environment },
    { type: MatSnackBar },
    { type: MatDialog }
];
JournalViewComponent.propDecorators = {
    topMainOrganization: [{ type: Input }],
    editingJournal: [{ type: Input }],
    versions: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    JournalViewComponent.prototype.topMainOrganization;
    /**
     * ************* auxiliary variables ******************
     * @type {?}
     */
    JournalViewComponent.prototype.panelOpenState;
    /** @type {?} */
    JournalViewComponent.prototype.defaultLogo;
    /**
     * Button roperty, is to enable or disable if there are not more versions
     * @type {?}
     */
    JournalViewComponent.prototype.isDisabledNavigatePrevious;
    /** @type {?} */
    JournalViewComponent.prototype.isDisabledNavigateNext;
    /** @type {?} */
    JournalViewComponent.prototype.vocabularies;
    /**
     * Represents a Journal Object, it is a type of Source.
     * Need the source.version array filled
     * @type {?}
     */
    JournalViewComponent.prototype.editingJournal;
    /** @type {?} */
    JournalViewComponent.prototype.versions;
    /**
     * the current version of a Journal, (a type of Source)
     * it is to compare and show changes between Journal and last version of journal
     * iteration over journal.versions
     * @type {?}
     */
    JournalViewComponent.prototype.selectedJournal;
    /**
     * Properties to move between versions
     * @type {?}
     * @private
     */
    JournalViewComponent.prototype.selectedVersion;
    /**
     * @type {?}
     * @private
     */
    JournalViewComponent.prototype.lengthVersion;
    /**
     * Inmutables data types of Journal
     * @type {?}
     */
    JournalViewComponent.prototype.journalDataType;
    /**
     * version.is_current = true
     * @type {?}
     */
    JournalViewComponent.prototype.showVersions;
    /** @type {?} */
    JournalViewComponent.prototype.editVersion;
    /**
     * @type {?}
     * @private
     */
    JournalViewComponent.prototype.metadata;
    /**
     * @type {?}
     * @private
     */
    JournalViewComponent.prototype.env;
    /**
     * @type {?}
     * @private
     */
    JournalViewComponent.prototype._snackBar;
    /** @type {?} */
    JournalViewComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiam91cm5hbC12aWV3LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3NvdXJjZXMvam91cm5hbC12aWV3L2pvdXJuYWwtdmlldy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBS0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakcsT0FBTyxFQUFFLFlBQVksRUFBRSwwQkFBMEIsRUFBRSxjQUFjLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQzs7QUFHckcsTUFBWSxlQUFlO0lBQ3ZCLGdFQUFnRTtJQUNoRSxPQUFPLEdBQUk7SUFDWCxLQUFLLEdBQUk7SUFDVCxRQUFRLEdBQUk7SUFDWixTQUFTLEdBQUk7SUFDYixLQUFLLEdBQUk7SUFDVCxLQUFLLEdBQUk7SUFDVCxLQUFLLEdBQUk7SUFDVCxLQUFLLEdBQUk7SUFDVCxLQUFLLElBQUs7SUFDVixHQUFHLEdBQUk7SUFDUCxLQUFLLEdBQUk7SUFDVCxJQUFJLElBQUs7SUFDVCxPQUFPLElBQUs7SUFDWixVQUFVLElBQUs7SUFDZixRQUFRLElBQUs7SUFDYixTQUFTLElBQUs7SUFDZCxnQkFBZ0IsSUFBSztJQUNyQixRQUFRLElBQUs7SUFDYixPQUFPLElBQUs7SUFDWixRQUFRLElBQUs7SUFDYixXQUFXLElBQUs7SUFDaEIsSUFBSSxJQUFLO0lBQ1QsTUFBTSxJQUFLO0VBQ2Q7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPRCxNQUFNLE9BQU8sb0JBQW9COzs7Ozs7O0lBaUY3QixZQUNZLFFBQXlCLEVBQ3pCLEdBQWdCLEVBQ2hCLFNBQXNCLEVBQ3ZC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eE5KLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsbUJBQW1CO2dCQUM3Qiw4aUlBQTRDOzthQUUvQzs7OztZQW5DUSxlQUFlO1lBQThCLFdBQVc7WUFEeEQsV0FBVztZQUFFLFNBQVM7OztrQ0F3QzFCLEtBQUs7NkJBNkJMLEtBQUs7dUJBR0wsS0FBSzs7OztJQWhDTixtREFDZ0Q7Ozs7O0lBS2hELDhDQUE4Qjs7SUFHOUIsMkNBQStEOzs7OztJQUsvRCwwREFBb0M7O0lBQ3BDLHNEQUFnQzs7SUFFaEMsNENBQXVEOzs7Ozs7SUFZdkQsOENBQ3NDOztJQUV0Qyx3Q0FDdUM7Ozs7Ozs7SUFVdkMsK0NBQXVDOzs7Ozs7SUFhdkMsK0NBQWdDOzs7OztJQUNoQyw2Q0FBOEI7Ozs7O0lBSzlCLCtDQUF5Qzs7Ozs7SUFXekMsNENBQTRCOztJQUM1QiwyQ0FBMkI7Ozs7O0lBS3ZCLHdDQUFpQzs7Ozs7SUFDakMsbUNBQXdCOzs7OztJQUN4Qix5Q0FBOEI7O0lBQzlCLHNDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiAgIENvcHlyaWdodCAoYykgMjAyMCBVbml2ZXJzaWRhZCBkZSBQaW5hciBkZWwgUsOtbyBcIkhlcm1hbm9zIFNhw616IE1vbnRlcyBkZSBPY2FcIlxuICogICBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0U25hY2tCYXIsIE1hdERpYWxvZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7IE1ldGFkYXRhU2VydmljZSwgTWVzc2FnZUhhbmRsZXIsIFN0YXR1c0NvZGUsIEVudmlyb25tZW50IH0gZnJvbSAnLi4vLi4vY29yZS9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE9yZ2FuaXphdGlvbiwgVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXMsIEpvdXJuYWxWZXJzaW9uIH0gZnJvbSAnLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5cblxuZXhwb3J0IGVudW0gSm91cm5hbERhdGFUeXBlIHtcbiAgICAvKiogaXMgdXNlZCBieSBkZWZhdWx0LCBgSm91cm5hbGAgaGF2ZSBub3QgdGhhdCB0eXBlIG9mIGRhdGEuICovXG4gICAgZGVmYXVsdCA9IDAsXG4gICAgdGl0bGUgPSAxLFxuICAgIHN1YnRpdGxlID0gMixcbiAgICBzaG9ydG5hbWUgPSAzLFxuICAgIGlzc25QID0gNCxcbiAgICBpc3NuRSA9IDUsXG4gICAgaXNzbkwgPSA2LFxuICAgIHJucHNQID0gNyxcbiAgICBybnBzRSA9IDIxLFxuICAgIHVybCA9IDgsXG4gICAgZW1haWwgPSA5LFxuICAgIGxvZ28gPSAxMCxcbiAgICBwdXJwb3NlID0gMTEsXG4gICAgc3RhcnRfeWVhciA9IDEyLFxuICAgIGVuZF95ZWFyID0gMTMsXG4gICAgZnJlcXVlbmN5ID0gMTQsXG4gICAgc2VyaWFkYXNfY3ViYW5hcyA9IDE1LFxuICAgIGZhY2Vib29rID0gMTYsXG4gICAgdHdpdHRlciA9IDE3LFxuICAgIGxpbmtlZGluID0gMTgsXG4gICAgZGVzY3JpcHRpb24gPSAxOSxcbiAgICB0ZXJtID0gMjAsXG4gICAgb2FpdXJsID0gMjIsXG59XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndG9jby1qb3VybmFsLXZpZXcnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9qb3VybmFsLXZpZXcuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2pvdXJuYWwtdmlldy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIEpvdXJuYWxWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgdG9wTWFpbk9yZ2FuaXphdGlvbjogT3JnYW5pemF0aW9uID0gbnVsbDtcblxuXG4gICAgLyoqKioqKioqKioqKioqKiogYXV4aWxpYXJ5IHZhcmlhYmxlcyAqKioqKioqKioqKioqKioqKioqL1xuXG4gICAgcHVibGljIHBhbmVsT3BlblN0YXRlID0gZmFsc2U7XG5cblxuICAgIHB1YmxpYyBkZWZhdWx0TG9nbyA9IHRoaXMuZW52LnNjZWliYUhvc3QgKyAnc3RhdGljL2Zhdmljb24uaWNvJ1xuXG4gICAgLyoqXG4gICAgICogQnV0dG9uIHJvcGVydHksIGlzIHRvIGVuYWJsZSBvciBkaXNhYmxlIGlmIHRoZXJlIGFyZSBub3QgbW9yZSB2ZXJzaW9uc1xuICAgICAqL1xuICAgIGlzRGlzYWJsZWROYXZpZ2F0ZVByZXZpb3VzOiBib29sZWFuO1xuICAgIGlzRGlzYWJsZWROYXZpZ2F0ZU5leHQ6IGJvb2xlYW47XG5cbiAgICBwdWJsaWMgdm9jYWJ1bGFyaWVzOiB0eXBlb2YgVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXM7XG5cblxuICAgIC8qKioqKioqKioqKioqKioqIGpvdXJuYWwgdmFyaWFibGVzICoqKioqKioqKioqKioqKioqKiovXG5cbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGEgSm91cm5hbCBPYmplY3QsIGl0IGlzIGEgdHlwZSBvZiBTb3VyY2UuXG4gICAgICogTmVlZCB0aGUgc291cmNlLnZlcnNpb24gYXJyYXkgZmlsbGVkXG4gICAgICovXG4gICAgLy8gQElucHV0KClcbiAgICAvLyBwdWJsaWMgam91cm5hbDogSm91cm5hbERhdGE7XG5cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBlZGl0aW5nSm91cm5hbDogSm91cm5hbFZlcnNpb247XG5cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyB2ZXJzaW9uczogQXJyYXk8Sm91cm5hbFZlcnNpb24+O1xuXG5cbiAgICAvKioqKioqKioqKioqKioqKiBzZWxlY3Qgam91cm5hbCB2ZXJzaW9uIHZhcmlhYmxlcyAqKioqKioqKioqKioqKioqKioqL1xuXG4gICAgLyoqXG4gICAgICogdGhlIGN1cnJlbnQgdmVyc2lvbiBvZiBhIEpvdXJuYWwsIChhIHR5cGUgb2YgU291cmNlKVxuICAgICAqIGl0IGlzIHRvIGNvbXBhcmUgYW5kIHNob3cgY2hhbmdlcyBiZXR3ZWVuIEpvdXJuYWwgYW5kIGxhc3QgdmVyc2lvbiBvZiBqb3VybmFsXG4gICAgICogaXRlcmF0aW9uIG92ZXIgam91cm5hbC52ZXJzaW9uc1xuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RlZEpvdXJuYWw6IEpvdXJuYWxWZXJzaW9uO1xuXG5cbiAgICAvKiogVE9ETzogSW4gdGhlIGZ1dHVyZSBkYXRhYmFzZVRlcm1zIGFuZCBzdWJqZWN0VGVybXMgd2lsbCBiZSBjaGFuZ2VzIGJ5XG4gICAgICogIG1pYXJUZXJtcyBhbmQgc3ViamVjdHNVbmVzY29UZXJtc1xuICAgICAqICBwdWJsaWMgbWlhclRlcm1zOiBBcnJheTxTb3VyY2VDbGFzaWZpY2F0aW9uPjtcbiAgICAgKiAgcHVibGljIHN1YmplY3RzVW5lc2NvVGVybXM6IEFycmF5PFNvdXJjZUNsYXNpZmljYXRpb24+O1xuICAgICovXG5cblxuICAgIC8qKlxuICAgICAqIFByb3BlcnRpZXMgdG8gbW92ZSBiZXR3ZWVuIHZlcnNpb25zXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZWxlY3RlZFZlcnNpb246IG51bWJlcjtcbiAgICBwcml2YXRlIGxlbmd0aFZlcnNpb246IG51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIElubXV0YWJsZXMgZGF0YSB0eXBlcyBvZiBKb3VybmFsXG4gICAgICovXG4gICAgcHVibGljIGpvdXJuYWxEYXRhVHlwZSA9IEpvdXJuYWxEYXRhVHlwZTtcblxuXG5cbiAgICAvKipcbiAgICAgKiB2ZXJzaW9uLmlzX2N1cnJlbnQgPSB0cnVlXG4gICAgICovXG4gICAgLy8gcHVibGljIGN1cnJlbnRKb3VybmFsOiBKb3VybmFsVmVyc2lvbjtcblxuXG5cbiAgICBwdWJsaWMgc2hvd1ZlcnNpb25zID0gZmFsc2U7XG4gICAgcHVibGljIGVkaXRWZXJzaW9uID0gZmFsc2U7XG5cblxuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgbWV0YWRhdGE6IE1ldGFkYXRhU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBlbnY6IEVudmlyb25tZW50LFxuICAgICAgICBwcml2YXRlIF9zbmFja0JhcjogTWF0U25hY2tCYXIsXG4gICAgICAgIHB1YmxpYyBkaWFsb2c6IE1hdERpYWxvZ1xuICAgICkgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcblxuICAgICAgICB0aGlzLmlzRGlzYWJsZWROYXZpZ2F0ZVByZXZpb3VzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkTmF2aWdhdGVOZXh0ID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy52b2NhYnVsYXJpZXMgPSBWb2NhYnVsYXJpZXNJbm11dGFibGVOYW1lcztcblxuICAgICAgICAvLyBndWFyZGFyIGxhIGNhbnRpZGFkIHRvdGFsIGRlIHZlcnNpb25lc1xuICAgICAgICB0aGlzLmxlbmd0aFZlcnNpb24gPSB0aGlzLnZlcnNpb25zLmxlbmd0aDtcbiAgICAgICAgLy8gZ3VhcmRhciBsYSBwb3NpY2lvbiBkZSBsYSB2ZXJzaW9uIGRvbmRlIGVzdGUgbGEgYWN0dWFsXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRWZXJzaW9uID0gdGhpcy5nZXRTZWxlY3RlZEpvdXJuYWxQb3NpdGlvbigpO1xuXG4gICAgICAgIHRoaXMuU2VsZWN0Sm91cm5hbFZlcnNpb24oKTtcblxuICAgICAgICB0aGlzLm1ldGFkYXRhLnNldFN0YW5kYXJkTWV0YShcIlJldmlzdGEgQ2llbnTDrWZpY2EgXCIgKyB0aGlzLmVkaXRpbmdKb3VybmFsLmRhdGEudGl0bGUsIHRoaXMuZWRpdGluZ0pvdXJuYWwuZGF0YS5kZXNjcmlwdGlvbiwgXCJcIik7XG5cbiAgICAgICAgLy8gaWYgKHRoaXMudmVyc2lvbnMpe1xuICAgICAgICAvLyAgIHRoaXMudmVyc2lvbnMuZm9yRWFjaCgoam91cm5hbFZlcnNpb246IEpvdXJuYWxWZXJzaW9uLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIC8vICAgICAvLyBjaGVjayBpZiBoYXMgdmVyc2lvbnMgdG8gdmlldyBhbmQgcmV0dXJuIHRoYXQgcG9zaXRpb25cbiAgICAgICAgLy8gICAgIGlmIChqb3VybmFsVmVyc2lvbi5pc19jdXJyZW50KSB7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5jdXJyZW50Sm91cm5hbCA9IG5ldyBKb3VybmFsVmVyc2lvbigpO1xuICAgICAgICAvLyAgICAgICAgIHRoaXMuY3VycmVudEpvdXJuYWwuZGVlcGNvcHkoam91cm5hbFZlcnNpb24pO1xuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyAgIH0pO1xuICAgICAgICAvLyB9XG4gICAgfVxuXG5cblxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIHNlbGVjdGVkIHBvc2l0aW9uIHRvIHRoZSBuZXh0IG9uZSBpZiBwb3NzaWJsZVxuICAgICAqL1xuICAgIHB1YmxpYyBuZXh0VmVyc2lvbigpOiB2b2lkIHtcblxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFZlcnNpb24gPCB0aGlzLmxlbmd0aFZlcnNpb24gLSAxKSB7XG5cbiAgICAgICAgICAgIHRoaXMuaXNEaXNhYmxlZE5hdmlnYXRlTmV4dCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5pc0Rpc2FibGVkTmF2aWdhdGVQcmV2aW91cyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZlcnNpb24rKztcbiAgICAgICAgICAgIHRoaXMuU2VsZWN0Sm91cm5hbFZlcnNpb24oKTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICB0aGlzLmlzRGlzYWJsZWROYXZpZ2F0ZU5leHQgPSB0cnVlO1xuICAgICAgICAgICAgY29uc3QgbSA9IG5ldyBNZXNzYWdlSGFuZGxlcih0aGlzLl9zbmFja0Jhcik7XG4gICAgICAgICAgICBtLnNob3dNZXNzYWdlKFN0YXR1c0NvZGUuT0ssICdObyBoYXkgbcOhcyB2ZXJzaW9uZXMgcGFyYSBtb3N0cmFyJylcblxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVmVyc2lvbiA9PSB0aGlzLmxlbmd0aFZlcnNpb24gLSAxKSB7XG4gICAgICAgICAgICB0aGlzLmlzRGlzYWJsZWROYXZpZ2F0ZU5leHQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgc2VsZWN0ZWQgcG9zaXRpb24gdG8gdGhlIGJlZm9yZSBvbmUgaWYgcG9zc2libGVcbiAgICAgKi9cbiAgICBwdWJsaWMgcHJldmlvdXNWZXJzaW9uKCk6IHZvaWQge1xuXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVmVyc2lvbiA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuaXNEaXNhYmxlZE5hdmlnYXRlUHJldmlvdXMgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNEaXNhYmxlZE5hdmlnYXRlTmV4dCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZlcnNpb24tLTtcbiAgICAgICAgICAgIHRoaXMuU2VsZWN0Sm91cm5hbFZlcnNpb24oKTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICB0aGlzLmlzRGlzYWJsZWROYXZpZ2F0ZVByZXZpb3VzID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLk9LLCAnTm8gaGF5IG3DoXMgdmVyc2lvbmVzIHBhcmEgbW9zdHJhcicpXG5cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFZlcnNpb24gPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5pc0Rpc2FibGVkTmF2aWdhdGVQcmV2aW91cyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3RzIHRoZSBzZWxlY3RlZCBqb3VybmFsIGFzIGEgSm91cm5hbFZlcnNpb25cbiAgICAgKi9cbiAgICBwdWJsaWMgU2VsZWN0Sm91cm5hbFZlcnNpb24oKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnZlcnNpb25zLmxlbmd0aCA+PSAwICYmXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmVyc2lvbiA+PSAwICYmXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmVyc2lvbiA8IHRoaXMudmVyc2lvbnMubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgIC8vIGxvYWQgdGhlIHNlbGVjdGVkIGpvdXJuYWxcbiAgICAgICAgICAgIGxldCB2ZXJzaW9uID0gbmV3IEpvdXJuYWxWZXJzaW9uKCk7XG4gICAgICAgICAgICB2ZXJzaW9uLmRlZXBjb3B5KHRoaXMudmVyc2lvbnNbdGhpcy5zZWxlY3RlZFZlcnNpb25dKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRKb3VybmFsID0gdmVyc2lvbjtcblxuICAgICAgICAgICAgLy8gbG9hZCBpZiB3YXMgdmlld2VkXG4gICAgICAgICAgICAvLyB0aGlzLnNlbGVjdGVkSm91cm5hbENoZWNrZWQgPSB0aGlzLnNlbGVjdGVkSm91cm5hbC5yZXZpZXdlZDtcblxuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBwb3NpdGlvbiBvZiB0aGUgdW5zZWVuIHZlcnNpb24gb2YgdGhlIGpvdXJuYWwgYXMgSm91cm5hbFZlcnNpb25cbiAgICAgKi9cbiAgICBwcml2YXRlIGdldFNlbGVjdGVkSm91cm5hbFBvc2l0aW9uKCk6IG51bWJlciB7XG4gICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgIHRoaXMudmVyc2lvbnMuZm9yRWFjaCgoam91cm5hbFZlcnNpb246IEpvdXJuYWxWZXJzaW9uLCBpbmRleDogbnVtYmVyKSA9PiB7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGhhcyB2ZXJzaW9ucyB0byB2aWV3IGFuZCByZXR1cm4gdGhhdCBwb3NpdGlvblxuICAgICAgICAgICAgaWYgKGpvdXJuYWxWZXJzaW9uLnJldmlld2VkICE9IG51bGwgJiYgam91cm5hbFZlcnNpb24ucmV2aWV3ZWQpIHtcbiAgICAgICAgICAgICAgICBjb3VudCA9IGluZGV4O1xuICAgICAgICAgICAgICAgIHJldHVybiBjb3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb3VudDtcbiAgICB9XG5cbiAgICBzb3VyY2VFZGl0RG9uZSh2ZXJzaW9uOiBKb3VybmFsVmVyc2lvbikge1xuICAgICAgICB0aGlzLmVkaXRWZXJzaW9uID0gZmFsc2U7XG4gICAgICAgIGNvbnNvbGUubG9nKCdBQWFBQUFBQUFBQUFBQUFBQUFBQUEnKTtcblxuICAgIH1cblxuICAgIHRvb2dsZVNob3dWZXJzaW9ucygpe1xuICAgICAgICB0aGlzLnNob3dWZXJzaW9ucyA9ICF0aGlzLnNob3dWZXJzaW9uc1xuICAgICAgICB0aGlzLmVkaXRWZXJzaW9uID0gZmFsc2U7XG4gICAgfVxuXG5cblxufVxuXG4iXX0=