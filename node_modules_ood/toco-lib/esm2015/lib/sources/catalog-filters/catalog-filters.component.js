/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/catalog-filters/catalog-filters.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component, ComponentFactoryResolver } from '@angular/core';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { MatSnackBar } from '@angular/material';
import { FilterItem } from '../../filters/public-api';
import { BooleanFilterComponent } from '../../filters/public-api';
import { FilterContainerService } from '../../filters/public-api';
import { FilterContainerComponent } from '../../filters/public-api';
import { MessageHandler, StatusCode } from '../../core/public-api';
import { CatalogService, TaxonomyService } from '../../backend/public-api';
import { Environment } from '../../core/env';
import { VocabulariesInmutableNames } from '../../entities/public-api';
export class CatalogFiltersComponent extends FilterContainerComponent {
    /**
     * @param {?} componentFactoryResolver
     * @param {?} childrenService
     * @param {?} service
     * @param {?} taxonomyService
     * @param {?} _snackBar
     * @param {?} env
     */
    constructor(componentFactoryResolver, childrenService, service, taxonomyService, _snackBar, env) {
        super(componentFactoryResolver, childrenService);
        this.componentFactoryResolver = componentFactoryResolver;
        this.childrenService = childrenService;
        this.service = service;
        this.taxonomyService = taxonomyService;
        this._snackBar = _snackBar;
        this.env = env;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        this.addOperator();
        // tslint:disable-next-line: no-use-before-declare
        default_filters.forEach((/**
         * @param {?} filter
         * @return {?}
         */
        filter => {
            this.filters_data.push(filter);
        }));
        this.service.getJournalsVocab().pipe(catchError((/**
         * @param {?} error
         * @return {?}
         */
        error => {
            /** @type {?} */
            const m = new MessageHandler(this._snackBar);
            m.showMessage(StatusCode.serverError, error.message);
            return of(null);
        })))
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            if (response) {
                response.data.vocabularies.forEach((/**
                 * @param {?} vocab
                 * @return {?}
                 */
                vocab => {
                    if (VocabulariesInmutableNames.CUBAN_INTITUTIONS === vocab.id
                        && this.env.topOrganizationPID !== '') {
                        console.log(this.env.topOrganizationPID);
                        this.taxonomyService.getTermByUUID(this.env.topOrganizationPID).subscribe((/**
                         * @param {?} termsResponse
                         * @return {?}
                         */
                        termsResponse => {
                            this.filters_data.push({
                                index: this.filters_data.length,
                                field: 'terms',
                                type: 'tree',
                                placeholder: vocab.human_name,
                                name: vocab.human_name,
                                idVocab: vocab.id,
                                selectOptions: termsResponse.data.term_node.children,
                                is_enabled: true
                            });
                        }));
                    }
                    else {
                        this.service.getTerminosByVocab(vocab.id).subscribe((/**
                         * @param {?} termsResponse
                         * @return {?}
                         */
                        termsResponse => {
                            this.filters_data.push({
                                index: this.filters_data.length,
                                field: 'terms',
                                type: 'select-autocomplete',
                                placeholder: vocab.human_name,
                                name: vocab.human_name,
                                idVocab: vocab.id,
                                selectOptions: termsResponse.data.terms,
                                is_enabled: true
                            });
                        }));
                    }
                }));
            }
            else {
                /** @type {?} */
                const m = new MessageHandler(this._snackBar);
                m.showMessage(StatusCode.serverError, "No puedo cargar los vocabularios");
            }
        }));
    }
    /**
     * @return {?}
     */
    addOperator() {
        /** @type {?} */
        const f = new FilterItem(BooleanFilterComponent, { field: 'op', value: true, name: ['AND', 'OR'], is_enabled: false, index: -1 });
        // this.current_filters.push(f);
        /** @type {?} */
        const componentFactory = this.componentFactoryResolver.resolveComponentFactory(f.component);
        /** @type {?} */
        const viewContainerRef = this.adHost.viewContainerRef;
        // viewContainerRef.clear();
        /** @type {?} */
        const componentRef = viewContainerRef.createComponent(componentFactory);
        ((/** @type {?} */ (componentRef.instance))).data = f.data;
    }
}
CatalogFiltersComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-catalog-filters-container',
                template: "<!-- <div fxLayout=\"row wrap\" fxLayoutAlign=\"start center\" fxLayoutAlign.xs=\"center center\" fxLayoutGap=\"1em\" fxLayoutGap.xs=\"0\"> -->\n\n  <ng-template toco-Filter></ng-template>\n\n<!-- </div> -->\n\n<button mat-icon-button [matMenuTriggerFor]=\"menu\">\n    <mat-icon>add</mat-icon>\n</button>\n  <mat-menu #menu=\"matMenu\" >\n    <ng-container *ngFor=\"let item of filters_data,let i=index\">\n        <ng-container *ngIf=\"item.is_enabled\">\n          <button mat-menu-item (click)=\"addFilter(i)\">\n            {{item.name}}\n          </button>\n        </ng-container>\n    </ng-container>\n    \n\n    \n  </mat-menu>",
                styles: [".width-100{width:100%}.mat-menu-item{height:37px}"]
            }] }
];
/** @nocollapse */
CatalogFiltersComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: FilterContainerService },
    { type: CatalogService },
    { type: TaxonomyService },
    { type: MatSnackBar },
    { type: Environment }
];
if (false) {
    /**
     * @type {?}
     * @protected
     */
    CatalogFiltersComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @protected
     */
    CatalogFiltersComponent.prototype.childrenService;
    /**
     * @type {?}
     * @protected
     */
    CatalogFiltersComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    CatalogFiltersComponent.prototype.taxonomyService;
    /**
     * @type {?}
     * @private
     */
    CatalogFiltersComponent.prototype._snackBar;
    /**
     * @type {?}
     * @private
     */
    CatalogFiltersComponent.prototype.env;
}
/** @type {?} */
const default_filters = [
    {
        index: 0,
        field: 'title',
        type: 'search',
        placeholder: 'Título',
        name: 'Título',
        is_enabled: true
    },
    {
        index: 1,
        field: 'issn',
        type: 'text',
        placeholder: 'ISSN',
        name: 'ISSN',
        is_enabled: true
    } /*,
        {
            index: 2,
            field: 'e_issn',
            type: 'text',
            placeholder: 'eISSN',
            name: 'eISSN',
            is_enabled: true
        },
        {
            index: 3,
            field: 'i_issn',
            type: 'text',
            placeholder: 'iISSN',
            name: 'iISSN',
            is_enabled: true
        }*/,
    {
        index: 2,
        field: 'rnps',
        type: 'number',
        placeholder: 'RNPS',
        name: 'RNPS',
        is_enabled: true
    } /*,
        {
            index: 5,
            field: 'term',
            type: 'select',
            placeholder: 'Términos',
            name: 'Términos',
            is_enabled: true
        } */
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2F0YWxvZy1maWx0ZXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3NvdXJjZXMvY2F0YWxvZy1maWx0ZXJzL2NhdGFsb2ctZmlsdGVycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBTUEsT0FBTyxFQUFFLFNBQVMsRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHaEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFbkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMzRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFPdkUsTUFBTSxPQUFPLHVCQUF3QixTQUFRLHdCQUF3Qjs7Ozs7Ozs7O0lBRW5FLFlBQXNCLHdCQUFrRCxFQUM1RCxlQUF1QyxFQUN2QyxPQUF1QixFQUN6QixlQUFnQyxFQUNoQyxTQUFzQixFQUN0QixHQUFnQjtRQUN4QixLQUFLLENBQUMsd0JBQXdCLEVBQUUsZUFBZSxDQUFDLENBQUE7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QUUsQ0FBQztRQUNSLEtBQUssRUFBRSxPQUFPO1FBQ2QsSUFBSSxFQUFFLFFBQVE7UUFDZCxXQUFXLEVBQUUsUUFBUTtRQUNyQixJQUFJLEVBQUUsUUFBUTtRQUNkLFVBQVUsRUFBRSxJQUFJO0tBQ2pCO0lBQ0Q7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUNSLEtBQUssRUFBRSxNQUFNO1FBQ2IsSUFBSSxFQUFFLE1BQU07UUFDWixXQUFXLEVBQUUsTUFBTTtRQUNuQixJQUFJLEVBQUUsTUFBTTtRQUNaLFVBQVUsRUFBRSxJQUFJO0tBQ2pCLENBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7V0FnQk07SUFDUDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJLEVBQUUsUUFBUTtRQUNkLFdBQVcsRUFBRSxNQUFNO1FBQ25CLElBQUksRUFBRSxNQUFNO1FBQ1osVUFBVSxFQUFFLElBQUk7S0FDakIsQ0FBQTs7Ozs7Ozs7WUFRTztDQUNUIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqICAgQ29weXJpZ2h0IChjKSAyMDIwIFVuaXZlcnNpZGFkIGRlIFBpbmFyIGRlbCBSw61vIFwiSGVybWFub3MgU2HDrXogTW9udGVzIGRlIE9jYVwiXG4gKiAgIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKi9cblxuXG5pbXBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBNYXRTbmFja0JhciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcblxuaW1wb3J0IHsgRmlsdGVyQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZmlsdGVycy9wdWJsaWMtYXBpJztcbmltcG9ydCB7IEZpbHRlckl0ZW0gfSBmcm9tICcuLi8uLi9maWx0ZXJzL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgQm9vbGVhbkZpbHRlckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2ZpbHRlcnMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBGaWx0ZXJDb250YWluZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZmlsdGVycy9wdWJsaWMtYXBpJztcbmltcG9ydCB7IEZpbHRlckNvbnRhaW5lckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2ZpbHRlcnMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBNZXNzYWdlSGFuZGxlciwgU3RhdHVzQ29kZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5cbmltcG9ydCB7IENhdGFsb2dTZXJ2aWNlLCBUYXhvbm9teVNlcnZpY2UgfSBmcm9tICcuLi8uLi9iYWNrZW5kL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tICcuLi8uLi9jb3JlL2Vudic7XG5pbXBvcnQgeyBWb2NhYnVsYXJpZXNJbm11dGFibGVOYW1lcyB9IGZyb20gJy4uLy4uL2VudGl0aWVzL3B1YmxpYy1hcGknO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0b2NvLWNhdGFsb2ctZmlsdGVycy1jb250YWluZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY2F0YWxvZy1maWx0ZXJzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY2F0YWxvZy1maWx0ZXJzLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQ2F0YWxvZ0ZpbHRlcnNDb21wb25lbnQgZXh0ZW5kcyBGaWx0ZXJDb250YWluZXJDb21wb25lbnQge1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcm90ZWN0ZWQgY2hpbGRyZW5TZXJ2aWNlOiBGaWx0ZXJDb250YWluZXJTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBzZXJ2aWNlOiBDYXRhbG9nU2VydmljZSxcbiAgICBwcml2YXRlIHRheG9ub215U2VydmljZTogVGF4b25vbXlTZXJ2aWNlLFxuICAgIHByaXZhdGUgX3NuYWNrQmFyOiBNYXRTbmFja0JhcixcbiAgICBwcml2YXRlIGVudjogRW52aXJvbm1lbnQpIHtcbiAgICBzdXBlcihjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIGNoaWxkcmVuU2VydmljZSlcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHN1cGVyLm5nT25Jbml0KCk7XG5cbiAgICB0aGlzLmFkZE9wZXJhdG9yKCk7XG5cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXVzZS1iZWZvcmUtZGVjbGFyZVxuICAgIGRlZmF1bHRfZmlsdGVycy5mb3JFYWNoKGZpbHRlciA9PiB7XG4gICAgICB0aGlzLmZpbHRlcnNfZGF0YS5wdXNoKGZpbHRlcik7XG4gICAgfSk7XG5cbiAgICB0aGlzLnNlcnZpY2UuZ2V0Sm91cm5hbHNWb2NhYigpLnBpcGUoXG4gICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgY29uc3QgbSA9IG5ldyBNZXNzYWdlSGFuZGxlcih0aGlzLl9zbmFja0Jhcik7XG4gICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiBvZihudWxsKTtcbiAgICAgIH0pXG4gICAgKVxuICAgICAgLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgIHJlc3BvbnNlLmRhdGEudm9jYWJ1bGFyaWVzLmZvckVhY2godm9jYWIgPT4ge1xuICAgICAgICAgICAgaWYgKFZvY2FidWxhcmllc0lubXV0YWJsZU5hbWVzLkNVQkFOX0lOVElUVVRJT05TID09PSB2b2NhYi5pZFxuICAgICAgICAgICAgICAmJiB0aGlzLmVudi50b3BPcmdhbml6YXRpb25QSUQgIT09ICcnKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZW52LnRvcE9yZ2FuaXphdGlvblBJRCk7XG4gICAgICAgICAgICAgIHRoaXMudGF4b25vbXlTZXJ2aWNlLmdldFRlcm1CeVVVSUQodGhpcy5lbnYudG9wT3JnYW5pemF0aW9uUElEKS5zdWJzY3JpYmUodGVybXNSZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzX2RhdGEucHVzaChcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuZmlsdGVyc19kYXRhLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICd0ZXJtcycsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0cmVlJyxcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHZvY2FiLmh1bWFuX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZvY2FiLmh1bWFuX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlkVm9jYWI6IHZvY2FiLmlkLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RPcHRpb25zOiB0ZXJtc1Jlc3BvbnNlLmRhdGEudGVybV9ub2RlLmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgICAgICBpc19lbmFibGVkOiB0cnVlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0VGVybWlub3NCeVZvY2FiKHZvY2FiLmlkKS5zdWJzY3JpYmUodGVybXNSZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJzX2RhdGEucHVzaChcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRoaXMuZmlsdGVyc19kYXRhLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICd0ZXJtcycsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZWxlY3QtYXV0b2NvbXBsZXRlJyxcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHZvY2FiLmh1bWFuX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZvY2FiLmh1bWFuX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlkVm9jYWI6IHZvY2FiLmlkLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RPcHRpb25zOiB0ZXJtc1Jlc3BvbnNlLmRhdGEudGVybXMsXG4gICAgICAgICAgICAgICAgICAgIGlzX2VuYWJsZWQ6IHRydWVcbiAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgbSA9IG5ldyBNZXNzYWdlSGFuZGxlcih0aGlzLl9zbmFja0Jhcik7XG4gICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLnNlcnZlckVycm9yLCBcIk5vIHB1ZWRvIGNhcmdhciBsb3Mgdm9jYWJ1bGFyaW9zXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIGFkZE9wZXJhdG9yKCkge1xuICAgIGNvbnN0IGYgPSBuZXcgRmlsdGVySXRlbShCb29sZWFuRmlsdGVyQ29tcG9uZW50LCB7IGZpZWxkOiAnb3AnLCB2YWx1ZTogdHJ1ZSwgbmFtZTogWydBTkQnLCAnT1InXSwgaXNfZW5hYmxlZDogZmFsc2UsIGluZGV4OiAtMSB9KTtcbiAgICAvLyB0aGlzLmN1cnJlbnRfZmlsdGVycy5wdXNoKGYpO1xuICAgIGNvbnN0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShmLmNvbXBvbmVudCk7XG4gICAgY29uc3Qgdmlld0NvbnRhaW5lclJlZiA9IHRoaXMuYWRIb3N0LnZpZXdDb250YWluZXJSZWY7XG4gICAgLy8gdmlld0NvbnRhaW5lclJlZi5jbGVhcigpO1xuICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudEZhY3RvcnkpO1xuICAgICg8RmlsdGVyQ29tcG9uZW50PmNvbXBvbmVudFJlZi5pbnN0YW5jZSkuZGF0YSA9IGYuZGF0YTtcbiAgfVxuXG59XG5cbmNvbnN0IGRlZmF1bHRfZmlsdGVycyA9XG4gIFtcbiAgICB7XG4gICAgICBpbmRleDogMCxcbiAgICAgIGZpZWxkOiAndGl0bGUnLFxuICAgICAgdHlwZTogJ3NlYXJjaCcsXG4gICAgICBwbGFjZWhvbGRlcjogJ1TDrXR1bG8nLFxuICAgICAgbmFtZTogJ1TDrXR1bG8nLFxuICAgICAgaXNfZW5hYmxlZDogdHJ1ZVxuICAgIH0sXG4gICAge1xuICAgICAgaW5kZXg6IDEsXG4gICAgICBmaWVsZDogJ2lzc24nLFxuICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgcGxhY2Vob2xkZXI6ICdJU1NOJyxcbiAgICAgIG5hbWU6ICdJU1NOJyxcbiAgICAgIGlzX2VuYWJsZWQ6IHRydWVcbiAgICB9LyosXG4gICAgICAgIHtcbiAgICAgICAgICAgIGluZGV4OiAyLFxuICAgICAgICAgICAgZmllbGQ6ICdlX2lzc24nLFxuICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdlSVNTTicsXG4gICAgICAgICAgICBuYW1lOiAnZUlTU04nLFxuICAgICAgICAgICAgaXNfZW5hYmxlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBpbmRleDogMyxcbiAgICAgICAgICAgIGZpZWxkOiAnaV9pc3NuJyxcbiAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnaUlTU04nLFxuICAgICAgICAgICAgbmFtZTogJ2lJU1NOJyxcbiAgICAgICAgICAgIGlzX2VuYWJsZWQ6IHRydWVcbiAgICAgICAgfSovLFxuICAgIHtcbiAgICAgIGluZGV4OiAyLFxuICAgICAgZmllbGQ6ICdybnBzJyxcbiAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgcGxhY2Vob2xkZXI6ICdSTlBTJyxcbiAgICAgIG5hbWU6ICdSTlBTJyxcbiAgICAgIGlzX2VuYWJsZWQ6IHRydWVcbiAgICB9LyosXG4gICAgICAgIHtcbiAgICAgICAgICAgIGluZGV4OiA1LFxuICAgICAgICAgICAgZmllbGQ6ICd0ZXJtJyxcbiAgICAgICAgICAgIHR5cGU6ICdzZWxlY3QnLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdUw6lybWlub3MnLFxuICAgICAgICAgICAgbmFtZTogJ1TDqXJtaW5vcycsXG4gICAgICAgICAgICBpc19lbmFibGVkOiB0cnVlXG4gICAgICAgIH0gKi9cbiAgXTtcbiJdfQ==