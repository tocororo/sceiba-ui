/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/source-edit/source-indexes/source-indexes.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Inject } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { MatDialog, MAT_DIALOG_DATA } from '@angular/material';
import { TaxonomyService } from '../../../backend/public-api';
import { SourceData, SourceClasification, VocabulariesInmutableNames } from '../../../entities/public-api';
import { InputTextComponent, FormFieldType, SelectComponent, InputUrlComponent, HintValue, HintPosition } from '../../../forms/public-api';
export class SourceIndexesComponent {
    /**
     * @param {?} dialog
     * @param {?} service
     */
    constructor(dialog, service) {
        this.dialog = dialog;
        this.service = service;
        this.editable = true;
        /*
            el arbol entero de los indexes
            el primer nivel se considera que es una clasificacion del index, por ejemplo
                {
                  "children": {...}
                  "term": {
                    "clasified_ids": [],
                    "class_ids": [],
                    "data": null,
                    "description": "WoS / Scopus",
                    "id": 4355,
                    "name": "http://miar.ub.edu/databases/GRUPO/G",
                    "parent_id": null,
                    "uuid": "a4aae8a2-b65d-4313-b666-5ef4170fc549",
                    "vocabulary_id": "INDEXES"
                  }
                }
            en el segundo nivel (children) estan los indices(bases de datos) que realmente clasifican a las fuentes
          */
        this.databases = null;
        /*
            cada elemento de este array tiene:
            dbclass, que es un termino del primer nivel de databases,
            dblist, son las clasificaciones de las fuentes con los correspondientes datos,
              los terminos correspondientes de los elementos de dblist son hijos de dbclass en databses
          */
        this.selectedDatabases = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.service.getTermsTreeByVocab(VocabulariesInmutableNames.INDEXES, 1).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            if (response.data.tree.term_node) {
                this.databases = response.data.tree.term_node;
                this.initIndexes();
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            console.log('ERROR: ' + err + '.');
        }), (/**
         * @return {?}
         */
        () => {
        }));
    }
    /**
     * @return {?}
     */
    initIndexes() {
        this.selectedDatabases = new Array(this.databases.length);
        this._setSelectedDatabses();
        this._setIndexesToSource();
        console.log('******* complete process');
    }
    /**
     * divide los source.classifications que son de INDEXES
     * en el arreglo selectedDatabases, cuyos elementos tienen
     * dbclass, que es el primer nivel
     * dblist, que son los SourceClassification seleccionados e hijos de dbclass
     * @private
     * @return {?}
     */
    _setSelectedDatabses() {
        for (let i = 0; i < this.databases.length; i++) {
            this.selectedDatabases[i] = {
                dbclass: this.databases[i].term,
                dblist: this.sourceData.classifications.filter((/**
                 * @param {?} value
                 * @return {?}
                 */
                value => value.vocabulary == VocabulariesInmutableNames.INDEXES &&
                    this.databases[i].children.find((/**
                     * @param {?} db
                     * @return {?}
                     */
                    db => db.term.uuid == value.id)) != undefined))
            };
        }
        for (let i = 0; i < this.databases.length; i++) {
            for (let k = 0; k < this.selectedDatabases[i].dblist.length; k++) {
                /** @type {?} */
                const element = this.selectedDatabases[i].dblist[k];
                if (!this.selectedDatabases[i].dblist[k].data) {
                    this.selectedDatabases[i].dblist[k].data = {};
                }
                if (!this.selectedDatabases[i].dblist[k].data['url']) {
                    this.selectedDatabases[i].dblist[k].data['url'] = '';
                }
                if (!this.selectedDatabases[i].dblist[k].data['initial_cover']) {
                    this.selectedDatabases[i].dblist[k].data['initial_cover'] = '';
                }
                if (!this.selectedDatabases[i].dblist[k].data['end_cover']) {
                    this.selectedDatabases[i].dblist[k].data['end_cover'] = '';
                }
            }
        }
    }
    /**
     * mantiene la lista sourceData.classification bien formada en relacion con lo que hay en selectedDatabases
     * @private
     * @return {?}
     */
    _setIndexesToSource() {
        // filtra las clasificaciones que no sean indexes
        this.sourceData.classifications = this.sourceData.classifications.filter((/**
         * @param {?} value
         * @return {?}
         */
        value => value.vocabulary != VocabulariesInmutableNames.INDEXES));
        this.selectedDatabases.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            // por cada elemento en selectedDatabases, si tiene algun elemento en dblist
            // entonces dbclass y dblist tambien son parte de sourceData.classifications
            if (element.dblist.length > 0) {
                /** @type {?} */
                const parent = new SourceClasification();
                parent.id = element.dbclass.uuid;
                parent.description = element.dbclass.description;
                parent.vocabulary = element.dbclass.vocabulary_id;
                this.sourceData.classifications.push(parent);
                this.sourceData.classifications = this.sourceData.classifications.concat(element.dblist);
            }
        }));
        console.log(this.sourceData);
    }
    /**
     * @param {?} dbclassIndex
     * @return {?}
     */
    addIndexAction(dbclassIndex) {
        /** @type {?} */
        const dbclass = this.selectedDatabases[dbclassIndex].dbclass;
        /** @type {?} */
        const options = this.databases[dbclassIndex].children.filter((/**
         * @param {?} value
         * @return {?}
         */
        value => this.selectedDatabases[dbclassIndex].dblist.find((/**
         * @param {?} db
         * @return {?}
         */
        db => db.id == value.term.uuid)) == undefined));
        if (options.length > 0) {
            this.dialog.open(SourceEditAddIndexComponent, {
                data: {
                    dbclass: this.selectedDatabases[dbclassIndex].dbclass,
                    options: options,
                    editing: null,
                    addIndex: (/**
                     * @param {?} result
                     * @return {?}
                     */
                    (result) => {
                        this.dialog.closeAll();
                        this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter((/**
                         * @param {?} value
                         * @return {?}
                         */
                        value => value.id != result.id));
                        this.selectedDatabases[dbclassIndex].dblist.push(result);
                        this._setIndexesToSource();
                    }),
                },
            });
        }
    }
    /**
     * @param {?} dbclassIndex
     * @param {?} editing
     * @return {?}
     */
    editIndexAction(dbclassIndex, editing) {
        /** @type {?} */
        const dbclass = this.selectedDatabases[dbclassIndex].dbclass;
        if (editing) {
            // this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter(
            //   value => value.id != editing.id
            // );
            /** @type {?} */
            const options = this.databases[dbclassIndex].children.filter((/**
             * @param {?} value
             * @return {?}
             */
            value => this.selectedDatabases[dbclassIndex].dblist.find((/**
             * @param {?} db
             * @return {?}
             */
            db => db.id == value.term.uuid)) == undefined ||
                value.term.uuid == editing.id));
            if (options.length > 0 || editing) {
                this.dialog.open(SourceEditAddIndexComponent, {
                    data: {
                        dbclass: this.selectedDatabases[dbclassIndex].dbclass,
                        options: options,
                        editing: editing,
                        addIndex: (/**
                         * @param {?} result
                         * @return {?}
                         */
                        (result) => {
                            this.dialog.closeAll();
                            // console.log('----------------------------',this.selectedDatabases[dbclassIndex].dblist);
                            /** @type {?} */
                            const newSelected = [];
                            this.selectedDatabases[dbclassIndex].dblist.forEach((/**
                             * @param {?} element
                             * @return {?}
                             */
                            element => {
                                if (element.id != result.id && element.id != editing.id) {
                                    newSelected.push(element);
                                }
                            }));
                            this.selectedDatabases[dbclassIndex].dblist = newSelected;
                            // this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter(
                            //   value => (value.id == result.id && value.id == editing.id));
                            // console.log('++++++++++++++++++++++',this.selectedDatabases[dbclassIndex].dblist);
                            this.selectedDatabases[dbclassIndex].dblist.push(result);
                            // console.log('*********************',this.selectedDatabases[dbclassIndex].dblist);
                            this._setIndexesToSource();
                        }),
                    },
                });
            }
        }
    }
    /**
     * @param {?} dbclassIndex
     * @param {?} toDelete
     * @return {?}
     */
    deleteIndexAction(dbclassIndex, toDelete) {
        // console.log('DELETE', toDelete);
        this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter((/**
         * @param {?} value
         * @return {?}
         */
        value => value.id != toDelete.id));
        this._setIndexesToSource();
    }
}
SourceIndexesComponent.decorators = [
    { type: Component, args: [{
                selector: "toco-source-indexes",
                template: "<mat-progress-bar\n  *ngIf=\"!selectedDatabases\"\n  mode=\"indeterminate\"\n></mat-progress-bar>\n\n<mat-accordion *ngIf=\"selectedDatabases\">\n  <mat-expansion-panel\n    *ngFor=\"let clasification of selectedDatabases; let classIndex = index\"\n  >\n    <mat-expansion-panel-header>\n      {{ clasification.dbclass.description }} ({{clasification.dblist.length}})\n    </mat-expansion-panel-header>\n    <mat-action-row *ngIf=\"editable\">\n      <button\n          mat-icon-button\n          aria-label=\"Adicionar\"\n          matTooltip=\"Adicionar\"\n          (click)=\"addIndexAction(classIndex)\"\n        >\n          <mat-icon>add</mat-icon>\n        </button>\n    </mat-action-row>\n    <mat-card *ngFor=\"let db of clasification.dblist; let dbIndex = index\">\n      <mat-card-header>\n        <mat-card-title><mat-label>{{ db.description }}</mat-label></mat-card-title>\n        <mat-card-subtitle>\n          <mat-label style=\"font-weight: bold;\">URL: </mat-label>\n          {{ db.data[\"url\"] }}\n        </mat-card-subtitle>\n      </mat-card-header>\n      <mat-card-content>\n          <mat-label style=\"font-weight: bold;\">Cobertura: </mat-label>\n          <mat-label>\n            {{ db.data[\"initial_cover\"] }} - {{ db.data[\"end_cover\"] }}\n          </mat-label>\n      </mat-card-content>\n      <mat-card-actions *ngIf=\"editable\">\n        <button\n          mat-icon-button\n          aria-label=\"Editar\"\n          matTooltip=\"Editar\"\n          (click)=\"editIndexAction(classIndex, db)\"\n        >\n          <mat-icon>edit</mat-icon>\n        </button>\n        <button\n          mat-icon-button\n          aria-label=\"Eliminar\"\n          matTooltip=\"Eliminar\"\n          (click)=\"deleteIndexAction(classIndex, db)\"\n        >\n          <mat-icon>delete</mat-icon>\n        </button>\n      </mat-card-actions>\n    </mat-card>\n  </mat-expansion-panel>\n</mat-accordion>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
SourceIndexesComponent.ctorParameters = () => [
    { type: MatDialog },
    { type: TaxonomyService }
];
SourceIndexesComponent.propDecorators = {
    sourceData: [{ type: Input }],
    editable: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    SourceIndexesComponent.prototype.sourceData;
    /** @type {?} */
    SourceIndexesComponent.prototype.editable;
    /** @type {?} */
    SourceIndexesComponent.prototype.databases;
    /** @type {?} */
    SourceIndexesComponent.prototype.selectedDatabases;
    /** @type {?} */
    SourceIndexesComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    SourceIndexesComponent.prototype.service;
}
export class SourceEditAddIndexComponent {
    /**
     * @param {?} service
     * @param {?} _formBuilder
     * @param {?} data
     */
    constructor(service, _formBuilder, data) {
        // console.log(data);
        this.service = service;
        this._formBuilder = _formBuilder;
        this.data = data;
        this.indexPanel = null;
        this.editing = null;
        this.dbclass = data.dbclass;
        this.options = data.options;
        if (data.editing) {
            this.editing = data.editing;
        }
        this.addIndex = data.addIndex;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.indexFormGroup = this._formBuilder.group({});
        if (this.dbclass) {
            this.indexPanel = [
                {
                    title: (this.editing) ? 'Editar' : 'Adicionar',
                    description: '',
                    iconName: '',
                    formSection: this.indexFormGroup,
                    formSectionContent: [
                        {
                            formControl: InputTextComponent.getFormControlByDefault(),
                            name: 'indexes',
                            label: this.dbclass.description,
                            type: FormFieldType.select_expr,
                            controlType: SelectComponent,
                            required: true,
                            width: '100%',
                            value: (this.editing) ? this.editing.id : null,
                            extraContent: {
                                multiple: false,
                                getOptions: (/**
                                 * @param {?} response
                                 * @return {?}
                                 */
                                (response) => {
                                    /** @type {?} */
                                    const opts = [];
                                    this.options.forEach((/**
                                     * @param {?} node
                                     * @return {?}
                                     */
                                    (node) => {
                                        opts.push({
                                            value: node.term.uuid,
                                            label: node.term.description,
                                        });
                                    }));
                                    return opts;
                                }),
                                selectionChange: (/**
                                 * @param {?} value
                                 * @return {?}
                                 */
                                (value) => {
                                    console.log(value);
                                })
                            }
                        },
                        {
                            formControl: InputUrlComponent.getFormControlByDefault(),
                            name: 'url',
                            label: 'URL',
                            type: FormFieldType.url,
                            controlType: InputUrlComponent,
                            required: false,
                            startHint: new HintValue(HintPosition.start, 'URL de la revista en el índice.'),
                            width: '100%',
                            value: (this.editing) ? [this.editing.data['url']] : '',
                        },
                        {
                            formControl: InputTextComponent.getFormControlByDefault(),
                            name: 'initial_cover',
                            label: 'Cobertura inicio',
                            type: FormFieldType.text,
                            controlType: InputTextComponent,
                            required: false,
                            startHint: new HintValue(HintPosition.start, ''),
                            width: '45%',
                            value: (this.editing) ? [this.editing.data['initial_cover']] : '',
                        },
                        {
                            formControl: InputTextComponent.getFormControlByDefault(),
                            name: 'end_cover',
                            label: 'Cobertura',
                            type: FormFieldType.text,
                            controlType: InputTextComponent,
                            required: false,
                            startHint: new HintValue(HintPosition.start, ''),
                            width: '45%',
                            value: (this.editing) ? [this.editing.data['end_cover']] : '',
                        },
                    ],
                },
            ];
        }
        this.addIndexAction = {
            doit: (/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                if (this.indexFormGroup.valid) {
                    /** @type {?} */
                    const result = new SourceClasification();
                    // console.log(this.indexFormGroup);
                    if (this.indexFormGroup.controls['indexes'].value) {
                        /** @type {?} */
                        const node = this.options.find((/**
                         * @param {?} value
                         * @return {?}
                         */
                        value => value.term.uuid == this.indexFormGroup.controls['indexes'].value));
                        if (node) {
                            result.vocabulary = node.term.vocabulary_id;
                            result.description = node.term.description;
                            result.id = node.term.uuid;
                            result.data = {
                                url: this.indexFormGroup.controls['url'].value,
                                initial_cover: this.indexFormGroup.controls['initial_cover'].value,
                                end_cover: this.indexFormGroup.controls['end_cover'].value,
                            };
                            this.addIndex(result);
                        }
                    }
                }
            }),
        };
    }
}
SourceEditAddIndexComponent.decorators = [
    { type: Component, args: [{
                selector: "toco-source-addindex",
                template: `
    <toco-form-container
      #indexPanelContainer
      [panelsContent]="indexPanel"
      [useAccordion]="false"
      fxLayout="row"
      [formGroup]="indexFormGroup"
      [action]="addIndexAction"
      [actionLabel]="'OK'"
      [deleteValuesAfterAction]="false"
    ></toco-form-container>
  `,
                styles: [""]
            }] }
];
/** @nocollapse */
SourceEditAddIndexComponent.ctorParameters = () => [
    { type: TaxonomyService },
    { type: FormBuilder },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
if (false) {
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.indexPanel;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.indexFormGroup;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.addIndexAction;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.dbclass;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.options;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.editing;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.addIndex;
    /**
     * @type {?}
     * @private
     */
    SourceEditAddIndexComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    SourceEditAddIndexComponent.prototype._formBuilder;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlLWluZGV4ZXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvc291cmNlcy9zb3VyY2UtZWRpdC9zb3VyY2UtaW5kZXhlcy9zb3VyY2UtaW5kZXhlcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakUsT0FBTyxFQUFhLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzlELE9BQU8sRUFBRSxVQUFVLEVBQWtCLG1CQUFtQixFQUFFLDBCQUEwQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDM0gsT0FBTyxFQUEwQyxrQkFBa0IsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFnQixpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFRak0sTUFBTSxPQUFPLHNCQUFzQjs7Ozs7SUFvQ2pDLFlBQW1CLE1BQWlCLEVBQVUsT0FBd0I7UUFBbkQsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBL0IvRCxhQUFRLEdBQVksSUFBSSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztRQXFCaEMsY0FBUyxHQUFlLElBQUksQ0FBQzs7Ozs7OztRQVE3QixzQkFBaUIsR0FBNEQsSUFBSSxDQUFDO0lBRVIsQ0FBQzs7OztJQUczRSxRQUFRO1FBQ04sSUFBSSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUzs7OztRQUMvRSxDQUFDLFFBQVEsRUFBRSxF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QyxDQUFDLEtBQUs7Z0NBQzlDLGFBQWEsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxLQUFLO2dDQUNsRSxTQUFTLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSzs2QkFDM0QsQ0FBQzs0QkFDRixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO3lCQUN2QjtxQkFDRjtpQkFDRjtZQUVILENBQUMsQ0FBQTtTQUNGLENBQUM7SUFDSixDQUFDOzs7WUFsSkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxzQkFBc0I7Z0JBRWhDLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7R0FXVDs7YUFDRjs7OztZQXhPUSxlQUFlO1lBRkosV0FBVzs0Q0F5UDFCLE1BQU0sU0FBQyxlQUFlOzs7O0lBYnpCLGlEQUF1Qzs7SUFDdkMscURBQTBCOztJQUUxQixxREFBb0M7O0lBRXBDLDhDQUFjOztJQUNkLDhDQUFvQjs7SUFDcEIsOENBQW9DOztJQUNwQywrQ0FBUzs7Ozs7SUFHUCw4Q0FBZ0M7Ozs7O0lBQ2hDLG1EQUFpQzs7SUFDakMsMkNBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCwgRm9ybUJ1aWxkZXIgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXREaWFsb2csIE1BVF9ESUFMT0dfREFUQSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7IFRheG9ub215U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBTb3VyY2VEYXRhLCBUZXJtTm9kZSwgVGVybSwgU291cmNlQ2xhc2lmaWNhdGlvbiwgVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXMgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9wdWJsaWMtYXBpJztcbmltcG9ydCB7IFBhbmVsQ29udGVudF9EZXByLCBGb3JtQ29udGFpbmVyQWN0aW9uLCBJbnB1dFRleHRDb21wb25lbnQsIEZvcm1GaWVsZFR5cGUsIFNlbGVjdENvbXBvbmVudCwgU2VsZWN0T3B0aW9uLCBJbnB1dFVybENvbXBvbmVudCwgSGludFZhbHVlLCBIaW50UG9zaXRpb24gfSBmcm9tICcuLi8uLi8uLi9mb3Jtcy9wdWJsaWMtYXBpJztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwidG9jby1zb3VyY2UtaW5kZXhlc1wiLFxuICB0ZW1wbGF0ZVVybDogJy4vc291cmNlLWluZGV4ZXMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9zb3VyY2UtaW5kZXhlcy5jb21wb25lbnQuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBTb3VyY2VJbmRleGVzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgc291cmNlRGF0YTogU291cmNlRGF0YTtcbiAgQElucHV0KClcbiAgcHVibGljIGVkaXRhYmxlOiBib29sZWFuID0gdHJ1ZTtcblxuICAvKlxuICAgIGVsIGFyYm9sIGVudGVybyBkZSBsb3MgaW5kZXhlc1xuICAgIGVsIHByaW1lciBuaXZlbCBzZSBjb25zaWRlcmEgcXVlIGVzIHVuYSBjbGFzaWZpY2FjaW9uIGRlbCBpbmRleCwgcG9yIGVqZW1wbG9cbiAgICAgICAge1xuICAgICAgICAgIFwiY2hpbGRyZW5cIjogey4uLn1cbiAgICAgICAgICBcInRlcm1cIjoge1xuICAgICAgICAgICAgXCJjbGFzaWZpZWRfaWRzXCI6IFtdLFxuICAgICAgICAgICAgXCJjbGFzc19pZHNcIjogW10sXG4gICAgICAgICAgICBcImRhdGFcIjogbnVsbCxcbiAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJXb1MgLyBTY29wdXNcIixcbiAgICAgICAgICAgIFwiaWRcIjogNDM1NSxcbiAgICAgICAgICAgIFwibmFtZVwiOiBcImh0dHA6Ly9taWFyLnViLmVkdS9kYXRhYmFzZXMvR1JVUE8vR1wiLFxuICAgICAgICAgICAgXCJwYXJlbnRfaWRcIjogbnVsbCxcbiAgICAgICAgICAgIFwidXVpZFwiOiBcImE0YWFlOGEyLWI2NWQtNDMxMy1iNjY2LTVlZjQxNzBmYzU0OVwiLFxuICAgICAgICAgICAgXCJ2b2NhYnVsYXJ5X2lkXCI6IFwiSU5ERVhFU1wiXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgZW4gZWwgc2VndW5kbyBuaXZlbCAoY2hpbGRyZW4pIGVzdGFuIGxvcyBpbmRpY2VzKGJhc2VzIGRlIGRhdG9zKSBxdWUgcmVhbG1lbnRlIGNsYXNpZmljYW4gYSBsYXMgZnVlbnRlc1xuICAqL1xuICBkYXRhYmFzZXM6IFRlcm1Ob2RlW10gPSBudWxsO1xuXG4gIC8qXG4gICAgY2FkYSBlbGVtZW50byBkZSBlc3RlIGFycmF5IHRpZW5lOlxuICAgIGRiY2xhc3MsIHF1ZSBlcyB1biB0ZXJtaW5vIGRlbCBwcmltZXIgbml2ZWwgZGUgZGF0YWJhc2VzLFxuICAgIGRibGlzdCwgc29uIGxhcyBjbGFzaWZpY2FjaW9uZXMgZGUgbGFzIGZ1ZW50ZXMgY29uIGxvcyBjb3JyZXNwb25kaWVudGVzIGRhdG9zLFxuICAgICAgbG9zIHRlcm1pbm9zIGNvcnJlc3BvbmRpZW50ZXMgZGUgbG9zIGVsZW1lbnRvcyBkZSBkYmxpc3Qgc29uIGhpam9zIGRlIGRiY2xhc3MgZW4gZGF0YWJzZXNcbiAgKi9cbiAgc2VsZWN0ZWREYXRhYmFzZXM6IEFycmF5PHsgZGJjbGFzczogVGVybSwgZGJsaXN0OiBTb3VyY2VDbGFzaWZpY2F0aW9uW10gfT4gPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBkaWFsb2c6IE1hdERpYWxvZywgcHJpdmF0ZSBzZXJ2aWNlOiBUYXhvbm9teVNlcnZpY2UpIHsgfVxuXG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5zZXJ2aWNlLmdldFRlcm1zVHJlZUJ5Vm9jYWIoVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXMuSU5ERVhFUywgMSkuc3Vic2NyaWJlKFxuICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnRyZWUudGVybV9ub2RlKSB7XG4gICAgICAgICAgdGhpcy5kYXRhYmFzZXMgPSByZXNwb25zZS5kYXRhLnRyZWUudGVybV9ub2RlO1xuICAgICAgICAgIHRoaXMuaW5pdEluZGV4ZXMoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIChlcnI6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAnRVJST1I6ICcgKyBlcnIgKyAnLidcbiAgICAgICAgKTtcbiAgICAgIH0sXG5cbiAgICAgICgpID0+IHtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHVibGljIGluaXRJbmRleGVzKCl7XG5cbiAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzID0gbmV3IEFycmF5KHRoaXMuZGF0YWJhc2VzLmxlbmd0aCk7XG4gICAgdGhpcy5fc2V0U2VsZWN0ZWREYXRhYnNlcygpO1xuICAgIHRoaXMuX3NldEluZGV4ZXNUb1NvdXJjZSgpO1xuICAgIGNvbnNvbGUubG9nKCcqKioqKioqIGNvbXBsZXRlIHByb2Nlc3MnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBkaXZpZGUgbG9zIHNvdXJjZS5jbGFzc2lmaWNhdGlvbnMgcXVlIHNvbiBkZSBJTkRFWEVTXG4gICAqIGVuIGVsIGFycmVnbG8gc2VsZWN0ZWREYXRhYmFzZXMsIGN1eW9zIGVsZW1lbnRvcyB0aWVuZW5cbiAgICogZGJjbGFzcywgcXVlIGVzIGVsIHByaW1lciBuaXZlbFxuICAgKiBkYmxpc3QsIHF1ZSBzb24gbG9zIFNvdXJjZUNsYXNzaWZpY2F0aW9uIHNlbGVjY2lvbmFkb3MgZSBoaWpvcyBkZSBkYmNsYXNzXG4gICAqL1xuICBwcml2YXRlIF9zZXRTZWxlY3RlZERhdGFic2VzKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRhYmFzZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbaV0gPSB7XG4gICAgICAgIGRiY2xhc3M6IHRoaXMuZGF0YWJhc2VzW2ldLnRlcm0sXG4gICAgICAgIGRibGlzdDogdGhpcy5zb3VyY2VEYXRhLmNsYXNzaWZpY2F0aW9ucy5maWx0ZXIoXG4gICAgICAgICAgdmFsdWUgPT5cbiAgICAgICAgICAgIHZhbHVlLnZvY2FidWxhcnkgPT0gVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXMuSU5ERVhFUyAmJlxuICAgICAgICAgICAgdGhpcy5kYXRhYmFzZXNbaV0uY2hpbGRyZW4uZmluZChkYiA9PiBkYi50ZXJtLnV1aWQgPT0gdmFsdWUuaWQpICE9IHVuZGVmaW5lZFxuICAgICAgICApXG4gICAgICB9O1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZGF0YWJhc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbaV0uZGJsaXN0Lmxlbmd0aDsgaysrKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXTtcbiAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhKXtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhWyd1cmwnXSl7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba10uZGF0YVsndXJsJ109Jyc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhWydpbml0aWFsX2NvdmVyJ10pe1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbaV0uZGJsaXN0W2tdLmRhdGFbJ2luaXRpYWxfY292ZXInXT0nJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbaV0uZGJsaXN0W2tdLmRhdGFbJ2VuZF9jb3ZlciddKXtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhWydlbmRfY292ZXInXT0nJztcbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogbWFudGllbmUgbGEgbGlzdGEgc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbiBiaWVuIGZvcm1hZGEgZW4gcmVsYWNpb24gY29uIGxvIHF1ZSBoYXkgZW4gc2VsZWN0ZWREYXRhYmFzZXNcbiAgICovXG4gIHByaXZhdGUgX3NldEluZGV4ZXNUb1NvdXJjZSgpIHtcbiAgICAvLyBmaWx0cmEgbGFzIGNsYXNpZmljYWNpb25lcyBxdWUgbm8gc2VhbiBpbmRleGVzXG4gICAgdGhpcy5zb3VyY2VEYXRhLmNsYXNzaWZpY2F0aW9ucyA9IHRoaXMuc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbnMuZmlsdGVyKFxuICAgICAgdmFsdWUgPT4gdmFsdWUudm9jYWJ1bGFyeSAhPSBWb2NhYnVsYXJpZXNJbm11dGFibGVOYW1lcy5JTkRFWEVTXG4gICAgKTtcblxuXG4gICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgLy8gcG9yIGNhZGEgZWxlbWVudG8gZW4gc2VsZWN0ZWREYXRhYmFzZXMsIHNpIHRpZW5lIGFsZ3VuIGVsZW1lbnRvIGVuIGRibGlzdFxuICAgICAgLy8gZW50b25jZXMgZGJjbGFzcyB5IGRibGlzdCB0YW1iaWVuIHNvbiBwYXJ0ZSBkZSBzb3VyY2VEYXRhLmNsYXNzaWZpY2F0aW9uc1xuICAgICAgaWYgKGVsZW1lbnQuZGJsaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gbmV3IFNvdXJjZUNsYXNpZmljYXRpb24oKTtcbiAgICAgICAgcGFyZW50LmlkID0gZWxlbWVudC5kYmNsYXNzLnV1aWQ7XG4gICAgICAgIHBhcmVudC5kZXNjcmlwdGlvbiA9IGVsZW1lbnQuZGJjbGFzcy5kZXNjcmlwdGlvbjtcbiAgICAgICAgcGFyZW50LnZvY2FidWxhcnkgPSBlbGVtZW50LmRiY2xhc3Mudm9jYWJ1bGFyeV9pZDtcbiAgICAgICAgdGhpcy5zb3VyY2VEYXRhLmNsYXNzaWZpY2F0aW9ucy5wdXNoKHBhcmVudCk7XG4gICAgICAgIHRoaXMuc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbnMgPSB0aGlzLnNvdXJjZURhdGEuY2xhc3NpZmljYXRpb25zLmNvbmNhdChlbGVtZW50LmRibGlzdCk7XG5cbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLnNvdXJjZURhdGEpO1xuXG4gIH1cblxuICBwdWJsaWMgYWRkSW5kZXhBY3Rpb24oZGJjbGFzc0luZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBkYmNsYXNzID0gdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRiY2xhc3M7XG4gICAgY29uc3Qgb3B0aW9uczogVGVybU5vZGVbXSA9IHRoaXMuZGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uY2hpbGRyZW4uZmlsdGVyKFxuICAgICAgdmFsdWUgPT5cbiAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5maW5kKGRiID0+IGRiLmlkID09IHZhbHVlLnRlcm0udXVpZCkgPT0gdW5kZWZpbmVkXG4gICAgKTtcbiAgICBpZiAob3B0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmRpYWxvZy5vcGVuKFNvdXJjZUVkaXRBZGRJbmRleENvbXBvbmVudCwge1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZGJjbGFzczogdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRiY2xhc3MsXG4gICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICBlZGl0aW5nOiBudWxsLFxuICAgICAgICAgIGFkZEluZGV4OiAocmVzdWx0OiBTb3VyY2VDbGFzaWZpY2F0aW9uKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZUFsbCgpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdCA9IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QuZmlsdGVyKFxuICAgICAgICAgICAgICB2YWx1ZSA9PiB2YWx1ZS5pZCAhPSByZXN1bHQuaWQpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5wdXNoKHJlc3VsdCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRJbmRleGVzVG9Tb3VyY2UoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gIH1cblxuICBwdWJsaWMgZWRpdEluZGV4QWN0aW9uKGRiY2xhc3NJbmRleDogbnVtYmVyLCBlZGl0aW5nOiBTb3VyY2VDbGFzaWZpY2F0aW9uKSB7XG4gICAgY29uc3QgZGJjbGFzcyA9IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmNsYXNzO1xuICAgIGlmIChlZGl0aW5nKSB7XG4gICAgICAvLyB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0ID0gdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5maWx0ZXIoXG4gICAgICAvLyAgIHZhbHVlID0+IHZhbHVlLmlkICE9IGVkaXRpbmcuaWRcbiAgICAgIC8vICk7XG5cbiAgICAgIGNvbnN0IG9wdGlvbnM6IFRlcm1Ob2RlW10gPSB0aGlzLmRhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmNoaWxkcmVuLmZpbHRlcihcbiAgICAgICAgdmFsdWUgPT5cbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0LmZpbmQoZGIgPT4gZGIuaWQgPT0gdmFsdWUudGVybS51dWlkKSA9PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICB2YWx1ZS50ZXJtLnV1aWQgPT0gZWRpdGluZy5pZFxuICAgICAgKTtcbiAgICAgIGlmIChvcHRpb25zLmxlbmd0aCA+IDAgfHwgZWRpdGluZykge1xuICAgICAgICB0aGlzLmRpYWxvZy5vcGVuKFNvdXJjZUVkaXRBZGRJbmRleENvbXBvbmVudCwge1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGRiY2xhc3M6IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmNsYXNzLFxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgIGVkaXRpbmc6IGVkaXRpbmcsXG4gICAgICAgICAgICBhZGRJbmRleDogKHJlc3VsdDogU291cmNlQ2xhc2lmaWNhdGlvbikgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZUFsbCgpO1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScsdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdCk7XG5cbiAgICAgICAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWQgPSBbXTtcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmlkICE9IHJlc3VsdC5pZCAmJiBlbGVtZW50LmlkICE9IGVkaXRpbmcuaWQpe1xuICAgICAgICAgICAgICAgICAgbmV3U2VsZWN0ZWQucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0ID0gbmV3U2VsZWN0ZWQ7XG4gICAgICAgICAgICAgIC8vIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QgPSB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0LmZpbHRlcihcbiAgICAgICAgICAgICAgLy8gICB2YWx1ZSA9PiAodmFsdWUuaWQgPT0gcmVzdWx0LmlkICYmIHZhbHVlLmlkID09IGVkaXRpbmcuaWQpKTtcblxuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnKysrKysrKysrKysrKysrKysrKysrKycsdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdCk7XG5cbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5wdXNoKHJlc3VsdCk7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCcqKioqKioqKioqKioqKioqKioqKionLHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QpO1xuICAgICAgICAgICAgICB0aGlzLl9zZXRJbmRleGVzVG9Tb3VyY2UoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGRlbGV0ZUluZGV4QWN0aW9uKGRiY2xhc3NJbmRleDogbnVtYmVyLCB0b0RlbGV0ZTogU291cmNlQ2xhc2lmaWNhdGlvbikge1xuICAgIC8vIGNvbnNvbGUubG9nKCdERUxFVEUnLCB0b0RlbGV0ZSk7XG5cbiAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0ID0gdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5maWx0ZXIodmFsdWUgPT4gdmFsdWUuaWQgIT0gdG9EZWxldGUuaWQpO1xuICAgIHRoaXMuX3NldEluZGV4ZXNUb1NvdXJjZSgpO1xuICB9XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0b2NvLXNvdXJjZS1hZGRpbmRleFwiLFxuICBzdHlsZVVybHM6IFsnLi9zb3VyY2UtaW5kZXhlcy5jb21wb25lbnQuc2NzcyddLFxuICB0ZW1wbGF0ZTogYFxuICAgIDx0b2NvLWZvcm0tY29udGFpbmVyXG4gICAgICAjaW5kZXhQYW5lbENvbnRhaW5lclxuICAgICAgW3BhbmVsc0NvbnRlbnRdPVwiaW5kZXhQYW5lbFwiXG4gICAgICBbdXNlQWNjb3JkaW9uXT1cImZhbHNlXCJcbiAgICAgIGZ4TGF5b3V0PVwicm93XCJcbiAgICAgIFtmb3JtR3JvdXBdPVwiaW5kZXhGb3JtR3JvdXBcIlxuICAgICAgW2FjdGlvbl09XCJhZGRJbmRleEFjdGlvblwiXG4gICAgICBbYWN0aW9uTGFiZWxdPVwiJ09LJ1wiXG4gICAgICBbZGVsZXRlVmFsdWVzQWZ0ZXJBY3Rpb25dPVwiZmFsc2VcIlxuICAgID48L3RvY28tZm9ybS1jb250YWluZXI+XG4gIGAsXG59KVxuZXhwb3J0IGNsYXNzIFNvdXJjZUVkaXRBZGRJbmRleENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIGluZGV4UGFuZWw6IFBhbmVsQ29udGVudF9EZXByW10gPSBudWxsO1xuICBpbmRleEZvcm1Hcm91cDogRm9ybUdyb3VwO1xuXG4gIGFkZEluZGV4QWN0aW9uOiBGb3JtQ29udGFpbmVyQWN0aW9uO1xuXG4gIGRiY2xhc3M6IFRlcm07XG4gIG9wdGlvbnM6IFRlcm1Ob2RlW107XG4gIGVkaXRpbmc6IFNvdXJjZUNsYXNpZmljYXRpb24gPSBudWxsO1xuICBhZGRJbmRleDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHNlcnZpY2U6IFRheG9ub215U2VydmljZSxcbiAgICBwcml2YXRlIF9mb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgQEluamVjdChNQVRfRElBTE9HX0RBVEEpIHB1YmxpYyBkYXRhOiBhbnlcbiAgKSB7XG4gICAgLy8gY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICB0aGlzLmRiY2xhc3MgPSBkYXRhLmRiY2xhc3M7XG4gICAgdGhpcy5vcHRpb25zID0gZGF0YS5vcHRpb25zO1xuICAgIGlmIChkYXRhLmVkaXRpbmcpIHtcbiAgICAgIHRoaXMuZWRpdGluZyA9IGRhdGEuZWRpdGluZztcbiAgICB9XG4gICAgdGhpcy5hZGRJbmRleCA9IGRhdGEuYWRkSW5kZXg7XG5cblxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5pbmRleEZvcm1Hcm91cCA9IHRoaXMuX2Zvcm1CdWlsZGVyLmdyb3VwKHt9KTtcbiAgICBpZiAodGhpcy5kYmNsYXNzKSB7XG4gICAgICB0aGlzLmluZGV4UGFuZWwgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogKHRoaXMuZWRpdGluZykgPyAnRWRpdGFyJyA6ICdBZGljaW9uYXInLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcbiAgICAgICAgICBpY29uTmFtZTogJycsXG4gICAgICAgICAgZm9ybVNlY3Rpb246IHRoaXMuaW5kZXhGb3JtR3JvdXAsXG4gICAgICAgICAgZm9ybVNlY3Rpb25Db250ZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGZvcm1Db250cm9sOiBJbnB1dFRleHRDb21wb25lbnQuZ2V0Rm9ybUNvbnRyb2xCeURlZmF1bHQoKSxcbiAgICAgICAgICAgICAgbmFtZTogJ2luZGV4ZXMnLFxuICAgICAgICAgICAgICBsYWJlbDogdGhpcy5kYmNsYXNzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLnNlbGVjdF9leHByLFxuICAgICAgICAgICAgICBjb250cm9sVHlwZTogU2VsZWN0Q29tcG9uZW50LFxuICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICh0aGlzLmVkaXRpbmcpID8gdGhpcy5lZGl0aW5nLmlkIDogbnVsbCxcbiAgICAgICAgICAgICAgZXh0cmFDb250ZW50OiB7XG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGdldE9wdGlvbnM6IChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBvcHRzOiBTZWxlY3RPcHRpb25bXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG5vZGU6IFRlcm1Ob2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG9wdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG5vZGUudGVybS51dWlkLFxuICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBub2RlLnRlcm0uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gb3B0cztcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdGlvbkNoYW5nZTogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmb3JtQ29udHJvbDogSW5wdXRVcmxDb21wb25lbnQuZ2V0Rm9ybUNvbnRyb2xCeURlZmF1bHQoKSxcbiAgICAgICAgICAgICAgbmFtZTogJ3VybCcsXG4gICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcbiAgICAgICAgICAgICAgdHlwZTogRm9ybUZpZWxkVHlwZS51cmwsXG4gICAgICAgICAgICAgIGNvbnRyb2xUeXBlOiBJbnB1dFVybENvbXBvbmVudCxcbiAgICAgICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBzdGFydEhpbnQ6IG5ldyBIaW50VmFsdWUoXG4gICAgICAgICAgICAgICAgSGludFBvc2l0aW9uLnN0YXJ0LFxuICAgICAgICAgICAgICAgICdVUkwgZGUgbGEgcmV2aXN0YSBlbiBlbCDDrW5kaWNlLidcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICh0aGlzLmVkaXRpbmcpID8gW3RoaXMuZWRpdGluZy5kYXRhWyd1cmwnXV0gOiAnJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGZvcm1Db250cm9sOiBJbnB1dFRleHRDb21wb25lbnQuZ2V0Rm9ybUNvbnRyb2xCeURlZmF1bHQoKSxcbiAgICAgICAgICAgICAgbmFtZTogJ2luaXRpYWxfY292ZXInLFxuICAgICAgICAgICAgICBsYWJlbDogJ0NvYmVydHVyYSBpbmljaW8nLFxuICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLnRleHQsXG4gICAgICAgICAgICAgIGNvbnRyb2xUeXBlOiBJbnB1dFRleHRDb21wb25lbnQsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgc3RhcnRIaW50OiBuZXcgSGludFZhbHVlKEhpbnRQb3NpdGlvbi5zdGFydCwgJycpLFxuICAgICAgICAgICAgICB3aWR0aDogJzQ1JScsXG4gICAgICAgICAgICAgIHZhbHVlOiAodGhpcy5lZGl0aW5nKSA/IFt0aGlzLmVkaXRpbmcuZGF0YVsnaW5pdGlhbF9jb3ZlciddXSA6ICcnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZm9ybUNvbnRyb2w6IElucHV0VGV4dENvbXBvbmVudC5nZXRGb3JtQ29udHJvbEJ5RGVmYXVsdCgpLFxuICAgICAgICAgICAgICBuYW1lOiAnZW5kX2NvdmVyJyxcbiAgICAgICAgICAgICAgbGFiZWw6ICdDb2JlcnR1cmEnLFxuICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLnRleHQsXG4gICAgICAgICAgICAgIGNvbnRyb2xUeXBlOiBJbnB1dFRleHRDb21wb25lbnQsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgc3RhcnRIaW50OiBuZXcgSGludFZhbHVlKEhpbnRQb3NpdGlvbi5zdGFydCwgJycpLFxuICAgICAgICAgICAgICB3aWR0aDogJzQ1JScsXG4gICAgICAgICAgICAgIHZhbHVlOiAodGhpcy5lZGl0aW5nKSA/IFt0aGlzLmVkaXRpbmcuZGF0YVsnZW5kX2NvdmVyJ11dIDogJycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgIH1cblxuXG4gICAgdGhpcy5hZGRJbmRleEFjdGlvbiA9IHtcbiAgICAgIGRvaXQ6IChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuaW5kZXhGb3JtR3JvdXAudmFsaWQpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgU291cmNlQ2xhc2lmaWNhdGlvbigpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuaW5kZXhGb3JtR3JvdXApO1xuXG4gICAgICAgICAgaWYgKHRoaXMuaW5kZXhGb3JtR3JvdXAuY29udHJvbHNbJ2luZGV4ZXMnXS52YWx1ZSkge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMub3B0aW9ucy5maW5kKHZhbHVlID0+IHZhbHVlLnRlcm0udXVpZCA9PSB0aGlzLmluZGV4Rm9ybUdyb3VwLmNvbnRyb2xzWydpbmRleGVzJ10udmFsdWUpO1xuICAgICAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgICAgcmVzdWx0LnZvY2FidWxhcnkgPSBub2RlLnRlcm0udm9jYWJ1bGFyeV9pZDtcbiAgICAgICAgICAgICAgcmVzdWx0LmRlc2NyaXB0aW9uID0gbm9kZS50ZXJtLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICByZXN1bHQuaWQgPSBub2RlLnRlcm0udXVpZDtcbiAgICAgICAgICAgICAgcmVzdWx0LmRhdGEgPSB7XG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLmluZGV4Rm9ybUdyb3VwLmNvbnRyb2xzWyd1cmwnXS52YWx1ZSxcbiAgICAgICAgICAgICAgICBpbml0aWFsX2NvdmVyOiB0aGlzLmluZGV4Rm9ybUdyb3VwLmNvbnRyb2xzWydpbml0aWFsX2NvdmVyJ10udmFsdWUsXG4gICAgICAgICAgICAgICAgZW5kX2NvdmVyOiB0aGlzLmluZGV4Rm9ybUdyb3VwLmNvbnRyb2xzWydlbmRfY292ZXInXS52YWx1ZSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgdGhpcy5hZGRJbmRleChyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9LFxuICAgIH07XG4gIH1cbn1cbiJdfQ==