/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/source-edit/source-organizations/source-organizations.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Inject } from "@angular/core";
import { MatDialogRef, MAT_DIALOG_DATA, MatDialog } from "@angular/material";
import { OrganizationServiceNoAuth } from '../../../backend/public-api';
import { MessageHandler, StatusCode, HandlerComponent } from '../../../core/public-api';
import { SourceData, Organization, SourceOrganizationRole, SourceOrganization, OrganizationRelationships } from '../../../entities/public-api';
export class SourceOrganizationsComponent {
    /**
     * @param {?} dialog
     * @param {?} orgService
     */
    constructor(dialog, orgService) {
        this.dialog = dialog;
        this.orgService = orgService;
        this.editable = true;
        this.topMainOrganization = null;
        this.roles = SourceOrganizationRole;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        console.log(this.sourceData.organizations);
        this.sourceData.organizations = this.sourceData.organizations.filter((/**
         * @param {?} element
         * @return {?}
         */
        (element) => element && element.role));
        console.log(this.sourceData.organizations);
    }
    /**
     * @param {?=} cuban
     * @param {?=} topMain
     * @return {?}
     */
    addOrg(cuban = true, topMain = false) {
        if (topMain && this.topMainOrganization) {
            this.dialog.open(SourceOrganizationSelectTopDialog, {
                width: "500px",
                data: {
                    topMainOrganization: this.topMainOrganization,
                    selectOrg: (/**
                     * @param {?} org
                     * @param {?} parents
                     * @return {?}
                     */
                    (org, parents) => {
                        this.addOrgToSource(org, SourceOrganizationRole.MAIN.value);
                        parents.forEach((/**
                         * @param {?} element
                         * @return {?}
                         */
                        (element) => {
                            this.addOrgToSource(element, SourceOrganizationRole.COLABORATOR.value);
                        }));
                    }),
                },
            });
        }
        else {
            this.dialog.open(SourceOrganizationSelectDialog, {
                width: "500px",
                data: {
                    filter: cuban ? { type: "country", value: "Cuba" } : null,
                    canSelectRole: this.topMainOrganization == null,
                    selectOrg: (/**
                     * @param {?} org
                     * @param {?} role
                     * @param {?} parents
                     * @return {?}
                     */
                    (org, role, parents) => {
                        this.addOrgToSource(org, role);
                        parents.forEach((/**
                         * @param {?} element
                         * @return {?}
                         */
                        (element) => {
                            this.addOrgToSource(element, SourceOrganizationRole.COLABORATOR.value);
                        }));
                    }),
                },
            });
        }
    }
    /**
     * @private
     * @param {?} org
     * @param {?} role
     * @return {?}
     */
    addOrgToSource(org, role) {
        if (!this.sourceData.organizations.find((/**
         * @param {?} o
         * @return {?}
         */
        (o) => o.id == org.id))) {
            /** @type {?} */
            let selected = new SourceOrganization();
            selected.deepcopy(org);
            selected.role = role;
            this.sourceData.organizations.push(selected);
            if (SourceOrganizationRole.MAIN.value == role) {
                this.setAsMain(org);
            }
        }
    }
    /**
     * @param {?} organization
     * @return {?}
     */
    setAsMain(organization) {
        this.sourceData.organizations.forEach((/**
         * @param {?} element
         * @return {?}
         */
        (element) => {
            if (organization.id == element.id) {
                element.role = SourceOrganizationRole.MAIN.value;
            }
            else {
                element.role = SourceOrganizationRole.COLABORATOR.value;
            }
        }));
    }
    /**
     * @param {?} index
     * @return {?}
     */
    removeInst(index) {
        /** @type {?} */
        const organization = this.sourceData.organizations[index];
        /** @type {?} */
        const m = new MessageHandler(null, this.dialog);
        /** @type {?} */
        const child = this.childToRemove(organization);
        if (child == null) {
            /** @type {?} */
            let parents = this.getOrgToDelete(organization);
            /** @type {?} */
            let toDelete = [];
            /** @type {?} */
            let msg = "";
            for (let i = 0; i < parents.length; i++) {
                /** @type {?} */
                const element = parents[i];
                toDelete.push(this.sourceData.organizations[element]);
                msg += this.sourceData.organizations[element].name + ", ";
            }
            toDelete.push(organization);
            console.log(toDelete);
            if (toDelete.length > 0) {
                m.showMessage(StatusCode.OK, msg, HandlerComponent.dialog, "Se eliminó también: ");
            }
            /** @type {?} */
            let orgs = [];
            for (let i = 0; i < this.sourceData.organizations.length; i++) {
                if (!toDelete.find((/**
                 * @param {?} o
                 * @return {?}
                 */
                (o) => o.id == this.sourceData.organizations[i].id))) {
                    orgs.push(this.sourceData.organizations[i]);
                }
            }
            console.log(orgs);
            this.sourceData.organizations = orgs;
            // this.sourceData.organizations = this.sourceData.organizations.filter(
            //   (o) => o.id != organization.id
            // );
        }
        else {
            m.showMessage(StatusCode.OK, child.name, HandlerComponent.dialog, "Para eliminar este elemento debe eliminar:");
        }
    }
    /**
     * @private
     * @param {?} org
     * @return {?}
     */
    childToRemove(org) {
        // se puede eliminar si no tiene hijos en el sourceData.organizations
        /** @type {?} */
        let result = true;
        if (org.relationships) {
            for (let index = 0; index < org.relationships.length; index++) {
                /** @type {?} */
                const element = org.relationships[index];
                if (element.type == OrganizationRelationships.CHILD.value) {
                    /** @type {?} */
                    const childIndex = this.getIndexByPid(element.identifiers[0].value);
                    if (childIndex != null) {
                        return this.sourceData.organizations[childIndex];
                    }
                }
            }
            return null;
        }
    }
    // removeInst(index) {
    //   let toDelete = []
    //   toDelete.push(index);
    //   toDelete.concat(this.getOrgToDelete(this.sourceData.organizations[index]));
    //   let orgs = [];
    //   for (let i = 0; i < this.sourceData.organizations.length; i++) {
    //     if(!toDelete.find((o) => o == i)){
    //       orgs.push(this.sourceData.organizations[i]);
    //     }
    //   }
    //   this.sourceData.organizations = orgs;
    // }
    /**
     * @private
     * @param {?} org
     * @return {?}
     */
    getOrgToDelete(org) {
        /** @type {?} */
        let toDelete = [];
        if (org.relationships) {
            org.relationships.forEach((/**
             * @param {?} element
             * @return {?}
             */
            (element) => {
                if (element.type == OrganizationRelationships.PARENT.value) {
                    /** @type {?} */
                    const parentIndex = this.getIndexByPid(element.identifiers[0].value);
                    if (parentIndex) {
                        toDelete.push(parentIndex);
                        toDelete.concat(this.getOrgToDelete(this.sourceData.organizations[parentIndex]));
                    }
                }
            }));
        }
        return toDelete;
    }
    /**
     * @private
     * @param {?} pid
     * @return {?}
     */
    getIndexByPid(pid) {
        for (let index = 0; index < this.sourceData.organizations.length; index++) {
            /** @type {?} */
            const element = this.sourceData.organizations[index];
            for (let pidindex = 0; pidindex < element.identifiers.length; pidindex++) {
                /** @type {?} */
                const identifier = element.identifiers[pidindex];
                console.log(identifier.value + "==" + pid);
                if (identifier.value == pid) {
                    console.log(identifier.value + "==" + pid + "  iguales!!!");
                    return index;
                }
            }
        }
        return null;
    }
}
SourceOrganizationsComponent.decorators = [
    { type: Component, args: [{
                selector: "toco-source-organizations",
                template: "<ng-container>\n  <mat-toolbar\n    *ngIf=\"editable\"\n    fxLayout=\"row wrap\"\n    fxLayoutAlign=\"space-between center\"\n    fxLayoutGap=\"20px\"\n  >\n    <span>Adicionar</span>\n    <div\n      fxLayout=\"row wrap\"\n      fxLayoutAlign=\"space-between center\"\n      fxLayoutGap=\"20px\"\n    >\n    <button *ngIf=\"topMainOrganization\" mat-raised-button (click)=\"addOrg(true, true)\">\n      Organizaci\u00F3n Principal\n    </button>\n      <button mat-raised-button (click)=\"addOrg(true)\">\n        Organizaciones Cubanas\n      </button>\n      <button mat-raised-button (click)=\"addOrg(false)\">\n        Otras\n      </button>\n    </div>\n  </mat-toolbar>\n\n  \n  <mat-accordion>\n    <mat-expansion-panel\n      *ngFor=\"let org of sourceData.organizations; let index = index\"\n      [expanded]=\"false\"\n    >\n      <mat-expansion-panel-header>\n        <mat-panel-title>\n          {{ roles[org.role].label }}\n        </mat-panel-title>\n        <mat-panel-description>\n          {{ org.name }}\n        </mat-panel-description>\n      </mat-expansion-panel-header>\n      <mat-action-row *ngIf=\"editable\">\n        <button\n          mat-stroked-button\n          [disabled]=\"org.length === 1\"\n          (click)=\"setAsMain(org)\"\n          *ngIf=\"!topMainOrganization\"\n        >\n          Establecer como Principal\n        </button>\n        <button\n          mat-stroked-button\n          [disabled]=\"org.length === 1\"\n          (click)=\"removeInst(index)\"\n        >\n          Eliminar\n        </button>\n      </mat-action-row>\n      <toco-org-view [org]=\"org\" [showContent]=\"false\"></toco-org-view>\n    </mat-expansion-panel>\n  </mat-accordion>\n</ng-container>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
SourceOrganizationsComponent.ctorParameters = () => [
    { type: MatDialog },
    { type: OrganizationServiceNoAuth }
];
SourceOrganizationsComponent.propDecorators = {
    sourceData: [{ type: Input }],
    editable: [{ type: Input }],
    topMainOrganization: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    SourceOrganizationsComponent.prototype.sourceData;
    /** @type {?} */
    SourceOrganizationsComponent.prototype.editable;
    /** @type {?} */
    SourceOrganizationsComponent.prototype.topMainOrganization;
    /** @type {?} */
    SourceOrganizationsComponent.prototype.roles;
    /** @type {?} */
    SourceOrganizationsComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    SourceOrganizationsComponent.prototype.orgService;
}
export class SourceOrganizationSelectTopDialog {
    /**
     * @param {?} dialogRef
     * @param {?} data
     * @param {?} orgService
     */
    constructor(dialogRef, data, orgService) {
        this.dialogRef = dialogRef;
        this.data = data;
        this.orgService = orgService;
        this.topMainOrganization = null;
        this.toSelect = null;
        this.selected = -1;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.topMainOrganization = this.data.topMainOrganization;
        this.toSelect = new Array();
        this.topMainOrganization.relationships.forEach((/**
         * @param {?} element
         * @return {?}
         */
        (element) => {
            if (element.type == OrganizationRelationships.CHILD.value) {
                this.toSelect.push(element);
            }
        }));
        console.log(this.toSelect);
    }
    /**
     * @return {?}
     */
    onNoClick() {
        this.dialogRef.close();
    }
    /**
     * @return {?}
     */
    ok() {
        // let selected = new SourceOrganization()
        // selected.organization = org;
        // selected.role = SourceOrganizationRole.MAIN.value;
        if (this.selected >= 0) {
            console.log(this.toSelect[this.selected]);
            this.orgService
                .getOrganizationByPID(this.toSelect[this.selected].identifiers[0].value)
                .subscribe({
                next: (/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    this.data.selectOrg(response.metadata, [this.topMainOrganization]);
                    this.dialogRef.close();
                }),
            });
        }
    }
}
SourceOrganizationSelectTopDialog.decorators = [
    { type: Component, args: [{
                selector: "toco-source-organizations-select-top-main",
                template: `<mat-dialog-content class="height-auto">
    <ng-container *ngIf="toSelect"
      >{{ topMainOrganization.name }}
      <br />
      <mat-form-field>
        <mat-label>Seleccione la Organización Principal: </mat-label>
        <mat-select [(value)]="selected" required>
          <mat-option
            *ngFor="let item of toSelect; let index = index"
            value="{{ index }}"
            >{{ item.label }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <br />
      <mat-label *ngIf="selected >= 0">{{
        toSelect[selected].label
      }}</mat-label>
      <br />
    </ng-container>
    <br />
    <button mat-raised-button (click)="ok()">OK</button>
  </mat-dialog-content>`
            }] }
];
/** @nocollapse */
SourceOrganizationSelectTopDialog.ctorParameters = () => [
    { type: MatDialogRef },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] },
    { type: OrganizationServiceNoAuth }
];
if (false) {
    /** @type {?} */
    SourceOrganizationSelectTopDialog.prototype.topMainOrganization;
    /** @type {?} */
    SourceOrganizationSelectTopDialog.prototype.toSelect;
    /** @type {?} */
    SourceOrganizationSelectTopDialog.prototype.selected;
    /** @type {?} */
    SourceOrganizationSelectTopDialog.prototype.dialogRef;
    /** @type {?} */
    SourceOrganizationSelectTopDialog.prototype.data;
    /**
     * @type {?}
     * @private
     */
    SourceOrganizationSelectTopDialog.prototype.orgService;
}
export class SourceOrganizationSelectDialog {
    /**
     * @param {?} dialogRef
     * @param {?} data
     * @param {?} orgService
     */
    constructor(dialogRef, data, orgService) {
        this.dialogRef = dialogRef;
        this.data = data;
        this.orgService = orgService;
        this.roles = [
            { label: "Principal", value: "MAIN" },
            { label: "Colaborador", value: "COLABORATOR" },
        ];
        this.role = null;
        this.parents = new Array();
        this.placeholder = "Buscar una organización";
        this.canSelectRole = true;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        console.log(this.data);
        this.canSelectRole = this.data.canSelectRole;
        if (this.data.filter) {
            this.placeholder = "Buscar una organización cubana";
        }
    }
    /**
     * @return {?}
     */
    onNoClick() {
        this.dialogRef.close();
    }
    /**
     * @param {?=} org
     * @return {?}
     */
    selectedOrg(org) {
        console.log(org);
        this.org = org;
        this.addParent(this.org);
    }
    /**
     * @private
     * @param {?} child
     * @return {?}
     */
    addParent(child) {
        child.relationships.forEach((/**
         * @param {?} p
         * @return {?}
         */
        (p) => {
            if (p.type == OrganizationRelationships.PARENT.value) {
                if (p.identifiers.length > 0 && p.identifiers[0].value) {
                    this.orgService
                        .getOrganizationByPID(p.identifiers[0].value)
                        .subscribe({
                        next: (/**
                         * @param {?} response
                         * @return {?}
                         */
                        (response) => {
                            console.log(response);
                            this.parents.push(response.metadata);
                            this.addParent(response.metadata);
                        }),
                    });
                }
            }
        }));
    }
    /**
     * @return {?}
     */
    ok() {
        // let selected = new SourceOrganization()
        // selected.organization = org;
        // selected.role = SourceOrganizationRole.MAIN.value;
        if (this.canSelectRole) {
            if (this.role) {
                this.data.selectOrg(this.org, this.role, this.parents);
                this.dialogRef.close();
            }
        }
        else {
            this.data.selectOrg(this.org, SourceOrganizationRole.COLABORATOR.value, this.parents);
            this.dialogRef.close();
        }
    }
}
SourceOrganizationSelectDialog.decorators = [
    { type: Component, args: [{
                selector: "toco-source-organizations-select-dialog",
                template: `<mat-dialog-content class="height-auto">
    <toco-org-search
      [orgFilter]="data.filter"
      (selectedOrg)="selectedOrg($event)"
      [placeholder]="placeholder"
    >
    </toco-org-search>
    <br />
    <mat-label *ngIf="org">{{ org.name }}</mat-label>
    <br />
    <mat-form-field *ngIf="canSelectRole">
      <mat-label>Rol</mat-label>
      <mat-select [(value)]="role" required>
        <mat-option *ngFor="let item of roles" value="{{ item.value }}">{{
          item.label
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <br />

    <ng-container *ngIf="parents.length > 0">
      <mat-label>Se añadirá también: </mat-label>
      <ng-container *ngFor="let item of parents">
        <br />
        <mat-label>{{ item.name }}</mat-label>
        <br />
      </ng-container>
      <br />
    </ng-container>

    <button mat-raised-button (click)="ok()">OK</button>
  </mat-dialog-content>`
            }] }
];
/** @nocollapse */
SourceOrganizationSelectDialog.ctorParameters = () => [
    { type: MatDialogRef },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] },
    { type: OrganizationServiceNoAuth }
];
if (false) {
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.roles;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.role;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.org;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.parents;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.placeholder;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.canSelectRole;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.dialogRef;
    /** @type {?} */
    SourceOrganizationSelectDialog.prototype.data;
    /**
     * @type {?}
     * @private
     */
    SourceOrganizationSelectDialog.prototype.orgService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlLW9yZ2FuaXphdGlvbnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvc291cmNlcy9zb3VyY2UtZWRpdC9zb3VyY2Utb3JnYW5pemF0aW9ucy9zb3VyY2Utb3JnYW5pemF0aW9ucy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakUsT0FBTyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDN0UsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDeEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN4RixPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxzQkFBc0IsRUFBRSxrQkFBa0IsRUFBRSx5QkFBeUIsRUFBZ0IsTUFBTSw4QkFBOEIsQ0FBQztBQVE3SixNQUFNLE9BQU8sNEJBQTRCOzs7OztJQVd2QyxZQUNTLE1BQWlCLEVBQ2hCLFVBQXFDO1FBRHRDLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDaEIsZUFBVSxHQUFWLFVBQVUsQ0FBMkI7UUFSeEMsYUFBUSxHQUFZLElBQUksQ0FBQztRQUd6Qix3QkFBbUIsR0FBaUIsSUFBSSxDQUFDO1FBRXpDLFVBQUssR0FBRyxzQkFBc0IsQ0FBQztJQUluQyxDQUFDOzs7O0lBRUosUUFBUTtRQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxNQUFNOzs7O1FBQ2xFLENBQUMsT0FBTyxFQUFF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O3dCQUNwQyxDQUFDLENBQUE7cUJBQ0YsQ0FBQyxDQUFDO2lCQUNOO2FBQ0Y7UUFDSCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFDTSxFQUFFO1FBQ1AsMENBQTBDO1FBQzFDLCtCQUErQjtRQUMvQixxREFBcUQ7UUFDckQsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDYixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN2RCxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ3hCO1NBQ0Y7YUFBTTtZQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUNqQixJQUFJLENBQUMsR0FBRyxFQUNSLHNCQUFzQixDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQ3hDLElBQUksQ0FBQyxPQUFPLENBQ2IsQ0FBQztZQUNGLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDeEI7SUFDSCxDQUFDOzs7WUF2R0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSx5Q0FBeUM7Z0JBQ25ELFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7d0JBZ0NZO2FBQ3ZCOzs7O1lBN1RRLFlBQVk7NENBaVVoQixNQUFNLFNBQUMsZUFBZTtZQWhVbEIseUJBQXlCOzs7O0lBb1VoQywrQ0FHRTs7SUFDRiw4Q0FBbUI7O0lBQ25CLDZDQUF5Qjs7SUFDekIsaURBQWdFOztJQUNoRSxxREFBd0M7O0lBQ3hDLHVEQUE0Qjs7SUFiMUIsbURBQThEOztJQUM5RCw4Q0FBeUM7Ozs7O0lBQ3pDLG9EQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgSW5qZWN0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcblxuaW1wb3J0IHsgTWF0RGlhbG9nUmVmLCBNQVRfRElBTE9HX0RBVEEsIE1hdERpYWxvZyB9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbFwiO1xuaW1wb3J0IHsgT3JnYW5pemF0aW9uU2VydmljZU5vQXV0aCB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBNZXNzYWdlSGFuZGxlciwgU3RhdHVzQ29kZSwgSGFuZGxlckNvbXBvbmVudCB9IGZyb20gJy4uLy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBTb3VyY2VEYXRhLCBPcmdhbml6YXRpb24sIFNvdXJjZU9yZ2FuaXphdGlvblJvbGUsIFNvdXJjZU9yZ2FuaXphdGlvbiwgT3JnYW5pemF0aW9uUmVsYXRpb25zaGlwcywgUmVsYXRpb25zaGlwIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRvY28tc291cmNlLW9yZ2FuaXphdGlvbnNcIixcbiAgdGVtcGxhdGVVcmw6IFwiLi9zb3VyY2Utb3JnYW5pemF0aW9ucy5jb21wb25lbnQuaHRtbFwiLFxuICBzdHlsZVVybHM6IFtcIi4vc291cmNlLW9yZ2FuaXphdGlvbnMuY29tcG9uZW50LnNjc3NcIl0sXG59KVxuZXhwb3J0IGNsYXNzIFNvdXJjZU9yZ2FuaXphdGlvbnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKVxuICBwdWJsaWMgc291cmNlRGF0YTogU291cmNlRGF0YTtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgZWRpdGFibGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyB0b3BNYWluT3JnYW5pemF0aW9uOiBPcmdhbml6YXRpb24gPSBudWxsO1xuXG4gIHB1YmxpYyByb2xlcyA9IFNvdXJjZU9yZ2FuaXphdGlvblJvbGU7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBkaWFsb2c6IE1hdERpYWxvZyxcbiAgICBwcml2YXRlIG9yZ1NlcnZpY2U6IE9yZ2FuaXphdGlvblNlcnZpY2VOb0F1dGhcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbnNvbGUubG9nKHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zKTtcbiAgICB0aGlzLnNvdXJjZURhdGEub3JnYW5pemF0aW9ucyA9IHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zLmZpbHRlcihcbiAgICAgIChlbGVtZW50KSA9PiBlbGVtZW50ICYmIGVsZW1lbnQucm9sZVxuICAgICk7XG4gICAgY29uc29sZS5sb2codGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnMpO1xuICB9XG5cbiAgYWRkT3JnKGN1YmFuID0gdHJ1ZSwgdG9wTWFpbiA9IGZhbHNlKSB7XG4gICAgaWYgKHRvcE1haW4gJiYgdGhpcy50b3BNYWluT3JnYW5pemF0aW9uKSB7XG4gICAgICB0aGlzLmRpYWxvZy5vcGVuKFNvdXJjZU9yZ2FuaXphdGlvblNlbGVjdFRvcERpYWxvZywge1xuICAgICAgICB3aWR0aDogXCI1MDBweFwiLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdG9wTWFpbk9yZ2FuaXphdGlvbjogdGhpcy50b3BNYWluT3JnYW5pemF0aW9uLFxuICAgICAgICAgIHNlbGVjdE9yZzogKG9yZzogT3JnYW5pemF0aW9uLCBwYXJlbnRzOiBBcnJheTxPcmdhbml6YXRpb24+KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFkZE9yZ1RvU291cmNlKG9yZywgU291cmNlT3JnYW5pemF0aW9uUm9sZS5NQUlOLnZhbHVlKTtcbiAgICAgICAgICAgIHBhcmVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmFkZE9yZ1RvU291cmNlKFxuICAgICAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgU291cmNlT3JnYW5pemF0aW9uUm9sZS5DT0xBQk9SQVRPUi52YWx1ZVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRpYWxvZy5vcGVuKFNvdXJjZU9yZ2FuaXphdGlvblNlbGVjdERpYWxvZywge1xuICAgICAgICB3aWR0aDogXCI1MDBweFwiLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZmlsdGVyOiBjdWJhbiA/IHsgdHlwZTogXCJjb3VudHJ5XCIsIHZhbHVlOiBcIkN1YmFcIiB9IDogbnVsbCxcbiAgICAgICAgICBjYW5TZWxlY3RSb2xlOiB0aGlzLnRvcE1haW5Pcmdhbml6YXRpb24gPT0gbnVsbCxcbiAgICAgICAgICBzZWxlY3RPcmc6IChcbiAgICAgICAgICAgIG9yZzogT3JnYW5pemF0aW9uLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIHBhcmVudHM6IEFycmF5PE9yZ2FuaXphdGlvbj5cbiAgICAgICAgICApID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWRkT3JnVG9Tb3VyY2Uob3JnLCByb2xlKTtcbiAgICAgICAgICAgIHBhcmVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmFkZE9yZ1RvU291cmNlKFxuICAgICAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgU291cmNlT3JnYW5pemF0aW9uUm9sZS5DT0xBQk9SQVRPUi52YWx1ZVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIGFkZE9yZ1RvU291cmNlKG9yZzogT3JnYW5pemF0aW9uLCByb2xlKSB7XG4gICAgaWYgKCF0aGlzLnNvdXJjZURhdGEub3JnYW5pemF0aW9ucy5maW5kKChvKSA9PiBvLmlkID09IG9yZy5pZCkpIHtcbiAgICAgIGxldCBzZWxlY3RlZCA9IG5ldyBTb3VyY2VPcmdhbml6YXRpb24oKTtcbiAgICAgIHNlbGVjdGVkLmRlZXBjb3B5KG9yZyk7XG4gICAgICBzZWxlY3RlZC5yb2xlID0gcm9sZTtcbiAgICAgIHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zLnB1c2goc2VsZWN0ZWQpO1xuICAgICAgaWYgKFNvdXJjZU9yZ2FuaXphdGlvblJvbGUuTUFJTi52YWx1ZSA9PSByb2xlKSB7XG4gICAgICAgIHRoaXMuc2V0QXNNYWluKG9yZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHNldEFzTWFpbihvcmdhbml6YXRpb246IE9yZ2FuaXphdGlvbikge1xuICAgIHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGlmIChvcmdhbml6YXRpb24uaWQgPT0gZWxlbWVudC5pZCkge1xuICAgICAgICBlbGVtZW50LnJvbGUgPSBTb3VyY2VPcmdhbml6YXRpb25Sb2xlLk1BSU4udmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LnJvbGUgPSBTb3VyY2VPcmdhbml6YXRpb25Sb2xlLkNPTEFCT1JBVE9SLnZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlSW5zdChpbmRleCkge1xuICAgIGNvbnN0IG9yZ2FuaXphdGlvbiA9IHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zW2luZGV4XTtcbiAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKG51bGwsIHRoaXMuZGlhbG9nKTtcbiAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRUb1JlbW92ZShvcmdhbml6YXRpb24pO1xuICAgIGlmIChjaGlsZCA9PSBudWxsKSB7XG4gICAgICBsZXQgcGFyZW50cyA9IHRoaXMuZ2V0T3JnVG9EZWxldGUob3JnYW5pemF0aW9uKTtcbiAgICAgIGxldCB0b0RlbGV0ZSA9IFtdO1xuICAgICAgbGV0IG1zZyA9IFwiXCI7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHBhcmVudHNbaV07XG4gICAgICAgIHRvRGVsZXRlLnB1c2godGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbZWxlbWVudF0pO1xuICAgICAgICBtc2cgKz0gdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbZWxlbWVudF0ubmFtZSArIFwiLCBcIjtcbiAgICAgIH1cbiAgICAgIHRvRGVsZXRlLnB1c2gob3JnYW5pemF0aW9uKTtcbiAgICAgIGNvbnNvbGUubG9nKHRvRGVsZXRlKTtcbiAgICAgIGlmKHRvRGVsZXRlLmxlbmd0aD4wKXtcbiAgICAgICAgbS5zaG93TWVzc2FnZShcbiAgICAgICAgICBTdGF0dXNDb2RlLk9LLFxuICAgICAgICAgIG1zZyxcbiAgICAgICAgICBIYW5kbGVyQ29tcG9uZW50LmRpYWxvZyxcbiAgICAgICAgICBcIlNlIGVsaW1pbsOzIHRhbWJpw6luOiBcIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBsZXQgb3JncyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNvdXJjZURhdGEub3JnYW5pemF0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIXRvRGVsZXRlLmZpbmQoKG8pID0+IG8uaWQgPT0gdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbaV0uaWQpXG4gICAgICAgICkge1xuICAgICAgICAgIG9yZ3MucHVzaCh0aGlzLnNvdXJjZURhdGEub3JnYW5pemF0aW9uc1tpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKG9yZ3MpO1xuICAgICAgdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnMgPSBvcmdzO1xuICAgICAgLy8gdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnMgPSB0aGlzLnNvdXJjZURhdGEub3JnYW5pemF0aW9ucy5maWx0ZXIoXG4gICAgICAvLyAgIChvKSA9PiBvLmlkICE9IG9yZ2FuaXphdGlvbi5pZFxuICAgICAgLy8gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbS5zaG93TWVzc2FnZShcbiAgICAgICAgU3RhdHVzQ29kZS5PSyxcbiAgICAgICAgY2hpbGQubmFtZSxcbiAgICAgICAgSGFuZGxlckNvbXBvbmVudC5kaWFsb2csXG4gICAgICAgIFwiUGFyYSBlbGltaW5hciBlc3RlIGVsZW1lbnRvIGRlYmUgZWxpbWluYXI6XCJcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGlsZFRvUmVtb3ZlKG9yZzogT3JnYW5pemF0aW9uKSB7XG4gICAgLy8gc2UgcHVlZGUgZWxpbWluYXIgc2kgbm8gdGllbmUgaGlqb3MgZW4gZWwgc291cmNlRGF0YS5vcmdhbml6YXRpb25zXG4gICAgbGV0IHJlc3VsdCA9IHRydWU7XG5cbiAgICBpZiAob3JnLnJlbGF0aW9uc2hpcHMpIHtcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBvcmcucmVsYXRpb25zaGlwcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IG9yZy5yZWxhdGlvbnNoaXBzW2luZGV4XTtcbiAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PSBPcmdhbml6YXRpb25SZWxhdGlvbnNoaXBzLkNISUxELnZhbHVlKSB7XG4gICAgICAgICAgY29uc3QgY2hpbGRJbmRleCA9IHRoaXMuZ2V0SW5kZXhCeVBpZChlbGVtZW50LmlkZW50aWZpZXJzWzBdLnZhbHVlKTtcbiAgICAgICAgICBpZiAoY2hpbGRJbmRleCAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbY2hpbGRJbmRleF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgLy8gcmVtb3ZlSW5zdChpbmRleCkge1xuICAvLyAgIGxldCB0b0RlbGV0ZSA9IFtdXG4gIC8vICAgdG9EZWxldGUucHVzaChpbmRleCk7XG4gIC8vICAgdG9EZWxldGUuY29uY2F0KHRoaXMuZ2V0T3JnVG9EZWxldGUodGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbaW5kZXhdKSk7XG4gIC8vICAgbGV0IG9yZ3MgPSBbXTtcbiAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gIC8vICAgICBpZighdG9EZWxldGUuZmluZCgobykgPT4gbyA9PSBpKSl7XG4gIC8vICAgICAgIG9yZ3MucHVzaCh0aGlzLnNvdXJjZURhdGEub3JnYW5pemF0aW9uc1tpXSk7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIHRoaXMuc291cmNlRGF0YS5vcmdhbml6YXRpb25zID0gb3JncztcbiAgLy8gfVxuXG4gIHByaXZhdGUgZ2V0T3JnVG9EZWxldGUob3JnOiBPcmdhbml6YXRpb24pIHtcbiAgICBsZXQgdG9EZWxldGUgPSBbXTtcbiAgICBpZiAob3JnLnJlbGF0aW9uc2hpcHMpIHtcbiAgICAgIG9yZy5yZWxhdGlvbnNoaXBzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PSBPcmdhbml6YXRpb25SZWxhdGlvbnNoaXBzLlBBUkVOVC52YWx1ZSkge1xuICAgICAgICAgIGNvbnN0IHBhcmVudEluZGV4ID0gdGhpcy5nZXRJbmRleEJ5UGlkKGVsZW1lbnQuaWRlbnRpZmllcnNbMF0udmFsdWUpO1xuICAgICAgICAgIGlmIChwYXJlbnRJbmRleCkge1xuICAgICAgICAgICAgdG9EZWxldGUucHVzaChwYXJlbnRJbmRleCk7XG4gICAgICAgICAgICB0b0RlbGV0ZS5jb25jYXQoXG4gICAgICAgICAgICAgIHRoaXMuZ2V0T3JnVG9EZWxldGUodGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbcGFyZW50SW5kZXhdKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0b0RlbGV0ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SW5kZXhCeVBpZChwaWQpIHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5zb3VyY2VEYXRhLm9yZ2FuaXphdGlvbnNbaW5kZXhdO1xuICAgICAgZm9yIChcbiAgICAgICAgbGV0IHBpZGluZGV4ID0gMDtcbiAgICAgICAgcGlkaW5kZXggPCBlbGVtZW50LmlkZW50aWZpZXJzLmxlbmd0aDtcbiAgICAgICAgcGlkaW5kZXgrK1xuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBlbGVtZW50LmlkZW50aWZpZXJzW3BpZGluZGV4XTtcbiAgICAgICAgY29uc29sZS5sb2coaWRlbnRpZmllci52YWx1ZSArIFwiPT1cIiArIHBpZCk7XG4gICAgICAgIGlmIChpZGVudGlmaWVyLnZhbHVlID09IHBpZCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGlkZW50aWZpZXIudmFsdWUgKyBcIj09XCIgKyBwaWQgKyBcIiAgaWd1YWxlcyEhIVwiKTtcbiAgICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRvY28tc291cmNlLW9yZ2FuaXphdGlvbnMtc2VsZWN0LXRvcC1tYWluXCIsXG4gIHRlbXBsYXRlOiBgPG1hdC1kaWFsb2ctY29udGVudCBjbGFzcz1cImhlaWdodC1hdXRvXCI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInRvU2VsZWN0XCJcbiAgICAgID57eyB0b3BNYWluT3JnYW5pemF0aW9uLm5hbWUgfX1cbiAgICAgIDxiciAvPlxuICAgICAgPG1hdC1mb3JtLWZpZWxkPlxuICAgICAgICA8bWF0LWxhYmVsPlNlbGVjY2lvbmUgbGEgT3JnYW5pemFjacOzbiBQcmluY2lwYWw6IDwvbWF0LWxhYmVsPlxuICAgICAgICA8bWF0LXNlbGVjdCBbKHZhbHVlKV09XCJzZWxlY3RlZFwiIHJlcXVpcmVkPlxuICAgICAgICAgIDxtYXQtb3B0aW9uXG4gICAgICAgICAgICAqbmdGb3I9XCJsZXQgaXRlbSBvZiB0b1NlbGVjdDsgbGV0IGluZGV4ID0gaW5kZXhcIlxuICAgICAgICAgICAgdmFsdWU9XCJ7eyBpbmRleCB9fVwiXG4gICAgICAgICAgICA+e3sgaXRlbS5sYWJlbCB9fTwvbWF0LW9wdGlvblxuICAgICAgICAgID5cbiAgICAgICAgPC9tYXQtc2VsZWN0PlxuICAgICAgPC9tYXQtZm9ybS1maWVsZD5cblxuICAgICAgPGJyIC8+XG4gICAgICA8bWF0LWxhYmVsICpuZ0lmPVwic2VsZWN0ZWQgPj0gMFwiPnt7XG4gICAgICAgIHRvU2VsZWN0W3NlbGVjdGVkXS5sYWJlbFxuICAgICAgfX08L21hdC1sYWJlbD5cbiAgICAgIDxiciAvPlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDxiciAvPlxuICAgIDxidXR0b24gbWF0LXJhaXNlZC1idXR0b24gKGNsaWNrKT1cIm9rKClcIj5PSzwvYnV0dG9uPlxuICA8L21hdC1kaWFsb2ctY29udGVudD5gLFxufSlcbmV4cG9ydCBjbGFzcyBTb3VyY2VPcmdhbml6YXRpb25TZWxlY3RUb3BEaWFsb2cgaW1wbGVtZW50cyBPbkluaXQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8U291cmNlT3JnYW5pemF0aW9uU2VsZWN0VG9wRGlhbG9nPixcbiAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgcHVibGljIGRhdGE6IGFueSxcbiAgICBwcml2YXRlIG9yZ1NlcnZpY2U6IE9yZ2FuaXphdGlvblNlcnZpY2VOb0F1dGhcbiAgKSB7fVxuXG4gIHB1YmxpYyB0b3BNYWluT3JnYW5pemF0aW9uOiBPcmdhbml6YXRpb24gPSBudWxsO1xuICBwdWJsaWMgdG9TZWxlY3Q6IEFycmF5PFJlbGF0aW9uc2hpcD4gPSBudWxsO1xuICBwdWJsaWMgc2VsZWN0ZWQgPSAtMTtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnRvcE1haW5Pcmdhbml6YXRpb24gPSB0aGlzLmRhdGEudG9wTWFpbk9yZ2FuaXphdGlvbjtcbiAgICB0aGlzLnRvU2VsZWN0ID0gbmV3IEFycmF5PFJlbGF0aW9uc2hpcD4oKTtcbiAgICB0aGlzLnRvcE1haW5Pcmdhbml6YXRpb24ucmVsYXRpb25zaGlwcy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBpZiAoZWxlbWVudC50eXBlID09IE9yZ2FuaXphdGlvblJlbGF0aW9uc2hpcHMuQ0hJTEQudmFsdWUpIHtcbiAgICAgICAgdGhpcy50b1NlbGVjdC5wdXNoKGVsZW1lbnQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKHRoaXMudG9TZWxlY3QpO1xuICB9XG4gIG9uTm9DbGljaygpOiB2b2lkIHtcbiAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSgpO1xuICB9XG5cbiAgcHVibGljIG9rKCkge1xuICAgIC8vIGxldCBzZWxlY3RlZCA9IG5ldyBTb3VyY2VPcmdhbml6YXRpb24oKVxuICAgIC8vIHNlbGVjdGVkLm9yZ2FuaXphdGlvbiA9IG9yZztcbiAgICAvLyBzZWxlY3RlZC5yb2xlID0gU291cmNlT3JnYW5pemF0aW9uUm9sZS5NQUlOLnZhbHVlO1xuICAgIGlmICh0aGlzLnNlbGVjdGVkID49IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMudG9TZWxlY3RbdGhpcy5zZWxlY3RlZF0pO1xuICAgICAgdGhpcy5vcmdTZXJ2aWNlXG4gICAgICAgIC5nZXRPcmdhbml6YXRpb25CeVBJRCh0aGlzLnRvU2VsZWN0W3RoaXMuc2VsZWN0ZWRdLmlkZW50aWZpZXJzWzBdLnZhbHVlKVxuICAgICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS5zZWxlY3RPcmcocmVzcG9uc2UubWV0YWRhdGEsIFt0aGlzLnRvcE1haW5Pcmdhbml6YXRpb25dKTtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0b2NvLXNvdXJjZS1vcmdhbml6YXRpb25zLXNlbGVjdC1kaWFsb2dcIixcbiAgdGVtcGxhdGU6IGA8bWF0LWRpYWxvZy1jb250ZW50IGNsYXNzPVwiaGVpZ2h0LWF1dG9cIj5cbiAgICA8dG9jby1vcmctc2VhcmNoXG4gICAgICBbb3JnRmlsdGVyXT1cImRhdGEuZmlsdGVyXCJcbiAgICAgIChzZWxlY3RlZE9yZyk9XCJzZWxlY3RlZE9yZygkZXZlbnQpXCJcbiAgICAgIFtwbGFjZWhvbGRlcl09XCJwbGFjZWhvbGRlclwiXG4gICAgPlxuICAgIDwvdG9jby1vcmctc2VhcmNoPlxuICAgIDxiciAvPlxuICAgIDxtYXQtbGFiZWwgKm5nSWY9XCJvcmdcIj57eyBvcmcubmFtZSB9fTwvbWF0LWxhYmVsPlxuICAgIDxiciAvPlxuICAgIDxtYXQtZm9ybS1maWVsZCAqbmdJZj1cImNhblNlbGVjdFJvbGVcIj5cbiAgICAgIDxtYXQtbGFiZWw+Um9sPC9tYXQtbGFiZWw+XG4gICAgICA8bWF0LXNlbGVjdCBbKHZhbHVlKV09XCJyb2xlXCIgcmVxdWlyZWQ+XG4gICAgICAgIDxtYXQtb3B0aW9uICpuZ0Zvcj1cImxldCBpdGVtIG9mIHJvbGVzXCIgdmFsdWU9XCJ7eyBpdGVtLnZhbHVlIH19XCI+e3tcbiAgICAgICAgICBpdGVtLmxhYmVsXG4gICAgICAgIH19PC9tYXQtb3B0aW9uPlxuICAgICAgPC9tYXQtc2VsZWN0PlxuICAgIDwvbWF0LWZvcm0tZmllbGQ+XG5cbiAgICA8YnIgLz5cblxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJwYXJlbnRzLmxlbmd0aCA+IDBcIj5cbiAgICAgIDxtYXQtbGFiZWw+U2UgYcOxYWRpcsOhIHRhbWJpw6luOiA8L21hdC1sYWJlbD5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGl0ZW0gb2YgcGFyZW50c1wiPlxuICAgICAgICA8YnIgLz5cbiAgICAgICAgPG1hdC1sYWJlbD57eyBpdGVtLm5hbWUgfX08L21hdC1sYWJlbD5cbiAgICAgICAgPGJyIC8+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDxiciAvPlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiAoY2xpY2spPVwib2soKVwiPk9LPC9idXR0b24+XG4gIDwvbWF0LWRpYWxvZy1jb250ZW50PmAsXG59KVxuZXhwb3J0IGNsYXNzIFNvdXJjZU9yZ2FuaXphdGlvblNlbGVjdERpYWxvZyBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBkaWFsb2dSZWY6IE1hdERpYWxvZ1JlZjxTb3VyY2VPcmdhbml6YXRpb25TZWxlY3REaWFsb2c+LFxuICAgIEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBwdWJsaWMgZGF0YTogYW55LFxuICAgIHByaXZhdGUgb3JnU2VydmljZTogT3JnYW5pemF0aW9uU2VydmljZU5vQXV0aFxuICApIHt9XG5cbiAgcHVibGljIHJvbGVzID0gW1xuICAgIHsgbGFiZWw6IFwiUHJpbmNpcGFsXCIsIHZhbHVlOiBcIk1BSU5cIiB9LFxuICAgIHsgbGFiZWw6IFwiQ29sYWJvcmFkb3JcIiwgdmFsdWU6IFwiQ09MQUJPUkFUT1JcIiB9LFxuICBdO1xuICBwdWJsaWMgcm9sZSA9IG51bGw7XG4gIHB1YmxpYyBvcmc6IE9yZ2FuaXphdGlvbjtcbiAgcHVibGljIHBhcmVudHM6IEFycmF5PE9yZ2FuaXphdGlvbj4gPSBuZXcgQXJyYXk8T3JnYW5pemF0aW9uPigpO1xuICBwbGFjZWhvbGRlciA9IFwiQnVzY2FyIHVuYSBvcmdhbml6YWNpw7NuXCI7XG4gIHB1YmxpYyBjYW5TZWxlY3RSb2xlID0gdHJ1ZTtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEpO1xuICAgIHRoaXMuY2FuU2VsZWN0Um9sZSA9IHRoaXMuZGF0YS5jYW5TZWxlY3RSb2xlO1xuICAgIGlmICh0aGlzLmRhdGEuZmlsdGVyKSB7XG4gICAgICB0aGlzLnBsYWNlaG9sZGVyID0gXCJCdXNjYXIgdW5hIG9yZ2FuaXphY2nDs24gY3ViYW5hXCI7XG4gICAgfVxuICB9XG4gIG9uTm9DbGljaygpOiB2b2lkIHtcbiAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSgpO1xuICB9XG5cbiAgcHVibGljIHNlbGVjdGVkT3JnKG9yZz86IE9yZ2FuaXphdGlvbik6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKG9yZyk7XG4gICAgdGhpcy5vcmcgPSBvcmc7XG4gICAgdGhpcy5hZGRQYXJlbnQodGhpcy5vcmcpO1xuICB9XG4gIHByaXZhdGUgYWRkUGFyZW50KGNoaWxkOiBPcmdhbml6YXRpb24pIHtcbiAgICBjaGlsZC5yZWxhdGlvbnNoaXBzLmZvckVhY2goKHApID0+IHtcbiAgICAgIGlmIChwLnR5cGUgPT0gT3JnYW5pemF0aW9uUmVsYXRpb25zaGlwcy5QQVJFTlQudmFsdWUpIHtcbiAgICAgICAgaWYgKHAuaWRlbnRpZmllcnMubGVuZ3RoID4gMCAmJiBwLmlkZW50aWZpZXJzWzBdLnZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5vcmdTZXJ2aWNlXG4gICAgICAgICAgICAuZ2V0T3JnYW5pemF0aW9uQnlQSUQocC5pZGVudGlmaWVyc1swXS52YWx1ZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICBuZXh0OiAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRzLnB1c2gocmVzcG9uc2UubWV0YWRhdGEpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkUGFyZW50KHJlc3BvbnNlLm1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgcHVibGljIG9rKCkge1xuICAgIC8vIGxldCBzZWxlY3RlZCA9IG5ldyBTb3VyY2VPcmdhbml6YXRpb24oKVxuICAgIC8vIHNlbGVjdGVkLm9yZ2FuaXphdGlvbiA9IG9yZztcbiAgICAvLyBzZWxlY3RlZC5yb2xlID0gU291cmNlT3JnYW5pemF0aW9uUm9sZS5NQUlOLnZhbHVlO1xuICAgIGlmICh0aGlzLmNhblNlbGVjdFJvbGUpIHtcbiAgICAgIGlmICh0aGlzLnJvbGUpIHtcbiAgICAgICAgdGhpcy5kYXRhLnNlbGVjdE9yZyh0aGlzLm9yZywgdGhpcy5yb2xlLCB0aGlzLnBhcmVudHMpO1xuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRhdGEuc2VsZWN0T3JnKFxuICAgICAgICB0aGlzLm9yZyxcbiAgICAgICAgU291cmNlT3JnYW5pemF0aW9uUm9sZS5DT0xBQk9SQVRPUi52YWx1ZSxcbiAgICAgICAgdGhpcy5wYXJlbnRzXG4gICAgICApO1xuICAgICAgdGhpcy5kaWFsb2dSZWYuY2xvc2UoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==