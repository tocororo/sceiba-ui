/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/sources-list/sources-list.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component, ViewChild } from '@angular/core';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { merge, of as observableOf } from 'rxjs';
import { startWith, switchMap, map, catchError } from 'rxjs/operators';
import { MatPaginator } from '@angular/material/paginator';
import { MatTableDataSource } from '@angular/material/table';
import { MetadataService } from '../../core/public-api';
import { Journal, JournalData, ISSN } from '../../entities/public-api';
import { FiltersService } from '../../filters/public-api';
import { Environment } from '../../core/env';
import { CatalogService } from '../../backend/public-api';
import { CatalogFiltersComponent } from '../catalog-filters/catalog-filters.component';
export class SourcesListComponent {
    /**
     * @param {?} service
     * @param {?} metadata
     * @param {?} filterService
     * @param {?} env
     */
    constructor(service, metadata, filterService, env) {
        this.service = service;
        this.metadata = metadata;
        this.filterService = filterService;
        this.env = env;
        this.journalList = [];
        this.loading = true;
        this.dataSource = new MatTableDataSource();
        this.columnsToDisplay = ['title', 'rnps', 'p-issn'];
        this.length = 0;
        this.pageSize = 5;
        this.pageSizeOptions = [5, 10, 15, 20];
        this.sceibaHost = '';
        this.layoutPosition = [
            {
                name: 'Derecha',
                layout: 'row-reverse',
                aling: 'center baseline',
                width: '22'
            },
            {
                name: 'Izquierda',
                layout: 'row',
                aling: 'center baseline',
                width: '22'
            },
            {
                name: 'Arriba',
                layout: 'column',
                aling: 'center center',
                width: '90'
            },
            {
                name: 'Abajo',
                layout: 'column-reverse',
                aling: 'center center',
                width: '90'
            }
        ];
        this.currentlayout = this.layoutPosition[1];
        this.sceibaHost = env.sceibaHost + '/catalog';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.metadata.setStandardMeta("Catálogo de Revistas Científicas", "", "");
        this.paginator.firstPage();
        this.paginator.pageSize = 5;
        this.service.getJournalsCount().subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            this.length = response.data.count;
        }));
        this.fetchJournalData();
        this.filterService.paramsChanged.subscribe((/**
         * @param {?} params
         * @return {?}
         */
        params => {
            this.params = params;
            this.fetchJournalData();
        }));
    }
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    /**
     * @return {?}
     */
    fetchJournalData() {
        this.loading = true;
        // this.dataSource.data = this.service.getJournalsPage(this.count, this.page);
        /** @type {?} */
        const arr = new Array();
        merge().pipe(startWith({}), switchMap((/**
         * @return {?}
         */
        () => {
            this.loading = true;
            return (/** @type {?} */ (this.service)).getJournalsPage(this.paginator.pageSize, this.paginator.pageIndex, this.params);
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            // Flip flag to show that loading has finished.
            this.loading = false;
            // this.isRateLimitReached = false;
            // this.resultsLength = response.total_count;
            this.length = response.data.sources.count;
            response.data.sources.data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                /** @type {?} */
                const j = new Journal();
                j.id = item.id;
                j.uuid = item.uuid;
                /** @type {?} */
                const info = new JournalData();
                info.url = item.data != null ? item.data.url : '';
                info.title = item.name;
                info.subtitle = item.subtitle;
                info.shortname = item.shortname;
                /** @type {?} */
                const issn = new ISSN();
                issn.e = item.data != null ? item.data.issn.e : '';
                issn.l = item.data != null ? item.data.issn.l : '';
                issn.p = item.data != null ? item.data.issn.p : '';
                info.issn = issn;
                info.rnps = item.data != null ? item.data.rnps : '';
                info.logo = item.data != null ? item.data.logo : '';
                info.purpose = item.purpose;
                info.description = item.data != null ? item.data.description : '';
                j.data = info;
                arr.push(j);
            }));
            return arr;
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.loading = false;
            console.log('ERRORRR ' + error);
            // Catch if the GitHub API has reached its rate limit. Return empty data.
            // this.isRateLimitReached = true;
            return observableOf([]);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => this.dataSource.data = data));
    }
    /**
     * @return {?}
     */
    onScrollUp() {
        // console.log("scrolled up!!");
    }
    /**
     * @return {?}
     */
    isEmpty() {
        if (this.journalList.length == 0) {
            this.loading = false;
            return true;
        }
        return false;
    }
    /**
     * @return {?}
     */
    isLoading() {
        return this.loading;
    }
    /**
     * @return {?}
     */
    openme() {
        /** @type {?} */
        const a = navigator.userAgent.match(/Android/i);
        /** @type {?} */
        const b = navigator.userAgent.match(/BlackBerry/i);
        /** @type {?} */
        const apple = navigator.userAgent.match(/iPhone|iPad|iPod/i);
        /** @type {?} */
        const o = navigator.userAgent.match(/Opera Mini/i);
        /** @type {?} */
        const i = navigator.userAgent.match(/IEMobile/i);
        if (a != null || b != null || apple != null || o != null || i != null) {
            return false;
        }
        return true;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    changeLayoutPosition(index) {
        this.currentlayout = this.layoutPosition[index];
    }
}
SourcesListComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-sources-list',
                template: "<!-- <div infiniteScroll [infiniteScrollDistance]=\"0\" [infiniteScrollUpDistance]=\"0.5\" [infiniteScrollThrottle]=\"10\" (scrolled)=\"onScrollDown()\"\n  (scrolledUp)=\"onScrollUp()\"> -->\n\n\n    <!-- <toco-page-header [info]=\"['Cat\u00E1logo de Revistas Cient\u00EDficas Cubanas']\">\n    </toco-page-header> -->\n    <div fxLayoutAlign=\"end center\" fxLayout=\"row\">\n      <button mat-icon-button [matMenuTriggerFor]=\"menu\">\n        <mat-icon>view_quilt</mat-icon>\n      </button>\n      <mat-menu #menu=\"matMenu\">\n        <button mat-menu-item (click)=\"changeLayoutPosition(0)\">\n          <mat-icon>arrow_forward</mat-icon>\n          <span>{{layoutPosition[0].name}}</span>\n        </button>\n        <button mat-menu-item (click)=\"changeLayoutPosition(1)\">\n          <mat-icon>arrow_back</mat-icon>\n          <span>{{layoutPosition[1].name}}</span>\n        </button>\n        <button mat-menu-item (click)=\"changeLayoutPosition(2)\">\n          <mat-icon>arrow_upward</mat-icon>\n          <span>{{layoutPosition[2].name}}</span>\n        </button>\n        <button mat-menu-item (click)=\"changeLayoutPosition(3)\">\n          <mat-icon>arrow_downward</mat-icon>\n          <span>{{layoutPosition[3].name}}</span>\n        </button>\n      </mat-menu>\n    </div>\n\n\n    <div fxLayout=\"{{currentlayout.layout}}\" fxLayout.xs=\"column nowrap\" fxLayoutAlign=\"{{currentlayout.aling}}\">\n\n      <toco-catalog-filters-container fxLayout=\"row wrap\" fxLayout.xs=\"column wrap\" fxFlex=\"{{currentlayout.width}}\" fxLayoutAlign=\"start center\" fxLayoutAlign.xs=\"center center\"\n        fxLayoutGap=\"1em\" class=\"width-90 back-grey mat-elevation-z8\">\n      </toco-catalog-filters-container>\n\n\n\n      <div class=\"mat-elevation-z8 width-90 margin1em\">\n        <table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows>\n          <ng-container matColumnDef=\"title\">\n            <th mat-header-cell *matHeaderCellDef>Titulo</th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.data.title}} </td>\n          </ng-container>\n          <ng-container matColumnDef=\"rnps\">\n            <th mat-header-cell *matHeaderCellDef>RNPS</th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.data.rnps}} </td>\n          </ng-container>\n          <ng-container matColumnDef=\"p-issn\">\n            <th mat-header-cell *matHeaderCellDef>P-ISSN</th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.data.issn.p}} </td>\n          </ng-container>\n\n          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n          <ng-container matColumnDef=\"expandedDetail\">\n            <td mat-cell *matCellDef=\"let element\" [attr.colspan]=\"columnsToDisplay.length\">\n              <div class=\"example-element-detail\" [@detailExpand]=\"element == expandedElement ? 'expanded' : 'collapsed'\">\n                <div class=\"example-element-description e2e-inner-html-bound\" [innerHTML]=\"element.data.description\"></div>\n\n              </div>\n            </td>\n          </ng-container>\n\n          <tr mat-header-row *matHeaderRowDef=\"columnsToDisplay\"></tr>\n          <tr mat-row *matRowDef=\"let element; columns: columnsToDisplay;\" class=\"example-element-row\" [class.example-expanded-row]=\"expandedElement === element\"\n            (click)=\"expandedElement = element\">\n          </tr>\n          <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"example-detail-row\"></tr>\n        </table>\n        <mat-paginator [length]=\"length\"\n              [pageSize]=\"pageSize\"\n              [pageSizeOptions]=\"pageSizeOptions\"\n              (page)=\"fetchJournalData()\">\n        </mat-paginator>\n      </div>\n\n      <mat-card *ngIf=\"!isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n        <mat-spinner></mat-spinner>\n        <!--<mat-progress-bar mode=\"indeterminate\"></mat-progress-bar>-->\n      </mat-card>\n\n      <!-- <mat-card *ngIf=\"isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n        <h1>No hay Informaci\u00F3n para Mostrar</h1>\n      </mat-card> -->\n    </div>\n\n    <!--\n      </mat-drawer-content>\n\n\n\n    </mat-drawer-container> -->\n\n<!-- </div> -->\n",
                animations: [
                    trigger('detailExpand', [
                        state('collapsed', style({ height: '0px', minHeight: '0', display: 'none' })),
                        state('expanded', style({ height: '*' })),
                        transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                    ]),
                ],
                styles: [".width-card{width:30%;min-width:240px;margin-left:24px;margin-top:24px}.card-float-left{float:left}.center-spinner{width:90.5%;min-width:240px;margin-left:24px;margin-right:24px;margin-top:24px}.back-grey{background:rgba(0,0,0,.01);margin:1.5em 1em;padding:1em;min-width:18em}.width-90{width:90%}.width-93{width:93.5%}table{width:90%}.margin1em{margin:1em}.menu-pull-right{flex:1 1 auto}table.mat-table{width:100%}tr.example-detail-row{height:0}tr.example-element-row:not(.example-expanded-row):hover{background:#f5f5f5}tr.example-element-row:not(.example-expanded-row):active{background:#efefef}.example-element-row td{border-bottom-width:0}.example-element-detail{overflow:hidden;display:flex}.example-element-diagram{min-width:80px;border:2px solid #000;padding:8px;font-weight:lighter;margin:8px 0;height:104px}.example-element-symbol{font-weight:700;font-size:40px;line-height:normal}.example-element-description{padding:16px}.example-element-description-attribution{opacity:.5}"]
            }] }
];
/** @nocollapse */
SourcesListComponent.ctorParameters = () => [
    { type: CatalogService },
    { type: MetadataService },
    { type: FiltersService },
    { type: Environment }
];
SourcesListComponent.propDecorators = {
    paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }],
    filter_component: [{ type: ViewChild, args: [CatalogFiltersComponent, { static: true },] }]
};
if (false) {
    /** @type {?} */
    SourcesListComponent.prototype.journalList;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.loading;
    /** @type {?} */
    SourcesListComponent.prototype.dataSource;
    /** @type {?} */
    SourcesListComponent.prototype.columnsToDisplay;
    /** @type {?} */
    SourcesListComponent.prototype.expandedElement;
    /** @type {?} */
    SourcesListComponent.prototype.length;
    /** @type {?} */
    SourcesListComponent.prototype.pageSize;
    /** @type {?} */
    SourcesListComponent.prototype.pageSizeOptions;
    /** @type {?} */
    SourcesListComponent.prototype.pageEvent;
    /** @type {?} */
    SourcesListComponent.prototype.params;
    /** @type {?} */
    SourcesListComponent.prototype.sceibaHost;
    /** @type {?} */
    SourcesListComponent.prototype.layoutPosition;
    /** @type {?} */
    SourcesListComponent.prototype.currentlayout;
    /** @type {?} */
    SourcesListComponent.prototype.paginator;
    /** @type {?} */
    SourcesListComponent.prototype.filter_component;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.metadata;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.env;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlcy1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3NvdXJjZXMvc291cmNlcy1saXN0L3NvdXJjZXMtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBTUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRixPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxZQUFZLEVBQWEsTUFBTSw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUU3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkUsT0FBTyxFQUFpQixjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUV6RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBY3ZGLE1BQU0sT0FBTyxvQkFBb0I7Ozs7Ozs7SUF5QzdCLFlBQW9CLE9BQXVCLEVBQVUsUUFBeUIsRUFBVSxhQUE2QixFQUFVLEdBQWdCO1FBQTNILFlB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IFBpbmFyIGRlbCBSw61vIFwiSGVybWFub3MgU2HDrXogTW9udGVzIGRlIE9jYVwiXG4gKiAgIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKi9cblxuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBhbmltYXRlLCBzdGF0ZSwgc3R5bGUsIHRyYW5zaXRpb24sIHRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IG1lcmdlLCBvZiBhcyBvYnNlcnZhYmxlT2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHN0YXJ0V2l0aCwgc3dpdGNoTWFwLCBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBNYXRQYWdpbmF0b3IsIFBhZ2VFdmVudCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3BhZ2luYXRvcic7XG5pbXBvcnQgeyBNYXRUYWJsZURhdGFTb3VyY2UgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC90YWJsZSc7XG5cbmltcG9ydCB7IE1ldGFkYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBKb3VybmFsLCBKb3VybmFsRGF0YSwgSVNTTiB9IGZyb20gJy4uLy4uL2VudGl0aWVzL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgRmlsdGVySHR0cE1hcCwgRmlsdGVyc1NlcnZpY2UgfSBmcm9tICcuLi8uLi9maWx0ZXJzL3B1YmxpYy1hcGknO1xuXG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJy4uLy4uL2NvcmUvZW52JztcblxuaW1wb3J0IHsgQ2F0YWxvZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9iYWNrZW5kL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgQ2F0YWxvZ0ZpbHRlcnNDb21wb25lbnQgfSBmcm9tICcuLi9jYXRhbG9nLWZpbHRlcnMvY2F0YWxvZy1maWx0ZXJzLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndG9jby1zb3VyY2VzLWxpc3QnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zb3VyY2VzLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3NvdXJjZXMtbGlzdC5jb21wb25lbnQuc2NzcyddLFxuICAgIGFuaW1hdGlvbnM6IFtcbiAgICAgICAgdHJpZ2dlcignZGV0YWlsRXhwYW5kJywgW1xuICAgICAgICAgICAgc3RhdGUoJ2NvbGxhcHNlZCcsIHN0eWxlKHsgaGVpZ2h0OiAnMHB4JywgbWluSGVpZ2h0OiAnMCcsIGRpc3BsYXk6ICdub25lJyB9KSksXG4gICAgICAgICAgICBzdGF0ZSgnZXhwYW5kZWQnLCBzdHlsZSh7IGhlaWdodDogJyonIH0pKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ2V4cGFuZGVkIDw9PiBjb2xsYXBzZWQnLCBhbmltYXRlKCcyMjVtcyBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDAuMiwgMSknKSksXG4gICAgICAgIF0pLFxuICAgIF0sXG59KVxuZXhwb3J0IGNsYXNzIFNvdXJjZXNMaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0XG57XG4gICAgam91cm5hbExpc3Q6IEpvdXJuYWxbXSA9IFtdO1xuICAgIHByaXZhdGUgbG9hZGluZyA9IHRydWU7XG4gICAgZGF0YVNvdXJjZSA9IG5ldyBNYXRUYWJsZURhdGFTb3VyY2U8Sm91cm5hbD4oKTtcbiAgICBjb2x1bW5zVG9EaXNwbGF5ID0gWyd0aXRsZScsICdybnBzJywgJ3AtaXNzbiddO1xuICAgIGV4cGFuZGVkRWxlbWVudDogSm91cm5hbDtcbiAgICBsZW5ndGggPSAwO1xuICAgIHBhZ2VTaXplID0gNTtcbiAgICBwYWdlU2l6ZU9wdGlvbnM6IG51bWJlcltdID0gWzUsIDEwLCAxNSwgMjBdO1xuICAgIHBhZ2VFdmVudDogUGFnZUV2ZW50O1xuICAgIHBhcmFtczogQXJyYXk8RmlsdGVySHR0cE1hcD47XG4gICAgc2NlaWJhSG9zdCA9ICcnO1xuICAgIGxheW91dFBvc2l0aW9uID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnRGVyZWNoYScsXG4gICAgICAgICAgICBsYXlvdXQ6ICdyb3ctcmV2ZXJzZScsXG4gICAgICAgICAgICBhbGluZzogJ2NlbnRlciBiYXNlbGluZScsXG4gICAgICAgICAgICB3aWR0aDogJzIyJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnSXpxdWllcmRhJyxcbiAgICAgICAgICAgIGxheW91dDogJ3JvdycsXG4gICAgICAgICAgICBhbGluZzogJ2NlbnRlciBiYXNlbGluZScsXG4gICAgICAgICAgICB3aWR0aDogJzIyJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnQXJyaWJhJyxcbiAgICAgICAgICAgIGxheW91dDogJ2NvbHVtbicsXG4gICAgICAgICAgICBhbGluZzogJ2NlbnRlciBjZW50ZXInLFxuICAgICAgICAgICAgd2lkdGg6ICc5MCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ0FiYWpvJyxcbiAgICAgICAgICAgIGxheW91dDogJ2NvbHVtbi1yZXZlcnNlJyxcbiAgICAgICAgICAgIGFsaW5nOiAnY2VudGVyIGNlbnRlcicsXG4gICAgICAgICAgICB3aWR0aDogJzkwJ1xuICAgICAgICB9XG4gICAgXTtcbiAgICBjdXJyZW50bGF5b3V0ID0gdGhpcy5sYXlvdXRQb3NpdGlvblsxXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc2VydmljZTogQ2F0YWxvZ1NlcnZpY2UsIHByaXZhdGUgbWV0YWRhdGE6IE1ldGFkYXRhU2VydmljZSwgcHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlOiBGaWx0ZXJzU2VydmljZSwgcHJpdmF0ZSBlbnY6IEVudmlyb25tZW50KSB7XG4gICAgICAgIHRoaXMuc2NlaWJhSG9zdCA9IGVudi5zY2VpYmFIb3N0ICsgJy9jYXRhbG9nJztcbiAgICB9XG5cbiAgICBAVmlld0NoaWxkKE1hdFBhZ2luYXRvciwgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBwYWdpbmF0b3I6IE1hdFBhZ2luYXRvcjtcblxuICAgIEBWaWV3Q2hpbGQoQ2F0YWxvZ0ZpbHRlcnNDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pXG4gICAgZmlsdGVyX2NvbXBvbmVudDogQ2F0YWxvZ0ZpbHRlcnNDb21wb25lbnQ7XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5tZXRhZGF0YS5zZXRTdGFuZGFyZE1ldGEoXCJDYXTDoWxvZ28gZGUgUmV2aXN0YXMgQ2llbnTDrWZpY2FzXCIsIFwiXCIsIFwiXCIpO1xuICAgICAgICB0aGlzLnBhZ2luYXRvci5maXJzdFBhZ2UoKTtcbiAgICAgICAgdGhpcy5wYWdpbmF0b3IucGFnZVNpemUgPSA1O1xuICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Sm91cm5hbHNDb3VudCgpLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IHJlc3BvbnNlLmRhdGEuY291bnQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmZldGNoSm91cm5hbERhdGEoKTtcbiAgICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlLnBhcmFtc0NoYW5nZWQuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XG4gICAgICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hKb3VybmFsRGF0YSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBvblBhZ2luYXRvckNoYW5nZWQoKXtcbiAgICAvLyAgIHRoaXMuZmlsdGVyU2VydmljZS5jaGFuZ2VGaWx0ZXIoJ2NvdW50Jyx0aGlzLnBhZ2luYXRvci5wYWdlU2l6ZSwgZmFsc2UpO1xuICAgIC8vICAgdGhpcy5maWx0ZXJTZXJ2aWNlLmNoYW5nZUZpbHRlcigncGFnZScsdGhpcy5wYWdpbmF0b3IucGFnZUluZGV4KTtcbiAgICAvLyB9XG5cbiAgICBmZXRjaEpvdXJuYWxEYXRhKCkge1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAvLyB0aGlzLmRhdGFTb3VyY2UuZGF0YSA9IHRoaXMuc2VydmljZS5nZXRKb3VybmFsc1BhZ2UodGhpcy5jb3VudCwgdGhpcy5wYWdlKTtcbiAgICAgICAgY29uc3QgYXJyID0gbmV3IEFycmF5PEpvdXJuYWw+KCk7XG5cbiAgICAgICAgbWVyZ2UoKS5waXBlKFxuICAgICAgICAgICAgc3RhcnRXaXRoKHt9KSxcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZSEuZ2V0Sm91cm5hbHNQYWdlKHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplLCB0aGlzLnBhZ2luYXRvci5wYWdlSW5kZXgsIHRoaXMucGFyYW1zKTtcbiAgICAgICAgfSksXG4gICAgICAgIG1hcChyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAvLyBGbGlwIGZsYWcgdG8gc2hvdyB0aGF0IGxvYWRpbmcgaGFzIGZpbmlzaGVkLlxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAvLyB0aGlzLmlzUmF0ZUxpbWl0UmVhY2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gdGhpcy5yZXN1bHRzTGVuZ3RoID0gcmVzcG9uc2UudG90YWxfY291bnQ7XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IHJlc3BvbnNlLmRhdGEuc291cmNlcy5jb3VudDtcbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuc291cmNlcy5kYXRhLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaiA9IG5ldyBKb3VybmFsKCk7XG4gICAgICAgICAgICAgICAgai5pZCA9IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgai51dWlkID0gaXRlbS51dWlkO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSBuZXcgSm91cm5hbERhdGEoKTtcbiAgICAgICAgICAgICAgICBpbmZvLnVybCA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLnVybCA6ICcnO1xuICAgICAgICAgICAgICAgIGluZm8udGl0bGUgPSBpdGVtLm5hbWU7XG4gICAgICAgICAgICAgICAgaW5mby5zdWJ0aXRsZSA9IGl0ZW0uc3VidGl0bGU7XG4gICAgICAgICAgICAgICAgaW5mby5zaG9ydG5hbWUgPSBpdGVtLnNob3J0bmFtZTtcbiAgICAgICAgICAgICAgICBjb25zdCBpc3NuID0gbmV3IElTU04oKTtcbiAgICAgICAgICAgICAgICBpc3NuLmUgPSBpdGVtLmRhdGEgIT0gbnVsbCA/IGl0ZW0uZGF0YS5pc3NuLmUgOiAnJztcbiAgICAgICAgICAgICAgICBpc3NuLmwgPSBpdGVtLmRhdGEgIT0gbnVsbCA/IGl0ZW0uZGF0YS5pc3NuLmwgOiAnJztcbiAgICAgICAgICAgICAgICBpc3NuLnAgPSBpdGVtLmRhdGEgIT0gbnVsbCA/IGl0ZW0uZGF0YS5pc3NuLnAgOiAnJztcbiAgICAgICAgICAgICAgICBpbmZvLmlzc24gPSBpc3NuO1xuICAgICAgICAgICAgICAgIGluZm8ucm5wcyA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLnJucHMgOiAnJztcbiAgICAgICAgICAgICAgICBpbmZvLmxvZ28gPSBpdGVtLmRhdGEgIT0gbnVsbCA/IGl0ZW0uZGF0YS5sb2dvIDogJyc7XG4gICAgICAgICAgICAgICAgaW5mby5wdXJwb3NlID0gaXRlbS5wdXJwb3NlO1xuICAgICAgICAgICAgICAgIGluZm8uZGVzY3JpcHRpb24gPSBpdGVtLmRhdGEgIT0gbnVsbCA/IGl0ZW0uZGF0YS5kZXNjcmlwdGlvbiA6ICcnO1xuICAgICAgICAgICAgICAgIGouZGF0YSA9IGluZm87XG4gICAgICAgICAgICAgICAgYXJyLnB1c2goaik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBhcnI7XG4gICAgICAgIH0pLFxuICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SUlIgJyArIGVycm9yKTtcbiAgICAgICAgICAgIC8vIENhdGNoIGlmIHRoZSBHaXRIdWIgQVBJIGhhcyByZWFjaGVkIGl0cyByYXRlIGxpbWl0LiBSZXR1cm4gZW1wdHkgZGF0YS5cbiAgICAgICAgICAgIC8vIHRoaXMuaXNSYXRlTGltaXRSZWFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBvYnNlcnZhYmxlT2YoW10pO1xuICAgICAgICB9KVxuICAgICAgICApLnN1YnNjcmliZShkYXRhID0+IHRoaXMuZGF0YVNvdXJjZS5kYXRhID0gZGF0YSk7XG4gICAgfVxuXG4gICAgb25TY3JvbGxVcCgpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJzY3JvbGxlZCB1cCEhXCIpO1xuICAgIH1cblxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIGlmICh0aGlzLmpvdXJuYWxMaXN0Lmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc0xvYWRpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRpbmc7XG4gICAgfVxuXG4gICAgb3Blbm1lKCk6IGJvb2xlYW5cbiAgICB7XG4gICAgICAgIGNvbnN0IGEgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpO1xuICAgICAgICBjb25zdCBiID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvQmxhY2tCZXJyeS9pKTtcbiAgICAgICAgY29uc3QgYXBwbGUgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9pUGhvbmV8aVBhZHxpUG9kL2kpO1xuICAgICAgICBjb25zdCBvID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvT3BlcmEgTWluaS9pKTtcbiAgICAgICAgY29uc3QgaSA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0lFTW9iaWxlL2kpO1xuXG4gICAgICAgIGlmIChhICE9IG51bGwgfHwgYiAhPSBudWxsIHx8IGFwcGxlICE9IG51bGwgfHwgbyAhPSBudWxsIHx8IGkgIT0gbnVsbClcbiAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNoYW5nZUxheW91dFBvc2l0aW9uKGluZGV4OiBudW1iZXIpXG4gICAge1xuICAgICAgICB0aGlzLmN1cnJlbnRsYXlvdXQgPSB0aGlzLmxheW91dFBvc2l0aW9uW2luZGV4XTtcbiAgICB9XG59XG4iXX0=