/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/datepicker-year/datepicker-year.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { InputControl } from '../../input/input.control';
import { Component, Input, forwardRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DateAdapter, MAT_DATE_FORMATS, MAT_DATE_LOCALE, MatDatepicker } from '@angular/material';
import { MomentDateAdapter } from '@angular/material-moment-adapter';
import moment from 'moment';
// const moment = _rollupMoment || _moment;
/** @type {?} */
export const YEAR_MODE_FORMATS = {
    parse: {
        dateInput: 'YYYY',
    },
    display: {
        dateInput: 'YYYY',
        monthYearLabel: 'MMM YYYY',
        dateA11yLabel: 'LL',
        monthYearA11yLabel: 'MMMM YYYY',
    },
};
export class DatepickerYearComponent extends InputControl {
    constructor() {
        super();
        /**
         * Component label
         */
        this.label = '';
        this.touchUi = false;
        // _inputCtrl: FormControl = new FormControl();
        // Function to call when the date changes.
        this.onChange = (/**
         * @param {?} year
         * @return {?}
         */
        (year) => { });
        // Function to call when the input is touched (when a star is clicked).
        this.onTouched = (/**
         * @return {?}
         */
        () => { });
    }
    /**
     * @return {?}
     */
    get max() {
        return this._max ? this._max.year() : undefined;
    }
    /**
     * @param {?} max
     * @return {?}
     */
    set max(max) {
        if (max) {
            /** @type {?} */
            const momentDate = typeof max === 'number' ? moment([max, 0, 1]) : moment(max);
            this._max = momentDate.isValid() ? momentDate : undefined;
        }
    }
    /**
     * @return {?}
     */
    get min() {
        return this._min ? this._min.year() : undefined;
    }
    /**
     * @param {?} min
     * @return {?}
     */
    set min(min) {
        if (min) {
            /** @type {?} */
            const momentDate = typeof min === 'number' ? moment([min, 0, 1]) : moment(min);
            this._min = momentDate.isValid() ? momentDate : undefined;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init('', '', false, true);
        // this.value = moment(this.value.toString()).format("YYYY")
        if (this.label == '') {
            this.label = this.content.label;
        }
        this.min = this.content.extraContent.minYear;
        this.max = this.content.extraContent.maxYear;
        console.log(this.content.extraContent, 'DATEPICKER YEAR EXTRA CONTENT....', this._min, this._max);
        this.writeValue(new Date(this.content.value));
    }
    /**
     * @param {?} date
     * @return {?}
     */
    writeValue(date) {
        if (date && this._isYearEnabled(date.getFullYear())) {
            /** @type {?} */
            const momentDate = moment(date);
            if (momentDate.isValid()) {
                this.content.formControl.setValue(moment(date), { emitEvent: false });
                this.content.value = moment(date).year;
                // this.content.formControl.setValue(this.content.value);
            }
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    // Allows Angular to disable the input.
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        isDisabled ? this._picker.disabled = true : this._picker.disabled = false;
        isDisabled ? this.content.formControl.disable() : this.content.formControl.enable();
    }
    /**
     * @param {?} chosenDate
     * @param {?} datepicker
     * @return {?}
     */
    _yearSelectedHandler(chosenDate, datepicker) {
        if (!this._isYearEnabled(chosenDate.year())) {
            datepicker.close();
            return;
        }
        this.content.formControl.setValue(chosenDate, { emitEvent: false });
        this.content.value = chosenDate.year;
        // this.content.formControl.setValue(this.content.value);
        this.onChange(chosenDate.toDate());
        this.onTouched();
        datepicker.close();
    }
    /**
     * @param {?} datepicker
     * @return {?}
     */
    _openDatepickerOnClick(datepicker) {
        if (!datepicker.opened) {
            datepicker.open();
        }
    }
    /**
     * @param {?} datepicker
     * @return {?}
     */
    _openDatepickerOnFocus(datepicker) {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (!datepicker.opened) {
                datepicker.open();
            }
        }));
    }
    /**
     * Whether the given year is enabled.
     * @private
     * @param {?} year
     * @return {?}
     */
    _isYearEnabled(year) {
        // disable if the year is greater than maxDate lower than minDate
        if (year === undefined || year === null ||
            (this._max && year > this._max.year()) ||
            (this._min && year < this._min.year())) {
            return false;
        }
        return true;
    }
}
DatepickerYearComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-datepicker-year',
                template: "<mat-form-field style=\"width: 100%\">\n  <!-- <mat-label>{{ label }}</mat-label> -->\n  <input\n    matInput\n    [matDatepicker]=\"datepicker\"\n    [max]=\"_max\"\n    [min]=\"_min\"\n    [formControl]=\"content.formControl\"\n    (click)=\"_openDatepickerOnClick(datepicker)\"\n    (focus)=\"_openDatepickerOnFocus(datepicker)\"\n    readonly\n    placeholder=\"{{ content.label }}\"\n    required=\"{{ content.required }}\"\n  />\n\n  <mat-datepicker\n    #datepicker\n    [touchUi]=\"touchUi\"\n    startView=\"multi-year\"\n    (yearSelected)=\"_yearSelectedHandler($event, datepicker)\"\n    panelClass=\"year-picker\"\n  >\n  </mat-datepicker>\n</mat-form-field>\n",
                providers: [
                    { provide: DateAdapter, useClass: MomentDateAdapter, deps: [MAT_DATE_LOCALE] },
                    { provide: MAT_DATE_FORMATS, useValue: YEAR_MODE_FORMATS },
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => DatepickerYearComponent)),
                        multi: true,
                    },
                ],
                host: {
                    "[style.minWidth]": "content.minWidth",
                    "[style.width]": "content.width",
                },
                styles: [""]
            }] }
];
/** @nocollapse */
DatepickerYearComponent.ctorParameters = () => [];
DatepickerYearComponent.propDecorators = {
    label: [{ type: Input }],
    max: [{ type: Input }],
    min: [{ type: Input }],
    touchUi: [{ type: Input }],
    _picker: [{ type: ViewChild, args: [MatDatepicker, { static: true },] }]
};
if (false) {
    /**
     * Component label
     * @type {?}
     */
    DatepickerYearComponent.prototype.label;
    /** @type {?} */
    DatepickerYearComponent.prototype._max;
    /** @type {?} */
    DatepickerYearComponent.prototype._min;
    /** @type {?} */
    DatepickerYearComponent.prototype.touchUi;
    /** @type {?} */
    DatepickerYearComponent.prototype._picker;
    /** @type {?} */
    DatepickerYearComponent.prototype.onChange;
    /** @type {?} */
    DatepickerYearComponent.prototype.onTouched;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci15ZWFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2Zvcm1zL2V4cGVyaW1lbnRhbC9kYXRlcGlja2VyLXllYXIvZGF0ZXBpY2tlci15ZWFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUV6RCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUE2QixNQUFNLGVBQWUsQ0FBQztBQUNuRyxPQUFPLEVBQWUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEYsT0FBTyxFQUFFLFdBQVcsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEcsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFckUsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDOzs7QUFLNUIsTUFBTSxPQUFPLGlCQUFpQixHQUFHO0lBQy9CLEtBQUssRUFBRTtRQUNMLFNBQVMsRUFBRSxNQUFNO0tBQ2xCO0lBQ0QsT0FBTyxFQUFFO1FBQ1AsU0FBUyxFQUFFLE1BQU07UUFDakIsY0FBYyxFQUFFLFVBQVU7UUFDMUIsYUFBYSxFQUFFLElBQUk7UUFDbkIsa0JBQWtCLEVBQUUsV0FBVztLQUNoQztDQUNGO0FBb0JELE1BQU0sT0FBTyx1QkFBeUIsU0FBUSxZQUFZO0lBcUR2RDtRQUFnQixLQUFLLEVBQUUsQ0FBQzs7OztRQWxEaEIsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQXdCWCxZQUFPLEdBQUcsS0FBSyxDQUFDOzs7UUFPekIsYUFBUTs7OztRQUFHLENBQUMsSUFBVSxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUM7O1FBRy9CLGNBQVM7OztRQUFHLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFB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aUJBQ2pDOzthQUNGOzs7OztvQkFJRSxLQUFLO2tCQUdMLEtBQUs7a0JBV0wsS0FBSztzQkFVTCxLQUFLO3NCQUVMLFNBQVMsU0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzs7Ozs7O0lBMUIxQyx3Q0FBb0I7O0lBRXBCLHVDQUFhOztJQVdiLHVDQUFhOztJQVdiLDBDQUF5Qjs7SUFFekIsMENBQTJFOztJQUszRSwyQ0FBK0I7O0lBRy9CLDRDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0Q29udHJvbCB9IGZyb20gJy4uLy4uL2lucHV0L2lucHV0LmNvbnRyb2wnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBmb3J3YXJkUmVmLCBWaWV3Q2hpbGQsIFZpZXdFbmNhcHN1bGF0aW9uLCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBEYXRlQWRhcHRlciwgTUFUX0RBVEVfRk9STUFUUywgTUFUX0RBVEVfTE9DQUxFLCBNYXREYXRlcGlja2VyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgTW9tZW50RGF0ZUFkYXB0ZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC1tb21lbnQtYWRhcHRlcic7XG5cbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IGRlZmF1bHRGb3JtYXQgYXMgX3JvbGx1cE1vbWVudCwgTW9tZW50IH0gZnJvbSAnbW9tZW50Jztcbi8vIGNvbnN0IG1vbWVudCA9IF9yb2xsdXBNb21lbnQgfHwgX21vbWVudDtcblxuXG5leHBvcnQgY29uc3QgWUVBUl9NT0RFX0ZPUk1BVFMgPSB7XG4gIHBhcnNlOiB7XG4gICAgZGF0ZUlucHV0OiAnWVlZWScsXG4gIH0sXG4gIGRpc3BsYXk6IHtcbiAgICBkYXRlSW5wdXQ6ICdZWVlZJyxcbiAgICBtb250aFllYXJMYWJlbDogJ01NTSBZWVlZJyxcbiAgICBkYXRlQTExeUxhYmVsOiAnTEwnLFxuICAgIG1vbnRoWWVhckExMXlMYWJlbDogJ01NTU0gWVlZWScsXG4gIH0sXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0b2NvLWRhdGVwaWNrZXIteWVhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlcGlja2VyLXllYXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kYXRlcGlja2VyLXllYXIuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgeyBwcm92aWRlOiBEYXRlQWRhcHRlciwgdXNlQ2xhc3M6IE1vbWVudERhdGVBZGFwdGVyLCBkZXBzOiBbTUFUX0RBVEVfTE9DQUxFXSB9LFxuICAgIHsgcHJvdmlkZTogTUFUX0RBVEVfRk9STUFUUywgdXNlVmFsdWU6IFlFQVJfTU9ERV9GT1JNQVRTIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBEYXRlcGlja2VyWWVhckNvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZSxcbiAgICB9LFxuICBdLFxuICBob3N0OiB7XG4gICAgXCJbc3R5bGUubWluV2lkdGhdXCI6IFwiY29udGVudC5taW5XaWR0aFwiLFxuICAgIFwiW3N0eWxlLndpZHRoXVwiOiBcImNvbnRlbnQud2lkdGhcIixcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgRGF0ZXBpY2tlclllYXJDb21wb25lbnQgIGV4dGVuZHMgSW5wdXRDb250cm9sIGltcGxlbWVudHMgT25Jbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG5cbiAgLyoqIENvbXBvbmVudCBsYWJlbCAqL1xuICBASW5wdXQoKSBsYWJlbCA9ICcnO1xuXG4gIF9tYXg6IE1vbWVudDtcbiAgQElucHV0KCkgZ2V0IG1heCgpOiBudW1iZXIgfCBEYXRlIHtcbiAgICByZXR1cm4gdGhpcy5fbWF4ID8gdGhpcy5fbWF4LnllYXIoKSA6IHVuZGVmaW5lZDtcbiAgfVxuICBzZXQgbWF4KG1heDogbnVtYmVyIHwgRGF0ZSkge1xuICAgIGlmIChtYXgpIHtcbiAgICAgIGNvbnN0IG1vbWVudERhdGUgPSB0eXBlb2YgbWF4ID09PSAnbnVtYmVyJyA/IG1vbWVudChbbWF4LCAwLCAxXSkgOiBtb21lbnQobWF4KTtcbiAgICAgIHRoaXMuX21heCA9IG1vbWVudERhdGUuaXNWYWxpZCgpID8gbW9tZW50RGF0ZSA6IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBfbWluOiBNb21lbnQ7XG4gIEBJbnB1dCgpIGdldCBtaW4oKTogbnVtYmVyIHwgRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX21pbiA/IHRoaXMuX21pbi55ZWFyKCkgOiB1bmRlZmluZWQ7XG4gIH1cbiAgc2V0IG1pbihtaW46IG51bWJlciB8IERhdGUpIHtcbiAgICBpZiAobWluKSB7XG4gICAgICBjb25zdCBtb21lbnREYXRlID0gdHlwZW9mIG1pbiA9PT0gJ251bWJlcicgPyBtb21lbnQoW21pbiwgMCwgMV0pIDogbW9tZW50KG1pbik7XG4gICAgICB0aGlzLl9taW4gPSBtb21lbnREYXRlLmlzVmFsaWQoKSA/IG1vbWVudERhdGUgOiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgdG91Y2hVaSA9IGZhbHNlO1xuXG4gIEBWaWV3Q2hpbGQoTWF0RGF0ZXBpY2tlciwgeyBzdGF0aWM6IHRydWUgfSkgX3BpY2tlcjogTWF0RGF0ZXBpY2tlcjxNb21lbnQ+O1xuXG4gIC8vIF9pbnB1dEN0cmw6IEZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKCk7XG5cbiAgLy8gRnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBkYXRlIGNoYW5nZXMuXG4gIG9uQ2hhbmdlID0gKHllYXI6IERhdGUpID0+IHsgfTtcblxuICAvLyBGdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGlucHV0IGlzIHRvdWNoZWQgKHdoZW4gYSBzdGFyIGlzIGNsaWNrZWQpLlxuICBvblRvdWNoZWQgPSAoKSA9PiB7IH07XG5cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmluaXQoJycsICcnLCBmYWxzZSwgdHJ1ZSk7XG4gICAgLy8gdGhpcy52YWx1ZSA9IG1vbWVudCh0aGlzLnZhbHVlLnRvU3RyaW5nKCkpLmZvcm1hdChcIllZWVlcIilcbiAgICBpZiAodGhpcy5sYWJlbCA9PSAnJykge1xuICAgICAgdGhpcy5sYWJlbCA9IHRoaXMuY29udGVudC5sYWJlbDtcbiAgICB9XG5cbiAgICB0aGlzLm1pbiA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQubWluWWVhcjtcbiAgICB0aGlzLm1heCA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQubWF4WWVhcjtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50LCAnREFURVBJQ0tFUiBZRUFSIEVYVFJBIENPTlRFTlQuLi4uJywgdGhpcy5fbWluLCB0aGlzLl9tYXgpXG5cbiAgICB0aGlzLndyaXRlVmFsdWUobmV3IERhdGUodGhpcy5jb250ZW50LnZhbHVlKSk7XG4gICB9XG4gICBjb25zdHJ1Y3RvcigpIHsgc3VwZXIoKTsgfVxuXG5cbiAgd3JpdGVWYWx1ZShkYXRlOiBEYXRlKTogdm9pZCB7XG4gICAgaWYgKGRhdGUgJiYgdGhpcy5faXNZZWFyRW5hYmxlZChkYXRlLmdldEZ1bGxZZWFyKCkpKSB7XG4gICAgICBjb25zdCBtb21lbnREYXRlID0gbW9tZW50KGRhdGUpO1xuICAgICAgaWYgKG1vbWVudERhdGUuaXNWYWxpZCgpKSB7XG4gICAgICAgIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZShtb21lbnQoZGF0ZSksIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gbW9tZW50KGRhdGUpLnllYXI7XG4gICAgICAgIC8vIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRlbnQudmFsdWUpO1xuXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIC8vIEFsbG93cyBBbmd1bGFyIHRvIGRpc2FibGUgdGhlIGlucHV0LlxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpc0Rpc2FibGVkID8gdGhpcy5fcGlja2VyLmRpc2FibGVkID0gdHJ1ZSA6IHRoaXMuX3BpY2tlci5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgaXNEaXNhYmxlZCA/IHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5kaXNhYmxlKCkgOiB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuZW5hYmxlKCk7XG4gIH1cblxuICBfeWVhclNlbGVjdGVkSGFuZGxlcihjaG9zZW5EYXRlOiBNb21lbnQsIGRhdGVwaWNrZXI6IE1hdERhdGVwaWNrZXI8TW9tZW50Pikge1xuICAgIGlmICghdGhpcy5faXNZZWFyRW5hYmxlZChjaG9zZW5EYXRlLnllYXIoKSkpIHtcbiAgICAgIGRhdGVwaWNrZXIuY2xvc2UoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUoY2hvc2VuRGF0ZSwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgIHRoaXMuY29udGVudC52YWx1ZSA9IGNob3NlbkRhdGUueWVhcjtcbiAgICAvLyB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5jb250ZW50LnZhbHVlKTtcbiAgICB0aGlzLm9uQ2hhbmdlKGNob3NlbkRhdGUudG9EYXRlKCkpO1xuICAgIHRoaXMub25Ub3VjaGVkKCk7XG4gICAgZGF0ZXBpY2tlci5jbG9zZSgpO1xuICB9XG5cbiAgX29wZW5EYXRlcGlja2VyT25DbGljayhkYXRlcGlja2VyOiBNYXREYXRlcGlja2VyPE1vbWVudD4pIHtcbiAgICBpZiAoIWRhdGVwaWNrZXIub3BlbmVkKSB7XG4gICAgICBkYXRlcGlja2VyLm9wZW4oKTtcbiAgICB9XG4gIH1cblxuICBfb3BlbkRhdGVwaWNrZXJPbkZvY3VzKGRhdGVwaWNrZXI6IE1hdERhdGVwaWNrZXI8TW9tZW50Pikge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFkYXRlcGlja2VyLm9wZW5lZCkge1xuICAgICAgICBkYXRlcGlja2VyLm9wZW4oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBXaGV0aGVyIHRoZSBnaXZlbiB5ZWFyIGlzIGVuYWJsZWQuICovXG4gIHByaXZhdGUgX2lzWWVhckVuYWJsZWQoeWVhcjogbnVtYmVyKSB7XG4gICAgLy8gZGlzYWJsZSBpZiB0aGUgeWVhciBpcyBncmVhdGVyIHRoYW4gbWF4RGF0ZSBsb3dlciB0aGFuIG1pbkRhdGVcbiAgICBpZiAoeWVhciA9PT0gdW5kZWZpbmVkIHx8IHllYXIgPT09IG51bGwgfHxcbiAgICAgICh0aGlzLl9tYXggJiYgeWVhciA+IHRoaXMuX21heC55ZWFyKCkpIHx8XG4gICAgICAodGhpcy5fbWluICYmIHllYXIgPCB0aGlzLl9taW4ueWVhcigpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG4iXX0=