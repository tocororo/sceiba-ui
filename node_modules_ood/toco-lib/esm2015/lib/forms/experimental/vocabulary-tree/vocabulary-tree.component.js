/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/vocabulary-tree/vocabulary-tree.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component } from "@angular/core";
import { FormControl, } from "@angular/forms";
import { startWith, map } from "rxjs/operators";
import { TaxonomyService } from '../../../backend/public-api';
import { InputControl } from '../../input/input.control';
/**
 * @record
 */
function VocabularyComponentExtraContent() { }
if (false) {
    /** @type {?} */
    VocabularyComponentExtraContent.prototype.multiple;
    /** @type {?} */
    VocabularyComponentExtraContent.prototype.selectedTermsIds;
    /** @type {?} */
    VocabularyComponentExtraContent.prototype.excludeTermsIds;
    /** @type {?} */
    VocabularyComponentExtraContent.prototype.level;
    /** @type {?} */
    VocabularyComponentExtraContent.prototype.vocab;
}
/**
 * A control to select a term or terms in a vocabulary.
 */
export class VocabularyTreeComponent extends InputControl {
    /**
     * @param {?} service
     */
    constructor(service) {
        super();
        this.service = service;
        // internalControl = new FormControl();
        //this control is used by the chips,not necessary to expose it
        this.chipsFormControl = new FormControl();
        this.levelsOptions = null;
        this.levelsSelection = new Array();
        this.lastLevelTerm = null;
        this.chipsList = [];
        this.leafsOptions = null;
        this.terms = [];
        this.loading = true;
        // selectedTermsIds = [];
        this.searchText = "Seleccione las opciones";
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init('', '', false, true);
        // (this.content.parentFormSection as FormGroup).addControl(
        //   this.content.name,
        //   this.content.formControl
        // );
        if (this.content.required) {
            this.content.formControl.setValidators((/**
             * @param {?} control
             * @return {?}
             */
            (control) => {
                return !this.content.value || this.content.value.length == 0
                    ? { requiredTerms: "No Terms Selected" }
                    : null;
            }));
        }
        this.inputId = this.content.label.trim().toLowerCase();
        if (this.content.extraContent) {
            this.extraContent = this.content.extraContent;
            // already selected terms
            if (!this.extraContent.selectedTermsIds) {
                this.extraContent.selectedTermsIds = [];
            }
            // terms ids to exclude of the possible options.
            if (!this.extraContent.excludeTermsIds) {
                this.extraContent.excludeTermsIds = [];
            }
            this.content.value = [];
            this.content.formControl.setValue(this.content.value);
            if (this.extraContent.level == undefined) {
                this.extraContent.level = 10;
            }
            if (this.extraContent.vocab) {
                this.loading = true;
                this.service.getTermsTreeByVocab(this.extraContent.vocab, 0).subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    this.loading = false;
                    /** @type {?} */
                    const nextLevel = response.data.tree.term_node;
                    if (this.extraContent.level > 0) {
                        this.levelsOptions = new Array();
                        // this.levelsSelection = new Array<TermNode>();
                        this._setLevelsOptions(nextLevel, 0);
                    }
                    else {
                        this.leafsOptions = this._get_terms(nextLevel);
                        this._updateFilteredOptions();
                    }
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                (err) => {
                    console.log("The observable got an error notification: " + err + ".");
                }), (/**
                 * @return {?}
                 */
                () => {
                    console.log("The observable got a complete notification.");
                    this.loading = !this.loading;
                }));
            }
            //   else if(this.extraContent.termID){
            //     this.service.getTermByUUID(this.extraContent.termID, this.extraContent.level)
            //     .subscribe(this.termsTreeObserver);
            // }
        }
    }
    /**
     * @private
     * @param {?} nextLevel
     * @param {?} level
     * @return {?}
     */
    _setLevelsOptions(nextLevel, level) {
        console.log('VOCABULARY TREE *****');
        console.log(this.extraContent.selectedTermsIds, nextLevel);
        /** @type {?} */
        let result = [];
        nextLevel.forEach((/**
         * @param {?} node
         * @return {?}
         */
        (node) => {
            if (!((/** @type {?} */ (this.extraContent.excludeTermsIds))).some((/**
             * @param {?} id
             * @return {?}
             */
            (id) => id === node.term.uuid))) {
                result.push(node);
            }
            if (((/** @type {?} */ (this.extraContent.selectedTermsIds))).some((/**
             * @param {?} id
             * @return {?}
             */
            (id) => id === node.term.uuid))) {
                this.onSelectionChange(level, node.term);
                // this.addTermToValue(node.term);
                // this.levelsSelection[level] = node.term;
            }
        }));
        this.levelsOptions.push(result);
    }
    /**
     * @param {?} level
     * @param {?} item
     * @return {?}
     */
    onSelectionChange(level, item) {
        console.log(level, item);
        this.leafsOptions = null;
        this.chipsList = [];
        this.loading = true;
        this.lastLevelTerm = item;
        this.levelsOptions = this.levelsOptions.slice(0, level + 1);
        // this.removeTermFromValue(this.levelsSelection[level]);
        // this.levelsSelection[level] = item;
        // this.addTermToValue(this.levelsSelection[level]);
        this.content.value = [];
        this.levelsSelection = this.levelsSelection.slice(0, level);
        this.levelsSelection.push(item);
        this.levelsSelection.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            this.addTermToValue(element, false);
        }));
        this.service.getTermByUUID(item.uuid, 1).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            console.log(response);
            this.loading = false;
            /** @type {?} */
            const nextLevel = response.data.term_node.children;
            if (this.extraContent.level > level + 1) {
                this._setLevelsOptions(nextLevel, level);
            }
            else {
                this.leafsOptions = this._get_terms(nextLevel);
                this._updateFilteredOptions();
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            console.log("The observable got an error notification: " + err + ".");
        }), (/**
         * @return {?}
         */
        () => {
            console.log("The observable got a complete notification.");
            this.loading = !this.loading;
        }));
    }
    /**
     * @private
     * @return {?}
     */
    setValidation() {
        if (this.content.formControl.valid) {
            this.chipsFormControl.setErrors(null);
        }
        else {
            this.chipsFormControl.setErrors({ requiered: true });
        }
    }
    /**
     * @private
     * @param {?} term
     * @param {?=} isLeaf
     * @return {?}
     */
    addTermToValue(term, isLeaf = true) {
        if (this.extraContent.multiple) {
            this.content.value.unshift(term);
        }
        else {
            this.content.value = [];
            this.levelsSelection.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                this.content.value.unshift(element);
            }));
            this.content.value.unshift(term);
        }
        console.log(this.content.value);
        this.content.formControl.setValue(this.content.value);
        this.setValidation();
        console.log(this.content.formControl);
    }
    /**
     * @private
     * @param {?} term
     * @return {?}
     */
    removeTermFromValue(term) {
        this.content.value = ((/** @type {?} */ (this.content.value))).filter((/**
         * @param {?} e
         * @return {?}
         */
        (e) => e.id !== term.id));
        this.content.formControl.setValue(this.content.value);
        this.setValidation();
        console.log(this.content.formControl);
    }
    /**
     * @private
     * @return {?}
     */
    _updateFilteredOptions() {
        this.filteredOptions = this.chipsFormControl.valueChanges.pipe(startWith(""), map((/**
         * @param {?} value
         * @return {?}
         */
        (value) => {
            /** @type {?} */
            const filterValue = value ? value.toLowerCase() : "";
            return this.leafsOptions.filter((/**
             * @param {?} option
             * @return {?}
             */
            (option) => option.term.description.toLowerCase().includes(filterValue)));
        })));
    }
    /**
     * @private
     * @param {?} nodes
     * @return {?}
     */
    _get_terms(nodes) {
        this.chipsList = [];
        /** @type {?} */
        let result = [];
        nodes.forEach((/**
         * @param {?} node
         * @return {?}
         */
        (node) => {
            if (((/** @type {?} */ (this.extraContent.selectedTermsIds))).some((/**
             * @param {?} id
             * @return {?}
             */
            (id) => id === node.term.uuid))) {
                this.addTermToValue(node.term);
                this.chipsList.push(node);
            }
            else {
                // if is not in any of the exclude term ids, then push
                if (!((/** @type {?} */ (this.extraContent.excludeTermsIds))).some((/**
                 * @param {?} id
                 * @return {?}
                 */
                (id) => id === node.term.uuid))) {
                    result.push(node);
                }
            }
        }));
        return result;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    addChips(value) {
        if (this.extraContent.multiple) {
            this.chipsList.unshift(value);
        }
        else {
            // if not is multiple, then the element in the chipsList goes back to the options
            if (this.chipsList.length > 0) {
                this.leafsOptions.push(this.chipsList[0]);
            }
            this.chipsList = [value];
        }
        console.log(value, this.chipsList);
        this.addTermToValue(value.term);
        this.leafsOptions = this.leafsOptions.filter((/**
         * @param {?} option
         * @return {?}
         */
        (option) => option.term.id !== value.term.id));
        this.chipsFormControl.setValue("");
        // document.getElementById(this.inputId).blur();
        this._updateFilteredOptions();
    }
    /**
     * @param {?} index
     * @return {?}
     */
    removeChip(index) {
        this.leafsOptions.push(this.chipsList[index]);
        this.removeTermFromValue(this.chipsList[index].term);
        this.chipsList.splice(index, 1);
        this._updateFilteredOptions();
    }
    /**
     * @param {?} node
     * @return {?}
     */
    getTermNameInATree(node) {
        if (node.parent != null) {
            return (this.getTermNameInATree(node.parent) + " / " + node.term.description);
        }
        else {
            return node.term.description;
        }
    }
}
VocabularyTreeComponent.decorators = [
    { type: Component, args: [{
                selector: "toco-vocabulary-tree",
                template: "<mat-card>\n  <mat-card-header>\n\n    <mat-progress-bar *ngIf=\"!levelsOptions\" mode=\"indeterminate\"></mat-progress-bar>\n\n    <ng-template *ngIf=\"levelsOptions\" >\n\n      <mat-form-field\n      *ngFor=\"let level of levelsOptions; let i = index\"\n      class=\"select-mat-form-field\"\n      [appearance]=\"content.appearance\"\n      style=\"width: 100%;\"\n    >\n      <mat-label>{{ content.label }}</mat-label>\n      <mat-select\n        name=\"item\"\n        [required]=\"content.required\"\n        [multiple]=\"false\"\n        [(value)]=\"levelsSelection[i]\"\n        (selectionChange)=\"onSelectionChange(i, levelsSelection[i])\"\n      >\n        <mat-option *ngFor=\"let item of level\" [value]=\"item.term\">\n          {{ item.term.description }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    </ng-template>\n  </mat-card-header>\n\n  <mat-card-content *ngIf=\"lastLevelTerm\">\n    <mat-progress-bar *ngIf=\"!leafsOptions\" mode=\"indeterminate\">\n    </mat-progress-bar>\n\n    <mat-form-field *ngIf=\"leafsOptions\" style=\"width: 100%;\">\n      <mat-label>\n        {{ lastLevelTerm.description }}\n        <span *ngIf=\"content.required\">*</span></mat-label\n      >\n      <input\n        matInput\n        id=\"'inputId-'{{ content.name }}\"\n        type=\"text\"\n        [formControl]=\"chipsFormControl\"\n        [matAutocomplete]=\"auto\"\n        aria-label=\"Number\"\n      />\n\n      <mat-hint *ngIf=\"content.startHint\" [align]=\"'start'\">{{\n        content.startHint.label\n      }}</mat-hint>\n      <mat-hint *ngIf=\"!content.startHint\" [align]=\"'start'\">{{\n        searchText\n      }}</mat-hint>\n\n      <mat-autocomplete #auto=\"matAutocomplete\">\n        <mat-option\n          *ngFor=\"let option of filteredOptions | async\"\n          [value]=\"option.term.description\"\n          (click)=\"addChips(option)\"\n          [title]=\"option.term.description\"\n        >\n          {{ option.term.description }}\n        </mat-option>\n      </mat-autocomplete>\n\n      <!-- <button mat-icon-button color=\"accent\" class=\"delete-filter\" (click)=\"remove_component()\">\n      <mat-icon>close</mat-icon>\n    </button> -->\n    </mat-form-field>\n\n    <mat-chip-list\n      class=\"mat-chip-list-stacked\"\n      fxLayout=\"row\"\n      fxLayoutAlign=\"start center\"\n      style=\"margin-bottom: 0.5em;\"\n      id=\"chiplist-{{ extraContent.vocab }}\"\n    >\n      <mat-chip\n        *ngFor=\"let item of chipsList; let i = index\"\n        (removed)=\"removeChip(i)\"\n        [removable]=\"true\"\n      >\n        {{ getTermNameInATree(item) }}\n        <mat-icon matChipRemove>cancel</mat-icon>\n      </mat-chip>\n    </mat-chip-list>\n  </mat-card-content>\n</mat-card>\n",
                host: {
                    "[style.minWidth]": "content.minWidth",
                    "[style.width]": "content.width",
                },
                styles: [""]
            }] }
];
/** @nocollapse */
VocabularyTreeComponent.ctorParameters = () => [
    { type: TaxonomyService }
];
if (false) {
    /** @type {?} */
    VocabularyTreeComponent.prototype.chipsFormControl;
    /** @type {?} */
    VocabularyTreeComponent.prototype.levelsOptions;
    /** @type {?} */
    VocabularyTreeComponent.prototype.levelsSelection;
    /** @type {?} */
    VocabularyTreeComponent.prototype.lastLevelTerm;
    /** @type {?} */
    VocabularyTreeComponent.prototype.inputId;
    /** @type {?} */
    VocabularyTreeComponent.prototype.filteredOptions;
    /** @type {?} */
    VocabularyTreeComponent.prototype.chipsList;
    /** @type {?} */
    VocabularyTreeComponent.prototype.leafsOptions;
    /** @type {?} */
    VocabularyTreeComponent.prototype.terms;
    /** @type {?} */
    VocabularyTreeComponent.prototype.loading;
    /** @type {?} */
    VocabularyTreeComponent.prototype.extraContent;
    /** @type {?} */
    VocabularyTreeComponent.prototype.searchText;
    /**
     * @type {?}
     * @private
     */
    VocabularyTreeComponent.prototype.service;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidm9jYWJ1bGFyeS10cmVlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2Zvcm1zL2V4cGVyaW1lbnRhbC92b2NhYnVsYXJ5LXRyZWUvdm9jYWJ1bGFyeS10cmVlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ2xELE9BQU8sRUFDTCxXQUFXLEdBSVosTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QixPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUc5RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7Ozs7QUFLekQsOENBUUM7OztJQVBDLG1EQUFrQjs7SUFDbEIsMkRBQXFCOztJQUNyQiwwREFBb0I7O0lBRXBCLGdEQUFjOztJQUVkLGdEQUFrQzs7Ozs7QUFlcEMsTUFBTSxPQUFPLHVCQUF3QixTQUFRLFlBQVk7Ozs7SUEyQnZELFlBQW9CLE9BQXdCO1FBQzFDLEtBQUssRUFBRSxDQUFDO1FBRFUsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7OztRQXRCNUMscUJBQWdCLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUVyQyxrQkFBYSxHQUFzQixJQUFJLENBQUM7UUFDeEMsb0JBQWUsR0FBZ0IsSUFBSSxLQUFLLEVBQVEsQ0FBQztRQUVqRCxrQkFBYSxHQUFTLElBQUksQ0FBQztRQUkzQixjQUFTLEdBQWUsRUFBRSxDQUFDO1FBQzNCLGlCQUFZLEdBQWUsSUFBSSxDQUFDO1FBRWhDLFVBQUssR0FBZSxFQUFFLENBQUM7UUFFdkIsWUFBTyxHQUFHLElBQUksQ0FBQzs7UUFNZixlQUFVLEdBQUcseUJBQXlCLENBQUM7SUFJdkMsQ0FBQzs7OztJQUVELFFBQVE7UUFD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QUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ2hDLENBQUM7Ozs7O0lBRUQsa0JBQWtCLENBQUMsSUFBYztRQUMvQixJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxFQUFFO1lBQ3ZCLE9BQU8sQ0FDTCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FDckUsQ0FBQztTQUNIO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1NBQzlCO0lBQ0gsQ0FBQzs7O1lBclNGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsc0JBQXNCO2dCQUNoQyxvdUZBQStDO2dCQUUvQyxJQUFJLEVBQUU7b0JBQ0osa0JBQWtCLEVBQUUsa0JBQWtCO29CQUN0QyxlQUFlLEVBQUUsZUFBZTtpQkFDakM7O2FBQ0Y7Ozs7WUE3QlEsZUFBZTs7OztJQW1DdEIsbURBQXFDOztJQUVyQyxnREFBd0M7O0lBQ3hDLGtEQUFpRDs7SUFFakQsZ0RBQTJCOztJQUUzQiwwQ0FBZ0I7O0lBQ2hCLGtEQUF3Qzs7SUFDeEMsNENBQTJCOztJQUMzQiwrQ0FBZ0M7O0lBRWhDLHdDQUF1Qjs7SUFFdkIsMENBQWU7O0lBRWYsK0NBQThDOztJQUk5Qyw2Q0FBdUM7Ozs7O0lBRTNCLDBDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiAgIENvcHlyaWdodCAoYykgMjAyMCBVbml2ZXJzaWRhZCBkZSBQaW5hciBkZWwgUsOtbyBcIkhlcm1hbm9zIFNhw616IE1vbnRlcyBkZSBPY2FcIlxuICogICBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7XG4gIEZvcm1Db250cm9sLFxuICBBYnN0cmFjdENvbnRyb2wsXG4gIFZhbGlkYXRpb25FcnJvcnMsXG4gIEZvcm1Hcm91cCxcbn0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBQYXJ0aWFsT2JzZXJ2ZXIgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgc3RhcnRXaXRoLCBtYXAgfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcbmltcG9ydCB7IFRheG9ub215U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBWb2NhYnVsYXJpZXNJbm11dGFibGVOYW1lcywgVGVybU5vZGUsIFRlcm0gfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9wdWJsaWMtYXBpJztcblxuaW1wb3J0IHsgSW5wdXRDb250cm9sIH0gZnJvbSAnLi4vLi4vaW5wdXQvaW5wdXQuY29udHJvbCc7XG5cbmltcG9ydCB7IFJlc3BvbnNlIH0gZnJvbSAnLi4vLi4vLi4vY29yZS9wdWJsaWMtYXBpJztcblxuXG5pbnRlcmZhY2UgVm9jYWJ1bGFyeUNvbXBvbmVudEV4dHJhQ29udGVudCB7XG4gIG11bHRpcGxlOiBib29sZWFuO1xuICBzZWxlY3RlZFRlcm1zSWRzOiBbXTtcbiAgZXhjbHVkZVRlcm1zSWRzOiBbXTtcblxuICBsZXZlbDogbnVtYmVyO1xuXG4gIHZvY2FiOiBWb2NhYnVsYXJpZXNJbm11dGFibGVOYW1lcztcbn1cblxuLyoqXG4gKiBBIGNvbnRyb2wgdG8gc2VsZWN0IGEgdGVybSBvciB0ZXJtcyBpbiBhIHZvY2FidWxhcnkuXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0b2NvLXZvY2FidWxhcnktdHJlZVwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL3ZvY2FidWxhcnktdHJlZS5jb21wb25lbnQuaHRtbFwiLFxuICBzdHlsZVVybHM6IFtcIi4vdm9jYWJ1bGFyeS10cmVlLmNvbXBvbmVudC5zY3NzXCJdLFxuICBob3N0OiB7XG4gICAgXCJbc3R5bGUubWluV2lkdGhdXCI6IFwiY29udGVudC5taW5XaWR0aFwiLFxuICAgIFwiW3N0eWxlLndpZHRoXVwiOiBcImNvbnRlbnQud2lkdGhcIixcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgVm9jYWJ1bGFyeVRyZWVDb21wb25lbnQgZXh0ZW5kcyBJbnB1dENvbnRyb2xcbiAgaW1wbGVtZW50cyBPbkluaXQge1xuICAvLyBpbnRlcm5hbENvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAvL3RoaXMgY29udHJvbCBpcyB1c2VkIGJ5IHRoZSBjaGlwcyxub3QgbmVjZXNzYXJ5IHRvIGV4cG9zZSBpdFxuICBjaGlwc0Zvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKCk7XG5cbiAgbGV2ZWxzT3B0aW9uczogQXJyYXk8VGVybU5vZGVbXT4gPSBudWxsO1xuICBsZXZlbHNTZWxlY3Rpb246IEFycmF5PFRlcm0+ID0gbmV3IEFycmF5PFRlcm0+KCk7XG5cbiAgbGFzdExldmVsVGVybTogVGVybSA9IG51bGw7XG5cbiAgaW5wdXRJZDogc3RyaW5nO1xuICBmaWx0ZXJlZE9wdGlvbnM6IE9ic2VydmFibGU8VGVybU5vZGVbXT47XG4gIGNoaXBzTGlzdDogVGVybU5vZGVbXSA9IFtdO1xuICBsZWFmc09wdGlvbnM6IFRlcm1Ob2RlW10gPSBudWxsO1xuXG4gIHRlcm1zOiBUZXJtTm9kZVtdID0gW107XG5cbiAgbG9hZGluZyA9IHRydWU7XG5cbiAgZXh0cmFDb250ZW50OiBWb2NhYnVsYXJ5Q29tcG9uZW50RXh0cmFDb250ZW50O1xuXG4gIC8vIHNlbGVjdGVkVGVybXNJZHMgPSBbXTtcblxuICBzZWFyY2hUZXh0ID0gXCJTZWxlY2Npb25lIGxhcyBvcGNpb25lc1wiO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgc2VydmljZTogVGF4b25vbXlTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaW5pdCgnJywgJycsIGZhbHNlLCB0cnVlKTtcbiAgICAvLyAodGhpcy5jb250ZW50LnBhcmVudEZvcm1TZWN0aW9uIGFzIEZvcm1Hcm91cCkuYWRkQ29udHJvbChcbiAgICAvLyAgIHRoaXMuY29udGVudC5uYW1lLFxuICAgIC8vICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sXG4gICAgLy8gKTtcbiAgICBpZiAodGhpcy5jb250ZW50LnJlcXVpcmVkKSB7XG4gICAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsaWRhdG9ycyhcbiAgICAgICAgKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgICAgICAgICByZXR1cm4gIXRoaXMuY29udGVudC52YWx1ZSB8fCB0aGlzLmNvbnRlbnQudmFsdWUubGVuZ3RoID09IDBcbiAgICAgICAgICAgID8geyByZXF1aXJlZFRlcm1zOiBcIk5vIFRlcm1zIFNlbGVjdGVkXCIgfVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuaW5wdXRJZCA9IHRoaXMuY29udGVudC5sYWJlbC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAodGhpcy5jb250ZW50LmV4dHJhQ29udGVudCkge1xuICAgICAgdGhpcy5leHRyYUNvbnRlbnQgPSB0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50O1xuXG4gICAgICAvLyBhbHJlYWR5IHNlbGVjdGVkIHRlcm1zXG4gICAgICBpZiAoIXRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHMpIHtcbiAgICAgICAgdGhpcy5leHRyYUNvbnRlbnQuc2VsZWN0ZWRUZXJtc0lkcyA9IFtdO1xuICAgICAgfVxuXG4gICAgICAvLyB0ZXJtcyBpZHMgdG8gZXhjbHVkZSBvZiB0aGUgcG9zc2libGUgb3B0aW9ucy5cbiAgICAgIGlmICghdGhpcy5leHRyYUNvbnRlbnQuZXhjbHVkZVRlcm1zSWRzKSB7XG4gICAgICAgIHRoaXMuZXh0cmFDb250ZW50LmV4Y2x1ZGVUZXJtc0lkcyA9IFtdO1xuICAgICAgfVxuICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gW107XG4gICAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5jb250ZW50LnZhbHVlKTtcblxuICAgICAgaWYgKHRoaXMuZXh0cmFDb250ZW50LmxldmVsID09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmV4dHJhQ29udGVudC5sZXZlbCA9IDEwO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZXh0cmFDb250ZW50LnZvY2FiKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRUZXJtc1RyZWVCeVZvY2FiKHRoaXMuZXh0cmFDb250ZW50LnZvY2FiLCAwKS5zdWJzY3JpYmUoXG4gICAgICAgICAgKHJlc3BvbnNlOiBSZXNwb25zZTxhbnk+KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IG5leHRMZXZlbCA9IHJlc3BvbnNlLmRhdGEudHJlZS50ZXJtX25vZGU7XG4gICAgICAgICAgICBpZiAodGhpcy5leHRyYUNvbnRlbnQubGV2ZWwgPiAwKSB7XG4gICAgICAgICAgICAgIHRoaXMubGV2ZWxzT3B0aW9ucyA9IG5ldyBBcnJheTxUZXJtTm9kZVtdPigpO1xuICAgICAgICAgICAgICAvLyB0aGlzLmxldmVsc1NlbGVjdGlvbiA9IG5ldyBBcnJheTxUZXJtTm9kZT4oKTtcbiAgICAgICAgICAgICAgdGhpcy5fc2V0TGV2ZWxzT3B0aW9ucyhuZXh0TGV2ZWwsIDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5sZWFmc09wdGlvbnMgPSB0aGlzLl9nZXRfdGVybXMobmV4dExldmVsKTtcbiAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlRmlsdGVyZWRPcHRpb25zKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgIFwiVGhlIG9ic2VydmFibGUgZ290IGFuIGVycm9yIG5vdGlmaWNhdGlvbjogXCIgKyBlcnIgKyBcIi5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgb2JzZXJ2YWJsZSBnb3QgYSBjb21wbGV0ZSBub3RpZmljYXRpb24uXCIpO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gIXRoaXMubG9hZGluZztcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvLyAgIGVsc2UgaWYodGhpcy5leHRyYUNvbnRlbnQudGVybUlEKXtcbiAgICAgIC8vICAgICB0aGlzLnNlcnZpY2UuZ2V0VGVybUJ5VVVJRCh0aGlzLmV4dHJhQ29udGVudC50ZXJtSUQsIHRoaXMuZXh0cmFDb250ZW50LmxldmVsKVxuICAgICAgLy8gICAgIC5zdWJzY3JpYmUodGhpcy50ZXJtc1RyZWVPYnNlcnZlcik7XG4gICAgICAvLyB9XG4gICAgfVxuICB9XG4gIHByaXZhdGUgX3NldExldmVsc09wdGlvbnMobmV4dExldmVsOiBUZXJtTm9kZVtdLCBsZXZlbDogbnVtYmVyKSB7XG4gICAgY29uc29sZS5sb2coJ1ZPQ0FCVUxBUlkgVFJFRSAqKioqKicpXG4gICAgY29uc29sZS5sb2codGhpcy5leHRyYUNvbnRlbnQuc2VsZWN0ZWRUZXJtc0lkcywgbmV4dExldmVsKVxuICAgIGxldCByZXN1bHQ6IFRlcm1Ob2RlW10gPSBbXTtcbiAgICBuZXh0TGV2ZWwuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICAhKHRoaXMuZXh0cmFDb250ZW50LmV4Y2x1ZGVUZXJtc0lkcyBhcyBbXSkuc29tZShcbiAgICAgICAgICAoaWQpID0+IGlkID09PSBub2RlLnRlcm0udXVpZFxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgcmVzdWx0LnB1c2gobm9kZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgKHRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHMgYXMgW10pLnNvbWUoXG4gICAgICAgICAgKGlkKSA9PiBpZCA9PT0gbm9kZS50ZXJtLnV1aWRcblxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5vblNlbGVjdGlvbkNoYW5nZShsZXZlbCwgbm9kZS50ZXJtKVxuICAgICAgICAvLyB0aGlzLmFkZFRlcm1Ub1ZhbHVlKG5vZGUudGVybSk7XG4gICAgICAgIC8vIHRoaXMubGV2ZWxzU2VsZWN0aW9uW2xldmVsXSA9IG5vZGUudGVybTtcbiAgICAgIH1cblxuXG4gICAgfSk7XG4gICAgdGhpcy5sZXZlbHNPcHRpb25zLnB1c2gocmVzdWx0KTtcbiAgfVxuICBvblNlbGVjdGlvbkNoYW5nZShsZXZlbCwgaXRlbTogVGVybSkge1xuICAgIGNvbnNvbGUubG9nKGxldmVsLCBpdGVtKTtcbiAgICB0aGlzLmxlYWZzT3B0aW9ucyA9IG51bGw7XG4gICAgdGhpcy5jaGlwc0xpc3QgPSBbXTtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMubGFzdExldmVsVGVybSA9IGl0ZW07XG4gICAgdGhpcy5sZXZlbHNPcHRpb25zID0gdGhpcy5sZXZlbHNPcHRpb25zLnNsaWNlKDAsIGxldmVsKzEpO1xuXG4gICAgLy8gdGhpcy5yZW1vdmVUZXJtRnJvbVZhbHVlKHRoaXMubGV2ZWxzU2VsZWN0aW9uW2xldmVsXSk7XG4gICAgLy8gdGhpcy5sZXZlbHNTZWxlY3Rpb25bbGV2ZWxdID0gaXRlbTtcbiAgICAvLyB0aGlzLmFkZFRlcm1Ub1ZhbHVlKHRoaXMubGV2ZWxzU2VsZWN0aW9uW2xldmVsXSk7XG5cbiAgICB0aGlzLmNvbnRlbnQudmFsdWUgPSBbXTtcblxuICAgIHRoaXMubGV2ZWxzU2VsZWN0aW9uID0gdGhpcy5sZXZlbHNTZWxlY3Rpb24uc2xpY2UoMCwgbGV2ZWwpO1xuICAgIHRoaXMubGV2ZWxzU2VsZWN0aW9uLnB1c2goaXRlbSk7XG4gICAgdGhpcy5sZXZlbHNTZWxlY3Rpb24uZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIHRoaXMuYWRkVGVybVRvVmFsdWUoZWxlbWVudCwgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZXJ2aWNlLmdldFRlcm1CeVVVSUQoaXRlbS51dWlkLCAxKS5zdWJzY3JpYmUoXG4gICAgICAocmVzcG9uc2U6IFJlc3BvbnNlPGFueT4pID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgbmV4dExldmVsID0gcmVzcG9uc2UuZGF0YS50ZXJtX25vZGUuY2hpbGRyZW47XG4gICAgICAgIGlmICh0aGlzLmV4dHJhQ29udGVudC5sZXZlbCA+IGxldmVsICsgMSkge1xuICAgICAgICAgIHRoaXMuX3NldExldmVsc09wdGlvbnMobmV4dExldmVsLCBsZXZlbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5sZWFmc09wdGlvbnMgPSB0aGlzLl9nZXRfdGVybXMobmV4dExldmVsKTtcbiAgICAgICAgICB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgKGVycjogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVGhlIG9ic2VydmFibGUgZ290IGFuIGVycm9yIG5vdGlmaWNhdGlvbjogXCIgKyBlcnIgKyBcIi5cIik7XG4gICAgICB9LFxuXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVGhlIG9ic2VydmFibGUgZ290IGEgY29tcGxldGUgbm90aWZpY2F0aW9uLlwiKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gIXRoaXMubG9hZGluZztcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRWYWxpZGF0aW9uKCkge1xuICAgIGlmICh0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wudmFsaWQpIHtcbiAgICAgIHRoaXMuY2hpcHNGb3JtQ29udHJvbC5zZXRFcnJvcnMobnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hpcHNGb3JtQ29udHJvbC5zZXRFcnJvcnMoeyByZXF1aWVyZWQ6IHRydWUgfSk7XG4gICAgfVxuICB9XG5cblxuICBwcml2YXRlIGFkZFRlcm1Ub1ZhbHVlKHRlcm06IFRlcm0sIGlzTGVhZj10cnVlKSB7XG4gICAgaWYgKHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlKSB7XG4gICAgICB0aGlzLmNvbnRlbnQudmFsdWUudW5zaGlmdCh0ZXJtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gW107XG4gICAgICB0aGlzLmxldmVsc1NlbGVjdGlvbi5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICB0aGlzLmNvbnRlbnQudmFsdWUudW5zaGlmdChlbGVtZW50KTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jb250ZW50LnZhbHVlLnVuc2hpZnQodGVybSk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKHRoaXMuY29udGVudC52YWx1ZSlcbiAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5jb250ZW50LnZhbHVlKTtcbiAgICB0aGlzLnNldFZhbGlkYXRpb24oKTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wpO1xuXG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVRlcm1Gcm9tVmFsdWUodGVybTogVGVybSkge1xuICAgIHRoaXMuY29udGVudC52YWx1ZSA9ICh0aGlzLmNvbnRlbnQudmFsdWUgYXMgW10pLmZpbHRlcihcbiAgICAgIChlOiBUZXJtKSA9PiBlLmlkICE9PSB0ZXJtLmlkXG4gICAgKTtcbiAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5jb250ZW50LnZhbHVlKTtcbiAgICB0aGlzLnNldFZhbGlkYXRpb24oKTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wpO1xuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlRmlsdGVyZWRPcHRpb25zKCkge1xuICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gdGhpcy5jaGlwc0Zvcm1Db250cm9sLnZhbHVlQ2hhbmdlcy5waXBlPFxuICAgICAgc3RyaW5nLFxuICAgICAgVGVybU5vZGVbXVxuICAgID4oXG4gICAgICBzdGFydFdpdGgoXCJcIiksXG4gICAgICBtYXAoKHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpbHRlclZhbHVlID0gdmFsdWUgPyB2YWx1ZS50b0xvd2VyQ2FzZSgpIDogXCJcIjtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVhZnNPcHRpb25zLmZpbHRlcigob3B0aW9uKSA9PlxuICAgICAgICAgIG9wdGlvbi50ZXJtLmRlc2NyaXB0aW9uLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyVmFsdWUpXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIF9nZXRfdGVybXMobm9kZXM6IFRlcm1Ob2RlW10pOiBUZXJtTm9kZVtdIHtcbiAgICB0aGlzLmNoaXBzTGlzdCA9IFtdO1xuICAgIGxldCByZXN1bHQ6IFRlcm1Ob2RlW10gPSBbXTtcbiAgICBub2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgICh0aGlzLmV4dHJhQ29udGVudC5zZWxlY3RlZFRlcm1zSWRzIGFzIFtdKS5zb21lKFxuICAgICAgICAgIChpZCkgPT4gaWQgPT09IG5vZGUudGVybS51dWlkXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICB0aGlzLmFkZFRlcm1Ub1ZhbHVlKG5vZGUudGVybSk7XG4gICAgICAgIHRoaXMuY2hpcHNMaXN0LnB1c2gobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpZiBpcyBub3QgaW4gYW55IG9mIHRoZSBleGNsdWRlIHRlcm0gaWRzLCB0aGVuIHB1c2hcbiAgICAgICAgaWYgKFxuICAgICAgICAgICEodGhpcy5leHRyYUNvbnRlbnQuZXhjbHVkZVRlcm1zSWRzIGFzIFtdKS5zb21lKFxuICAgICAgICAgICAgKGlkKSA9PiBpZCA9PT0gbm9kZS50ZXJtLnV1aWRcbiAgICAgICAgICApXG4gICAgICAgICkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgYWRkQ2hpcHModmFsdWU6IFRlcm1Ob2RlKSB7XG4gICAgaWYgKHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlKSB7XG4gICAgICB0aGlzLmNoaXBzTGlzdC51bnNoaWZ0KHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gaWYgbm90IGlzIG11bHRpcGxlLCB0aGVuIHRoZSBlbGVtZW50IGluIHRoZSBjaGlwc0xpc3QgZ29lcyBiYWNrIHRvIHRoZSBvcHRpb25zXG4gICAgICBpZiAodGhpcy5jaGlwc0xpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLmxlYWZzT3B0aW9ucy5wdXNoKHRoaXMuY2hpcHNMaXN0WzBdKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2hpcHNMaXN0ID0gW3ZhbHVlXTtcbiAgICB9XG4gICAgY29uc29sZS5sb2codmFsdWUsIHRoaXMuY2hpcHNMaXN0KTtcbiAgICB0aGlzLmFkZFRlcm1Ub1ZhbHVlKHZhbHVlLnRlcm0pO1xuICAgIHRoaXMubGVhZnNPcHRpb25zID0gdGhpcy5sZWFmc09wdGlvbnMuZmlsdGVyKFxuICAgICAgKG9wdGlvbikgPT4gb3B0aW9uLnRlcm0uaWQgIT09IHZhbHVlLnRlcm0uaWRcbiAgICApO1xuXG4gICAgdGhpcy5jaGlwc0Zvcm1Db250cm9sLnNldFZhbHVlKFwiXCIpO1xuICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaW5wdXRJZCkuYmx1cigpO1xuICAgIHRoaXMuX3VwZGF0ZUZpbHRlcmVkT3B0aW9ucygpO1xuICB9XG5cbiAgcmVtb3ZlQ2hpcChpbmRleDogbnVtYmVyKSB7XG4gICAgdGhpcy5sZWFmc09wdGlvbnMucHVzaCh0aGlzLmNoaXBzTGlzdFtpbmRleF0pO1xuICAgIHRoaXMucmVtb3ZlVGVybUZyb21WYWx1ZSh0aGlzLmNoaXBzTGlzdFtpbmRleF0udGVybSk7XG4gICAgdGhpcy5jaGlwc0xpc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgICB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgfVxuXG4gIGdldFRlcm1OYW1lSW5BVHJlZShub2RlOiBUZXJtTm9kZSkge1xuICAgIGlmIChub2RlLnBhcmVudCAhPSBudWxsKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICB0aGlzLmdldFRlcm1OYW1lSW5BVHJlZShub2RlLnBhcmVudCkgKyBcIiAvIFwiICsgbm9kZS50ZXJtLmRlc2NyaXB0aW9uXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbm9kZS50ZXJtLmRlc2NyaXB0aW9uO1xuICAgIH1cbiAgfVxufVxuIl19