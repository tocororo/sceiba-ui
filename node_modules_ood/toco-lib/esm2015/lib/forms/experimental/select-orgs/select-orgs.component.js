/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/select-orgs/select-orgs.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormControl } from '@angular/forms';
import { InputControl } from '../../input/input.control';
import { OrganizationServiceNoAuth } from '../../../backend/organization.service';
import { HttpParams } from '@angular/common/http';
import { HitList } from '../../../entities/common';
/**
 * @record
 */
function SelectOrgsComponentExtraContent() { }
if (false) {
    /** @type {?} */
    SelectOrgsComponentExtraContent.prototype.multiple;
    /** @type {?} */
    SelectOrgsComponentExtraContent.prototype.selectedOrgsIds;
    /**
     * Input `orgFilter` is a dict with `type` and `value` to filter the organizations,
     * \@Example { type: 'country' , value: 'Cuba" }
     * @type {?}
     */
    SelectOrgsComponentExtraContent.prototype.orgFilter;
}
export class SelectOrgsComponent extends InputControl {
    /**
     * @param {?} _orgService
     */
    constructor(_orgService) {
        super();
        this._orgService = _orgService;
        /**
         * Input `orgCtrl` is a FormControl
         */
        this.orgCtrl = new FormControl();
        this.filteredOrg = new HitList();
        this.params = new HttpParams();
        this.placeholder = "Escriba al menos 3 letras";
        this.label = "Busque una organizaciÃ³n";
        this.appearance = "outline";
        /**
         * Input `cleaning` is a boolen, if true then clean the search
         */
        this.cleaning = false;
        this.selectedOrg = new EventEmitter();
        this.chipsList = [];
        this.loading = false;
        this.toSearch = 0;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init('', '', false, false);
        this.extraContent = this.content.extraContent;
        this.content.value = [];
        this.extraContent.selectedOrgsIds.forEach((/**
         * @param {?} uuid
         * @return {?}
         */
        uuid => {
            this._orgService.getOrganizationByUUID(uuid).subscribe({
                next: (/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    this.addChips(response);
                })
            });
        }));
        this.params = this.params.set('size', '10');
        this.params = this.params.set('page', '1');
        if (this.extraContent.orgFilter != undefined) {
            this.params = this.params.set(this.extraContent.orgFilter.type, this.extraContent.orgFilter.value);
        }
        this.orgCtrl.valueChanges
            .subscribe({
            next: (/**
             * @param {?} orgValueChanges
             * @return {?}
             */
            (orgValueChanges) => {
                this.toSearch++;
                // this condition check if the param is a `string` an if at least write 3 letters
                if (this.toSearch > 3 && typeof orgValueChanges === 'string') {
                    this.toSearch = 0;
                    this.params = this.params.set('q', orgValueChanges);
                    this.loading = true;
                    this._orgService.getOrganizations(this.params).subscribe({
                        next: (/**
                         * @param {?} response
                         * @return {?}
                         */
                        (response) => {
                            this.filteredOrg = response.hits;
                            this.loading = false;
                        })
                    });
                }
                else if (typeof orgValueChanges === 'object') {
                    this.toSearch = 0;
                    this.selectedOrg.emit(orgValueChanges);
                    if (this.cleaning) {
                        this.orgCtrl.setValue('');
                    }
                }
            })
        });
    }
    /* This function return the organization name
        * @param org the Organization object
        */
    /**
     * @param {?=} org
     * @return {?}
     */
    displayFn(org) {
        return org ? org.name : undefined;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    addChips(value) {
        if (this.extraContent.multiple) {
            if (!this.chipsList.find((/**
             * @param {?} x
             * @return {?}
             */
            x => x.id == value.id))) {
                this.chipsList.unshift(value);
                this.content.value.unshift(value);
            }
        }
        else {
            this.chipsList = [value];
            this.content.value = [value];
        }
        this.content.formControl.setValue(this.content.value);
        this.orgCtrl.setValue("");
        this.filteredOrg = new HitList();
    }
    /**
     * @param {?} index
     * @return {?}
     */
    removeChip(index) {
        /** @type {?} */
        let todelete = this.chipsList[index];
        this.content.value = ((/** @type {?} */ (this.content.value))).filter((/**
         * @param {?} e
         * @return {?}
         */
        (e) => e.id !== todelete.id));
        this.content.formControl.setValue(this.content.value);
        this.chipsList.splice(index, 1);
    }
}
SelectOrgsComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-select-org',
                template: "<mat-card>\n\n\n  <mat-card-subtitle>\n    <mat-form-field style=\"width: 100%;height: 100%;\">\n\n      <mat-label> {{content.label}} <span *ngIf=\"content.required\">*</span></mat-label>\n      <input matInput placeholder=\"{{placeholder}}\" aria-label=\"Buscar\" [matAutocomplete]=\"auto\" [formControl]=\"orgCtrl\">\n      <input\n        matInput\n        id=\"'inputId-'{{content.name}}\"\n        type=\"text\"\n        [formControl]=\"orgCtrl\"\n        [matAutocomplete]=\"auto\"\n          aria-label=\"Number\"\n      />\n\n      <mat-hint *ngIf=\"content.startHint\" [align]=\"'start'\">{{ content.startHint.label }}</mat-hint>\n\n      <mat-autocomplete #auto=\"matAutocomplete\" [displayWith]=\"displayFn\">\n\n        <mat-option *ngFor=\"let org of filteredOrg.hits\" [value]=\"org.metadata\" (click)=\"addChips(org)\">\n            <span title=\"{{org.metadata.name}}\">{{org.metadata.name}}</span>\n        </mat-option>\n\n      </mat-autocomplete>\n\n      <!-- <button mat-icon-button color=\"accent\" class=\"delete-filter\" (click)=\"remove_component()\">\n        <mat-icon>close</mat-icon>\n      </button> -->\n    </mat-form-field>\n  </mat-card-subtitle>\n\n  <mat-progress-bar\n    mode=\"indeterminate\"\n    *ngIf=\"loading\">\n  </mat-progress-bar>\n\n  <mat-card-content *ngIf=\"!loading\">\n    <mat-chip-list class=\"mat-chip-list-stacked\" fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"margin-bottom: .5em\"\n      id=\"chiplist-{{content.name}}\">\n      <mat-chip *ngFor=\"let item of chipsList; let i=index\" (removed)=\"removeChip(i)\" [removable]=\"true\" style=\"width: 100%;height: 100%;\">\n        {{ item.metadata.name }}\n        <mat-icon matChipRemove>cancel</mat-icon>\n      </mat-chip>\n    </mat-chip-list>\n  </mat-card-content>\n\n</mat-card>\n",
                host: {
                    "[style.minWidth]": "content.minWidth",
                    "[style.width]": "content.width"
                },
                styles: [""]
            }] }
];
/** @nocollapse */
SelectOrgsComponent.ctorParameters = () => [
    { type: OrganizationServiceNoAuth }
];
SelectOrgsComponent.propDecorators = {
    orgCtrl: [{ type: Input }],
    placeholder: [{ type: Input }],
    label: [{ type: Input }],
    appearance: [{ type: Input }],
    cleaning: [{ type: Input }],
    selectedOrg: [{ type: Output }]
};
if (false) {
    /**
     * Input `orgCtrl` is a FormControl
     * @type {?}
     */
    SelectOrgsComponent.prototype.orgCtrl;
    /** @type {?} */
    SelectOrgsComponent.prototype.filteredOrg;
    /** @type {?} */
    SelectOrgsComponent.prototype.params;
    /** @type {?} */
    SelectOrgsComponent.prototype.placeholder;
    /** @type {?} */
    SelectOrgsComponent.prototype.label;
    /** @type {?} */
    SelectOrgsComponent.prototype.appearance;
    /**
     * Input `cleaning` is a boolen, if true then clean the search
     * @type {?}
     */
    SelectOrgsComponent.prototype.cleaning;
    /** @type {?} */
    SelectOrgsComponent.prototype.selectedOrg;
    /** @type {?} */
    SelectOrgsComponent.prototype.chipsList;
    /** @type {?} */
    SelectOrgsComponent.prototype.extraContent;
    /** @type {?} */
    SelectOrgsComponent.prototype.loading;
    /** @type {?} */
    SelectOrgsComponent.prototype.toSearch;
    /**
     * @type {?}
     * @private
     */
    SelectOrgsComponent.prototype._orgService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LW9yZ3MuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvZm9ybXMvZXhwZXJpbWVudGFsL3NlbGVjdC1vcmdzL3NlbGVjdC1vcmdzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUFFLFdBQVcsRUFBcUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVoRixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDbEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBTyxPQUFPLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7OztBQUd4RCw4Q0FTQzs7O0lBUkMsbURBQWtCOztJQUNsQiwwREFBb0I7Ozs7OztJQUtwQixvREFBMEM7O0FBYTVDLE1BQU0sT0FBTyxtQkFBb0IsU0FBUSxZQUFZOzs7O0lBcUNsRCxZQUFxQixXQUFzQztRQUFLLEtBQUssRUFBRSxDQUFDO1FBQW5ELGdCQUFXLEdBQVgsV0FBVyxDQUEyQjs7OztRQTlCM0QsWUFBTyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFFNUIsZ0JBQVcsR0FBRyxJQUFLLE9BQU8sRUFBZ0IsQ0FBQztRQUUzQyxXQUFNLEdBQUUsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUl6QixnQkFBVyxHQUFXLDJCQUEyQixDQUFDO1FBR2xELFVBQUssR0FBVyx5QkFBeUIsQ0FBQztRQUcxQyxlQUFVLEdBQVcsU0FBUyxDQUFDOzs7O1FBTS9CLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFHMUIsZ0JBQVcsR0FBK0IsSUFBSSxZQUFZLEVBQWdCLENBQUM7UUFF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QyxDQUFDO1FBQ0YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7OztZQXZIRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0IsNnhEQUEyQztnQkFFM0MsSUFBSSxFQUFFO29CQUNKLGtCQUFrQixFQUFFLGtCQUFrQjtvQkFDdEMsZUFBZSxFQUFFLGVBQWU7aUJBQ2pDOzthQUNGOzs7O1lBeEJRLHlCQUF5Qjs7O3NCQStCOUIsS0FBSzswQkFRTCxLQUFLO29CQUdMLEtBQUs7eUJBR0wsS0FBSzt1QkFNTCxLQUFLOzBCQUdMLE1BQU07Ozs7Ozs7SUF2QlAsc0NBQzRCOztJQUU1QiwwQ0FBMkM7O0lBRTNDLHFDQUF5Qjs7SUFHekIsMENBQ2tEOztJQUVsRCxvQ0FDMEM7O0lBRTFDLHlDQUMrQjs7Ozs7SUFLL0IsdUNBQzBCOztJQUUxQiwwQ0FDMkU7O0lBRTNFLHdDQUFvQzs7SUFDcEMsMkNBQThDOztJQUM5QyxzQ0FBZ0I7O0lBRWhCLHVDQUFXOzs7OztJQUNFLDBDQUE4QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IElucHV0Q29udHJvbCB9IGZyb20gJy4uLy4uL2lucHV0L2lucHV0LmNvbnRyb2wnO1xuaW1wb3J0IHsgT3JnYW5pemF0aW9uU2VydmljZU5vQXV0aCB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvb3JnYW5pemF0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgSHR0cFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEhpdCwgSGl0TGlzdCB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL2NvbW1vbic7XG5pbXBvcnQgeyBPcmdhbml6YXRpb24gfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9vcmdhbml6YXRpb24uZW50aXR5JztcblxuaW50ZXJmYWNlIFNlbGVjdE9yZ3NDb21wb25lbnRFeHRyYUNvbnRlbnR7XG4gIG11bHRpcGxlOiBib29sZWFuO1xuICBzZWxlY3RlZE9yZ3NJZHM6IFtdO1xuICAvKipcbiAgICAqIElucHV0IGBvcmdGaWx0ZXJgIGlzIGEgZGljdCB3aXRoIGB0eXBlYCBhbmQgYHZhbHVlYCB0byBmaWx0ZXIgdGhlIG9yZ2FuaXphdGlvbnMsXG4gICAgKiBARXhhbXBsZSB7IHR5cGU6ICdjb3VudHJ5JyAsIHZhbHVlOiAnQ3ViYVwiIH1cbiAgICAqL1xuICBvcmdGaWx0ZXI6IHsgdHlwZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nfTtcblxufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0b2NvLXNlbGVjdC1vcmcnLFxuICB0ZW1wbGF0ZVVybDogJy4vc2VsZWN0LW9yZ3MuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9zZWxlY3Qtb3Jncy5jb21wb25lbnQuc2NzcyddLFxuICBob3N0OiB7XG4gICAgXCJbc3R5bGUubWluV2lkdGhdXCI6IFwiY29udGVudC5taW5XaWR0aFwiLFxuICAgIFwiW3N0eWxlLndpZHRoXVwiOiBcImNvbnRlbnQud2lkdGhcIlxuICB9XG59KVxuZXhwb3J0IGNsYXNzIFNlbGVjdE9yZ3NDb21wb25lbnQgZXh0ZW5kcyBJbnB1dENvbnRyb2xcbmltcGxlbWVudHMgT25Jbml0IHtcblxuICAvKipcbiAgICogSW5wdXQgYG9yZ0N0cmxgIGlzIGEgRm9ybUNvbnRyb2xcbiAgICovXG4gICBASW5wdXQoKVxuICAgb3JnQ3RybCA9IG5ldyBGb3JtQ29udHJvbCgpO1xuXG4gICBmaWx0ZXJlZE9yZyA9IG5ldyAgSGl0TGlzdDxPcmdhbml6YXRpb24+KCk7XG5cbiAgIHBhcmFtcz0gbmV3IEh0dHBQYXJhbXMoKTtcblxuXG4gICBASW5wdXQoKVxuICAgcGxhY2Vob2xkZXI6IHN0cmluZyA9IFwiRXNjcmliYSBhbCBtZW5vcyAzIGxldHJhc1wiO1xuXG4gICBASW5wdXQoKVxuICAgbGFiZWw6IHN0cmluZyA9IFwiQnVzcXVlIHVuYSBvcmdhbml6YWNpw7NuXCI7XG5cbiAgIEBJbnB1dCgpXG4gICBhcHBlYXJhbmNlOiBzdHJpbmcgPSBcIm91dGxpbmVcIjtcblxuICAgLyoqXG4gICAgKiBJbnB1dCBgY2xlYW5pbmdgIGlzIGEgYm9vbGVuLCBpZiB0cnVlIHRoZW4gY2xlYW4gdGhlIHNlYXJjaFxuICAgICovXG4gICBASW5wdXQoKVxuICAgY2xlYW5pbmc6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgQE91dHB1dCgpXG4gICBzZWxlY3RlZE9yZzogRXZlbnRFbWl0dGVyPE9yZ2FuaXphdGlvbj4gPSBuZXcgRXZlbnRFbWl0dGVyPE9yZ2FuaXphdGlvbj4oKTtcblxuICAgY2hpcHNMaXN0OiBIaXQ8T3JnYW5pemF0aW9uPltdID0gW107XG4gICBleHRyYUNvbnRlbnQ6IFNlbGVjdE9yZ3NDb21wb25lbnRFeHRyYUNvbnRlbnQ7XG4gICBsb2FkaW5nID0gZmFsc2U7XG5cbiAgIHRvU2VhcmNoPTA7XG4gICBjb25zdHJ1Y3RvciggcHJpdmF0ZSBfb3JnU2VydmljZTogT3JnYW5pemF0aW9uU2VydmljZU5vQXV0aCkgeyAgc3VwZXIoKTt9XG5cbiAgIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaW5pdCgnJywgJycsIGZhbHNlLCBmYWxzZSk7XG4gICAgdGhpcy5leHRyYUNvbnRlbnQgPSB0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50O1xuICAgIHRoaXMuY29udGVudC52YWx1ZSA9IFtdO1xuXG4gICAgdGhpcy5leHRyYUNvbnRlbnQuc2VsZWN0ZWRPcmdzSWRzLmZvckVhY2godXVpZCA9PiB7XG4gICAgICB0aGlzLl9vcmdTZXJ2aWNlLmdldE9yZ2FuaXphdGlvbkJ5VVVJRCh1dWlkKS5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICB0aGlzLmFkZENoaXBzKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIH0pO1xuICAgICB0aGlzLnBhcmFtcyA9IHRoaXMucGFyYW1zLnNldCgnc2l6ZScsICcxMCcpO1xuICAgICB0aGlzLnBhcmFtcyA9IHRoaXMucGFyYW1zLnNldCgncGFnZScsICcxJyk7XG4gICAgIGlmICh0aGlzLmV4dHJhQ29udGVudC5vcmdGaWx0ZXIgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgdGhpcy5wYXJhbXMgPSB0aGlzLnBhcmFtcy5zZXQodGhpcy5leHRyYUNvbnRlbnQub3JnRmlsdGVyLnR5cGUsIHRoaXMuZXh0cmFDb250ZW50Lm9yZ0ZpbHRlci52YWx1ZSk7XG4gICAgIH1cbiAgICAgdGhpcy5vcmdDdHJsLnZhbHVlQ2hhbmdlc1xuICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICBuZXh0OiAob3JnVmFsdWVDaGFuZ2VzKSA9PiB7XG4gICAgICAgICB0aGlzLnRvU2VhcmNoKys7XG4gICAgICAgICAvLyB0aGlzIGNvbmRpdGlvbiBjaGVjayBpZiB0aGUgcGFyYW0gaXMgYSBgc3RyaW5nYCBhbiBpZiBhdCBsZWFzdCB3cml0ZSAzIGxldHRlcnNcbiAgICAgICAgIGlmICh0aGlzLnRvU2VhcmNoID4gMyAmJiB0eXBlb2Ygb3JnVmFsdWVDaGFuZ2VzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICB0aGlzLnRvU2VhcmNoID0gMDtcbiAgICAgICAgICAgdGhpcy5wYXJhbXMgPSB0aGlzLnBhcmFtcy5zZXQoJ3EnLCBvcmdWYWx1ZUNoYW5nZXMpXG4gICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgIHRoaXMuX29yZ1NlcnZpY2UuZ2V0T3JnYW5pemF0aW9ucyh0aGlzLnBhcmFtcykuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgIG5leHQ6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkT3JnID0gcmVzcG9uc2UuaGl0c1xuICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgfSk7XG4gICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcmdWYWx1ZUNoYW5nZXMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgIHRoaXMudG9TZWFyY2ggPSAwO1xuICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3JnLmVtaXQob3JnVmFsdWVDaGFuZ2VzKTtcbiAgICAgICAgICAgaWYgKHRoaXMuY2xlYW5pbmcpe1xuICAgICAgICAgICAgIHRoaXMub3JnQ3RybC5zZXRWYWx1ZSgnJyk7XG4gICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICB9XG4gICAgIH0pXG4gICB9XG4gICAvKiBUaGlzIGZ1bmN0aW9uIHJldHVybiB0aGUgb3JnYW5pemF0aW9uIG5hbWVcbiAgICAqIEBwYXJhbSBvcmcgdGhlIE9yZ2FuaXphdGlvbiBvYmplY3RcbiAgICAqL1xuICAgZGlzcGxheUZuKG9yZz86IE9yZ2FuaXphdGlvbik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgIHJldHVybiBvcmcgPyBvcmcubmFtZSA6IHVuZGVmaW5lZDtcbiAgIH1cblxuICAgYWRkQ2hpcHModmFsdWU6IEhpdDxPcmdhbml6YXRpb24+KSB7XG4gICAgaWYgKHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlKSB7XG4gICAgICBpZighdGhpcy5jaGlwc0xpc3QuZmluZCh4ID0+IHguaWQgPT0gdmFsdWUuaWQpKXtcbiAgICAgICAgdGhpcy5jaGlwc0xpc3QudW5zaGlmdCh2YWx1ZSk7XG4gICAgICAgIHRoaXMuY29udGVudC52YWx1ZS51bnNoaWZ0KHZhbHVlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGlwc0xpc3QgPSBbdmFsdWVdO1xuICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gW3ZhbHVlXTtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sLnNldFZhbHVlKHRoaXMuY29udGVudC52YWx1ZSk7XG4gICAgdGhpcy5vcmdDdHJsLnNldFZhbHVlKFwiXCIpO1xuICAgIHRoaXMuZmlsdGVyZWRPcmcgPSBuZXcgIEhpdExpc3Q8T3JnYW5pemF0aW9uPigpO1xuICB9XG5cbiAgcmVtb3ZlQ2hpcChpbmRleDogbnVtYmVyKSB7XG4gICAgbGV0IHRvZGVsZXRlID0gdGhpcy5jaGlwc0xpc3RbaW5kZXhdXG4gICAgdGhpcy5jb250ZW50LnZhbHVlID0gKHRoaXMuY29udGVudC52YWx1ZSBhcyBbXSkuZmlsdGVyKFxuICAgICAgKGU6IEhpdDxPcmdhbml6YXRpb24+KSA9PiBlLmlkICE9PSB0b2RlbGV0ZS5pZFxuICAgICk7XG4gICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sLnNldFZhbHVlKHRoaXMuY29udGVudC52YWx1ZSk7XG4gICAgdGhpcy5jaGlwc0xpc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxufVxuIl19