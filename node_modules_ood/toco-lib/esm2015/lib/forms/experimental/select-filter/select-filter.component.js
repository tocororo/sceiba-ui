/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/select-filter/select-filter.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component } from "@angular/core";
import { FormControl } from "@angular/forms";
import { map, startWith } from "rxjs/operators";
import { isArray } from "util";
import { InputControl } from '../../input/input.control';
/**
 * @record
 */
function SelectFilterComponentExtraContent() { }
if (false) {
    /** @type {?} */
    SelectFilterComponentExtraContent.prototype.multiple;
    /** @type {?} */
    SelectFilterComponentExtraContent.prototype.selectedTermsIds;
    /** @type {?} */
    SelectFilterComponentExtraContent.prototype.excludeTermsIds;
}
export class SelectFilterComponent extends InputControl {
    constructor() {
        super();
        //   internalControl = new FormControl();
        // internalControl = new FormControl();
        //this control is used by the chips,not necessary to expose it
        this.chipsFormControl = new FormControl();
        this.chipsList = [];
        this.selectOptions = [];
        this.terms = [];
        this.loading = true;
        // selectedTermsIds = [];
        this.searchText = "Seleccione las opciones";
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init('', '', false, true);
        // (this.content.parentFormSection as FormGroup).addControl(
        //   this.content.name,
        //   this.internalControl
        // );
        if (this.content.required) {
            this.content.formControl.setValidators((/**
             * @param {?} control
             * @return {?}
             */
            (control) => {
                return !this.content.value || this.content.value.length == 0
                    ? { requiredTerms: "No Terms Selected" }
                    : null;
            }));
        }
        this.inputId = this.content.label.trim().toLowerCase();
        if (this.content.extraContent) {
            this.extraContent = this.content.extraContent;
            // if (this.extraContent.multiple !== null) {
            //   this.multiple = this.extraContent.multiple;
            // }
            // if (this.extraContent.selectedTermsIds) {
            //   this.content.value = this.extraContent.selectedTermsIds;
            // } else {
            //   this.content.value = [];
            // }
            // already selected terms
            if (!this.extraContent.selectedTermsIds) {
                this.extraContent.selectedTermsIds = [];
            }
            // terms ids to exclude of the possible options.
            if (!this.extraContent.excludeTermsIds) {
                this.extraContent.excludeTermsIds = [];
            }
            this.content.value = [];
            if (this.content.extraContent.observable) {
                this.content.extraContent.observable.subscribe((
                // next
                /**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    this.selectOptions = this.content.extraContent.getOptions(response);
                    this.selectOptionsLoaded();
                }), (
                // error
                /**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    console.log(error);
                }), (
                // complete
                /**
                 * @return {?}
                 */
                () => { }));
            }
            else {
                this.selectOptions = this.content.extraContent.getOptions();
                this.selectOptionsLoaded();
            }
            //   else if(this.extraContent.termID){
            //     this.service.getTermByUUID(this.extraContent.termID, this.extraContent.level)
            //     .subscribe(this.termsTreeObserver);
            // }
            // this._updateFilteredOptions();
        }
    }
    /**
     * @private
     * @return {?}
     */
    selectOptionsLoaded() {
        this.selectOptions.forEach((/**
         * @param {?} option
         * @return {?}
         */
        (option) => {
            if (((/** @type {?} */ (this.extraContent.selectedTermsIds))).some((/**
             * @param {?} val
             * @return {?}
             */
            val => val === option.value))) {
                this.addChips(option);
            }
            // if (this.extraContent.multiple) {
            //   try {
            //     const index = this.content.value.indexOf(option.value);
            //     if (index >= 0) {
            //       this.addChips(option);
            //     }
            //   } catch (error) {}
            // } else {
            //   if (option.value == this.content.value) {
            //     this.addChips(option);
            //   }
            // }
        }));
        if (this.extraContent.multiple &&
            (this.content.value == null ||
                this.content.value == undefined ||
                !isArray(this.content.value))) {
            this.content.value = [];
        }
        this._updateFilteredOptions();
        this.loading = false;
    }
    /**
     * @private
     * @return {?}
     */
    setValidation() {
        if (this.content.formControl.valid) {
            this.chipsFormControl.setErrors(null);
        }
        else {
            this.chipsFormControl.setErrors({ requiered: true });
        }
    }
    /**
     * @private
     * @param {?} term
     * @return {?}
     */
    addTermToValue(term) {
        if (this.extraContent.multiple) {
            this.content.value.unshift(term);
        }
        else {
            this.content.value = [term];
        }
        this.content.formControl.setValue(this.content.value);
        this.setValidation();
    }
    /**
     * @private
     * @param {?} term
     * @return {?}
     */
    removeTermFromValue(term) {
        this.content.value = ((/** @type {?} */ (this.content.value))).filter((/**
         * @param {?} e
         * @return {?}
         */
        (e) => e.value !== term.value));
        this.content.formControl.setValue(this.content.value);
        this.setValidation();
    }
    /**
     * @private
     * @return {?}
     */
    _updateFilteredOptions() {
        this.filteredOptions = this.chipsFormControl.valueChanges.pipe(startWith(""), map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            /** @type {?} */
            const filterValue = value ? value.toLowerCase() : "";
            console.log('************************************');
            console.log(this.selectOptions);
            console.log('************************************');
            return this.selectOptions.filter((/**
             * @param {?} option
             * @return {?}
             */
            option => option.label.toLowerCase().includes(filterValue)));
        })));
    }
    /**
     * @param {?} value
     * @return {?}
     */
    addChips(value) {
        if (this.extraContent.multiple) {
            this.chipsList.unshift(value);
        }
        else {
            // if not is multiple, then the element in the chipsList goes back to the options
            if (this.chipsList.length > 0) {
                this.selectOptions.push(this.chipsList[0]);
            }
            this.chipsList = [value];
        }
        this.addTermToValue(value);
        // console.log(this.selectOptions);
        this.selectOptions = this.selectOptions.filter((/**
         * @param {?} option
         * @return {?}
         */
        option => option.value !== value.value));
        // console.log(this.selectOptions);
        this.chipsFormControl.setValue("");
        // document.getElementById(this.inputId).blur();
        this._updateFilteredOptions();
    }
    /**
     * @param {?} index
     * @return {?}
     */
    removeChip(index) {
        // console.log(this.selectOptions);
        this.selectOptions.push(this.chipsList[index]);
        // console.log(this.selectOptions);
        this.removeTermFromValue(this.chipsList[index]);
        this.chipsList.splice(index, 1);
        this._updateFilteredOptions();
    }
}
SelectFilterComponent.decorators = [
    { type: Component, args: [{
                selector: "toco-select-filter",
                template: "\n<mat-card>\n\n  <mat-progress-bar\n    mode=\"indeterminate\"\n    *ngIf=\"!selectOptions\">\n  </mat-progress-bar>\n\n  <mat-card-subtitle *ngIf=\"selectOptions\">\n    <mat-form-field style=\"width: 100%;\">\n\n      <mat-label> {{content.label}} <span *ngIf=\"content.required\">*</span></mat-label>\n      <input\n        matInput\n        id=\"'inputId-'{{content.name}}\"\n        type=\"text\"\n        [formControl]=\"chipsFormControl\"\n        [matAutocomplete]=\"auto\"\n          aria-label=\"Number\"\n      />\n\n      <mat-hint *ngIf=\"content.startHint\" [align]=\"'start'\">{{ content.startHint.label }}</mat-hint>\n      <mat-hint *ngIf=\"!content.startHint\" [align]=\"'start'\">{{ searchText }}</mat-hint>\n\n      <mat-autocomplete #auto=\"matAutocomplete\">\n        <mat-option *ngFor=\"let option of filteredOptions | async\" [value]=\"option.label\" (click)=\"addChips(option)\"\n          [title]=\"option.label\">\n          {{ option.label }}\n        </mat-option>\n      </mat-autocomplete>\n\n      <!-- <button mat-icon-button color=\"accent\" class=\"delete-filter\" (click)=\"remove_component()\">\n        <mat-icon>close</mat-icon>\n      </button> -->\n    </mat-form-field>\n  </mat-card-subtitle>\n\n  <mat-card-content *ngIf=\"!loading\">\n    <mat-chip-list class=\"mat-chip-list-stacked\" fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"margin-bottom: .5em\"\n      id=\"chiplist-{{content.name}}\">\n      <mat-chip *ngFor=\"let item of chipsList; let i=index\" (removed)=\"removeChip(i)\" [removable]=\"true\" style=\"width: 100%;height: 100%;\">\n        {{ item.label }}\n        <mat-icon matChipRemove>cancel</mat-icon>\n      </mat-chip>\n    </mat-chip-list>\n  </mat-card-content>\n\n</mat-card>\n",
                host: {
                    "[style.minWidth]": "content.minWidth",
                    "[style.width]": "content.width",
                },
                styles: [""]
            }] }
];
/** @nocollapse */
SelectFilterComponent.ctorParameters = () => [];
if (false) {
    /** @type {?} */
    SelectFilterComponent.prototype.chipsFormControl;
    /** @type {?} */
    SelectFilterComponent.prototype.inputId;
    /** @type {?} */
    SelectFilterComponent.prototype.filteredOptions;
    /** @type {?} */
    SelectFilterComponent.prototype.chipsList;
    /** @type {?} */
    SelectFilterComponent.prototype.selectOptions;
    /** @type {?} */
    SelectFilterComponent.prototype.terms;
    /** @type {?} */
    SelectFilterComponent.prototype.loading;
    /** @type {?} */
    SelectFilterComponent.prototype.extraContent;
    /** @type {?} */
    SelectFilterComponent.prototype.searchText;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90b2NvLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9mb3Jtcy9leHBlcmltZW50YWwvc2VsZWN0LWZpbHRlci9zZWxlY3QtZmlsdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ2xELE9BQU8sRUFBbUIsV0FBVyxFQUFvQixNQUFNLGdCQUFnQixDQUFDO0FBRWhGLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7Ozs7QUFLekQsZ0RBS0M7OztJQUpDLHFEQUFrQjs7SUFDbEIsNkRBQXFCOztJQUNyQiw0REFBb0I7O0FBZXRCLE1BQU0sT0FBTyxxQkFBc0IsU0FBUSxZQUFZO0lBd0JyRDtRQUVFLEtBQUssRUFBRSxDQUFDOzs7O1FBbkJWLHFCQUFnQixHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFHckMsY0FBUyxHQUFtQixFQUFFLENBQUM7UUFDL0Isa0JBQWEsR0FBbUIsRUFBRSxDQUFDO1FBRW5DLFVBQUssR0FBbUIsRUFBRSxDQUFDO1FBRTNCLFlBQU8sR0FBRyxJQUFJLENBQUM7O1FBTWYsZUFBVSxHQUFHLHlCQUF5QixDQUFDO0lBTXZDLENBQUM7Ozs7SUFFRCxRQUFRO1FBRU4sSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQiw0REFBNEQ7UUFDNUQsdUJBQXVCO1FBQ3ZCLHlCQUF5QjtRQUN6QixLQUFLO1FBRUwsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUN6QixJQUFJ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LGtCQUFrQixFQUFFLGtCQUFrQjtvQkFDdEMsZUFBZSxFQUFFLGVBQWU7aUJBQ2pDOzthQUNGOzs7Ozs7SUFRQyxpREFBcUM7O0lBQ3JDLHdDQUFnQjs7SUFDaEIsZ0RBQTRDOztJQUM1QywwQ0FBK0I7O0lBQy9CLDhDQUFtQzs7SUFFbkMsc0NBQTJCOztJQUUzQix3Q0FBZTs7SUFFZiw2Q0FBZ0Q7O0lBSWhELDJDQUF1QyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiAgIENvcHlyaWdodCAoYykgMjAyMCBVbml2ZXJzaWRhZCBkZSBQaW5hciBkZWwgUsOtbyBcIkhlcm1hbm9zIFNhw616IE1vbnRlcyBkZSBPY2FcIlxuICogICBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgRm9ybUNvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnMgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgbWFwLCBzdGFydFdpdGggfSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcbmltcG9ydCB7IGlzQXJyYXkgfSBmcm9tIFwidXRpbFwiO1xuaW1wb3J0IHsgSW5wdXRDb250cm9sIH0gZnJvbSAnLi4vLi4vaW5wdXQvaW5wdXQuY29udHJvbCc7XG5pbXBvcnQgeyBTZWxlY3RPcHRpb24gfSBmcm9tIFwiLi4vLi4vaW5wdXQvc2VsZWN0L3NlbGVjdC1pbnB1dC5jb21wb25lbnRcIjtcblxuXG5cbmludGVyZmFjZSBTZWxlY3RGaWx0ZXJDb21wb25lbnRFeHRyYUNvbnRlbnR7XG4gIG11bHRpcGxlOiBib29sZWFuO1xuICBzZWxlY3RlZFRlcm1zSWRzOiBbXTtcbiAgZXhjbHVkZVRlcm1zSWRzOiBbXTtcblxufVxuXG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRvY28tc2VsZWN0LWZpbHRlclwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL3NlbGVjdC1maWx0ZXIuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL3NlbGVjdC1maWx0ZXIuY29tcG9uZW50LnNjc3NcIl0sXG4gIGhvc3Q6IHtcbiAgICBcIltzdHlsZS5taW5XaWR0aF1cIjogXCJjb250ZW50Lm1pbldpZHRoXCIsXG4gICAgXCJbc3R5bGUud2lkdGhdXCI6IFwiY29udGVudC53aWR0aFwiLFxuICB9LFxufSlcbmV4cG9ydCBjbGFzcyBTZWxlY3RGaWx0ZXJDb21wb25lbnQgZXh0ZW5kcyBJbnB1dENvbnRyb2xcbiAgaW1wbGVtZW50cyBPbkluaXQge1xuICAvLyAgIGludGVybmFsQ29udHJvbCA9IG5ldyBGb3JtQ29udHJvbCgpO1xuXG4gIC8vIGludGVybmFsQ29udHJvbCA9IG5ldyBGb3JtQ29udHJvbCgpO1xuXG4gIC8vdGhpcyBjb250cm9sIGlzIHVzZWQgYnkgdGhlIGNoaXBzLG5vdCBuZWNlc3NhcnkgdG8gZXhwb3NlIGl0XG4gIGNoaXBzRm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcbiAgaW5wdXRJZDogc3RyaW5nO1xuICBmaWx0ZXJlZE9wdGlvbnM6IE9ic2VydmFibGU8U2VsZWN0T3B0aW9uW10+O1xuICBjaGlwc0xpc3Q6IFNlbGVjdE9wdGlvbltdID0gW107XG4gIHNlbGVjdE9wdGlvbnM6IFNlbGVjdE9wdGlvbltdID0gW107XG5cbiAgdGVybXM6IFNlbGVjdE9wdGlvbltdID0gW107XG5cbiAgbG9hZGluZyA9IHRydWU7XG5cbiAgZXh0cmFDb250ZW50OiBTZWxlY3RGaWx0ZXJDb21wb25lbnRFeHRyYUNvbnRlbnQ7XG5cbiAgLy8gc2VsZWN0ZWRUZXJtc0lkcyA9IFtdO1xuXG4gIHNlYXJjaFRleHQgPSBcIlNlbGVjY2lvbmUgbGFzIG9wY2lvbmVzXCI7XG5cblxuICBjb25zdHJ1Y3RvcigpXG4gIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkluaXQoKVxuICB7XG4gICAgdGhpcy5pbml0KCcnLCAnJywgZmFsc2UsIHRydWUpO1xuICAgIC8vICh0aGlzLmNvbnRlbnQucGFyZW50Rm9ybVNlY3Rpb24gYXMgRm9ybUdyb3VwKS5hZGRDb250cm9sKFxuICAgIC8vICAgdGhpcy5jb250ZW50Lm5hbWUsXG4gICAgLy8gICB0aGlzLmludGVybmFsQ29udHJvbFxuICAgIC8vICk7XG5cbiAgICBpZiAodGhpcy5jb250ZW50LnJlcXVpcmVkKSB7XG4gICAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsaWRhdG9ycyhcbiAgICAgICAgKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgICAgICAgICByZXR1cm4gIXRoaXMuY29udGVudC52YWx1ZSB8fCB0aGlzLmNvbnRlbnQudmFsdWUubGVuZ3RoID09IDBcbiAgICAgICAgICAgID8geyByZXF1aXJlZFRlcm1zOiBcIk5vIFRlcm1zIFNlbGVjdGVkXCIgfVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuaW5wdXRJZCA9IHRoaXMuY29udGVudC5sYWJlbC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAodGhpcy5jb250ZW50LmV4dHJhQ29udGVudCkge1xuICAgICAgdGhpcy5leHRyYUNvbnRlbnQgPSB0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50O1xuXG4gICAgICAvLyBpZiAodGhpcy5leHRyYUNvbnRlbnQubXVsdGlwbGUgIT09IG51bGwpIHtcbiAgICAgIC8vICAgdGhpcy5tdWx0aXBsZSA9IHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlO1xuICAgICAgLy8gfVxuICAgICAgLy8gaWYgKHRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHMpIHtcbiAgICAgIC8vICAgdGhpcy5jb250ZW50LnZhbHVlID0gdGhpcy5leHRyYUNvbnRlbnQuc2VsZWN0ZWRUZXJtc0lkcztcbiAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAvLyAgIHRoaXMuY29udGVudC52YWx1ZSA9IFtdO1xuICAgICAgLy8gfVxuXG4gICAgICAvLyBhbHJlYWR5IHNlbGVjdGVkIHRlcm1zXG4gICAgICBpZiAoIXRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHMpIHtcbiAgICAgICAgdGhpcy5leHRyYUNvbnRlbnQuc2VsZWN0ZWRUZXJtc0lkcyA9IFtdO1xuICAgICAgfVxuXG4gICAgICAvLyB0ZXJtcyBpZHMgdG8gZXhjbHVkZSBvZiB0aGUgcG9zc2libGUgb3B0aW9ucy5cbiAgICAgIGlmICghdGhpcy5leHRyYUNvbnRlbnQuZXhjbHVkZVRlcm1zSWRzKSB7XG4gICAgICAgIHRoaXMuZXh0cmFDb250ZW50LmV4Y2x1ZGVUZXJtc0lkcyA9IFtdO1xuICAgICAgfVxuICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gW107XG5cbiAgICAgIGlmICh0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50Lm9ic2VydmFibGUpIHtcbiAgICAgICAgdGhpcy5jb250ZW50LmV4dHJhQ29udGVudC5vYnNlcnZhYmxlLnN1YnNjcmliZShcbiAgICAgICAgICAvLyBuZXh0XG4gICAgICAgICAgKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0T3B0aW9ucyA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQuZ2V0T3B0aW9ucyhyZXNwb25zZSk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnNMb2FkZWQoKTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgLy8gZXJyb3JcbiAgICAgICAgICAoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gY29tcGxldGVcbiAgICAgICAgICAoKSA9PiB7fVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZWxlY3RPcHRpb25zID0gdGhpcy5jb250ZW50LmV4dHJhQ29udGVudC5nZXRPcHRpb25zKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0T3B0aW9uc0xvYWRlZCgpO1xuICAgICAgfVxuICAgIC8vICAgZWxzZSBpZih0aGlzLmV4dHJhQ29udGVudC50ZXJtSUQpe1xuICAgIC8vICAgICB0aGlzLnNlcnZpY2UuZ2V0VGVybUJ5VVVJRCh0aGlzLmV4dHJhQ29udGVudC50ZXJtSUQsIHRoaXMuZXh0cmFDb250ZW50LmxldmVsKVxuICAgIC8vICAgICAuc3Vic2NyaWJlKHRoaXMudGVybXNUcmVlT2JzZXJ2ZXIpO1xuICAgIC8vIH1cbiAgICAgIC8vIHRoaXMuX3VwZGF0ZUZpbHRlcmVkT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG5cbiAgcHJpdmF0ZSBzZWxlY3RPcHRpb25zTG9hZGVkKCkge1xuICAgIHRoaXMuc2VsZWN0T3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgKHRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHMgYXMgW10pLnNvbWUoXG4gICAgICAgICAgdmFsID0+IHZhbCA9PT0gb3B0aW9uLnZhbHVlXG4gICAgICAgIClcbiAgICAgICl7XG4gICAgICAgIHRoaXMuYWRkQ2hpcHMob3B0aW9uKTtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgKHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlKSB7XG4gICAgICAvLyAgIHRyeSB7XG4gICAgICAvLyAgICAgY29uc3QgaW5kZXggPSB0aGlzLmNvbnRlbnQudmFsdWUuaW5kZXhPZihvcHRpb24udmFsdWUpO1xuICAgICAgLy8gICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAvLyAgICAgICB0aGlzLmFkZENoaXBzKG9wdGlvbik7XG4gICAgICAvLyAgICAgfVxuICAgICAgLy8gICB9IGNhdGNoIChlcnJvcikge31cbiAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAvLyAgIGlmIChvcHRpb24udmFsdWUgPT0gdGhpcy5jb250ZW50LnZhbHVlKSB7XG4gICAgICAvLyAgICAgdGhpcy5hZGRDaGlwcyhvcHRpb24pO1xuICAgICAgLy8gICB9XG4gICAgICAvLyB9XG4gICAgfSk7XG4gICAgaWYgKFxuICAgICAgdGhpcy5leHRyYUNvbnRlbnQubXVsdGlwbGUgJiZcbiAgICAgICh0aGlzLmNvbnRlbnQudmFsdWUgPT0gbnVsbCB8fFxuICAgICAgICB0aGlzLmNvbnRlbnQudmFsdWUgPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICFpc0FycmF5KHRoaXMuY29udGVudC52YWx1ZSkpXG4gICAgKSB7XG4gICAgICB0aGlzLmNvbnRlbnQudmFsdWUgPSBbXTtcbiAgICB9XG5cbiAgICB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VmFsaWRhdGlvbigpIHtcbiAgICBpZiAodGhpcy5jb250ZW50LmZvcm1Db250cm9sLnZhbGlkKSB7XG4gICAgICB0aGlzLmNoaXBzRm9ybUNvbnRyb2wuc2V0RXJyb3JzKG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoaXBzRm9ybUNvbnRyb2wuc2V0RXJyb3JzKHsgcmVxdWllcmVkOiB0cnVlIH0pO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIGFkZFRlcm1Ub1ZhbHVlKHRlcm06IFNlbGVjdE9wdGlvbikge1xuICAgIGlmICh0aGlzLmV4dHJhQ29udGVudC5tdWx0aXBsZSkge1xuICAgICAgdGhpcy5jb250ZW50LnZhbHVlLnVuc2hpZnQodGVybSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY29udGVudC52YWx1ZSA9IFt0ZXJtXTtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sLnNldFZhbHVlKHRoaXMuY29udGVudC52YWx1ZSk7XG4gICAgdGhpcy5zZXRWYWxpZGF0aW9uKCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVRlcm1Gcm9tVmFsdWUodGVybTogU2VsZWN0T3B0aW9uKSB7XG4gICAgdGhpcy5jb250ZW50LnZhbHVlID0gKHRoaXMuY29udGVudC52YWx1ZSBhcyBbXSkuZmlsdGVyKFxuICAgICAgKGU6IFNlbGVjdE9wdGlvbikgPT4gZS52YWx1ZSAhPT0gdGVybS52YWx1ZVxuICAgICk7XG4gICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sLnNldFZhbHVlKHRoaXMuY29udGVudC52YWx1ZSk7XG4gICAgdGhpcy5zZXRWYWxpZGF0aW9uKCk7XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKSB7XG4gICAgdGhpcy5maWx0ZXJlZE9wdGlvbnMgPSB0aGlzLmNoaXBzRm9ybUNvbnRyb2wudmFsdWVDaGFuZ2VzLnBpcGU8XG4gICAgICBzdHJpbmcsXG4gICAgICBTZWxlY3RPcHRpb25bXVxuICAgID4oXG4gICAgICBzdGFydFdpdGgoXCJcIiksXG4gICAgICBtYXAodmFsdWUgPT4ge1xuICAgICAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IHZhbHVlID8gdmFsdWUudG9Mb3dlckNhc2UoKSA6IFwiXCI7XG4gICAgICAgIGNvbnNvbGUubG9nKCcqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKionKVxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdE9wdGlvbnMpO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqJylcblxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RPcHRpb25zLmZpbHRlcihvcHRpb24gPT5cbiAgICAgICAgICBvcHRpb24ubGFiZWwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXJWYWx1ZSlcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG5cblxuICBhZGRDaGlwcyh2YWx1ZTogU2VsZWN0T3B0aW9uKSB7XG4gICAgaWYgKHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlKSB7XG4gICAgICB0aGlzLmNoaXBzTGlzdC51bnNoaWZ0KHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gaWYgbm90IGlzIG11bHRpcGxlLCB0aGVuIHRoZSBlbGVtZW50IGluIHRoZSBjaGlwc0xpc3QgZ29lcyBiYWNrIHRvIHRoZSBvcHRpb25zXG4gICAgICBpZiAodGhpcy5jaGlwc0xpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnMucHVzaCh0aGlzLmNoaXBzTGlzdFswXSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNoaXBzTGlzdCA9IFt2YWx1ZV07XG4gICAgfVxuICAgIHRoaXMuYWRkVGVybVRvVmFsdWUodmFsdWUpO1xuICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0T3B0aW9ucyk7XG4gICAgdGhpcy5zZWxlY3RPcHRpb25zID0gdGhpcy5zZWxlY3RPcHRpb25zLmZpbHRlcihcbiAgICAgIG9wdGlvbiA9PiBvcHRpb24udmFsdWUgIT09IHZhbHVlLnZhbHVlXG4gICAgKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdE9wdGlvbnMpO1xuXG4gICAgdGhpcy5jaGlwc0Zvcm1Db250cm9sLnNldFZhbHVlKFwiXCIpO1xuICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaW5wdXRJZCkuYmx1cigpO1xuICAgIHRoaXMuX3VwZGF0ZUZpbHRlcmVkT3B0aW9ucygpO1xuICB9XG5cbiAgcmVtb3ZlQ2hpcChpbmRleDogbnVtYmVyKSB7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy5zZWxlY3RPcHRpb25zKTtcblxuICAgIHRoaXMuc2VsZWN0T3B0aW9ucy5wdXNoKHRoaXMuY2hpcHNMaXN0W2luZGV4XSk7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy5zZWxlY3RPcHRpb25zKTtcbiAgICB0aGlzLnJlbW92ZVRlcm1Gcm9tVmFsdWUodGhpcy5jaGlwc0xpc3RbaW5kZXhdKTtcbiAgICB0aGlzLmNoaXBzTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHRoaXMuX3VwZGF0ZUZpbHRlcmVkT3B0aW9ucygpO1xuICB9XG5cbn1cbiJdfQ==