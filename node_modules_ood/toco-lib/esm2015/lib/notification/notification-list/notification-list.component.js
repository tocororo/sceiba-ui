/**
 * @fileoverview added by tsickle
 * Generated from: lib/notification/notification-list/notification-list.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { MatTableDataSource, MatPaginator, MatSnackBar } from '@angular/material';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import moment from 'moment';
import { NotificationService } from '../../backend/public-api';
import { MessageHandler, StatusCode } from '../../core/public-api';
export class NotificationListComponent {
    /**
     * @param {?} service
     * @param {?} _snackBar
     */
    constructor(service, _snackBar) {
        this.service = service;
        this._snackBar = _snackBar;
        this.dataSource = new MatTableDataSource();
        this.columnsToDisplay = ['action', 'description', 'classification', 'emiter', 'emiterEmail', 'createdAt'];
        this.columnsLabels = ['', 'Descripción', 'Clasificación', 'Emisor', 'Correo del emisor', 'Creada'];
        this.moment = moment;
        this.pageSizeOptions = [5, 10, 15, 20];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.paginator.firstPage();
        this.paginator.pageSize = 5;
        this.getNotificationsListData();
    }
    /**
     * @return {?}
     */
    getNotificationsListData() {
        this.service.getNotificationsList(this.paginator.pageSize, this.paginator.pageIndex)
            .pipe(catchError((/**
         * @param {?} error
         * @return {?}
         */
        error => {
            /** @type {?} */
            const m = new MessageHandler(this._snackBar);
            m.showMessage(StatusCode.serverError, error.message);
            return of(null);
        })))
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            if (response) {
                this.paginator.length = response.data.total_not_view;
                /** @type {?} */
                const arr = response.data.notifications
                    .map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => (Object.assign({}, n, { classification: {
                        label: n.classification,
                        color: n.classification === 'INFO' ? '#2196F3' : n.classification === 'ALERT' ? '#FF5722' : '#d32f2f'
                    } }))));
                this.dataSource.data = arr;
            }
            else {
                this.paginator.length = 0;
                this.dataSource.data = null;
            }
        }));
    }
    /**
     * @param {?} id
     * @return {?}
     */
    setnotificationViewed(id) {
        console.log(id);
        if (id) {
            this.service.setNotificationViewed(id)
                .pipe(catchError((/**
             * @param {?} error
             * @return {?}
             */
            error => {
                /** @type {?} */
                const m = new MessageHandler(this._snackBar);
                m.showMessage(StatusCode.serverError, error.message);
                return of(null);
            })))
                .subscribe((/**
             * @param {?} response
             * @return {?}
             */
            response => {
                if (response.status === 'success') {
                    this.getNotificationsListData();
                    /** @type {?} */
                    const m = new MessageHandler(this._snackBar);
                    m.showMessage(StatusCode.OK, 'La notificación fue marcada como leída');
                }
                else {
                    /** @type {?} */
                    const m = new MessageHandler(this._snackBar);
                    m.showMessage(StatusCode.serverError, response.message);
                }
            }));
        }
    }
}
NotificationListComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-notification-list',
                template: "<div [ngStyle]=\"{padding: '2em 1em 0 1em', overflow: 'auto'}\">\n    <table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows>\n        <ng-container matColumnDef=\"{{column}}\" *ngFor=\"let column of columnsToDisplay; let i = index\">\n            <th [id]=\"column+'-th'\" mat-header-cell *matHeaderCellDef> {{columnsLabels[i]}} </th>\n            <td class=\"element-row-header\"\n                mat-cell *matCellDef=\"let element\"\n                [id]=\"column+'-td'\"\n                [class.expanded-row]=\"column === 'description' && expandedElement === element\" (click)=\"expandedElement = element\"\n                [ngStyle]=\"{'font-weight': !element.viewed ? 'bold' : '0', width: column === 'action' ? '50px' : 'inherit'}\"\n            >\n              <ng-container *ngIf=\"column === 'action'\">\n                <button mat-icon-button *ngIf=\"!element.viewed\" color=\"primary\" (click)=\"setnotificationViewed(element.id)\" matTooltip=\"Marcar como visto\">\n                  <mat-icon class=\"mat-16\">visibility</mat-icon>\n                </button>\n                <button mat-icon-button *ngIf=\"element.viewed\" disabled color=\"primary\" (click)=\"setnotificationViewed(element.id)\" matTooltip=\"Visto\">\n                  <mat-icon class=\"mat-16\">viewed</mat-icon>\n                </button>\n              </ng-container>\n\n              <span *ngIf=\"column === 'createdAt' \" > {{moment(element[column]).format('ll')}} </span>\n              <div class=\"element-tag\" [ngStyle]=\"{'background-color': element['classification'].color}\" *ngIf=\"column === 'classification'\" > {{element[column].label}} </div>\n              <span *ngIf=\"column === 'emiter'\" > {{element[column].name}} {{element[column].lastname}} </span>\n              <span *ngIf=\"column === 'emiterEmail'\" > {{element['emiter'].email}} </span>\n              <div  *ngIf=\"column === 'description'\" class=\"element-description-header\" >\n                <mat-icon class=\"mat-16\" color=\"primary\" >{{expandedElement === element ? 'expand_more' : 'chevron_right'}}</mat-icon>\n                {{(element[column].length && element[column].length>70) ?\n                   (element[column] | slice:0:70)+' ...'\n                   :(element[column])\n                }}\n              </div>\n            </td>\n            <td mat-cell *matCellDef=\"let element\">\n            </td>\n        </ng-container>\n\n        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n        <ng-container matColumnDef=\"expandedDetail\">\n            <td mat-cell *matCellDef=\"let element\" [attr.colspan]=\"columnsToDisplay.length\">\n                <div class=\"element-detail\" fxLayout=\"row wrap\" fxLayoutAlign=\"space-between center\"  fxLayoutGap=\"15px\" [@detailExpand]=\"element == expandedElement ? 'expanded' : 'collapsed'\">\n\n                    <div class=\"element-description\">\n                        {{element.description}}\n                    </div>\n\n                </div>\n            </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"columnsToDisplay\"></tr>\n        <tr mat-row *matRowDef=\"let element; columns: columnsToDisplay;\" class=\"element-row\"\n            >\n        </tr>\n        <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"detail-row\"></tr>\n    </table>\n    <div *ngIf=\"paginator.length === 0\" class=\"empty-notifications-container\">\n      <mat-icon class=\"empty-notifications-icon\">notifications</mat-icon>\n      <h1 style=\"color: grey;\">SIN NOTIFICACIONES</h1>\n    </div>\n    <mat-paginator [length]=\"paginator.length\" [pageSize]=\"paginator.pageSize\" [pageSizeOptions]=\"pageSizeOptions\" (page)=\"getNotificationsListData()\">\n    </mat-paginator>\n</div>\n",
                animations: [
                    trigger('detailExpand', [
                        state('collapsed', style({ height: '0px', minHeight: '0' })),
                        state('expanded', style({ height: '*' })),
                        transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                    ]),
                ],
                styles: ["table{width:100%}tr.detail-row{height:0}tr.element-row:not(.expanded-row):hover{background:#f4f4f4}tr.element-row:not(.expanded-row):active{background:#efefef}.element-row td{border-bottom-width:0}.element-detail{overflow:hidden;display:flex;background-color:#f4f4f4;border-radius:10px 10px 0 0}.element-tag{display:flex;justify-content:center;padding:6px;border-radius:15px;width:60%}.element-description-header{display:flex;align-items:center;cursor:pointer;padding:10px 25px 10px 10px}.element-description{padding:16px}.element-description-attribution{opacity:.5}.empty-notifications-container{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:30px}.empty-notifications-icon{color:grey;font-size:6em;height:100px;width:100px}@media only screen and (max-width:768px){#description-th{padding-left:34px!important}#emiter-td,#emiter-th{display:none!important}#createdAt-th,#emiterEmail-td,#emiterEmail-th{padding-left:20px!important}#createdAt-td{min-width:120px!important;padding-left:20px!important}}"]
            }] }
];
/** @nocollapse */
NotificationListComponent.ctorParameters = () => [
    { type: NotificationService },
    { type: MatSnackBar }
];
NotificationListComponent.propDecorators = {
    paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }]
};
if (false) {
    /** @type {?} */
    NotificationListComponent.prototype.dataSource;
    /** @type {?} */
    NotificationListComponent.prototype.columnsToDisplay;
    /** @type {?} */
    NotificationListComponent.prototype.columnsLabels;
    /** @type {?} */
    NotificationListComponent.prototype.expandedElement;
    /** @type {?} */
    NotificationListComponent.prototype.moment;
    /** @type {?} */
    NotificationListComponent.prototype.pageSizeOptions;
    /** @type {?} */
    NotificationListComponent.prototype.paginator;
    /**
     * @type {?}
     * @private
     */
    NotificationListComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    NotificationListComponent.prototype._snackBar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1saXN0L25vdGlmaWNhdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFlBQVksRUFBRSxXQUFXLEVBQW9CLE1BQU0sbUJBQW1CLENBQUM7QUFDcEcsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFpQm5FLE1BQU0sT0FBTyx5QkFBeUI7Ozs7O0lBWWxDLFlBQW9CLE9BQTRCLEVBQVUsU0FBc0I7UUFBNUQsWUFBTyxHQUFQLE9BQU8sQ0FBcUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFhO1FBVmhGLGVBQVUsR0FBRyxJQUFJLGtCQUFrQixFQUFvQixDQUFDO1FBQ3hELHFCQUFnQixHQUFHLENBQUMsUUFBUSxFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLFdBQVcsQ0FBRSxDQUFDO1FBQ3RHLGtCQUFhLEdBQUcsQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxRQUFRLEVB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d0MsQ0FBQyxDQUFDO2lCQUN4RTtxQkFBTTs7MEJBQ0MsQ0FBQyxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQzVDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQ3pEO1lBQ0gsQ0FBQyxFQUNGLENBQUM7U0FDTDtJQUNMLENBQUM7OztZQWhGSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLHVCQUF1QjtnQkFDakMsaXlIQUFpRDtnQkFFakQsVUFBVSxFQUFFO29CQUNSLE9BQU8sQ0FBQyxjQUFjLEVBQUU7d0JBQ3BCLEtBQUssQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQzt3QkFDNUQsS0FBSyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQzt3QkFDekMsVUFBVSxDQUFDLHdCQUF3QixFQUFFLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO3FCQUN4RixDQUFDO2lCQUNMOzthQUNKOzs7O1lBaEJRLG1CQUFtQjtZQUplLFdBQVc7Ozt3QkFnQ2pELFNBQVMsU0FBQyxZQUFZLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzs7O0lBUnpDLCtDQUF3RDs7SUFDeEQscURBQXNHOztJQUN0RyxrREFBOEY7O0lBQzlGLG9EQUE4Qjs7SUFDOUIsMkNBQTRCOztJQUU1QixvREFBNEM7O0lBRTVDLDhDQUFtRTs7Ozs7SUFFdkQsNENBQW9DOzs7OztJQUFFLDhDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRyaWdnZXIsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgYW5pbWF0ZSB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgTWF0VGFibGVEYXRhU291cmNlLCBNYXRQYWdpbmF0b3IsIE1hdFNuYWNrQmFyLCBNYXRQYWdpbmF0b3JJbnRsIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vYmFja2VuZC9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE1lc3NhZ2VIYW5kbGVyLCBTdGF0dXNDb2RlIH0gZnJvbSAnLi4vLi4vY29yZS9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbkluZm8gfSBmcm9tICcuLi9ub3RpZmljYXRpb24tYnV0dG9uL25vdGlmaWNhdGlvbi1idXR0b24uY29tcG9uZW50JztcblxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2xpYi1ub3RpZmljYXRpb24tbGlzdCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL25vdGlmaWNhdGlvbi1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9ub3RpZmljYXRpb24tbGlzdC5jb21wb25lbnQuc2NzcyddLFxuICAgIGFuaW1hdGlvbnM6IFtcbiAgICAgICAgdHJpZ2dlcignZGV0YWlsRXhwYW5kJywgW1xuICAgICAgICAgICAgc3RhdGUoJ2NvbGxhcHNlZCcsIHN0eWxlKHsgaGVpZ2h0OiAnMHB4JywgbWluSGVpZ2h0OiAnMCcgfSkpLFxuICAgICAgICAgICAgc3RhdGUoJ2V4cGFuZGVkJywgc3R5bGUoeyBoZWlnaHQ6ICcqJyB9KSksXG4gICAgICAgICAgICB0cmFuc2l0aW9uKCdleHBhbmRlZCA8PT4gY29sbGFwc2VkJywgYW5pbWF0ZSgnMjI1bXMgY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAwLjIsIDEpJykpLFxuICAgICAgICBdKSxcbiAgICBdXG59KVxuXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uTGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBkYXRhU291cmNlID0gbmV3IE1hdFRhYmxlRGF0YVNvdXJjZTxOb3RpZmljYXRpb25JbmZvPigpO1xuICAgIGNvbHVtbnNUb0Rpc3BsYXkgPSBbJ2FjdGlvbicsICdkZXNjcmlwdGlvbicsICdjbGFzc2lmaWNhdGlvbicsICdlbWl0ZXInLCAnZW1pdGVyRW1haWwnLCAnY3JlYXRlZEF0JyBdO1xuICAgIGNvbHVtbnNMYWJlbHMgPSBbJycsICdEZXNjcmlwY2nDs24nLCAnQ2xhc2lmaWNhY2nDs24nLCAnRW1pc29yJywgJ0NvcnJlbyBkZWwgZW1pc29yJywgJ0NyZWFkYSddO1xuICAgIGV4cGFuZGVkRWxlbWVudDogTm90aWZpY2F0aW9uO1xuICAgIHB1YmxpYyBtb21lbnQ6IGFueSA9IG1vbWVudDtcblxuICAgIHBhZ2VTaXplT3B0aW9uczogbnVtYmVyW10gPSBbNSwgMTAsIDE1LCAyMF07XG5cbiAgICBAVmlld0NoaWxkKE1hdFBhZ2luYXRvciwgeyBzdGF0aWM6IHRydWUgfSkgcGFnaW5hdG9yOiBNYXRQYWdpbmF0b3I7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNlcnZpY2U6IE5vdGlmaWNhdGlvblNlcnZpY2UsIHByaXZhdGUgX3NuYWNrQmFyOiBNYXRTbmFja0JhcikgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5wYWdpbmF0b3IuZmlyc3RQYWdlKCk7XG4gICAgICAgIHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplID0gNTtcbiAgICAgICAgdGhpcy5nZXROb3RpZmljYXRpb25zTGlzdERhdGEoKTtcbiAgICB9XG4gICAgZ2V0Tm90aWZpY2F0aW9uc0xpc3REYXRhKCkge1xuICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Tm90aWZpY2F0aW9uc0xpc3QodGhpcy5wYWdpbmF0b3IucGFnZVNpemUsIHRoaXMucGFnaW5hdG9yLnBhZ2VJbmRleClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLnNlcnZlckVycm9yLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0b3IubGVuZ3RoID0gcmVzcG9uc2UuZGF0YS50b3RhbF9ub3RfdmlldztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyOiBOb3RpZmljYXRpb25JbmZvW10gPSByZXNwb25zZS5kYXRhLm5vdGlmaWNhdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgLm1hcCggbiA9PiAoey4uLm4sIGNsYXNzaWZpY2F0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbi5jbGFzc2lmaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBuLmNsYXNzaWZpY2F0aW9uID09PSAnSU5GTycgPyAnIzIxOTZGMycgOiBuLmNsYXNzaWZpY2F0aW9uID09PSAnQUxFUlQnID8gJyNGRjU3MjInIDogJyNkMzJmMmYnXG4gICAgICAgICAgICAgICAgICAgICAgfX0pKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhU291cmNlLmRhdGEgPSBhcnI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdpbmF0b3IubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhU291cmNlLmRhdGEgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgfVxuICAgIHNldG5vdGlmaWNhdGlvblZpZXdlZChpZDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGlkKTtcbiAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgdGhpcy5zZXJ2aWNlLnNldE5vdGlmaWNhdGlvblZpZXdlZChpZClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICBtLnNob3dNZXNzYWdlKFN0YXR1c0NvZGUuc2VydmVyRXJyb3IsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgICAgdGhpcy5nZXROb3RpZmljYXRpb25zTGlzdERhdGEoKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLk9LLCAnTGEgbm90aWZpY2FjacOzbiBmdWUgbWFyY2FkYSBjb21vIGxlw61kYScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19