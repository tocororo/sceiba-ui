/**
 * @fileoverview added by tsickle
 * Generated from: lib/notification/notification-button/notification-button.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { of as observableOf, timer } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { MatSnackBar } from '@angular/material';
import moment from 'moment';
import { NotificationService } from '../../backend/public-api';
import { MessageHandler, StatusCode } from '../../core/public-api';
import { OAuthStorage } from 'angular-oauth2-oidc';
export class NotificationButtonComponent {
    /**
     * @param {?} service
     * @param {?} _snackBar
     * @param {?} oauthStorage
     */
    constructor(service, _snackBar, oauthStorage) {
        this.service = service;
        this._snackBar = _snackBar;
        this.oauthStorage = oauthStorage;
        this.count = 0;
        this.moment = moment;
        this.timerSuscription = null;
        this.timerObserver = {
            next: (/**
             * @param {?} _
             * @return {?}
             */
            (_) => {
                // if (this.oauthStorage.getItem('access_token')){
                this.service.getNotificationsList(5, 0).pipe(catchError((/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    /** @type {?} */
                    const m = new MessageHandler(this._snackBar);
                    m.showMessage(StatusCode.serverError, error.message);
                    return observableOf(null);
                })))
                    .subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                response => {
                    if (response && response.status === "success") {
                        this.count = response.data.total_not_view;
                        /** @type {?} */
                        const arr = response.data.notifications
                            .map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => (Object.assign({}, n, { classification: {
                                label: n.classification,
                                color: n.classification === 'INFO' ? '#2196F3' : n.classification === 'ALERT' ? '#FF5722' : '#d32f2f'
                            } }))))
                            .filter((/**
                         * @param {?} n
                         * @return {?}
                         */
                        n => !n.viewed));
                        this.notifications = arr;
                    }
                    else if (response) {
                        /** @type {?} */
                        const m = new MessageHandler(this._snackBar);
                        m.showMessage(StatusCode.serverError, response.message);
                    }
                    else {
                        /** @type {?} */
                        const m = new MessageHandler(this._snackBar);
                        m.showMessage(StatusCode.serverError, 'Notificaciones no encontradas');
                    }
                }));
                // }
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                console.log('The observable got an error notification: ' + err + '.');
            }),
            complete: (/**
             * @return {?}
             */
            () => {
                console.log('The observable got a complete notification.');
            })
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // Emits, one every second (90000ms), starting after 0 seconds
        this.timerSuscription = timer(0, 900000).subscribe(this.timerObserver);
        if (this.color == undefined)
            this.color = "primary";
        if (this.buttonType == undefined)
            this.buttonType = "mat-mini-fab";
    }
    /**
     * @return {?}
     */
    notificationsCount() {
        if (this.count == 0)
            return '';
        if (this.count > 10)
            return '+10';
        return this.count;
    }
}
NotificationButtonComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-notification-button',
                template: "<ng-container [ngSwitch]=\"buttonType\">\n\n    <button *ngSwitchCase=\"'mat-icon-button'\" mat-icon-button [matBadge]=\"notificationsCount()\" matBadgeColor=\"accent\" [matMenuTriggerFor]=\"notificationsMenu\" matTooltip=\"Notificaciones\">\n        <mat-icon>notifications</mat-icon>\n    </button>\n\n    <button *ngSwitchCase=\"'mat-button'\" mat-button color=\"{{color}}\" [matBadge]=\"notificationsCount()\" matBadgeColor=\"accent\" [matMenuTriggerFor]=\"notificationsMenu\" matTooltip=\"Notificaciones\">\n        <mat-icon>notifications</mat-icon>\n    </button>\n\n    <button *ngSwitchDefault mat-mini-fab color=\"{{color}}\" [matBadge]=\"notificationsCount()\" matBadgeColor=\"accent\" [matMenuTriggerFor]=\"notificationsMenu\" matTooltip=\"Notificaciones\">\n        <mat-icon>notifications</mat-icon>\n    </button>\n</ng-container>\n\n<mat-menu #notificationsMenu=\"matMenu\" style=\"max-width: 400px !important;\">\n  <button class=\"notification-item\" mat-menu-item *ngFor=\"let notification of notifications\">\n    <div class=\"notification-container\" [ngStyle]=\"{'border-left-color': notification.classification.color}\">\n      <div class=\"notification-header\">\n        <span>{{notification.emiter.name}} {{notification.emiter.lastname}}</span>\n        <span>{{moment(notification.createdAt).startOf('day').fromNow()}}</span>\n      </div>\n      <span class=\"notification-description\">\n        {{(notification.description.length>135) ?\n          (notification.description | slice:0:135)+' ...'\n          :(notification.description)\n        }}\n      </span>\n    </div>\n  </button>\n  <div *ngIf=\"count === 0\" class=\"empty-notifications-container\">\n    <mat-icon class=\"empty-notifications-icon\">notifications</mat-icon>\n    <h1 style=\"color: gray; font-size: 25px\">SIN NOTIFICACIONES</h1>\n  </div>\n    <mat-divider></mat-divider>\n    <a [routerLink]=\"['/notifications']\" style=\"text-decoration: none;\">\n        <button mat-menu-item style=\"text-align: center;\" color=\"accent\">\n            Ver todas\n        </button>\n    </a>\n</mat-menu>\n",
                styles: [".notification-item{height:100%;border-bottom:1px solid #f5f5f5;padding-left:0}.notification-container{display:flex;flex-direction:column;justify-content:flex-start;padding-left:10px;padding-bottom:10px;border-left:10px solid}.notification-header{display:flex;justify-content:space-between;margin-bottom:-5px;font-size:12px;color:gray}.notification-description{line-height:20px;white-space:pre-wrap;font-size:15px}.empty-notifications-container{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:30px}.empty-notifications-icon{color:grey;font-size:4.5em;height:70px;width:70px}::ng-deep.mat-menu-panel{max-width:400px!important}"]
            }] }
];
/** @nocollapse */
NotificationButtonComponent.ctorParameters = () => [
    { type: NotificationService },
    { type: MatSnackBar },
    { type: OAuthStorage }
];
NotificationButtonComponent.propDecorators = {
    color: [{ type: Input }],
    buttonType: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NotificationButtonComponent.prototype.color;
    /** @type {?} */
    NotificationButtonComponent.prototype.buttonType;
    /** @type {?} */
    NotificationButtonComponent.prototype.count;
    /** @type {?} */
    NotificationButtonComponent.prototype.notifications;
    /** @type {?} */
    NotificationButtonComponent.prototype.moment;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.timerSuscription;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.timerObserver;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype._snackBar;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.oauthStorage;
}
class UserNotification {
}
if (false) {
    /** @type {?} */
    UserNotification.prototype.id;
    /** @type {?} */
    UserNotification.prototype.name;
    /** @type {?} */
    UserNotification.prototype.lastname;
    /** @type {?} */
    UserNotification.prototype.email;
}
export class NotificationInfo {
}
if (false) {
    /** @type {?} */
    NotificationInfo.prototype.classification;
    /** @type {?} */
    NotificationInfo.prototype.receiver_id;
    /** @type {?} */
    NotificationInfo.prototype.viewed;
    /** @type {?} */
    NotificationInfo.prototype.viewed_date;
    /** @type {?} */
    NotificationInfo.prototype.description;
    /** @type {?} */
    NotificationInfo.prototype.createdAt;
    /** @type {?} */
    NotificationInfo.prototype.emiter;
    /** @type {?} */
    NotificationInfo.prototype.app;
    /** @type {?} */
    NotificationInfo.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90b2NvLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLWJ1dHRvbi9ub3RpZmljYXRpb24tYnV0dG9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxFQUFFLElBQUksWUFBWSxFQUFFLEtBQUssRUFBaUMsTUFBTSxNQUFNLENBQUM7QUFDaEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNuRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFPbkQsTUFBTSxPQUFPLDJCQUEyQjs7Ozs7O0lBcURwQyxZQUFvQixPQUE0QixFQUFVLFNBQXNCLEVBQVUsWUFBMEI7UUFBaEcsWUFBTyxHQUFQLE9BQU8sQ0FBcUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFhO1FBQVUsaUJBQVksR0FBWixZQUFZLENBQWM7UUEvQzdHLFVBQUssR0FBVyxDQUFDLENBQUM7UUFFbEIsV0FBTSxHQUFRLE1BQU0sQ0FBQztRQUVwQixxQkFBZ0IsR0FBaUIsSUFBSSxDQUFDO1FBQ3RDLGtCQUFhLEdBQTRCO1lBQzdDLElBQUk7Ozs7WUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUVSLGtEQUFrRDtnQkFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0Is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QixDQUFDOzs7WUEzRUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSwwQkFBMEI7Z0JBQ3BDLGlrRUFBbUQ7O2FBRXREOzs7O1lBUlEsbUJBQW1CO1lBRm5CLFdBQVc7WUFJWCxZQUFZOzs7b0JBU2hCLEtBQUs7eUJBRUwsS0FBSzs7OztJQUZOLDRDQUE4Qjs7SUFFOUIsaURBQW1DOztJQUVuQyw0Q0FBeUI7O0lBQ3pCLG9EQUE4Qzs7SUFDOUMsNkNBQTRCOzs7OztJQUU1Qix1REFBOEM7Ozs7O0lBQzlDLG9EQXdDRTs7Ozs7SUFFVSw4Q0FBb0M7Ozs7O0lBQUUsZ0RBQThCOzs7OztJQUFFLG1EQUFrQzs7QUFxQnhILE1BQU8sZ0JBQWdCO0NBS3RCOzs7SUFKQyw4QkFBVzs7SUFDWCxnQ0FBYTs7SUFDYixvQ0FBaUI7O0lBQ2pCLGlDQUFjOztBQUdoQixNQUFNLE9BQU8sZ0JBQWdCO0NBVTVCOzs7SUFUQywwQ0FBaUQ7O0lBQ2pELHVDQUE4Qjs7SUFDOUIsa0NBQWdCOztJQUNoQix1Q0FBb0I7O0lBQ3BCLHVDQUFvQjs7SUFDcEIscUNBQWtCOztJQUNsQixrQ0FBeUI7O0lBQ3pCLCtCQUFZOztJQUNaLGdDQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBvZiBhcyBvYnNlcnZhYmxlT2YsIHRpbWVyLCBTdWJzY3JpcHRpb24sIFBhcnRpYWxPYnNlcnZlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBNZXNzYWdlSGFuZGxlciwgU3RhdHVzQ29kZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBPQXV0aFN0b3JhZ2UgfSBmcm9tICdhbmd1bGFyLW9hdXRoMi1vaWRjJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0b2NvLW5vdGlmaWNhdGlvbi1idXR0b24nLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9ub3RpZmljYXRpb24tYnV0dG9uLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9ub3RpZmljYXRpb24tYnV0dG9uLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uQnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIEBJbnB1dCgpIHB1YmxpYyBjb2xvcjogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgcHVibGljIGJ1dHRvblR5cGU6IHN0cmluZztcblxuICAgIHB1YmxpYyBjb3VudDogbnVtYmVyID0gMDtcbiAgICBwdWJsaWMgbm90aWZpY2F0aW9uczogQXJyYXk8Tm90aWZpY2F0aW9uSW5mbz47XG4gICAgcHVibGljIG1vbWVudDogYW55ID0gbW9tZW50O1xuXG4gICAgcHJpdmF0ZSB0aW1lclN1c2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIHByaXZhdGUgdGltZXJPYnNlcnZlcjogUGFydGlhbE9ic2VydmVyPG51bWJlcj4gPSB7XG4gICAgICAgIG5leHQ6IChfKSA9PiB7XG5cbiAgICAgICAgICAgIC8vIGlmICh0aGlzLm9hdXRoU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKSl7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmdldE5vdGlmaWNhdGlvbnNMaXN0KDUsMCkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZU9mKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gXCJzdWNjZXNzXCIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb3VudCA9IHJlc3BvbnNlLmRhdGEudG90YWxfbm90X3ZpZXc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnI6IE5vdGlmaWNhdGlvbkluZm9bXSA9IHJlc3BvbnNlLmRhdGEubm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBuID0+ICh7Li4ubiwgY2xhc3NpZmljYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbi5jbGFzc2lmaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogbi5jbGFzc2lmaWNhdGlvbiA9PT0gJ0lORk8nID8gJyMyMTk2RjMnIDogbi5jbGFzc2lmaWNhdGlvbiA9PT0gJ0FMRVJUJyA/ICcjRkY1NzIyJyA6ICcjZDMyZjJmJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9fSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihuID0+ICFuLnZpZXdlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSBhcnI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgJ05vdGlmaWNhY2lvbmVzIG5vIGVuY29udHJhZGFzJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfSxcblxuICAgICAgICBlcnJvcjogKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGhlIG9ic2VydmFibGUgZ290IGFuIGVycm9yIG5vdGlmaWNhdGlvbjogJyArIGVyciArICcuJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGUgb2JzZXJ2YWJsZSBnb3QgYSBjb21wbGV0ZSBub3RpZmljYXRpb24uJyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlLCBwcml2YXRlIF9zbmFja0JhcjogTWF0U25hY2tCYXIsIHByaXZhdGUgb2F1dGhTdG9yYWdlOiBPQXV0aFN0b3JhZ2UpIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIC8vIEVtaXRzLCBvbmUgZXZlcnkgc2Vjb25kICg5MDAwMG1zKSwgc3RhcnRpbmcgYWZ0ZXIgMCBzZWNvbmRzXG4gICAgICAgIHRoaXMudGltZXJTdXNjcmlwdGlvbiA9IHRpbWVyKDAsIDkwMDAwMCkuc3Vic2NyaWJlKHRoaXMudGltZXJPYnNlcnZlcik7XG5cbiAgICAgICAgaWYgKHRoaXMuY29sb3IgPT0gdW5kZWZpbmVkKSB0aGlzLmNvbG9yID0gXCJwcmltYXJ5XCI7XG5cbiAgICAgICAgaWYgKHRoaXMuYnV0dG9uVHlwZSA9PSB1bmRlZmluZWQpIHRoaXMuYnV0dG9uVHlwZSA9IFwibWF0LW1pbmktZmFiXCI7XG4gICAgfVxuXG4gICAgbm90aWZpY2F0aW9uc0NvdW50KCl7XG4gICAgICBpZih0aGlzLmNvdW50ID09IDApXG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIGlmICh0aGlzLmNvdW50ID4gMTApXG4gICAgICAgICAgICByZXR1cm4gJysxMCc7XG4gICAgICAgIHJldHVybiB0aGlzLmNvdW50O1xuICAgIH1cblxufVxuXG5jbGFzcyAgVXNlck5vdGlmaWNhdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgbGFzdG5hbWU6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvbkluZm8ge1xuICBjbGFzc2lmaWNhdGlvbjogeyBsYWJlbDogc3RyaW5nLCBjb2xvcjogc3RyaW5nIH07XG4gIHJlY2VpdmVyX2lkOiBVc2VyTm90aWZpY2F0aW9uO1xuICB2aWV3ZWQ6IGJvb2xlYW47XG4gIHZpZXdlZF9kYXRlOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xuICBlbWl0ZXI6IFVzZXJOb3RpZmljYXRpb247XG4gIGFwcDogc3RyaW5nO1xuICBkYXRhOiB7fTtcbn1cbiJdfQ==