/**
 * @fileoverview added by tsickle
 * Generated from: lib/organizations/org-tree-viewer/org-tree-viewer.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FlatTreeControl } from '@angular/cdk/tree';
import { Component, EventEmitter, Injectable, Input, Output } from '@angular/core';
import { BehaviorSubject, merge } from 'rxjs';
import { map } from 'rxjs/operators';
import { OrganizationServiceNoAuth } from '../../backend/public-api';
/**
 * Flat node with expandable and level information
 */
export class OrganizationFlatNode {
    /**
     * @param {?} item
     * @param {?} parent
     * @param {?=} level
     * @param {?=} expandable
     * @param {?=} isLoading
     */
    constructor(item, parent, level = 1, expandable = false, isLoading = false) {
        this.item = item;
        this.parent = parent;
        this.level = level;
        this.expandable = expandable;
        this.isLoading = isLoading;
    }
}
if (false) {
    /** @type {?} */
    OrganizationFlatNode.prototype.item;
    /** @type {?} */
    OrganizationFlatNode.prototype.parent;
    /** @type {?} */
    OrganizationFlatNode.prototype.level;
    /** @type {?} */
    OrganizationFlatNode.prototype.expandable;
    /** @type {?} */
    OrganizationFlatNode.prototype.isLoading;
}
export class OrganizationDataSource {
    /**
     * @param {?} _treeControl
     * @param {?} orgService
     */
    constructor(_treeControl, orgService) {
        this._treeControl = _treeControl;
        this.orgService = orgService;
        this.dataChange = new BehaviorSubject([]);
        this.orgRelationshipType = null;
    }
    /**
     * @return {?}
     */
    get data() { return this.dataChange.value; }
    /**
     * @param {?} value
     * @return {?}
     */
    set data(value) {
        this._treeControl.dataNodes = value;
        this.dataChange.next(value);
    }
    /**
     * @param {?} collectionViewer
     * @return {?}
     */
    connect(collectionViewer) {
        this._treeControl.expansionModel.onChange.subscribe((/**
         * @param {?} change
         * @return {?}
         */
        change => {
            if (((/** @type {?} */ (change))).added ||
                ((/** @type {?} */ (change))).removed) {
                this.handleTreeControl((/** @type {?} */ (change)));
            }
        }));
        return merge(collectionViewer.viewChange, this.dataChange).pipe(map((/**
         * @return {?}
         */
        () => this.data)));
    }
    /**
     * Handle expand/collapse behaviors
     * @param {?} change
     * @return {?}
     */
    handleTreeControl(change) {
        if (change.added) {
            change.added.forEach((/**
             * @param {?} node
             * @return {?}
             */
            node => this.toggleNode(node, true)));
        }
        if (change.removed) {
            change.removed.slice().reverse().forEach((/**
             * @param {?} node
             * @return {?}
             */
            node => this.toggleNode(node, false)));
        }
    }
    /**
     * Toggle the node, remove from display list
     * @param {?} node
     * @param {?} expand
     * @return {?}
     */
    toggleNode(node, expand) {
        node.isLoading = true;
        /** @type {?} */
        const index = this.data.indexOf(node);
        if (node.item.metadata.relationships.length <= 0 || index < 0) { // If no children, or cannot find the node, no op
            return;
        }
        if (expand) {
            this.orgService.getOrganizationRelationships(node.item.metadata.id, this.orgRelationshipType).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            (response) => {
                /** @type {?} */
                const nodes = response.map((/**
                 * @param {?} org
                 * @return {?}
                 */
                org => new OrganizationFlatNode(org, node, node.level + 1, org.metadata.relationships.length > 0)));
                this.data.splice(index + 1, 0, ...nodes);
                this.dataChange.next(this.data);
                node.isLoading = false;
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => { }), (/**
             * @return {?}
             */
            () => { }));
        }
        else {
            /** @type {?} */
            let count = 0;
            for (let i = index + 1; i < this.data.length
                && this.data[i].level > node.level; i++) {
                count++;
            }
            this.data.splice(index + 1, count);
            this.dataChange.next(this.data);
            node.isLoading = false;
        }
    }
}
OrganizationDataSource.decorators = [
    { type: Injectable }
];
/** @nocollapse */
OrganizationDataSource.ctorParameters = () => [
    { type: FlatTreeControl },
    { type: OrganizationServiceNoAuth }
];
if (false) {
    /** @type {?} */
    OrganizationDataSource.prototype.dataChange;
    /** @type {?} */
    OrganizationDataSource.prototype.orgRelationshipType;
    /**
     * @type {?}
     * @private
     */
    OrganizationDataSource.prototype._treeControl;
    /**
     * @type {?}
     * @private
     */
    OrganizationDataSource.prototype.orgService;
}
export class OrgTreeViewerComponent {
    /**
     * @param {?} orgService
     */
    constructor(orgService) {
        this.orgService = orgService;
        this.organizations = new Array();
        this.orgRelationshipType = null;
        this.iconAction = 'visibility';
        this.labelAction = '';
        this.ngStyle = null;
        this.action = new EventEmitter();
        this.error = false;
        this.getLevel = (/**
         * @param {?} node
         * @return {?}
         */
        (node) => node.level);
        this.isExpandable = (/**
         * @param {?} node
         * @return {?}
         */
        (node) => node.expandable);
        this.hasChild = (/**
         * @param {?} _
         * @param {?} _nodeData
         * @return {?}
         */
        (_, _nodeData) => _nodeData.expandable);
        this.treeControl = new FlatTreeControl(this.getLevel, this.isExpandable);
        this.dataSource = new OrganizationDataSource(this.treeControl, orgService);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dataSource.orgRelationshipType = this.orgRelationshipType;
        this.dataSource.data = this.organizations.map((/**
         * @param {?} org
         * @return {?}
         */
        org => new OrganizationFlatNode(org, null, 1, org.metadata.relationships.length > 0)));
    }
    /**
     * @param {?} org
     * @return {?}
     */
    emitAction(org) {
        this.action.emit(org);
    }
}
OrgTreeViewerComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-org-tree-viewer',
                template: "<mat-tree\n  [dataSource]=\"dataSource\"\n  [treeControl]=\"treeControl\"\n  [ngStyle]=\"ngStyle\"\n>\n  <mat-tree-node\n    *matTreeNodeDef=\"let node\"\n    matTreeNodePadding\n  >\n    <button mat-icon-button disabled></button>\n    {{ node.item.metadata.name }}\n    <button\n        mat-icon-button\n        matTooltip=\"labelAction\"\n        (click)=\"emitAction(node)\"\n      >\n        <mat-icon>{{iconAction}}</mat-icon>\n      </button>\n  </mat-tree-node>\n  <mat-tree-node\n    *matTreeNodeDef=\"let node; when: hasChild\"\n    matTreeNodePadding\n  >\n    <button\n      mat-icon-button\n      [attr.aria-label]=\"'toggle ' + node.filename\"\n      matTreeNodeToggle\n    >\n      <mat-icon class=\"mat-icon-rtl-mirror\">\n        {{ treeControl.isExpanded(node) ? \"expand_more\" : \"chevron_right\" }}\n      </mat-icon>\n    </button>\n    {{ node.item.metadata.name }}\n    <button\n        mat-icon-button\n        matTooltip=\"labelAction\"\n        (click)=\"emitAction(node)\"\n      >\n        <mat-icon>{{iconAction}}</mat-icon>\n      </button>\n    <mat-progress-bar\n      *ngIf=\"node.isLoading\"\n      mode=\"indeterminate\"\n      class=\"example-tree-progress-bar\"\n    ></mat-progress-bar>\n  </mat-tree-node>\n</mat-tree>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
OrgTreeViewerComponent.ctorParameters = () => [
    { type: OrganizationServiceNoAuth }
];
OrgTreeViewerComponent.propDecorators = {
    organizations: [{ type: Input }],
    orgRelationshipType: [{ type: Input }],
    iconAction: [{ type: Input }],
    labelAction: [{ type: Input }],
    ngStyle: [{ type: Input }],
    action: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    OrgTreeViewerComponent.prototype.organizations;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.orgRelationshipType;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.iconAction;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.labelAction;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.ngStyle;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.action;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.error;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.treeControl;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.dataSource;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.getLevel;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.isExpandable;
    /** @type {?} */
    OrgTreeViewerComponent.prototype.hasChild;
    /**
     * @type {?}
     * @private
     */
    OrgTreeViewerComponent.prototype.orgService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JnLXRyZWUtdmlld2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL29yZ2FuaXphdGlvbnMvb3JnLXRyZWUtdmlld2VyL29yZy10cmVlLXZpZXdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0YsT0FBTyxFQUFFLGVBQWUsRUFBYyxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDOzs7O0FBT3JFLE1BQU0sT0FBTyxvQkFBb0I7Ozs7Ozs7O0lBQy9CLFlBQW1CLElBQXVCLEVBQ3ZCLE1BQTRCLEVBQzVCLFFBQVEsQ0FBQyxFQUNULGFBQWEsS0FBSyxFQUNsQixZQUFZLEtBQUs7UUFKakIsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDdkIsV0FBTSxHQUFOLE1BQU0sQ0FBc0I7UUFDNUIsVUFBSyxHQUFMLEtBQUssQ0FBSTtRQUNULGVBQVUsR0FBVixVQUFVLENBQVE7UUFDbEIsY0FBUyxHQUFULFNBQVMsQ0FBUTtJQUFJLENBQUM7Q0FDMUM7OztJQUxhLG9DQUE4Qjs7SUFDOUIsc0NBQW1DOztJQUNuQyxxQ0FBZ0I7O0lBQ2hCLDBDQUF5Qjs7SUFDekIseUNBQXdCOztBQUl0QyxNQUFNLE9BQU8sc0JBQXNCOzs7OztJQU1qQyxZQUFvQixZQUFtRCxFQUNuRCxVQUFxQztRQURyQyxpQkFBWSxHQUFaLFlBQVksQ0FBdUM7UUFDbkQsZUFBVSxHQUFWLFVBQVUsQ0FBMkI7UUFKekQsZUFBVSxH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QkFFTCxLQUFLO3FCQUVMLE1BQU07Ozs7SUFWUCwrQ0FBK0Q7O0lBRS9ELHFEQUE0Qzs7SUFFNUMsNENBQW1DOztJQUVuQyw2Q0FBMEI7O0lBRTFCLHlDQUF3Qjs7SUFFeEIsd0NBQ2tEOztJQUVsRCx1Q0FBcUI7O0lBRXJCLDZDQUFtRDs7SUFFbkQsNENBQW1DOztJQUVuQywwQ0FBc0Q7O0lBRXRELDhDQUErRDs7SUFFL0QsMENBQWdGOzs7OztJQUc5RSw0Q0FBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xsZWN0aW9uVmlld2VyLCBTZWxlY3Rpb25DaGFuZ2UgfSBmcm9tICdAYW5ndWxhci9jZGsvY29sbGVjdGlvbnMnO1xuaW1wb3J0IHsgRmxhdFRyZWVDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3RyZWUnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIEluamVjdGFibGUsIElucHV0LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBtZXJnZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgT3JnYW5pemF0aW9uU2VydmljZU5vQXV0aCB9IGZyb20gJy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBIaXQgfSBmcm9tICcuLi8uLi9lbnRpdGllcy9jb21tb24nO1xuaW1wb3J0IHsgT3JnYW5pemF0aW9uLCBPcmdhbml6YXRpb25SZWxhdGlvbnNoaXBzIH0gZnJvbSAnLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5cblxuXG4vKiogRmxhdCBub2RlIHdpdGggZXhwYW5kYWJsZSBhbmQgbGV2ZWwgaW5mb3JtYXRpb24gKi9cbmV4cG9ydCBjbGFzcyBPcmdhbml6YXRpb25GbGF0Tm9kZSB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpdGVtOiBIaXQ8T3JnYW5pemF0aW9uPixcbiAgICAgICAgICAgICAgcHVibGljIHBhcmVudDogT3JnYW5pemF0aW9uRmxhdE5vZGUsXG4gICAgICAgICAgICAgIHB1YmxpYyBsZXZlbCA9IDEsXG4gICAgICAgICAgICAgIHB1YmxpYyBleHBhbmRhYmxlID0gZmFsc2UsXG4gICAgICAgICAgICAgIHB1YmxpYyBpc0xvYWRpbmcgPSBmYWxzZSkgeyB9XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBPcmdhbml6YXRpb25EYXRhU291cmNlIHtcblxuXG4gIGRhdGFDaGFuZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PE9yZ2FuaXphdGlvbkZsYXROb2RlW10+KFtdKTtcbiAgb3JnUmVsYXRpb25zaGlwVHlwZTogc3RyaW5nID0gbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF90cmVlQ29udHJvbDogRmxhdFRyZWVDb250cm9sPE9yZ2FuaXphdGlvbkZsYXROb2RlPixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBvcmdTZXJ2aWNlOiBPcmdhbml6YXRpb25TZXJ2aWNlTm9BdXRoKSB7IH1cblxuXG4gIGdldCBkYXRhKCk6IE9yZ2FuaXphdGlvbkZsYXROb2RlW10geyByZXR1cm4gdGhpcy5kYXRhQ2hhbmdlLnZhbHVlOyB9XG4gIHNldCBkYXRhKHZhbHVlOiBPcmdhbml6YXRpb25GbGF0Tm9kZVtdKSB7XG4gICAgdGhpcy5fdHJlZUNvbnRyb2wuZGF0YU5vZGVzID0gdmFsdWU7XG4gICAgdGhpcy5kYXRhQ2hhbmdlLm5leHQodmFsdWUpO1xuICB9XG5cblxuICBjb25uZWN0KGNvbGxlY3Rpb25WaWV3ZXI6IENvbGxlY3Rpb25WaWV3ZXIpOiBPYnNlcnZhYmxlPE9yZ2FuaXphdGlvbkZsYXROb2RlW10+IHtcbiAgICB0aGlzLl90cmVlQ29udHJvbC5leHBhbnNpb25Nb2RlbC5vbkNoYW5nZS5zdWJzY3JpYmUoY2hhbmdlID0+IHtcbiAgICAgIGlmICgoY2hhbmdlIGFzIFNlbGVjdGlvbkNoYW5nZTxPcmdhbml6YXRpb25GbGF0Tm9kZT4pLmFkZGVkIHx8XG4gICAgICAgIChjaGFuZ2UgYXMgU2VsZWN0aW9uQ2hhbmdlPE9yZ2FuaXphdGlvbkZsYXROb2RlPikucmVtb3ZlZCkge1xuICAgICAgICB0aGlzLmhhbmRsZVRyZWVDb250cm9sKGNoYW5nZSBhcyBTZWxlY3Rpb25DaGFuZ2U8T3JnYW5pemF0aW9uRmxhdE5vZGU+KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBtZXJnZShjb2xsZWN0aW9uVmlld2VyLnZpZXdDaGFuZ2UsIHRoaXMuZGF0YUNoYW5nZSkucGlwZShtYXAoKCkgPT4gdGhpcy5kYXRhKSk7XG4gIH1cblxuICAvKiogSGFuZGxlIGV4cGFuZC9jb2xsYXBzZSBiZWhhdmlvcnMgKi9cbiAgaGFuZGxlVHJlZUNvbnRyb2woY2hhbmdlOiBTZWxlY3Rpb25DaGFuZ2U8T3JnYW5pemF0aW9uRmxhdE5vZGU+KSB7XG4gICAgaWYgKGNoYW5nZS5hZGRlZCkge1xuICAgICAgY2hhbmdlLmFkZGVkLmZvckVhY2gobm9kZSA9PiB0aGlzLnRvZ2dsZU5vZGUobm9kZSwgdHJ1ZSkpO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlLnJlbW92ZWQpIHtcbiAgICAgIGNoYW5nZS5yZW1vdmVkLnNsaWNlKCkucmV2ZXJzZSgpLmZvckVhY2gobm9kZSA9PiB0aGlzLnRvZ2dsZU5vZGUobm9kZSwgZmFsc2UpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVG9nZ2xlIHRoZSBub2RlLCByZW1vdmUgZnJvbSBkaXNwbGF5IGxpc3RcbiAgICovXG4gIHRvZ2dsZU5vZGUobm9kZTogT3JnYW5pemF0aW9uRmxhdE5vZGUsIGV4cGFuZDogYm9vbGVhbikge1xuICAgIG5vZGUuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5pbmRleE9mKG5vZGUpO1xuICAgIGlmIChub2RlLml0ZW0ubWV0YWRhdGEucmVsYXRpb25zaGlwcy5sZW5ndGggPD0gMCB8fCBpbmRleCA8IDApIHsgLy8gSWYgbm8gY2hpbGRyZW4sIG9yIGNhbm5vdCBmaW5kIHRoZSBub2RlLCBubyBvcFxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZXhwYW5kKSB7XG4gICAgICB0aGlzLm9yZ1NlcnZpY2UuZ2V0T3JnYW5pemF0aW9uUmVsYXRpb25zaGlwcyhub2RlLml0ZW0ubWV0YWRhdGEuaWQsIHRoaXMub3JnUmVsYXRpb25zaGlwVHlwZSkuc3Vic2NyaWJlKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBjb25zdCBub2RlcyA9IHJlc3BvbnNlLm1hcChcbiAgICAgICAgICAgIG9yZyA9PlxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uRmxhdE5vZGUob3JnLCBub2RlLCBub2RlLmxldmVsICsgMSwgb3JnLm1ldGFkYXRhLnJlbGF0aW9uc2hpcHMubGVuZ3RoID4gMClcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhpcy5kYXRhLnNwbGljZShpbmRleCArIDEsIDAsIC4uLm5vZGVzKTtcblxuICAgICAgICAgIHRoaXMuZGF0YUNoYW5nZS5uZXh0KHRoaXMuZGF0YSk7XG4gICAgICAgICAgbm9kZS5pc0xvYWRpbmcgPSBmYWxzZTtcblxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHsgfSxcbiAgICAgICAgKCkgPT4geyB9XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgZm9yIChsZXQgaSA9IGluZGV4ICsgMTsgaSA8IHRoaXMuZGF0YS5sZW5ndGhcbiAgICAgICAgJiYgdGhpcy5kYXRhW2ldLmxldmVsID4gbm9kZS5sZXZlbDsgaSsrKSB7XG4gICAgICAgIGNvdW50KytcbiAgICAgIH1cbiAgICAgIHRoaXMuZGF0YS5zcGxpY2UoaW5kZXggKyAxLCBjb3VudCk7XG4gICAgICB0aGlzLmRhdGFDaGFuZ2UubmV4dCh0aGlzLmRhdGEpO1xuICAgICAgbm9kZS5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndG9jby1vcmctdHJlZS12aWV3ZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vb3JnLXRyZWUtdmlld2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vb3JnLXRyZWUtdmlld2VyLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgT3JnVHJlZVZpZXdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KCkgb3JnYW5pemF0aW9uczogQXJyYXk8SGl0PE9yZ2FuaXphdGlvbj4+ID0gbmV3IEFycmF5KCk7XG5cbiAgQElucHV0KCkgb3JnUmVsYXRpb25zaGlwVHlwZTogc3RyaW5nID0gbnVsbDtcblxuICBASW5wdXQoKSBpY29uQWN0aW9uID0gJ3Zpc2liaWxpdHknO1xuXG4gIEBJbnB1dCgpIGxhYmVsQWN0aW9uID0gJyc7XG5cbiAgQElucHV0KCkgbmdTdHlsZSA9IG51bGw7XG5cbiAgQE91dHB1dCgpXG4gIGFjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXI8T3JnYW5pemF0aW9uRmxhdE5vZGU+KCk7XG5cbiAgcHVibGljIGVycm9yID0gZmFsc2U7XG5cbiAgdHJlZUNvbnRyb2w6IEZsYXRUcmVlQ29udHJvbDxPcmdhbml6YXRpb25GbGF0Tm9kZT47XG5cbiAgZGF0YVNvdXJjZTogT3JnYW5pemF0aW9uRGF0YVNvdXJjZTtcblxuICBnZXRMZXZlbCA9IChub2RlOiBPcmdhbml6YXRpb25GbGF0Tm9kZSkgPT4gbm9kZS5sZXZlbDtcblxuICBpc0V4cGFuZGFibGUgPSAobm9kZTogT3JnYW5pemF0aW9uRmxhdE5vZGUpID0+IG5vZGUuZXhwYW5kYWJsZTtcblxuICBoYXNDaGlsZCA9IChfOiBudW1iZXIsIF9ub2RlRGF0YTogT3JnYW5pemF0aW9uRmxhdE5vZGUpID0+IF9ub2RlRGF0YS5leHBhbmRhYmxlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgb3JnU2VydmljZTogT3JnYW5pemF0aW9uU2VydmljZU5vQXV0aCkge1xuICAgIHRoaXMudHJlZUNvbnRyb2wgPSBuZXcgRmxhdFRyZWVDb250cm9sPE9yZ2FuaXphdGlvbkZsYXROb2RlPih0aGlzLmdldExldmVsLCB0aGlzLmlzRXhwYW5kYWJsZSk7XG4gICAgdGhpcy5kYXRhU291cmNlID0gbmV3IE9yZ2FuaXphdGlvbkRhdGFTb3VyY2UodGhpcy50cmVlQ29udHJvbCwgb3JnU2VydmljZSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmRhdGFTb3VyY2Uub3JnUmVsYXRpb25zaGlwVHlwZSA9IHRoaXMub3JnUmVsYXRpb25zaGlwVHlwZTtcblxuICAgIHRoaXMuZGF0YVNvdXJjZS5kYXRhID0gdGhpcy5vcmdhbml6YXRpb25zLm1hcChcbiAgICAgIG9yZyA9PlxuICAgICAgICBuZXcgT3JnYW5pemF0aW9uRmxhdE5vZGUob3JnLCBudWxsLCAgMSwgb3JnLm1ldGFkYXRhLnJlbGF0aW9uc2hpcHMubGVuZ3RoID4gMClcbiAgICApO1xuICB9XG5cbiAgZW1pdEFjdGlvbihvcmcpIHtcbiAgICB0aGlzLmFjdGlvbi5lbWl0KG9yZyk7XG4gIH1cbn1cbiJdfQ==