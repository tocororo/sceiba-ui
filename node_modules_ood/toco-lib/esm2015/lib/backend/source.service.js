/**
 * @fileoverview added by tsickle
 * Generated from: lib/backend/source.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { HttpBackend, HttpClient, HttpHeaders, HttpParams } from "@angular/common/http";
import { Injectable } from "@angular/core";
import { OAuthStorage } from "angular-oauth2-oidc";
import { Environment } from "../core/env";
export class SourceService {
    /**
     * @param {?} env
     * @param {?} http
     * @param {?} handler
     * @param {?} oauthStorage
     */
    constructor(env, http, handler, oauthStorage) {
        this.env = env;
        this.http = http;
        this.handler = handler;
        this.oauthStorage = oauthStorage;
        this.prefix = "source";
        this.httpOptions = {
            headers: new HttpHeaders({
                "Content-Type": "application/json",
                Authorization: "Bearer ",
            }),
        };
        this.token = "";
        this.token = this.oauthStorage.getItem("access_token");
        // TODO: hay una mejor manera de hacer esto, creando diferentes y propios HttpClients que
        // tengan un comportamiento especifico (eg: sin/con autenticacion)
        // ver: https://github.com/angular/angular/issues/20203#issuecomment-369754776
        // otra solucion seria pasar parametros especiales como {ignore_auth = true} y que el
        // interceptor actue en consecuencia... .
        // https://github.com/angular/angular/issues/18155#issuecomment-382438006
        this.httpSearch = new HttpClient(handler);
    }
    /**
     * @param {?=} size
     * @param {?=} page
     * @param {?=} role
     * @return {?}
     */
    getMySources(size = 10, page = 1, role = 'manager') {
        /** @type {?} */
        let params = new HttpParams();
        params = params.set("size", size.toString(10));
        params = params.set("page", page.toString(10));
        /** @type {?} */
        const options = {
            params: params,
        };
        // this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/me/" + role + "/ALL";
        return this.http.get(req, options);
    }
    /**
     * @return {?}
     */
    getMySourcesAllRoles() {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/me/ALL";
        return this.http.get(req);
    }
    /**
     * @private
     * @param {?} source
     * @return {?}
     */
    adhocstringgify(source) {
        /** @type {?} */
        let orgs = JSON.stringify(source.data.organizations);
        console.log("-------------------", orgs);
        /** @type {?} */
        let all = source.entitystringify();
        console.log("-------------------", all);
        /** @type {?} */
        let from = all.search('"organizations"') + 16;
        /** @type {?} */
        let p1 = all.substr(0, from);
        console.log(p1);
        /** @type {?} */
        let p2 = all.substr(from);
        console.log(p2);
        /** @type {?} */
        let len = this.count_to_len(p2);
        console.log(len);
        /** @type {?} */
        let p3 = all.substr(from + len);
        console.log(p3);
        return p1 + orgs + p3;
    }
    /**
     * @private
     * @param {?} p2
     * @return {?}
     */
    count_to_len(p2) {
        if (p2[0] == "[") {
            /** @type {?} */
            let len = 1;
            /** @type {?} */
            let count = 1;
            for (let index = 1; index < p2.length; index++) {
                /** @type {?} */
                const element = p2[index];
                len++;
                if (p2[index] === "[")
                    count++;
                if (p2[index] === "]")
                    count--;
                if (count === 0)
                    return len;
            }
        }
    }
    /**
     * @param {?} source
     * @param {?} uuid
     * @return {?}
     */
    editSource(source, uuid) {
        // this.adhocstringgify(source)
        // console.log(source)
        // let valu = source.entitystringify();
        // console.log("s: ", valu)
        // this.adhocstringgify(source)
        // console.log(source)
        // let valu = source.entitystringify();
        // console.log("s: ", valu)
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/" + uuid + "/edit";
        return this.http.post(req, this.adhocstringgify(source), this.httpOptions);
    }
    /**
     * @param {?} source
     * @param {?} uuid
     * @return {?}
     */
    makeSourceAsApproved(source, uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/" + uuid + "/publish";
        return this.http.post(req, this.adhocstringgify(source), this.httpOptions);
    }
    /**
     * @param {?} source
     * @param {?} uuid
     * @return {?}
     */
    makeSourceAsUnApproved(source, uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/" + uuid + "/unpublish";
        return this.http.post(req, this.adhocstringgify(source), this.httpOptions);
    }
    /**
     * @param {?} source
     * @param {?} uuid
     * @param {?} role
     * @return {?}
     */
    newSource(source, uuid, role) {
        /** @type {?} */
        let params = new HttpParams();
        params = params.set("pid", uuid.toString());
        params = params.set("role", role.toString());
        /** @type {?} */
        const options = {
            params: params,
        };
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/new";
        return this.http.post(req, this.adhocstringgify(source), options);
    }
    /**
     * @param {?} issn
     * @return {?}
     */
    getIssnInfo(issn) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/journal/issn/" + issn;
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    getSourcesByTermUUID(uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/relations/" + uuid;
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    getSourceVersions(uuid) {
        this.httpOptions.headers = this.httpOptions.headers.set("Authorization", "Bearer " + this.token);
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/" + uuid + "/versions";
        return this.http.get(req, this.httpOptions);
    }
    /**
     * @param {?} uuid
     * @param {?=} level
     * @return {?}
     */
    countSourcesByTerm(uuid, level = 0) {
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const options = {
            params: params.set("level", level.toString(10)),
        };
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + "/relations/" + uuid + "/count";
        return this.http.get(req, options);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    getSourceByUUID(uuid) {
        // const req = this.env.sceibaApi + this.prefix + "/" + uuid;
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/' + uuid;
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    permissionGetSourceEditors(uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/editor/' + uuid + '/users';
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @param {?} user
     * @param {?=} allow
     * @return {?}
     */
    permissionSetSourceEditor(uuid, user, allow = false) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/' + user + '/editor/' + uuid + ((allow) ? '/allow' : '/deny');
        return this.http.post(req, null, this.httpOptions);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    permissionGetSourceManagers(uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/manager/' + uuid + '/users';
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @param {?} user
     * @param {?=} allow
     * @return {?}
     */
    permissionSetSourceManager(uuid, user, allow = false) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/' + user + '/manager/' + uuid + ((allow) ? '/allow' : '/deny');
        return this.http.post(req, null, this.httpOptions);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    permissionGetOrganizationManagers(uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/organization/' + uuid + '/users';
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @param {?} user
     * @param {?=} allow
     * @return {?}
     */
    permissionSetOrganizationManager(uuid, user, allow = false) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/' + user + '/organization/' + uuid + ((allow) ? '/allow' : '/deny');
        return this.http.post(req, null, this.httpOptions);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    permissionGetTermManagers(uuid) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/term/' + uuid + '/users';
        return this.http.get(req);
    }
    /**
     * @param {?} uuid
     * @param {?} user
     * @param {?=} allow
     * @return {?}
     */
    permissionSetTermManager(uuid, user, allow = false) {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/permission/' + user + '/term/' + uuid + ((allow) ? '/allow' : '/deny');
        return this.http.post(req, null, this.httpOptions);
    }
}
SourceService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
SourceService.ctorParameters = () => [
    { type: Environment },
    { type: HttpClient },
    { type: HttpBackend },
    { type: OAuthStorage }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.prefix;
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.httpOptions;
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.token;
    /** @type {?} */
    SourceService.prototype.httpSearch;
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.env;
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.handler;
    /**
     * @type {?}
     * @private
     */
    SourceService.prototype.oauthStorage;
}
export class SourceServiceNoAuth {
    /**
     * @param {?} env
     * @param {?} handler
     */
    constructor(env, handler) {
        // TODO: hay una mejor manera de hacer esto, creando diferentes y propios HttpClients que
        // tengan un comportamiento especifico (eg: sin/con autenticacion)
        // ver: https://github.com/angular/angular/issues/20203#issuecomment-369754776
        // otra solucion seria pasar parametros especiales como {ignore_auth = true} y que el
        // interceptor actue en consecuencia... .
        // https://github.com/angular/angular/issues/18155#issuecomment-382438006
        this.env = env;
        this.handler = handler;
        this.http = new HttpClient(handler);
    }
    /**
     * @param {?} uuid
     * @return {?}
     */
    getSourceByUUID(uuid) {
        // const req = this.env.sceibaApi + this.prefix + "/" + uuid;
        /** @type {?} */
        const req = this.env.sceibaApi + "/pid/source/" + uuid;
        return this.http.get(req);
    }
    /**
     * @param {?} issn
     * @return {?}
     */
    getSourceByISSN(issn) {
        // const req = this.env.sceibaApi + this.prefix + "/" + uuid;
        /** @type {?} */
        const req = this.env.sceibaApi + "source/byissn/" + issn;
        return this.http.get(req);
    }
    /**
     * @param {?} pid
     * @return {?}
     */
    getSourceByPID(pid) {
        // const req = this.env.sceibaApi + this.prefix + "/" + uuid;
        /** @type {?} */
        let params = new HttpParams();
        params = params.set('value', pid);
        /** @type {?} */
        const options = {
            params: params,
        };
        /** @type {?} */
        const req = this.env.sceibaApi + 'source/pid';
        return this.http.get(req, options);
    }
    /**
     * @param {?} params
     * @return {?}
     */
    getSources(params) {
        /** @type {?} */
        const options = {
            params: params,
        };
        console.log(params);
        /** @type {?} */
        const req = this.env.sceibaApi + 'search/sources';
        return this.http.get(req, options);
    }
    /**
     * @param {?} topOrgId
     * @return {?}
     */
    getSourcesStats(topOrgId) {
        /** @type {?} */
        let params = new HttpParams();
        params = params.set('org', topOrgId);
        /** @type {?} */
        const options = {
            params: params,
        };
        /** @type {?} */
        const req = this.env.sceibaApi + 'source/stats';
        return this.http.get(req, options);
    }
}
SourceServiceNoAuth.decorators = [
    { type: Injectable }
];
/** @nocollapse */
SourceServiceNoAuth.ctorParameters = () => [
    { type: Environment },
    { type: HttpBackend }
];
if (false) {
    /** @type {?} */
    SourceServiceNoAuth.prototype.http;
    /**
     * @type {?}
     * @private
     */
    SourceServiceNoAuth.prototype.env;
    /**
     * @type {?}
     * @private
     */
    SourceServiceNoAuth.prototype.handler;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90b2NvLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9iYWNrZW5kL3NvdXJjZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUtBLE9BQU8sRUFDTCxXQUFXLEVBQUUsVUFBVSxFQUN2QixXQUFXLEVBQ1gsVUFBVSxFQUNYLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFbkQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQVUxQyxNQUFNLE9BQU8sYUFBYTs7Ozs7OztJQVl4QixZQUNVLEdBQWdCLEVBQ2hCLElBQWdCLEVBQ2hCLE9BQW9CLEVBQ3BCLFlBQTBCO1FBSDFCLFFBQUcsR0FBSCxHQUFHLENBQWE7UUFDaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixZQUFPLEdBQVAsT0FBTyxDQUFhO1FBQ3BCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBZjVCLFdBQU0sR0FBRyxRQUFRLENBQUM7UUFFbEIsZ0JBQVcsR0FBRztZQUNwQixPQUFPLEVBQUUsSUFBSSxXQUFXLENBQUM7Z0JBQ3ZCLGNBQWMsRUFBRSxrQkFBa0I7Z0JBQ2xDLGFBQWEsRUFBRSxTQUFTO2FBQ3pCLENBQUM7U0FDSCxDQUFDO1FBRU0sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQVFqQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRXZELHlGQUF5RjtRQUN6RixrRUFBa0U7UUFDbEUsOEVBQThFO1FBQzlFLHFGQUFxRjtRQUNyRix5Q0FBeUM7UUFDekMseUVBQXlFO1FBRXpFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7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LE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQzs7Y0FFNUIsT0FBTyxHQUFHO1lBQ2QsTUFBTSxFQUFFLE1BQU07U0FFZjs7Y0FFSyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsWUFBWTtRQUM3QyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFrQixHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdEQsQ0FBQzs7Ozs7SUFHRCxVQUFVLENBQUMsTUFBa0I7O2NBQ3JCLE9BQU8sR0FBRztZQUNkLE1BQU0sRUFBRSxNQUFNO1NBRWY7UUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDOztjQUNkLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxnQkFBZ0I7UUFDakQsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBeUIsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzdELENBQUM7Ozs7O0lBRUQsZUFBZSxDQUFDLFFBQVE7O1lBQ2xCLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRTtRQUM3QixNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7O2NBRS9CLE9BQU8sR0FBRztZQUNkLE1BQU0sRUFBRSxNQUFNO1NBRWY7O2NBQ0ssR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLGNBQWM7UUFDL0MsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBZ0IsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3BELENBQUM7OztZQS9ERixVQUFVOzs7O1lBalBGLFdBQVc7WUFQbEIsV0FBVzs7OztJQTJQWCxtQ0FBaUI7Ozs7O0lBQ0wsa0NBQXdCOzs7OztJQUFFLHNDQUE0QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiAgIENvcHlyaWdodCAoYykgMjAyMCBVbml2ZXJzaWRhZCBkZSBQaW5hciBkZWwgUsOtbyBcIkhlcm1hbm9zIFNhw616IE1vbnRlcyBkZSBPY2FcIlxuICogICBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICovXG5cbmltcG9ydCB7XG4gIEh0dHBCYWNrZW5kLCBIdHRwQ2xpZW50LFxuICBIdHRwSGVhZGVycyxcbiAgSHR0cFBhcmFtc1xufSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgT0F1dGhTdG9yYWdlIH0gZnJvbSBcImFuZ3VsYXItb2F1dGgyLW9pZGNcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tIFwiLi4vY29yZS9lbnZcIjtcbmltcG9ydCB7IFJlc3BvbnNlIH0gZnJvbSAnLi4vY29yZS9wdWJsaWMtYXBpJztcbmltcG9ydCB7XG4gIEhpdCwgU2VhcmNoUmVzcG9uc2UsIFNvdXJjZSwgU291cmNlRGF0YSwgU291cmNlVmVyc2lvblxufSBmcm9tIFwiLi4vZW50aXRpZXMvcHVibGljLWFwaVwiO1xuXG5cblxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU291cmNlU2VydmljZSB7XG4gIHByaXZhdGUgcHJlZml4ID0gXCJzb3VyY2VcIjtcblxuICBwcml2YXRlIGh0dHBPcHRpb25zID0ge1xuICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiLFxuICAgIH0pLFxuICB9O1xuXG4gIHByaXZhdGUgdG9rZW4gPSBcIlwiO1xuICBodHRwU2VhcmNoOiBIdHRwQ2xpZW50O1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVudjogRW52aXJvbm1lbnQsXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgaGFuZGxlcjogSHR0cEJhY2tlbmQsXG4gICAgcHJpdmF0ZSBvYXV0aFN0b3JhZ2U6IE9BdXRoU3RvcmFnZVxuICApIHtcbiAgICB0aGlzLnRva2VuID0gdGhpcy5vYXV0aFN0b3JhZ2UuZ2V0SXRlbShcImFjY2Vzc190b2tlblwiKTtcblxuICAgIC8vIFRPRE86IGhheSB1bmEgbWVqb3IgbWFuZXJhIGRlIGhhY2VyIGVzdG8sIGNyZWFuZG8gZGlmZXJlbnRlcyB5IHByb3Bpb3MgSHR0cENsaWVudHMgcXVlXG4gICAgLy8gdGVuZ2FuIHVuIGNvbXBvcnRhbWllbnRvIGVzcGVjaWZpY28gKGVnOiBzaW4vY29uIGF1dGVudGljYWNpb24pXG4gICAgLy8gdmVyOiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2lzc3Vlcy8yMDIwMyNpc3N1ZWNvbW1lbnQtMzY5NzU0Nzc2XG4gICAgLy8gb3RyYSBzb2x1Y2lvbiBzZXJpYSBwYXNhciBwYXJhbWV0cm9zIGVzcGVjaWFsZXMgY29tbyB7aWdub3JlX2F1dGggPSB0cnVlfSB5IHF1ZSBlbFxuICAgIC8vIGludGVyY2VwdG9yIGFjdHVlIGVuIGNvbnNlY3VlbmNpYS4uLiAuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMTgxNTUjaXNzdWVjb21tZW50LTM4MjQzODAwNlxuXG4gICAgdGhpcy5odHRwU2VhcmNoID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcik7XG4gIH1cblxuICBnZXRNeVNvdXJjZXMoc2l6ZTogbnVtYmVyID0gMTAsIHBhZ2U6IG51bWJlciA9IDEsIHJvbGU9J21hbmFnZXInKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgcGFyYW1zID0gcGFyYW1zLnNldChcInNpemVcIiwgc2l6ZS50b1N0cmluZygxMCkpO1xuICAgIHBhcmFtcyA9IHBhcmFtcy5zZXQoXCJwYWdlXCIsIHBhZ2UudG9TdHJpbmcoMTApKTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIC8vIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xuICAgIH07XG4gICAgLy8gdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzID0gdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIHRoaXMudG9rZW4pO1xuXG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyBcIi9tZS9cIisgcm9sZSArIFwiL0FMTFwiO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSwgb3B0aW9ucyk7XG4gIH1cblxuICBnZXRNeVNvdXJjZXNBbGxSb2xlcygpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL21lL0FMTFwiO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSk7XG4gIH1cblxuXG4gIHByaXZhdGUgYWRob2NzdHJpbmdnaWZ5KHNvdXJjZTogU291cmNlVmVyc2lvbikge1xuICAgIGxldCBvcmdzOiBzdHJpbmcgPSBKU09OLnN0cmluZ2lmeShzb3VyY2UuZGF0YS5vcmdhbml6YXRpb25zKTtcbiAgICBjb25zb2xlLmxvZyhcIi0tLS0tLS0tLS0tLS0tLS0tLS1cIiwgb3Jncyk7XG5cbiAgICBsZXQgYWxsID0gc291cmNlLmVudGl0eXN0cmluZ2lmeSgpO1xuICAgIGNvbnNvbGUubG9nKFwiLS0tLS0tLS0tLS0tLS0tLS0tLVwiLCBhbGwpO1xuXG4gICAgbGV0IGZyb20gPSBhbGwuc2VhcmNoKCdcIm9yZ2FuaXphdGlvbnNcIicpICsgMTY7XG5cbiAgICBsZXQgcDEgPSBhbGwuc3Vic3RyKDAsIGZyb20pO1xuICAgIGNvbnNvbGUubG9nKHAxKTtcblxuICAgIGxldCBwMiA9IGFsbC5zdWJzdHIoZnJvbSk7XG4gICAgY29uc29sZS5sb2cocDIpO1xuXG4gICAgbGV0IGxlbiA9IHRoaXMuY291bnRfdG9fbGVuKHAyKTtcbiAgICBjb25zb2xlLmxvZyhsZW4pO1xuXG4gICAgbGV0IHAzID0gYWxsLnN1YnN0cihmcm9tICsgbGVuKTtcbiAgICBjb25zb2xlLmxvZyhwMyk7XG5cbiAgICByZXR1cm4gcDEgKyBvcmdzICsgcDM7XG4gIH1cbiAgcHJpdmF0ZSBjb3VudF90b19sZW4ocDI6IHN0cmluZykge1xuICAgIGlmIChwMlswXSA9PSBcIltcIikge1xuICAgICAgbGV0IGxlbiA9IDE7XG4gICAgICBsZXQgY291bnQgPSAxO1xuICAgICAgZm9yIChsZXQgaW5kZXggPSAxOyBpbmRleCA8IHAyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gcDJbaW5kZXhdO1xuICAgICAgICBsZW4rKztcbiAgICAgICAgaWYgKHAyW2luZGV4XSA9PT0gXCJbXCIpIGNvdW50Kys7XG4gICAgICAgIGlmIChwMltpbmRleF0gPT09IFwiXVwiKSBjb3VudC0tO1xuICAgICAgICBpZiAoY291bnQgPT09IDApIHJldHVybiBsZW47XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGVkaXRTb3VyY2Uoc291cmNlOiBTb3VyY2VWZXJzaW9uLCB1dWlkOiBhbnkpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICAvLyB0aGlzLmFkaG9jc3RyaW5nZ2lmeShzb3VyY2UpXG4gICAgLy8gY29uc29sZS5sb2coc291cmNlKVxuICAgIC8vIGxldCB2YWx1ID0gc291cmNlLmVudGl0eXN0cmluZ2lmeSgpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiczogXCIsIHZhbHUpXG5cbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL1wiICsgdXVpZCArIFwiL2VkaXRcIjtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UmVzcG9uc2U8YW55Pj4oXG4gICAgICByZXEsXG4gICAgICB0aGlzLmFkaG9jc3RyaW5nZ2lmeShzb3VyY2UpLFxuICAgICAgdGhpcy5odHRwT3B0aW9uc1xuICAgICk7XG4gIH1cblxuICBtYWtlU291cmNlQXNBcHByb3ZlZChzb3VyY2U6IFNvdXJjZVZlcnNpb24sdXVpZCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgXCIvXCIgKyB1dWlkICsgXCIvcHVibGlzaFwiO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHJlcSxcbiAgICAgIHRoaXMuYWRob2NzdHJpbmdnaWZ5KHNvdXJjZSksXG4gICAgICB0aGlzLmh0dHBPcHRpb25zXG4gICAgKTtcbiAgfVxuXG4gIG1ha2VTb3VyY2VBc1VuQXBwcm92ZWQoc291cmNlOiBTb3VyY2VWZXJzaW9uLHV1aWQpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL1wiICsgdXVpZCArIFwiL3VucHVibGlzaFwiO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHJlcSxcbiAgICAgIHRoaXMuYWRob2NzdHJpbmdnaWZ5KHNvdXJjZSksXG4gICAgICB0aGlzLmh0dHBPcHRpb25zXG4gICAgKTtcbiAgfVxuXG4gIG5ld1NvdXJjZShzb3VyY2U6IFNvdXJjZVZlcnNpb24sIHV1aWQsIHJvbGUpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuc2V0KFwicGlkXCIsIHV1aWQudG9TdHJpbmcoKSk7XG4gICAgcGFyYW1zID0gcGFyYW1zLnNldChcInJvbGVcIiwgcm9sZS50b1N0cmluZygpKTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIC8vIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xuICAgIH07XG5cbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL25ld1wiO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHJlcSxcbiAgICAgIHRoaXMuYWRob2NzdHJpbmdnaWZ5KHNvdXJjZSksXG4gICAgICBvcHRpb25zXG4gICAgKTtcbiAgfVxuXG4gIGdldElzc25JbmZvKGlzc24pOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL2pvdXJuYWwvaXNzbi9cIiArIGlzc247XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UmVzcG9uc2U8YW55Pj4ocmVxKTtcbiAgfVxuXG4gIGdldFNvdXJjZXNCeVRlcm1VVUlEKHV1aWQpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL3JlbGF0aW9ucy9cIiArIHV1aWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UmVzcG9uc2U8YW55Pj4ocmVxKTtcbiAgfVxuXG4gIGdldFNvdXJjZVZlcnNpb25zKHV1aWQpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMgPSB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMuc2V0KFxuICAgICAgXCJBdXRob3JpemF0aW9uXCIsXG4gICAgICBcIkJlYXJlciBcIiArIHRoaXMudG9rZW5cbiAgICApO1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgXCIvXCIgKyB1dWlkICsgXCIvdmVyc2lvbnNcIjtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIHRoaXMuaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgY291bnRTb3VyY2VzQnlUZXJtKHV1aWQsIGxldmVsID0gMCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcy5zZXQoXCJsZXZlbFwiLCBsZXZlbC50b1N0cmluZygxMCkpLFxuICAgIH07XG4gICAgY29uc3QgcmVxID1cbiAgICAgIHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgXCIvcmVsYXRpb25zL1wiICsgdXVpZCArIFwiL2NvdW50XCI7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UmVzcG9uc2U8YW55Pj4ocmVxLCBvcHRpb25zKTtcbiAgfVxuXG4gIGdldFNvdXJjZUJ5VVVJRCh1dWlkKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgLy8gY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyBcIi9cIiArIHV1aWQ7XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICArIHRoaXMucHJlZml4ICsgJy8nICsgdXVpZDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxTb3VyY2VEYXRhPj4ocmVxKTtcbiAgfVxuXG4gIHBlcm1pc3Npb25HZXRTb3VyY2VFZGl0b3JzKHV1aWQpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgICsgdGhpcy5wcmVmaXggKyAnL3Blcm1pc3Npb24vZWRpdG9yLycgKyB1dWlkICsnL3VzZXJzJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEpO1xuICB9XG5cbiAgcGVybWlzc2lvblNldFNvdXJjZUVkaXRvcih1dWlkLCB1c2VyLCBhbGxvdz0gZmFsc2UpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgICsgdGhpcy5wcmVmaXggKyAnL3Blcm1pc3Npb24vJyArIHVzZXIgKyAnL2VkaXRvci8nICsgdXVpZCArICgoYWxsb3cpID8gJy9hbGxvdycgOiAnL2RlbnknKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UmVzcG9uc2U8YW55Pj4oXG4gICAgICByZXEsXG4gICAgICBudWxsLFxuICAgICAgdGhpcy5odHRwT3B0aW9uc1xuICAgICk7XG4gIH1cblxuICBwZXJtaXNzaW9uR2V0U291cmNlTWFuYWdlcnModXVpZCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSAgKyB0aGlzLnByZWZpeCArICcvcGVybWlzc2lvbi9tYW5hZ2VyLycgKyB1dWlkICsnL3VzZXJzJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEpO1xuICB9XG5cbiAgcGVybWlzc2lvblNldFNvdXJjZU1hbmFnZXIodXVpZCwgdXNlciwgYWxsb3c9IGZhbHNlKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICArIHRoaXMucHJlZml4ICsgJy9wZXJtaXNzaW9uLycgKyB1c2VyICsgJy9tYW5hZ2VyLycgKyB1dWlkICsgKChhbGxvdykgPyAnL2FsbG93JyA6ICcvZGVueScpO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHJlcSxcbiAgICAgIG51bGwsXG4gICAgICB0aGlzLmh0dHBPcHRpb25zXG4gICAgKTtcbiAgfVxuXG4gIHBlcm1pc3Npb25HZXRPcmdhbml6YXRpb25NYW5hZ2Vycyh1dWlkKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICArIHRoaXMucHJlZml4ICsgJy9wZXJtaXNzaW9uL29yZ2FuaXphdGlvbi8nICsgdXVpZCArJy91c2Vycyc7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UmVzcG9uc2U8YW55Pj4ocmVxKTtcbiAgfVxuXG4gIHBlcm1pc3Npb25TZXRPcmdhbml6YXRpb25NYW5hZ2VyKHV1aWQsIHVzZXIsIGFsbG93PSBmYWxzZSk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSAgKyB0aGlzLnByZWZpeCArICcvcGVybWlzc2lvbi8nICsgdXNlciArICcvb3JnYW5pemF0aW9uLycgKyB1dWlkICsgKChhbGxvdykgPyAnL2FsbG93JyA6ICcvZGVueScpO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHJlcSxcbiAgICAgIG51bGwsXG4gICAgICB0aGlzLmh0dHBPcHRpb25zXG4gICAgKTtcbiAgfVxuXG4gIHBlcm1pc3Npb25HZXRUZXJtTWFuYWdlcnModXVpZCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSAgKyB0aGlzLnByZWZpeCArICcvcGVybWlzc2lvbi90ZXJtLycgKyB1dWlkICsnL3VzZXJzJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEpO1xuICB9XG5cbiAgcGVybWlzc2lvblNldFRlcm1NYW5hZ2VyKHV1aWQsIHVzZXIsIGFsbG93PSBmYWxzZSk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSAgKyB0aGlzLnByZWZpeCArICcvcGVybWlzc2lvbi8nICsgdXNlciArICcvdGVybS8nICsgdXVpZCArICgoYWxsb3cpID8gJy9hbGxvdycgOiAnL2RlbnknKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UmVzcG9uc2U8YW55Pj4oXG4gICAgICByZXEsXG4gICAgICBudWxsLFxuICAgICAgdGhpcy5odHRwT3B0aW9uc1xuICAgICk7XG4gIH1cblxufVxuXG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTb3VyY2VTZXJ2aWNlTm9BdXRoIHtcblxuICBodHRwOiBIdHRwQ2xpZW50O1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVudjogRW52aXJvbm1lbnQsIHByaXZhdGUgaGFuZGxlcjogSHR0cEJhY2tlbmQpIHtcblxuICAgIC8vIFRPRE86IGhheSB1bmEgbWVqb3IgbWFuZXJhIGRlIGhhY2VyIGVzdG8sIGNyZWFuZG8gZGlmZXJlbnRlcyB5IHByb3Bpb3MgSHR0cENsaWVudHMgcXVlXG4gICAgLy8gdGVuZ2FuIHVuIGNvbXBvcnRhbWllbnRvIGVzcGVjaWZpY28gKGVnOiBzaW4vY29uIGF1dGVudGljYWNpb24pXG4gICAgLy8gdmVyOiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2lzc3Vlcy8yMDIwMyNpc3N1ZWNvbW1lbnQtMzY5NzU0Nzc2XG4gICAgLy8gb3RyYSBzb2x1Y2lvbiBzZXJpYSBwYXNhciBwYXJhbWV0cm9zIGVzcGVjaWFsZXMgY29tbyB7aWdub3JlX2F1dGggPSB0cnVlfSB5IHF1ZSBlbFxuICAgIC8vIGludGVyY2VwdG9yIGFjdHVlIGVuIGNvbnNlY3VlbmNpYS4uLiAuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMTgxNTUjaXNzdWVjb21tZW50LTM4MjQzODAwNlxuXG4gICAgdGhpcy5odHRwID0gbmV3IEh0dHBDbGllbnQoaGFuZGxlcik7XG4gIH1cblxuICBnZXRTb3VyY2VCeVVVSUQodXVpZCk6IE9ic2VydmFibGU8SGl0PFNvdXJjZURhdGE+PiB7XG4gICAgLy8gY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyBcIi9cIiArIHV1aWQ7XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgXCIvcGlkL3NvdXJjZS9cIiArIHV1aWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8SGl0PFNvdXJjZURhdGE+PihyZXEpO1xuICB9XG5cbiAgZ2V0U291cmNlQnlJU1NOKGlzc24pOiBPYnNlcnZhYmxlPEhpdDxTb3VyY2VEYXRhPj4ge1xuICAgIC8vIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgXCIvXCIgKyB1dWlkO1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSArIFwic291cmNlL2J5aXNzbi9cIiArIGlzc247XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8SGl0PFNvdXJjZURhdGE+PihyZXEpO1xuICB9XG5cbiAgZ2V0U291cmNlQnlQSUQocGlkKTogT2JzZXJ2YWJsZTxIaXQ8U291cmNlRGF0YT4+IHtcbiAgICAvLyBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArIFwiL1wiICsgdXVpZDtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuc2V0KCd2YWx1ZScsIHBpZCk7XG5cbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAvLyBoZWFkZXJzOiB0aGlzLmhlYWRlcnNcbiAgICB9O1xuXG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgJ3NvdXJjZS9waWQnO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PEhpdDxTb3VyY2VEYXRhPj4ocmVxLCBvcHRpb25zKTtcbiAgfVxuXG5cbiAgZ2V0U291cmNlcyhwYXJhbXM6IEh0dHBQYXJhbXMpOiBPYnNlcnZhYmxlPFNlYXJjaFJlc3BvbnNlPFNvdXJjZT4+IHtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAvLyBoZWFkZXJzOiB0aGlzLmhlYWRlcnNcbiAgICB9O1xuICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgJ3NlYXJjaC9zb3VyY2VzJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxTZWFyY2hSZXNwb25zZTxTb3VyY2U+PihyZXEsIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0U291cmNlc1N0YXRzKHRvcE9yZ0lkKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgcGFyYW1zID0gcGFyYW1zLnNldCgnb3JnJywgdG9wT3JnSWQpO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgLy8gaGVhZGVyczogdGhpcy5oZWFkZXJzXG4gICAgfTtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyAnc291cmNlL3N0YXRzJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIG9wdGlvbnMpO1xuICB9XG5cbn1cbiJdfQ==