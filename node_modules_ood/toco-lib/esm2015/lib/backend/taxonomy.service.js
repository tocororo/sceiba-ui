/**
 * @fileoverview added by tsickle
 * Generated from: lib/backend/taxonomy.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { OAuthStorage } from 'angular-oauth2-oidc';
import { Environment } from '../core/public-api';
// TODO: Poner todos los tipos de datos de retorno de Response.
// No puede haber en ningun servicio del backend un Response<any>
export class TaxonomyService {
    /**
     * @param {?} env
     * @param {?} http
     * @param {?} oauthStorage
     */
    constructor(env, http, oauthStorage) {
        this.env = env;
        this.http = http;
        this.oauthStorage = oauthStorage;
        this.prefix = 'vocabularies';
        this.httpOptions = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json',
            })
        };
        this.token = '';
        this.token = this.oauthStorage.getItem('access_token');
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getVocabulary(id) {
        /** @type {?} */
        let req = this.env.sceibaApi + this.prefix + '/vocabulary/' + id;
        return this.http.get(req);
    }
    /**
     * @param {?} ids
     * @return {?}
     */
    getTermListByIDs(ids) {
        /** @type {?} */
        let p = '';
        ids.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => p = p + n.toString(10) + ','));
        p = p.substring(0, p.length - 1);
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const options = {
            params: params.set('ids', p)
        };
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/term/inlist';
        return this.http.get(req, options);
    }
    /**
     * @param {?} termID
     * @param {?=} level
     * @return {?}
     */
    getTermByID(termID, level = 10) {
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const options = {
            params: params.set('level', level.toString(10))
        };
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/term/id/' + termID;
        return this.http.get(req, options);
    }
    /**
     * @param {?} termUUID
     * @param {?=} level
     * @return {?}
     */
    getTermByUUID(termUUID, level = 10) {
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const options = {
            params: params.set('level', level.toString(10))
        };
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/term/' + termUUID;
        return this.http.get(req, options);
    }
    /**
     * @param {?} vocabId
     * @param {?=} level
     * @return {?}
     */
    getTermsTreeByVocab(vocabId, level = 10) {
        /** @type {?} */
        let params = new HttpParams();
        /** @type {?} */
        const options = {
            params: params.set('level', level.toString(10))
        };
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/term/tree/' + vocabId;
        return this.http.get(req, options);
    }
    /**
     * @param {?} vocab
     * @return {?}
     */
    newVocabulary(vocab) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/vocabulary/new', vocab.entitystringify(), this.httpOptions);
    }
    /**
     * @param {?} vocab
     * @return {?}
     */
    editVocabulary(vocab) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/vocabulary/edit/' + vocab.id, vocab.entitystringify(), this.httpOptions);
    }
    /**
     * @return {?}
     */
    getVocabularies() {
        return this.http.get(this.env.sceibaApi + this.prefix + '/vocabulary/list');
    }
    /**
     * @param {?} term
     * @return {?}
     */
    newTerm(term) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/term/new', term.entitystringify(), this.httpOptions);
    }
    /**
     * @param {?} term
     * @return {?}
     */
    editTerm(term) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/term/edit/' + term.uuid, term.entitystringify(), this.httpOptions);
    }
    /**
     * @return {?}
     */
    getCurrentUserPermissions() {
        /** @type {?} */
        const req = this.env.sceibaApi + this.prefix + '/user/permissions';
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.get(req, this.httpOptions);
    }
}
TaxonomyService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
TaxonomyService.ctorParameters = () => [
    { type: Environment },
    { type: HttpClient },
    { type: OAuthStorage }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.prefix;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.httpOptions;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.token;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.env;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.oauthStorage;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGF4b25vbXkuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2JhY2tlbmQvdGF4b25vbXkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFNQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTNFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUduRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7OztBQVNqRCxNQUFNLE9BQU8sZUFBZTs7Ozs7O0lBWTFCLFlBQW9CLEdBQWdCLEVBQVUsSUFBZ0IsRUFBVSxZQUEwQjtRQUE5RSxRQUFHLEdBQUgsR0FBRyxDQUFhO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUFVLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBVjFGLFdBQU0sR0FBRyxjQUFjLENBQUM7UUFFeEIsZ0JBQVcsR0FBRztZQUNwQixPQUFPLEVBQUUsSUFBSSxXQUFXLENBQ3RCO2dCQUNFLGNBQWMsRUFBRSxrQkFBa0I7YUFDbkMsQ0FBQztTQUNMLENBQUM7UUFDTSxVQUFLLEdBQUcsRUFBRSxDQUFDO1FBR2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDekQsQ0FBQzs7Ozs7SUFFRCxhQUFhLENBQUMsRUFBRTs7WUFDVixHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxjQUFjLEdBQUcsRUFBRTtRQUNoRSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFnQixHQUFHLENBQUMsQ0FBQztJQUMzQyxDQUFDOzs7OztJQUVELGdCQUFnQixD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LEVBQUUsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqRyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUNuQixJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLGFBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUM1RCxJQUFJLENBQUMsZUFBZSxFQUFFLEVBRXRCLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN0QixDQUFDOzs7O0lBRUQseUJBQXlCOztjQUNqQixHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxtQkFBbUI7UUFDbEUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pHLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQWdCLEdBQUcsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDN0QsQ0FBQzs7O1lBekdGLFVBQVU7Ozs7WUFSRixXQUFXO1lBTFgsVUFBVTtZQUVWLFlBQVk7Ozs7Ozs7SUFjbkIsaUNBQWdDOzs7OztJQUVoQyxzQ0FLRTs7Ozs7SUFDRixnQ0FBbUI7Ozs7O0lBRVAsOEJBQXdCOzs7OztJQUFFLCtCQUF3Qjs7Ozs7SUFBRSx1Q0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogICBDb3B5cmlnaHQgKGMpIDIwMjAgVW5pdmVyc2lkYWQgZGUgUGluYXIgZGVsIFLDrW8gXCJIZXJtYW5vcyBTYcOteiBNb250ZXMgZGUgT2NhXCJcbiAqICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgUGFydGlhbE9ic2VydmVyLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBPQXV0aFN0b3JhZ2UgfSBmcm9tICdhbmd1bGFyLW9hdXRoMi1vaWRjJztcblxuXG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJy4uL2NvcmUvcHVibGljLWFwaSc7XG5cbmltcG9ydCB7IFJlc3BvbnNlIH0gZnJvbSAnLi4vY29yZS9wdWJsaWMtYXBpJztcbmltcG9ydCB7IFZvY2FidWxhcnksIFRlcm0gfSBmcm9tICcuLi9lbnRpdGllcy9wdWJsaWMtYXBpJztcblxuLy8gVE9ETzogUG9uZXIgdG9kb3MgbG9zIHRpcG9zIGRlIGRhdG9zIGRlIHJldG9ybm8gZGUgUmVzcG9uc2UuXG4vLyBObyBwdWVkZSBoYWJlciBlbiBuaW5ndW4gc2VydmljaW8gZGVsIGJhY2tlbmQgdW4gUmVzcG9uc2U8YW55PlxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVGF4b25vbXlTZXJ2aWNlIHtcblxuICBwcml2YXRlIHByZWZpeCA9ICd2b2NhYnVsYXJpZXMnO1xuXG4gIHByaXZhdGUgaHR0cE9wdGlvbnMgPSB7XG4gICAgaGVhZGVyczogbmV3IEh0dHBIZWFkZXJzKFxuICAgICAge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSlcbiAgfTtcbiAgcHJpdmF0ZSB0b2tlbiA9ICcnO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZW52OiBFbnZpcm9ubWVudCwgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LCBwcml2YXRlIG9hdXRoU3RvcmFnZTogT0F1dGhTdG9yYWdlKSB7XG4gICAgdGhpcy50b2tlbiA9IHRoaXMub2F1dGhTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpO1xuICB9XG5cbiAgZ2V0Vm9jYWJ1bGFyeShpZCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGxldCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdm9jYWJ1bGFyeS8nICsgaWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UmVzcG9uc2U8YW55Pj4ocmVxKTtcbiAgfVxuXG4gIGdldFRlcm1MaXN0QnlJRHMoaWRzOiBudW1iZXJbXSk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGxldCBwID0gJyc7XG4gICAgaWRzLmZvckVhY2gobiA9PiBwID0gcCArIG4udG9TdHJpbmcoMTApICsgJywnKTtcbiAgICBwID0gcC5zdWJzdHJpbmcoMCwgcC5sZW5ndGggLSAxKTtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgcGFyYW1zOiBwYXJhbXMuc2V0KCdpZHMnLCBwKVxuICAgIH07XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3Rlcm0vaW5saXN0JztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0VGVybUJ5SUQodGVybUlELCBsZXZlbD0xMCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcy5zZXQoJ2xldmVsJywgbGV2ZWwudG9TdHJpbmcoMTApKVxuICAgIH07XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3Rlcm0vaWQvJyArIHRlcm1JRDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0VGVybUJ5VVVJRCh0ZXJtVVVJRCwgbGV2ZWw9MTApOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgcGFyYW1zOiBwYXJhbXMuc2V0KCdsZXZlbCcsIGxldmVsLnRvU3RyaW5nKDEwKSlcbiAgICB9O1xuICAgIGNvbnN0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgJy90ZXJtLycgKyB0ZXJtVVVJRDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIG9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0VGVybXNUcmVlQnlWb2NhYih2b2NhYklkLCBsZXZlbD0xMCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcy5zZXQoJ2xldmVsJywgbGV2ZWwudG9TdHJpbmcoMTApKVxuICAgIH07XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3Rlcm0vdHJlZS8nICsgdm9jYWJJZDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIG9wdGlvbnMpO1xuICB9XG5cbiAgbmV3Vm9jYWJ1bGFyeSh2b2NhYjogVm9jYWJ1bGFyeSk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycyA9IHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyB0aGlzLnRva2VuKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UmVzcG9uc2U8YW55Pj4oXG4gICAgICB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdm9jYWJ1bGFyeS9uZXcnLFxuICAgICAgdm9jYWIuZW50aXR5c3RyaW5naWZ5KClcbiAgICAgICxcbiAgICAgIHRoaXMuaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgZWRpdFZvY2FidWxhcnkodm9jYWI6IFZvY2FidWxhcnkpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMgPSB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgdGhpcy50b2tlbik7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PFJlc3BvbnNlPGFueT4+KFxuICAgICAgdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3ZvY2FidWxhcnkvZWRpdC8nICsgdm9jYWIuaWQsXG4gICAgICB2b2NhYi5lbnRpdHlzdHJpbmdpZnkoKVxuICAgICAgLFxuICAgICAgdGhpcy5odHRwT3B0aW9ucyk7XG4gIH1cblxuICBnZXRWb2NhYnVsYXJpZXMoKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UmVzcG9uc2U8YW55Pj4odGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3ZvY2FidWxhcnkvbGlzdCcpO1xuICB9XG5cbiAgbmV3VGVybSh0ZXJtOiBUZXJtKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzID0gdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIHRoaXMudG9rZW4pO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgJy90ZXJtL25ldycsXG4gICAgICB0ZXJtLmVudGl0eXN0cmluZ2lmeSgpXG4gICAgICAsXG4gICAgICB0aGlzLmh0dHBPcHRpb25zKTtcbiAgfVxuXG4gIGVkaXRUZXJtKHRlcm06IFRlcm0pOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMgPSB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgdGhpcy50b2tlbik7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PFJlc3BvbnNlPGFueT4+KFxuICAgICAgdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3Rlcm0vZWRpdC8nICsgdGVybS51dWlkLFxuICAgICAgdGVybS5lbnRpdHlzdHJpbmdpZnkoKVxuICAgICAgLFxuICAgICAgdGhpcy5odHRwT3B0aW9ucyk7XG4gIH1cblxuICBnZXRDdXJyZW50VXNlclBlcm1pc3Npb25zKCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj57XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3VzZXIvcGVybWlzc2lvbnMnO1xuICAgIHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycyA9IHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyB0aGlzLnRva2VuKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEsIHRoaXMuaHR0cE9wdGlvbnMpO1xuICB9XG59XG4iXX0=