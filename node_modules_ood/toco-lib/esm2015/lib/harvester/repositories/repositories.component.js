/**
 * @fileoverview added by tsickle
 * Generated from: lib/harvester/repositories/repositories.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild } from '@angular/core';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { merge, of as observableOf } from 'rxjs';
import { startWith, switchMap, map, catchError } from 'rxjs/operators';
import { MatPaginator } from '@angular/material/paginator';
import { MatTableDataSource } from '@angular/material/table';
import { CatalogService } from '../../backend/public-api';
import { MetadataService } from '../../core/public-api';
import { Journal, JournalData, ISSN } from '../../entities/public-api';
import { FiltersService } from '../../filters/public-api';
import { Environment } from '../../core/env';
import { HarvesterFiltersComponent } from '../harvester-filters/harvester-filters.component';
export class RepositoriesComponent {
    /**
     * @param {?} service
     * @param {?} metadata
     * @param {?} filterService
     * @param {?} env
     */
    constructor(service, metadata, filterService, env) {
        this.service = service;
        this.metadata = metadata;
        this.filterService = filterService;
        this.env = env;
        this.journalList = [];
        this.loading = true;
        this.dataSource = new MatTableDataSource();
        this.columnsToDisplay = ['title'];
        this.length = 0;
        this.pageSize = 5;
        this.pageSizeOptions = [5, 10, 20, 40, 60, 80, 100];
        this.sceibaHost = '';
        this.currentlayout = {
            name: 'Izquierda',
            layout: 'row',
            aling: 'center baseline',
            width: '22'
        };
        this.sceibaHost = env.sceibaHost + "/catalog";
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.metadata.setStandardMeta("Catálogo de Revistas Científicas", "", "");
        this.paginator.firstPage();
        this.paginator.pageSize = this.pageSize;
        this.service.getJournalsCount().subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            this.length = response.data.count;
        }));
        this.fetchJournalData();
        this.filterService.paramsChanged.subscribe((/**
         * @param {?} params
         * @return {?}
         */
        params => {
            this.params = params;
            this.fetchJournalData();
        }));
    }
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    /**
     * @return {?}
     */
    fetchJournalData() {
        this.loading = true;
        //this.dataSource.data = this.service.getJournalsPage(this.count, this.page);
        /** @type {?} */
        let arr = new Array();
        merge().pipe(startWith({}), switchMap((/**
         * @return {?}
         */
        () => {
            this.loading = true;
            return (/** @type {?} */ (this.service)).getJournalsPage(this.paginator.pageSize, this.paginator.pageIndex, this.params);
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            // Flip flag to show that loading has finished.
            this.loading = false;
            // this.isRateLimitReached = false;
            // this.resultsLength = response.total_count;
            this.length = response.data.sources.count;
            response.data.sources.data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                /** @type {?} */
                let j = new Journal();
                j.id = item.id;
                j.uuid = item.uuid;
                j.source_type = item.source_type;
                // j.harvest_type = item.harvest_type;
                j.data.oaiurl = item.harvest_endpoint;
                /** @type {?} */
                let info = new JournalData();
                info.url = item.data != null ? item.data.url : "";
                info.title = item.name;
                info.subtitle = item.subtitle;
                info.shortname = item.shortname;
                /** @type {?} */
                let issn = new ISSN();
                issn.e = item.data != null ? item.data.issn.e : "";
                issn.l = item.data != null ? item.data.issn.l : "";
                issn.p = item.data != null ? item.data.issn.p : "";
                info.issn = issn;
                info.rnps = item.data != null ? item.data.rnps : "";
                info.logo = item.data != null ? item.data.logo : "";
                info.purpose = item.purpose;
                info.description = item.data != null ? item.data.description : "";
                j.data = info;
                arr.push(j);
            }));
            return arr;
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.loading = false;
            console.log("ERRORRR  " + error);
            // Catch if the GitHub API has reached its rate limit. Return empty data.
            // this.isRateLimitReached = true;
            return observableOf([]);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => this.dataSource.data = data));
    }
    /**
     * @return {?}
     */
    onScrollUp() {
        // console.log("scrolled up!!");
    }
    /**
     * @return {?}
     */
    isEmpty() {
        if (this.journalList.length == 0) {
            this.loading = false;
            return true;
        }
        return false;
    }
    /**
     * @return {?}
     */
    isLoading() {
        return this.loading;
    }
    /**
     * @return {?}
     */
    currentJournals() {
        console.log(this.dataSource.data);
    }
}
RepositoriesComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-repositories',
                template: "<div fxLayout=\"{{currentlayout.layout}}\" fxLayout.xs=\"column nowrap\" fxLayoutAlign=\"{{currentlayout.aling}}\">\n  <button mat-raised-button (click)=\"currentJournals()\">Print Current Fournals</button>\n  <button mat-raised-button (click)=\"currentJournals()\">Print Current Fournals</button>\n  <button mat-raised-button (click)=\"currentJournals()\">Print Current Fournals</button>\n</div>\n\n\n<div fxLayout=\"{{currentlayout.layout}}\" fxLayout.xs=\"column nowrap\" fxLayoutAlign=\"{{currentlayout.aling}}\">\n\n  <toco-harvester-filters-container fxLayout=\"row wrap\" fxLayout.xs=\"column wrap\" fxFlex=\"{{currentlayout.width}}\" fxLayoutAlign=\"start center\" fxLayoutAlign.xs=\"center center\"\n    fxLayoutGap=\"1em\" class=\"width-90 back-grey mat-elevation-z8\">\n  </toco-harvester-filters-container>\n\n  <div class=\"mat-elevation-z8 width-90 margin1em\">\n    <table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows>\n      <ng-container matColumnDef=\"title\">\n        <th mat-header-cell *matHeaderCellDef>Titulo</th>\n        <td mat-cell *matCellDef=\"let element\"> {{element.data.title}} </td>\n      </ng-container>\n      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n      <ng-container matColumnDef=\"expandedDetail\">\n        <td mat-cell *matCellDef=\"let element\" [attr.colspan]=\"columnsToDisplay.length\">\n          <div class=\"example-element-detail\" [@detailExpand]=\"element == expandedElement ? 'expanded' : 'collapsed'\">\n              <toco-harvester-repository\n              [repostitory]=\"element\"></toco-harvester-repository>\n          </div>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"columnsToDisplay\"></tr>\n      <tr mat-row *matRowDef=\"let element; columns: columnsToDisplay;\" class=\"example-element-row\" [class.example-expanded-row]=\"expandedElement === element\"\n        (click)=\"expandedElement = element\">\n      </tr>\n      <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"example-detail-row\"></tr>\n    </table>\n    <mat-paginator [length]=\"length\"\n          [pageSize]=\"pageSize\"\n          [pageSizeOptions]=\"pageSizeOptions\"\n          (page)=\"fetchJournalData()\">\n    </mat-paginator>\n  </div>\n\n  <mat-card *ngIf=\"!isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n    <mat-spinner></mat-spinner>\n    <!--<mat-progress-bar mode=\"indeterminate\"></mat-progress-bar>-->\n  </mat-card>\n\n  <!-- <mat-card *ngIf=\"isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n    <h1>No hay Informaci\u00F3n para Mostrar</h1>\n  </mat-card> -->\n</div>\n\n",
                animations: [
                    trigger('detailExpand', [
                        state('collapsed', style({ height: '0px', minHeight: '0', display: 'none' })),
                        state('expanded', style({ height: '*' })),
                        transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                    ]),
                ],
                styles: [".width-card{width:30%;min-width:240px;margin-left:24px;margin-top:24px}.card-float-left{float:left}.center-spinner{width:90.5%;min-width:240px;margin-left:24px;margin-right:24px;margin-top:24px}.back-grey{background:rgba(0,0,0,.01);margin:1.5em 1em;padding:1em;min-width:18em}.width-90{width:90%}.width-93{width:93.5%}table{width:90%}.margin1em{margin:1em}.menu-pull-right{flex:1 1 auto}table.mat-table{width:100%}tr.example-detail-row{height:0}tr.example-element-row:not(.example-expanded-row):hover{background:#f5f5f5}tr.example-element-row:not(.example-expanded-row):active{background:#efefef}.example-element-row td{border-bottom-width:0}.example-element-detail{overflow:hidden;display:flex}.example-element-diagram{min-width:80px;border:2px solid #000;padding:8px;font-weight:lighter;margin:8px 0;height:104px}.example-element-symbol{font-weight:700;font-size:40px;line-height:normal}.example-element-description{padding:16px}.example-element-description-attribution{opacity:.5}"]
            }] }
];
/** @nocollapse */
RepositoriesComponent.ctorParameters = () => [
    { type: CatalogService },
    { type: MetadataService },
    { type: FiltersService },
    { type: Environment }
];
RepositoriesComponent.propDecorators = {
    paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }],
    filter_component: [{ type: ViewChild, args: [HarvesterFiltersComponent, { static: true },] }]
};
if (false) {
    /** @type {?} */
    RepositoriesComponent.prototype.journalList;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.loading;
    /** @type {?} */
    RepositoriesComponent.prototype.dataSource;
    /** @type {?} */
    RepositoriesComponent.prototype.columnsToDisplay;
    /** @type {?} */
    RepositoriesComponent.prototype.expandedElement;
    /** @type {?} */
    RepositoriesComponent.prototype.length;
    /** @type {?} */
    RepositoriesComponent.prototype.pageSize;
    /** @type {?} */
    RepositoriesComponent.prototype.pageSizeOptions;
    /** @type {?} */
    RepositoriesComponent.prototype.pageEvent;
    /** @type {?} */
    RepositoriesComponent.prototype.params;
    /** @type {?} */
    RepositoriesComponent.prototype.sceibaHost;
    /** @type {?} */
    RepositoriesComponent.prototype.currentlayout;
    /** @type {?} */
    RepositoriesComponent.prototype.paginator;
    /** @type {?} */
    RepositoriesComponent.prototype.filter_component;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.metadata;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.env;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yaWVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2hhcnZlc3Rlci9yZXBvc2l0b3JpZXMvcmVwb3NpdG9yaWVzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDL0UsT0FBTyxFQUFDLEtBQUssRUFBQyxFQUFFLElBQUksWUFBWSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQzlDLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2RSxPQUFPLEVBQUUsWUFBWSxFQUFhLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFN0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RSxPQUFPLEVBQWlCLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXpFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU3QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQWM3RixNQUFNLE9BQU8scUJBQXFCOzs7Ozs7O0lBcUI5QixZQUFvQixPQUF1QixFQUMvQixRQUF5QixFQUN6QixhQUE4QixFQUM5QixHQUFnQjtRQUhSLFlB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Qix1Q0FBNkI7O0lBRTdCLDJDQUFlOztJQUNmLDhDQUtDOztJQVVELDBDQUN3Qjs7SUFFeEIsaURBQzZDOzs7OztJQVpqQyx3Q0FBK0I7Ozs7O0lBQ3ZDLHlDQUFpQzs7Ozs7SUFDakMsOENBQXNDOzs7OztJQUN0QyxvQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7YW5pbWF0ZSwgc3RhdGUsIHN0eWxlLCB0cmFuc2l0aW9uLCB0cmlnZ2VyfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7bWVyZ2Usb2YgYXMgb2JzZXJ2YWJsZU9mfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHN0YXJ0V2l0aCwgc3dpdGNoTWFwLCBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBNYXRQYWdpbmF0b3IsIFBhZ2VFdmVudCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3BhZ2luYXRvcic7XG5pbXBvcnQgeyBNYXRUYWJsZURhdGFTb3VyY2UgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC90YWJsZSc7XG5cbmltcG9ydCB7IENhdGFsb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vYmFja2VuZC9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE1ldGFkYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBKb3VybmFsLCBKb3VybmFsRGF0YSwgSVNTTiB9IGZyb20gJy4uLy4uL2VudGl0aWVzL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgRmlsdGVySHR0cE1hcCwgRmlsdGVyc1NlcnZpY2UgfSBmcm9tICcuLi8uLi9maWx0ZXJzL3B1YmxpYy1hcGknO1xuXG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJy4uLy4uL2NvcmUvZW52JztcblxuaW1wb3J0IHsgSGFydmVzdGVyRmlsdGVyc0NvbXBvbmVudCB9IGZyb20gJy4uL2hhcnZlc3Rlci1maWx0ZXJzL2hhcnZlc3Rlci1maWx0ZXJzLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndG9jby1yZXBvc2l0b3JpZXMnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9yZXBvc2l0b3JpZXMuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3JlcG9zaXRvcmllcy5jb21wb25lbnQuc2NzcyddLFxuICAgIGFuaW1hdGlvbnM6IFtcbiAgICAgICAgdHJpZ2dlcignZGV0YWlsRXhwYW5kJywgW1xuICAgICAgICAgICAgc3RhdGUoJ2NvbGxhcHNlZCcsIHN0eWxlKHtoZWlnaHQ6ICcwcHgnLCBtaW5IZWlnaHQ6ICcwJywgZGlzcGxheTogJ25vbmUnfSkpLFxuICAgICAgICAgICAgc3RhdGUoJ2V4cGFuZGVkJywgc3R5bGUoe2hlaWdodDogJyonfSkpLFxuICAgICAgICAgICAgdHJhbnNpdGlvbignZXhwYW5kZWQgPD0+IGNvbGxhcHNlZCcsIGFuaW1hdGUoJzIyNW1zIGN1YmljLWJlemllcigwLjQsIDAuMCwgMC4yLCAxKScpKSxcbiAgICAgICAgXSksXG4gICAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUmVwb3NpdG9yaWVzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGpvdXJuYWxMaXN0OiBKb3VybmFsW10gPSBbXTtcbiAgICBwcml2YXRlIGxvYWRpbmc6IGJvb2xlYW4gPSB0cnVlO1xuICAgIGRhdGFTb3VyY2UgPSBuZXcgTWF0VGFibGVEYXRhU291cmNlPEpvdXJuYWw+KCk7XG4gICAgY29sdW1uc1RvRGlzcGxheSA9IFsndGl0bGUnXTtcbiAgICBleHBhbmRlZEVsZW1lbnQ6IEpvdXJuYWw7XG4gICAgbGVuZ3RoID0gMDtcbiAgICBwYWdlU2l6ZSA9IDU7XG4gICAgcGFnZVNpemVPcHRpb25zOiBudW1iZXJbXSA9IFs1LCAxMCwgMjAsIDQwLCA2MCwgODAsIDEwMF07XG4gICAgcGFnZUV2ZW50OiBQYWdlRXZlbnQ7XG4gICAgcGFyYW1zOiBBcnJheTxGaWx0ZXJIdHRwTWFwPjtcblxuICAgIHNjZWliYUhvc3QgPSAnJ1xuICAgIGN1cnJlbnRsYXlvdXQgPSB7XG4gICAgICAgIG5hbWU6ICdJenF1aWVyZGEnLFxuICAgICAgICBsYXlvdXQ6ICdyb3cnLFxuICAgICAgICBhbGluZzogJ2NlbnRlciBiYXNlbGluZScsXG4gICAgICAgIHdpZHRoOiAgJzIyJ1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc2VydmljZTogQ2F0YWxvZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbWV0YWRhdGE6IE1ldGFkYXRhU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlIDogRmlsdGVyc1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZW52OiBFbnZpcm9ubWVudClcbiAgICB7XG4gICAgICAgIHRoaXMuc2NlaWJhSG9zdCA9IGVudi5zY2VpYmFIb3N0ICsgXCIvY2F0YWxvZ1wiXG4gICAgfVxuXG4gICAgQFZpZXdDaGlsZChNYXRQYWdpbmF0b3IsIHsgc3RhdGljOiB0cnVlIH0pXG4gICAgcGFnaW5hdG9yOiBNYXRQYWdpbmF0b3I7XG5cbiAgICBAVmlld0NoaWxkKEhhcnZlc3RlckZpbHRlcnNDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pXG4gICAgZmlsdGVyX2NvbXBvbmVudCA6IEhhcnZlc3RlckZpbHRlcnNDb21wb25lbnQ7XG5cbiAgICBuZ09uSW5pdCgpIHtcblxuICAgICAgICB0aGlzLm1ldGFkYXRhLnNldFN0YW5kYXJkTWV0YShcIkNhdMOhbG9nbyBkZSBSZXZpc3RhcyBDaWVudMOtZmljYXNcIiwgXCJcIiwgXCJcIik7XG4gICAgICAgIHRoaXMucGFnaW5hdG9yLmZpcnN0UGFnZSgpO1xuICAgICAgICB0aGlzLnBhZ2luYXRvci5wYWdlU2l6ZSA9IHRoaXMucGFnZVNpemU7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRKb3VybmFsc0NvdW50KCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+e1xuICAgICAgICAgICAgdGhpcy5sZW5ndGggPSByZXNwb25zZS5kYXRhLmNvdW50O1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mZXRjaEpvdXJuYWxEYXRhKCk7XG5cbiAgICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlLnBhcmFtc0NoYW5nZWQuc3Vic2NyaWJlKHBhcmFtcyA9PntcbiAgICAgICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgICAgICAgICAgdGhpcy5mZXRjaEpvdXJuYWxEYXRhKCk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gb25QYWdpbmF0b3JDaGFuZ2VkKCl7XG4gICAgLy8gICB0aGlzLmZpbHRlclNlcnZpY2UuY2hhbmdlRmlsdGVyKCdjb3VudCcsdGhpcy5wYWdpbmF0b3IucGFnZVNpemUsIGZhbHNlKTtcbiAgICAvLyAgIHRoaXMuZmlsdGVyU2VydmljZS5jaGFuZ2VGaWx0ZXIoJ3BhZ2UnLHRoaXMucGFnaW5hdG9yLnBhZ2VJbmRleCk7XG4gICAgLy8gfVxuXG4gICAgZmV0Y2hKb3VybmFsRGF0YSgpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgLy90aGlzLmRhdGFTb3VyY2UuZGF0YSA9IHRoaXMuc2VydmljZS5nZXRKb3VybmFsc1BhZ2UodGhpcy5jb3VudCwgdGhpcy5wYWdlKTtcbiAgICAgICAgbGV0IGFyciA9IG5ldyBBcnJheTxKb3VybmFsPigpO1xuICAgICAgICBtZXJnZSgpLnBpcGUoXG4gICAgICAgICAgICBzdGFydFdpdGgoe30pLFxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2UhLmdldEpvdXJuYWxzUGFnZSh0aGlzLnBhZ2luYXRvci5wYWdlU2l6ZSwgdGhpcy5wYWdpbmF0b3IucGFnZUluZGV4LCB0aGlzLnBhcmFtcyk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG1hcChyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gRmxpcCBmbGFnIHRvIHNob3cgdGhhdCBsb2FkaW5nIGhhcyBmaW5pc2hlZC5cbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmlzUmF0ZUxpbWl0UmVhY2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMucmVzdWx0c0xlbmd0aCA9IHJlc3BvbnNlLnRvdGFsX2NvdW50O1xuICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gcmVzcG9uc2UuZGF0YS5zb3VyY2VzLmNvdW50XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5zb3VyY2VzLmRhdGEuZm9yRWFjaChpdGVtID0+e1xuICAgICAgICAgICAgICAgICAgICBsZXQgaiA9IG5ldyBKb3VybmFsKCk7XG4gICAgICAgICAgICAgICAgICAgIGouaWQgPSBpdGVtLmlkO1xuICAgICAgICAgICAgICAgICAgICBqLnV1aWQgPSBpdGVtLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgIGouc291cmNlX3R5cGUgPSBpdGVtLnNvdXJjZV90eXBlO1xuICAgICAgICAgICAgICAgICAgICAvLyBqLmhhcnZlc3RfdHlwZSA9IGl0ZW0uaGFydmVzdF90eXBlO1xuICAgICAgICAgICAgICAgICAgICBqLmRhdGEub2FpdXJsID0gaXRlbS5oYXJ2ZXN0X2VuZHBvaW50O1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0gbmV3IEpvdXJuYWxEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnVybCA9IGl0ZW0uZGF0YSE9IG51bGwgPyBpdGVtLmRhdGEudXJsOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby50aXRsZSA9IGl0ZW0ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uc3VidGl0bGUgPSBpdGVtLnN1YnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5zaG9ydG5hbWUgID0gaXRlbS5zaG9ydG5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGlzc24gPSBuZXcgSVNTTigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzc24uZSA9IGl0ZW0uZGF0YSE9IG51bGwgPyBpdGVtLmRhdGEuaXNzbi5lIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc3NuLmwgPSBpdGVtLmRhdGEhPSBudWxsID8gaXRlbS5kYXRhLmlzc24ubCA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNzbi5wID0gaXRlbS5kYXRhIT0gbnVsbCA/IGl0ZW0uZGF0YS5pc3NuLnAgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5pc3NuID0gaXNzbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8ucm5wcyA9IGl0ZW0uZGF0YSE9IG51bGwgPyBpdGVtLmRhdGEucm5wcyA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmxvZ28gPSBpdGVtLmRhdGEhPSBudWxsID8gaXRlbS5kYXRhLmxvZ28gOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5wdXJwb3NlICA9IGl0ZW0ucHVycG9zZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uZGVzY3JpcHRpb24gID0gaXRlbS5kYXRhIT0gbnVsbCA/IGl0ZW0uZGF0YS5kZXNjcmlwdGlvbiA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGouZGF0YSA9IGluZm87XG4gICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKGopO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnI7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRVJST1JSUiAgXCIrZXJyb3IpXG4gICAgICAgICAgICAgICAgLy8gQ2F0Y2ggaWYgdGhlIEdpdEh1YiBBUEkgaGFzIHJlYWNoZWQgaXRzIHJhdGUgbGltaXQuIFJldHVybiBlbXB0eSBkYXRhLlxuICAgICAgICAgICAgICAgIC8vIHRoaXMuaXNSYXRlTGltaXRSZWFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZU9mKFtdKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICkuc3Vic2NyaWJlKGRhdGEgPT4gdGhpcy5kYXRhU291cmNlLmRhdGEgPSBkYXRhKTtcblxuICAgIH1cblxuICAgIG9uU2Nyb2xsVXAoKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2Nyb2xsZWQgdXAhIVwiKTtcbiAgICB9XG5cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICBpZiAodGhpcy5qb3VybmFsTGlzdC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaXNMb2FkaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkaW5nO1xuICAgIH1cblxuICAgIGN1cnJlbnRKb3VybmFscygpe1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGFTb3VyY2UuZGF0YSlcbiAgICB9XG59XG4iXX0=