/**
 * @fileoverview added by tsickle
 * Generated from: lib/taxonomy/vocabularies/vocabularies.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, Output, EventEmitter } from '@angular/core';
import { of } from 'rxjs';
import { catchError, finalize, startWith, map } from 'rxjs/operators';
import { FormControl, FormBuilder } from '@angular/forms';
import { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';
import { MatSnackBar } from '@angular/material/snack-bar';
import { MessageHandler, StatusCode } from '../../core/public-api';
import { Vocabulary } from '../../entities/public-api';
import { FormFieldType, HintValue, HintPosition } from '../../forms/public-api';
import { TaxonomyService } from '../../backend/public-api';
import { OAuthStorage } from 'angular-oauth2-oidc';
export class VocabularyDialogComponent {
    /**
     * @param {?} service
     * @param {?} _formBuilder
     * @param {?} dialogRef
     * @param {?} _snackBar
     * @param {?} data
     */
    constructor(service, _formBuilder, dialogRef, _snackBar, data) {
        this.service = service;
        this._formBuilder = _formBuilder;
        this.dialogRef = dialogRef;
        this._snackBar = _snackBar;
        this.data = data;
        this.actionLabel = 'Aceptar';
        this.hasService = false;
        if (data.accept) {
            this.accept = data.accept;
            this.hasService = true;
            this.vocab = new Vocabulary();
            if (data.vocab === null) {
                this.vocab.isNew = true;
            }
            else {
                this.vocab.deepcopy(data.vocab);
                this.actionLabel = 'Actualizar';
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.hasService) {
            this.formGroup = this._formBuilder.group({});
            this.panels = [
                {
                    title: this.vocab.isNew ? 'Nuevo Vocabulario' : 'Editar Vocabulario',
                    description: '',
                    iconName: '',
                    formSection: this.formGroup,
                    formSectionContent: [
                        {
                            name: 'name',
                            label: 'Identificador',
                            type: FormFieldType.identifier,
                            required: true,
                            width: '100%',
                            value: this.vocab.name,
                            startHint: new HintValue(HintPosition.start, 'Un identificador es una secuencia de letras')
                        },
                        {
                            name: 'human_name',
                            label: 'Nombre',
                            type: FormFieldType.text,
                            required: false,
                            width: '100%',
                            value: this.vocab.human_name,
                            startHint: new HintValue(HintPosition.start, '')
                        },
                        {
                            name: 'description',
                            label: 'Descripción',
                            type: FormFieldType.textarea,
                            required: false,
                            width: '100%',
                            value: this.vocab.description,
                            startHint: new HintValue(HintPosition.start, '')
                        }
                    ]
                }
            ];
            this.action = {
                doit: (/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    if (this.formGroup.valid) {
                        this.vocab.name = this.formGroup.value['name'];
                        this.vocab.human_name = this.formGroup.value['human_name'];
                        this.vocab.description = this.formGroup.value['description'];
                        this.accept(this.vocab);
                    }
                    else {
                        /** @type {?} */
                        const m = new MessageHandler(this._snackBar);
                        m.showMessage(StatusCode.OK, 'El identificador no es válido.');
                    }
                })
            };
        }
    }
    /**
     * @return {?}
     */
    onNoClick() {
        this.dialogRef.close();
    }
    /**
     * @return {?}
     */
    acceptAction() {
    }
}
VocabularyDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-vocabulary-dialog',
                template: "<form *ngIf=\"hasService\">\n    <toco-form-container\n        [panelsContent]=\"panels\"\n        [formGroup]=\"formGroup\"\n        [useAccordion]=\"false\"\n        [action]=\"action\"\n        [actionLabel]=\"actionLabel\"\n    ></toco-form-container>\n\n\n    <!-- <div>\n        <button mat-raised-button color=\"primary\" (click)=\"acceptAction()\">{{actionLabel}}</button>\n    </div> -->\n</form>\n\n<h2 *ngIf=\"!hasService\"> No Service</h2>\n"
            }] }
];
/** @nocollapse */
VocabularyDialogComponent.ctorParameters = () => [
    { type: TaxonomyService },
    { type: FormBuilder },
    { type: MatDialogRef },
    { type: MatSnackBar },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
if (false) {
    /** @type {?} */
    VocabularyDialogComponent.prototype.panels;
    /** @type {?} */
    VocabularyDialogComponent.prototype.formGroup;
    /** @type {?} */
    VocabularyDialogComponent.prototype.action;
    /** @type {?} */
    VocabularyDialogComponent.prototype.actionLabel;
    /** @type {?} */
    VocabularyDialogComponent.prototype.hasService;
    /** @type {?} */
    VocabularyDialogComponent.prototype.vocab;
    /** @type {?} */
    VocabularyDialogComponent.prototype.accept;
    /**
     * @type {?}
     * @private
     */
    VocabularyDialogComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    VocabularyDialogComponent.prototype._formBuilder;
    /** @type {?} */
    VocabularyDialogComponent.prototype.dialogRef;
    /** @type {?} */
    VocabularyDialogComponent.prototype._snackBar;
    /** @type {?} */
    VocabularyDialogComponent.prototype.data;
}
export class VocabulariesComponent {
    /**
     * @param {?} service
     * @param {?} oautheStorage
     * @param {?} dialog
     * @param {?} _snackBar
     */
    constructor(service, oautheStorage, dialog, _snackBar) {
        this.service = service;
        this.oautheStorage = oautheStorage;
        this.dialog = dialog;
        this._snackBar = _snackBar;
        this.vocabulariesChangeObserver = {
            next: (/**
             * @param {?} result
             * @return {?}
             */
            (result) => {
                this.dialog.closeAll();
                this.loadVocabularies();
                /** @type {?} */
                const voc = new Vocabulary();
                voc.deepcopy(result.data.vocabulary);
                this.selectVocab(voc);
                /** @type {?} */
                const m = new MessageHandler(this._snackBar);
                m.showMessage(StatusCode.OK, result.message);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                console.log('error: ' + err + '.');
            }),
            complete: (/**
             * @return {?}
             */
            () => {
                console.log('complete.');
            })
        };
        this.vocabCtrl = new FormControl();
        this.selectedVocab = new EventEmitter();
        this.currentVocab = null;
        this.vocabularies = [];
        this.loading = false;
        this.emiterShowTerms = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getAuthenticatedUserPermissions();
        this.loadVocabularies();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
    }
    /**
     * @param {?} item
     * @return {?}
     */
    selectVocab(item) {
        this.currentVocab = item;
    }
    /**
     * @return {?}
     */
    loadVocabularies() {
        this.loading = true;
        this.service.getVocabularies().pipe(catchError((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            /** @type {?} */
            const m = new MessageHandler(this._snackBar);
            m.showMessage(StatusCode.serverError, err.message);
            // TODO: Maybe you must set a better return.
            return of(null);
        })), finalize((/**
         * @return {?}
         */
        () => this.loading = false)))
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            if (response) {
                this.vocabularies = response.data.vocabularies;
                this.filteredVocabularies = this.vocabCtrl.valueChanges
                    .pipe(startWith(''), map((/**
                 * @param {?} value
                 * @return {?}
                 */
                value => {
                    return this.vocabularies.filter((/**
                     * @param {?} vocab
                     * @return {?}
                     */
                    vocab => vocab.name.toLowerCase().includes(value.toLowerCase())));
                })));
            }
            else {
                this.vocabularies = [];
            }
        }));
    }
    /**
     * @return {?}
     */
    newVocab() {
        this.openVocabDialog(null);
    }
    /**
     * @param {?} vocab
     * @return {?}
     */
    editVocab(vocab) {
        this.openVocabDialog(vocab);
    }
    /**
     * @private
     * @param {?} vocab
     * @return {?}
     */
    openVocabDialog(vocab) {
        /** @type {?} */
        const dialogRef = this.dialog.open(VocabularyDialogComponent, {
            data: {
                vocab: vocab,
                accept: (/**
                 * @param {?} voc
                 * @return {?}
                 */
                (voc) => {
                    this.dialog.closeAll();
                    if (voc.isNew) {
                        this.service.newVocabulary(voc).pipe().subscribe(this.vocabulariesChangeObserver);
                    }
                    else {
                        this.service.editVocabulary(voc).pipe().subscribe(this.vocabulariesChangeObserver);
                    }
                })
            }
        });
        dialogRef.afterClosed().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            console.log('dialog closed');
        }));
    }
    /**
     * @param {?} vocab
     * @return {?}
     */
    deleteVocab(vocab) {
    }
    /**
     * @return {?}
     */
    onSelectionChange() {
        this.selectedVocab.emit(this.currentVocab);
    }
    /**
     * @return {?}
     */
    getAuthenticatedUserPermissions() {
        this.service.getCurrentUserPermissions().pipe(catchError((/**
         * @param {?} err
         * @return {?}
         */
        err => {
            /** @type {?} */
            const m = new MessageHandler(this._snackBar);
            m.showMessage(StatusCode.serverError, err.message);
            // TODO: Maybe you must set a better return.
            return of(null);
        })))
            .subscribe((/**
         * @param {?} request
         * @return {?}
         */
        request => {
            if (request.status == 'success') {
                /** @type {?} */
                var permJson = JSON.stringify(request.data.permissions.actions);
                this.oautheStorage.setItem('user_permissions', permJson);
            }
        }));
    }
    /**
     * @param {?} permission
     * @param {?=} id
     * @return {?}
     */
    hasPermission(permission, id) {
        /** @type {?} */
        const userPermission = JSON.parse(this.oautheStorage.getItem('user_permissions'));
        if (!userPermission) {
            return false;
        }
        switch (permission) {
            case 'add':
                if (userPermission.taxonomy_full_editor_actions === null)
                    return true;
                return false;
            case 'edit':
                if (userPermission.taxonomy_full_editor_actions === null)
                    return true;
                if (userPermission.vocabulary_editor_actions) {
                    /** @type {?} */
                    const arr = userPermission.vocabulary_editor_actions;
                    if (arr.includes(id)) {
                        return true;
                    }
                }
                else if (userPermission.taxonomy_full_editor_actions) {
                    return true;
                }
                return false;
            default:
                return false;
        }
    }
}
VocabulariesComponent.decorators = [
    { type: Component, args: [{
                selector: 'toco-vocabularies',
                template: "<mat-card>\n  <mat-card-header>\n    <mat-card-title>\n      <div fxLayout=\"row\" fxLayoutAlign=\"space-between none\">\n        Vocabularios\n        <button *ngIf=\"hasPermission('add')\" mat-icon-button (click)=\"newVocab()\" matTooltip=\"Adicionar Vocabulario\">\n          <mat-icon>library_add</mat-icon>\n        </button>\n      </div>\n    </mat-card-title>\n  </mat-card-header>\n  <mat-card-content [style.overflow]=\"'auto'\" [style.height]=\"'25em'\">\n    <mat-spinner *ngIf=\"loading; else elseTemplate\"></mat-spinner>\n    <ng-template #elseTemplate>\n\n\n      <mat-form-field [ngStyle]=\"{'width': '100%'}\">\n        <mat-label>Vocabularios</mat-label>\n        <mat-select\n          [(value)]=\"currentVocab\"\n          (selectionChange)=\"onSelectionChange()\"\n        >\n          <mat-option *ngFor=\"let option of vocabularies\" [value]=\"option\">\n            {{option.human_name}}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n      \n\n      <!-- <mat-form-field>\n        <input matInput placeholder=\"Vocabularios\" aria-label=\"Vocabularios\" [matAutocomplete]=\"auto\"\n          [formControl]=\"vocabCtrl\">\n        <mat-autocomplete #auto=\"matAutocomplete\">\n          <mat-option *ngFor=\"let item of filteredVocabularies | async\" [value]=\"item.human_name\" (click)=selectVocab(item) (keydown.enter)=selectVocab(item)>\n            {{item.human_name}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field> -->\n\n\n      <mat-card *ngIf=\"currentVocab\">\n        <mat-card-header>\n          <mat-card-title></mat-card-title>\n          <mat-card-subtitle>\n              <strong>Identificador: </strong> {{ currentVocab.name }}\n              </mat-card-subtitle>\n        </mat-card-header>\n        <mat-card-content>\n            <strong>Nombre: </strong> {{ currentVocab.human_name }}\n          <p> <strong> Descripci\u00F3n: </strong> </p>\n          <div class=\"e2e-inner-html-bound  text-align-justify\" [innerHTML]=\"currentVocab.description\"></div>\n\n        </mat-card-content>\n        <mat-card-actions>\n          <button mat-flat-button *ngIf=\"hasPermission('edit', currentVocab.id)\" (click)=\"editVocab(currentVocab)\">Editar \n            <mat-icon>edit</mat-icon>\n          </button>\n        </mat-card-actions>\n      </mat-card>\n      \n    </ng-template>\n  </mat-card-content>\n</mat-card>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
VocabulariesComponent.ctorParameters = () => [
    { type: TaxonomyService },
    { type: OAuthStorage },
    { type: MatDialog },
    { type: MatSnackBar }
];
VocabulariesComponent.propDecorators = {
    selectedVocab: [{ type: Output }],
    emiterShowTerms: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype.vocabulariesChangeObserver;
    /** @type {?} */
    VocabulariesComponent.prototype.vocabCtrl;
    /** @type {?} */
    VocabulariesComponent.prototype.filteredVocabularies;
    /** @type {?} */
    VocabulariesComponent.prototype.selectedVocab;
    /** @type {?} */
    VocabulariesComponent.prototype.currentVocab;
    /** @type {?} */
    VocabulariesComponent.prototype.vocabularies;
    /** @type {?} */
    VocabulariesComponent.prototype.loading;
    /** @type {?} */
    VocabulariesComponent.prototype.emiterShowTerms;
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype.oautheStorage;
    /** @type {?} */
    VocabulariesComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype._snackBar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidm9jYWJ1bGFyaWVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3RheG9ub215L3ZvY2FidWxhcmllcy92b2NhYnVsYXJpZXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsTUFBTSxFQUFhLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzRixPQUFPLEVBQUUsRUFBRSxFQUErQixNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEUsT0FBTyxFQUFFLFdBQVcsRUFBYSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFMUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQVksTUFBTSx1QkFBdUIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUE2QyxhQUFhLEVBQXVCLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVoSixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBUW5ELE1BQU0sT0FBTyx5QkFBeUI7Ozs7Ozs7O0lBVWxDLFlBQ1ksT0FBd0IsRUFDeEIsWUFBeUIsRUFDMUIsU0FBK0MsRUFDL0MsU0FBc0IsRUFDRyxJQUFTO1FBSmpDLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLGlCQUFZLEdBQVos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Q3BELE9BQU8sSUFBSSxDQUFDO2dCQUVoQixPQUFPLEtBQUssQ0FBQztZQUVqQixLQUFLLE1BQU07Z0JBQ1AsSUFBSSxjQUFjLENBQUMsNEJBQTRCLEtBQUssSUFBSTtvQkFDcEQsT0FBTyxJQUFJLENBQUM7Z0JBRWhCLElBQUksY0FBYyxDQUFDLHlCQUF5QixFQUFFOzswQkFDcEMsR0FBRyxHQUFrQixjQUFjLENBQUMseUJBQXlCO29CQUVuRSxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUU7d0JBQ2xCLE9BQU8sSUFBSSxDQUFBO3FCQUNkO2lCQUVKO3FCQUNJLElBQUksY0FBYyxDQUFDLDRCQUE0QixFQUFFO29CQUNsRCxPQUFPLElBQUksQ0FBQztpQkFDZjtnQkFFRCxPQUFPLEtBQUssQ0FBQztZQUVqQjtnQkFDSSxPQUFPLEtBQUssQ0FBQztTQUNwQjtJQUNMLENBQUM7OztZQTNLSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLG1CQUFtQjtnQkFDN0IsaTRFQUE0Qzs7YUFFL0M7Ozs7WUFqSFEsZUFBZTtZQUNmLFlBQVk7WUFSWixTQUFTO1lBQ1QsV0FBVzs7OzRCQWlKZixNQUFNOzhCQVNOLE1BQU07Ozs7Ozs7SUFoQ1AsMkRBa0JFOztJQUVGLDBDQUFxQzs7SUFDckMscURBQXNEOztJQUV0RCw4Q0FDb0U7O0lBRXBFLDZDQUF1Qzs7SUFFdkMsNkNBQXVDOztJQUV2Qyx3Q0FBZ0I7O0lBRWhCLGdEQUF5RTs7Ozs7SUFFN0Qsd0NBQWdDOzs7OztJQUN4Qyw4Q0FBbUM7O0lBQ25DLHVDQUF3Qjs7Ozs7SUFDeEIsMENBQThCIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0LCBPdXRwdXQsIE9uRGVzdHJveSwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IG9mLCBQYXJ0aWFsT2JzZXJ2ZXIsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIGZpbmFsaXplLCBzdGFydFdpdGgsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTWF0RGlhbG9nLCBNYXREaWFsb2dSZWYsIE1BVF9ESUFMT0dfREFUQSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5pbXBvcnQgeyBNYXRTbmFja0JhciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NuYWNrLWJhcic7XG5cbmltcG9ydCB7IE1lc3NhZ2VIYW5kbGVyLCBTdGF0dXNDb2RlLCBSZXNwb25zZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBWb2NhYnVsYXJ5IH0gZnJvbSAnLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBGb3JtQ29udGFpbmVyQ29tcG9uZW50LCBQYW5lbENvbnRlbnRfRGVwciwgRm9ybUZpZWxkVHlwZSwgRm9ybUNvbnRhaW5lckFjdGlvbiwgSGludFZhbHVlLCBIaW50UG9zaXRpb24gfSBmcm9tICcuLi8uLi9mb3Jtcy9wdWJsaWMtYXBpJztcblxuaW1wb3J0IHsgVGF4b25vbXlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vYmFja2VuZC9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE9BdXRoU3RvcmFnZSB9IGZyb20gJ2FuZ3VsYXItb2F1dGgyLW9pZGMnO1xuXG5cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0b2NvLXZvY2FidWxhcnktZGlhbG9nJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdm9jYWJ1bGFyeS1kaWFsb2cuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgVm9jYWJ1bGFyeURpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBwdWJsaWMgcGFuZWxzOiBQYW5lbENvbnRlbnRfRGVwcltdO1xuICAgIHB1YmxpYyBmb3JtR3JvdXA6IEZvcm1Hcm91cDtcbiAgICBwdWJsaWMgYWN0aW9uOiBGb3JtQ29udGFpbmVyQWN0aW9uO1xuICAgIHB1YmxpYyBhY3Rpb25MYWJlbCA9ICdBY2VwdGFyJztcbiAgICBwdWJsaWMgaGFzU2VydmljZSA9IGZhbHNlO1xuICAgIHZvY2FiOiBWb2NhYnVsYXJ5O1xuICAgIGFjY2VwdDtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHNlcnZpY2U6IFRheG9ub215U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBfZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgICAgICBwdWJsaWMgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8Rm9ybUNvbnRhaW5lckNvbXBvbmVudD4sXG4gICAgICAgIHB1YmxpYyBfc25hY2tCYXI6IE1hdFNuYWNrQmFyLFxuICAgICAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgcHVibGljIGRhdGE6IGFueSkge1xuXG4gICAgICAgIGlmIChkYXRhLmFjY2VwdCkge1xuICAgICAgICAgICAgdGhpcy5hY2NlcHQgPSBkYXRhLmFjY2VwdDtcbiAgICAgICAgICAgIHRoaXMuaGFzU2VydmljZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnZvY2FiID0gbmV3IFZvY2FidWxhcnkoKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnZvY2FiID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52b2NhYi5pc05ldyA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudm9jYWIuZGVlcGNvcHkoZGF0YS52b2NhYik7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25MYWJlbCA9ICdBY3R1YWxpemFyJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmhhc1NlcnZpY2UpIHtcblxuICAgICAgICAgICAgdGhpcy5mb3JtR3JvdXAgPSB0aGlzLl9mb3JtQnVpbGRlci5ncm91cCh7fSk7XG4gICAgICAgICAgICB0aGlzLnBhbmVscyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnZvY2FiLmlzTmV3ID8gJ051ZXZvIFZvY2FidWxhcmlvJyA6ICdFZGl0YXIgVm9jYWJ1bGFyaW8nLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgICAgICAgICAgIGljb25OYW1lOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybVNlY3Rpb246IHRoaXMuZm9ybUdyb3VwLFxuICAgICAgICAgICAgICAgICAgICBmb3JtU2VjdGlvbkNvbnRlbnQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdJZGVudGlmaWNhZG9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLmlkZW50aWZpZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52b2NhYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SGludDogbmV3IEhpbnRWYWx1ZShIaW50UG9zaXRpb24uc3RhcnQsICdVbiBpZGVudGlmaWNhZG9yIGVzIHVuYSBzZWN1ZW5jaWEgZGUgbGV0cmFzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2h1bWFuX25hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTm9tYnJlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudm9jYWIuaHVtYW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydEhpbnQ6IG5ldyBIaW50VmFsdWUoSGludFBvc2l0aW9uLnN0YXJ0LCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0Rlc2NyaXBjacOzbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogRm9ybUZpZWxkVHlwZS50ZXh0YXJlYSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52b2NhYi5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydEhpbnQ6IG5ldyBIaW50VmFsdWUoSGludFBvc2l0aW9uLnN0YXJ0LCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB0aGlzLmFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICBkb2l0OiAoZGF0YTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvcm1Hcm91cC52YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52b2NhYi5uYW1lID0gdGhpcy5mb3JtR3JvdXAudmFsdWVbJ25hbWUnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudm9jYWIuaHVtYW5fbmFtZSA9IHRoaXMuZm9ybUdyb3VwLnZhbHVlWydodW1hbl9uYW1lJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZvY2FiLmRlc2NyaXB0aW9uID0gdGhpcy5mb3JtR3JvdXAudmFsdWVbJ2Rlc2NyaXB0aW9uJ107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjZXB0KHRoaXMudm9jYWIpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5PSywgJ0VsIGlkZW50aWZpY2Fkb3Igbm8gZXMgdsOhbGlkby4nKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbk5vQ2xpY2soKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgYWNjZXB0QWN0aW9uKCkge1xuXG5cbiAgICB9XG59XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndG9jby12b2NhYnVsYXJpZXMnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi92b2NhYnVsYXJpZXMuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3ZvY2FidWxhcmllcy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFZvY2FidWxhcmllc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIHByaXZhdGUgdm9jYWJ1bGFyaWVzQ2hhbmdlT2JzZXJ2ZXI6IFBhcnRpYWxPYnNlcnZlcjxSZXNwb25zZTxhbnk+PiA9IHtcbiAgICAgICAgbmV4dDogKHJlc3VsdDogUmVzcG9uc2U8YW55PikgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICAgICAgICAgIHRoaXMubG9hZFZvY2FidWxhcmllcygpO1xuICAgICAgICAgICAgY29uc3Qgdm9jID0gbmV3IFZvY2FidWxhcnkoKTtcbiAgICAgICAgICAgIHZvYy5kZWVwY29weShyZXN1bHQuZGF0YS52b2NhYnVsYXJ5KTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Vm9jYWIodm9jKTtcbiAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLk9LLCByZXN1bHQubWVzc2FnZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXJyb3I6IChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yOiAnICsgZXJyICsgJy4nKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvbXBsZXRlLicpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyB2b2NhYkN0cmwgPSBuZXcgRm9ybUNvbnRyb2woKTtcbiAgICBwdWJsaWMgZmlsdGVyZWRWb2NhYnVsYXJpZXM6IE9ic2VydmFibGU8Vm9jYWJ1bGFyeVtdPjtcblxuICAgIEBPdXRwdXQoKVxuICAgIHB1YmxpYyBzZWxlY3RlZFZvY2FiOiBFdmVudEVtaXR0ZXI8Vm9jYWJ1bGFyeT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBwdWJsaWMgY3VycmVudFZvY2FiOiBWb2NhYnVsYXJ5ID0gbnVsbDtcblxuICAgIHB1YmxpYyB2b2NhYnVsYXJpZXM6IFZvY2FidWxhcnlbXSA9IFtdO1xuXG4gICAgbG9hZGluZyA9IGZhbHNlO1xuXG4gICAgQE91dHB1dCgpIGVtaXRlclNob3dUZXJtczogRXZlbnRFbWl0dGVyPFZvY2FidWxhcnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2aWNlOiBUYXhvbm9teVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgb2F1dGhlU3RvcmFnZTogT0F1dGhTdG9yYWdlLFxuICAgICAgICBwdWJsaWMgZGlhbG9nOiBNYXREaWFsb2csXG4gICAgICAgIHByaXZhdGUgX3NuYWNrQmFyOiBNYXRTbmFja0JhcikgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5nZXRBdXRoZW50aWNhdGVkVXNlclBlcm1pc3Npb25zKCk7XG4gICAgICAgIHRoaXMubG9hZFZvY2FidWxhcmllcygpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIH1cblxuICAgIHNlbGVjdFZvY2FiKGl0ZW06IFZvY2FidWxhcnkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50Vm9jYWIgPSBpdGVtO1xuICAgIH1cblxuICAgIGxvYWRWb2NhYnVsYXJpZXMoKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRWb2NhYnVsYXJpZXMoKS5waXBlKFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IE1heWJlIHlvdSBtdXN0IHNldCBhIGJldHRlciByZXR1cm4uXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmaW5hbGl6ZSgoKSA9PiB0aGlzLmxvYWRpbmcgPSBmYWxzZSlcbiAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudm9jYWJ1bGFyaWVzID0gcmVzcG9uc2UuZGF0YS52b2NhYnVsYXJpZXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRWb2NhYnVsYXJpZXMgPSB0aGlzLnZvY2FiQ3RybC52YWx1ZUNoYW5nZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlPHN0cmluZywgVm9jYWJ1bGFyeVtdPihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFdpdGgoJycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZvY2FidWxhcmllcy5maWx0ZXIodm9jYWIgPT4gdm9jYWIubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlLnRvTG93ZXJDYXNlKCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZvY2FidWxhcmllcyA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5ld1ZvY2FiKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm9wZW5Wb2NhYkRpYWxvZyhudWxsKTtcbiAgICB9XG5cbiAgICBlZGl0Vm9jYWIodm9jYWI6IGFueSkge1xuICAgICAgICB0aGlzLm9wZW5Wb2NhYkRpYWxvZyh2b2NhYik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvcGVuVm9jYWJEaWFsb2codm9jYWI6IFZvY2FidWxhcnkpIHtcblxuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFZvY2FidWxhcnlEaWFsb2dDb21wb25lbnQsIHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB2b2NhYjogdm9jYWIsXG4gICAgICAgICAgICAgICAgYWNjZXB0OiAodm9jOiBWb2NhYnVsYXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlQWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2b2MuaXNOZXcpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLm5ld1ZvY2FidWxhcnkodm9jKS5waXBlKCkuc3Vic2NyaWJlKHRoaXMudm9jYWJ1bGFyaWVzQ2hhbmdlT2JzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmVkaXRWb2NhYnVsYXJ5KHZvYykucGlwZSgpLnN1YnNjcmliZSh0aGlzLnZvY2FidWxhcmllc0NoYW5nZU9ic2VydmVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGRpYWxvZ1JlZi5hZnRlckNsb3NlZCgpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RpYWxvZyBjbG9zZWQnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZGVsZXRlVm9jYWIodm9jYWI6IFZvY2FidWxhcnkpIHtcbiAgICB9XG5cbiAgICBvblNlbGVjdGlvbkNoYW5nZSgpe1xuICAgICAgICB0aGlzLnNlbGVjdGVkVm9jYWIuZW1pdCh0aGlzLmN1cnJlbnRWb2NhYik7XG4gICAgfVxuXG4gICAgZ2V0QXV0aGVudGljYXRlZFVzZXJQZXJtaXNzaW9ucygpIHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLmdldEN1cnJlbnRVc2VyUGVybWlzc2lvbnMoKS5waXBlKFxuICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IE1heWJlIHlvdSBtdXN0IHNldCBhIGJldHRlciByZXR1cm4uXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXF1ZXN0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwZXJtSnNvbiA9IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuZGF0YS5wZXJtaXNzaW9ucy5hY3Rpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYXV0aGVTdG9yYWdlLnNldEl0ZW0oJ3VzZXJfcGVybWlzc2lvbnMnLCBwZXJtSnNvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaGFzUGVybWlzc2lvbihwZXJtaXNzaW9uOiBzdHJpbmcsIGlkPzogc3RyaW5nKTogYm9vbGVhbiB7XG5cbiAgICAgICAgY29uc3QgdXNlclBlcm1pc3Npb24gPSBKU09OLnBhcnNlKHRoaXMub2F1dGhlU3RvcmFnZS5nZXRJdGVtKCd1c2VyX3Blcm1pc3Npb25zJykpO1xuICAgICAgICBpZiAoIXVzZXJQZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgICAgICAgIGlmICh1c2VyUGVybWlzc2lvbi50YXhvbm9teV9mdWxsX2VkaXRvcl9hY3Rpb25zID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgY2FzZSAnZWRpdCc6XG4gICAgICAgICAgICAgICAgaWYgKHVzZXJQZXJtaXNzaW9uLnRheG9ub215X2Z1bGxfZWRpdG9yX2FjdGlvbnMgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJQZXJtaXNzaW9uLnZvY2FidWxhcnlfZWRpdG9yX2FjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyOiBBcnJheTxzdHJpbmc+ID0gdXNlclBlcm1pc3Npb24udm9jYWJ1bGFyeV9lZGl0b3JfYWN0aW9ucztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJyLmluY2x1ZGVzKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVzZXJQZXJtaXNzaW9uLnRheG9ub215X2Z1bGxfZWRpdG9yX2FjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==