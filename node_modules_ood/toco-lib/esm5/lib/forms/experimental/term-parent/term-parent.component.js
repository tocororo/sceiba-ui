/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/term-parent/term-parent.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component } from '@angular/core';
import { FormControl } from '@angular/forms';
import { startWith, map } from 'rxjs/operators';
import { InputControl } from '../../input/input.control';
var TermParentComponent = /** @class */ (function (_super) {
    tslib_1.__extends(TermParentComponent, _super);
    function TermParentComponent() {
        var _this = _super.call(this) || this;
        // internalControl = new FormControl();
        _this.formControl = new FormControl();
        _this.selectOptions = [];
        _this.currentTerm = null;
        _this.parentTerm = null;
        return _this;
    }
    /**
     * @return {?}
     */
    TermParentComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.init('', '', false, true);
        // (this.content.parentFormSection as FormGroup).addControl(
        //     this.content.name,
        //     this.internalControl
        //   );
        console.log(this.content.value);
        console.log(this.content.required);
        console.log(this.content.required && (this.content.value == 0 || this.content.value == null || this.content.value == undefined));
        if (this.content.required) {
            this.content.formControl.setValidators((/**
             * @param {?} control
             * @return {?}
             */
            function (control) {
                return (control.value == 0 || control.value == null || control.value == undefined)
                    ? { 'requiredTerms': 'No Terms Selected' }
                    : null;
            }));
        }
        this.setValueToInternalControl();
        this.inputId = this.content.label.trim().toLowerCase();
        if (this.content.extraContent && this.content.extraContent.terms) {
            if (this.content.extraContent.currentTerm) {
                this.currentTerm = this.content.extraContent.currentTerm;
            }
            ((/** @type {?} */ (this.content.extraContent.terms))).forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) {
                _this.selectOptions = _this.selectOptions.concat(_this._get_terms(element));
            }));
            this._updateFilteredOptions();
        }
    };
    /**
     * @private
     * @return {?}
     */
    TermParentComponent.prototype._updateFilteredOptions = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.filteredOptions = this.formControl.valueChanges.pipe(startWith(''), map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var filterValue = value.toLowerCase();
            return _this.selectOptions.filter((/**
             * @param {?} option
             * @return {?}
             */
            function (option) { return option.identifier.toLowerCase().includes(filterValue); }));
        })));
    };
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    TermParentComponent.prototype._get_terms = /**
     * @private
     * @param {?} node
     * @return {?}
     */
    function (node) {
        var _this = this;
        /** @type {?} */
        var result = [];
        if (!this.currentTerm) {
            result.push(node.term);
        }
        else {
            if (this.currentTerm.id !== node.term.id) {
                if (this.currentTerm.parent_id && this.currentTerm.parent_id === node.term.id) {
                    this.parentTerm = node.term;
                }
                else {
                    result.push(node.term);
                }
            }
        }
        node.children.forEach((/**
         * @param {?} child
         * @return {?}
         */
        function (child) {
            result = result.concat(_this._get_terms(child));
        }));
        return result;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    TermParentComponent.prototype.addParent = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.parentTerm = value;
        this.selectOptions = this.selectOptions.filter((/**
         * @param {?} option
         * @return {?}
         */
        function (option) { return option.id !== value.id; }));
        this.formControl.setValue('');
        this._updateFilteredOptions();
        // document.getElementById(this.inputId).blur();
        (this.currentTerm) ? this.currentTerm.parent_id = this.parentTerm.id : this.parentTerm.id;
        this.setValueToInternalControl();
    };
    /**
     * @return {?}
     */
    TermParentComponent.prototype.removeParent = /**
     * @return {?}
     */
    function () {
        this.selectOptions.push(this.parentTerm);
        this._updateFilteredOptions();
        this.parentTerm = null;
        this.setValueToInternalControl();
    };
    /**
     * @private
     * @return {?}
     */
    TermParentComponent.prototype.setValueToInternalControl = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.parentTerm == null) {
            this.content.value = null;
            this.content.formControl.setValue(null);
        }
        else {
            this.content.value = this.parentTerm.id;
            this.content.formControl.setValue(this.content.value);
        }
        if (this.content.formControl.valid) {
            this.formControl.setErrors(null);
        }
        else {
            this.formControl.setErrors({ requiered: true });
        }
    };
    TermParentComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-term-parent',
                    template: "<div class=\"card-filter\" *ngIf=\"content.extraContent\">\n\n  <mat-form-field style=\"width: 100%;\">\n\n      <mat-label> {{content.label}} <span *ngIf=\"content.required\">*</span></mat-label>\n    <input \n        matInput \n        id=\"'inputId-'{{content.name}}\" \n        type=\"text\" \n        [formControl]=\"formControl\"\n        [placeholder]=\"content.label\"\n        [matAutocomplete]=\"auto\" \n        aria-label=\"Number\" \n      />\n    <mat-autocomplete #auto=\"matAutocomplete\">\n      <mat-option *ngFor=\"let option of filteredOptions | async\" [value]=\"option.identifier\" (click)=\"addParent(option)\"\n        [title]=\"option.description\">\n        {{ option.description }}\n      </mat-option>\n    </mat-autocomplete>\n\n  </mat-form-field>\n\n  <mat-chip-list fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"margin-bottom: .5em\" id=\"chiplist\">\n    <mat-chip (click)=\"removeParent()\" *ngIf=\"parentTerm\">{{ parentTerm.description }}</mat-chip>\n  </mat-chip-list>\n\n</div>",
                    host: {
                        '[style.minWidth]': 'content.minWidth',
                        '[style.width]': 'content.width'
                    },
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    TermParentComponent.ctorParameters = function () { return []; };
    return TermParentComponent;
}(InputControl));
export { TermParentComponent };
if (false) {
    /** @type {?} */
    TermParentComponent.prototype.formControl;
    /** @type {?} */
    TermParentComponent.prototype.inputId;
    /** @type {?} */
    TermParentComponent.prototype.filteredOptions;
    /** @type {?} */
    TermParentComponent.prototype.selectOptions;
    /** @type {?} */
    TermParentComponent.prototype.currentTerm;
    /** @type {?} */
    TermParentComponent.prototype.parentTerm;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVybS1wYXJlbnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvZm9ybXMvZXhwZXJpbWVudGFsL3Rlcm0tcGFyZW50L3Rlcm0tcGFyZW50LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBTUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFnRCxNQUFNLGdCQUFnQixDQUFDO0FBRTNGLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJaEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBR3pEO0lBU3lDLCtDQUFZO0lBWWpEO1FBQUEsWUFFSSxpQkFBTyxTQUNWOztRQVZELGlCQUFXLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUdoQyxtQkFBYSxHQUFXLEVBQUUsQ0FBQztRQUMzQixpQkFBVyxHQUFTLElBQUksQ0FBQztRQUN6QixnQkFBVSxHQUFTLElBQUksQ0FBQzs7SUFLeEIsQ0FBQzs7OztJQUVELHNDQUFROzs7SUFBUjtRQUFBLGlCQW9DQztRQWxDQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzdCLDREQUE0RDtRQUM1RCx5QkFBeUI7UUFDekIsMkJBQTJCO1FBQzNCLE9BQU87UUFFUCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRW5DLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUss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OztJQUFqQztRQUNJLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLEVBQUM7WUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQzFCLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMzQzthQUFJO1lBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7WUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDekQ7UUFFRCxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBQztZQUMvQixJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNwQzthQUFJO1lBQ0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsRUFBQyxTQUFTLEVBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQztTQUNoRDtJQUNMLENBQUM7O2dCQWhJSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtvQkFDNUIsNmdDQUEyQztvQkFFM0MsSUFBSSxFQUFFO3dCQUNGLGtCQUFrQixFQUFFLGtCQUFrQjt3QkFDdEMsZUFBZSxFQUFFLGVBQWU7cUJBQ25DOztpQkFDSjs7OztJQXlIRCwwQkFBQztDQUFBLEFBaklELENBU3lDLFlBQVksR0F3SHBEO1NBeEhZLG1CQUFtQjs7O0lBSzVCLDBDQUFnQzs7SUFDaEMsc0NBQWdCOztJQUNoQiw4Q0FBb0M7O0lBQ3BDLDRDQUEyQjs7SUFDM0IsMENBQXlCOztJQUN6Qix5Q0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogICBDb3B5cmlnaHQgKGMpIDIwMjAgVW5pdmVyc2lkYWQgZGUgUGluYXIgZGVsIFLDrW8gXCJIZXJtYW5vcyBTYcOteiBNb250ZXMgZGUgT2NhXCJcbiAqICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgQWJzdHJhY3RDb250cm9sLCBWYWxpZGF0aW9uRXJyb3JzLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzdGFydFdpdGgsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuXG5pbXBvcnQgeyBGb3JtRmllbGRDb250cm9sX0V4cGVyaW1lbnRhbCB9IGZyb20gJy4uL2Zvcm0tZmllbGQuY29udHJvbC5leHBlcmltZW50YWwnO1xuaW1wb3J0IHsgSW5wdXRDb250cm9sIH0gZnJvbSAnLi4vLi4vaW5wdXQvaW5wdXQuY29udHJvbCc7XG5pbXBvcnQgeyBUZXJtLCBUZXJtTm9kZSB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL3B1YmxpYy1hcGknO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RvY28tdGVybS1wYXJlbnQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi90ZXJtLXBhcmVudC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vdGVybS1wYXJlbnQuY29tcG9uZW50LnNjc3MnXSxcbiAgICBob3N0OiB7XG4gICAgICAgICdbc3R5bGUubWluV2lkdGhdJzogJ2NvbnRlbnQubWluV2lkdGgnLFxuICAgICAgICAnW3N0eWxlLndpZHRoXSc6ICdjb250ZW50LndpZHRoJ1xuICAgIH1cbn0pXG5leHBvcnQgY2xhc3MgVGVybVBhcmVudENvbXBvbmVudCBleHRlbmRzIElucHV0Q29udHJvbCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICAvLyBpbnRlcm5hbENvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuXG4gICAgZm9ybUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcbiAgICBpbnB1dElkOiBzdHJpbmc7XG4gICAgZmlsdGVyZWRPcHRpb25zOiBPYnNlcnZhYmxlPFRlcm1bXT47XG4gICAgc2VsZWN0T3B0aW9uczogVGVybVtdID0gW107XG4gICAgY3VycmVudFRlcm06IFRlcm0gPSBudWxsO1xuICAgIHBhcmVudFRlcm06IFRlcm0gPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IoKVxuICAgIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcblxuICAgICAgdGhpcy5pbml0KCcnLCAnJywgZmFsc2UsIHRydWUpO1xuICAgICAgICAvLyAodGhpcy5jb250ZW50LnBhcmVudEZvcm1TZWN0aW9uIGFzIEZvcm1Hcm91cCkuYWRkQ29udHJvbChcbiAgICAgICAgLy8gICAgIHRoaXMuY29udGVudC5uYW1lLFxuICAgICAgICAvLyAgICAgdGhpcy5pbnRlcm5hbENvbnRyb2xcbiAgICAgICAgLy8gICApO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY29udGVudC52YWx1ZSlcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5jb250ZW50LnJlcXVpcmVkKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmNvbnRlbnQucmVxdWlyZWQgJiYgKHRoaXMuY29udGVudC52YWx1ZSA9PSAwIHx8IHRoaXMuY29udGVudC52YWx1ZSA9PSBudWxsIHx8IHRoaXMuY29udGVudC52YWx1ZSA9PSB1bmRlZmluZWQpKTtcblxuICAgICAgICBpZiAodGhpcy5jb250ZW50LnJlcXVpcmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsaWRhdG9ycygoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiAoY29udHJvbC52YWx1ZSA9PSAwIHx8IGNvbnRyb2wudmFsdWUgPT0gbnVsbCB8fCBjb250cm9sLnZhbHVlID09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgPyB7ICdyZXF1aXJlZFRlcm1zJzogJ05vIFRlcm1zIFNlbGVjdGVkJyB9XG4gICAgICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0VmFsdWVUb0ludGVybmFsQ29udHJvbCgpO1xuXG5cbiAgICAgICAgdGhpcy5pbnB1dElkID0gdGhpcy5jb250ZW50LmxhYmVsLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAodGhpcy5jb250ZW50LmV4dHJhQ29udGVudCAmJiB0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50LnRlcm1zKSB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50LmN1cnJlbnRUZXJtKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGVybSA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQuY3VycmVudFRlcm07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICh0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50LnRlcm1zIGFzIFRlcm1Ob2RlW10pLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RPcHRpb25zID0gdGhpcy5zZWxlY3RPcHRpb25zLmNvbmNhdCh0aGlzLl9nZXRfdGVybXMoZWxlbWVudCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUZpbHRlcmVkT3B0aW9ucygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfdXBkYXRlRmlsdGVyZWRPcHRpb25zKCkge1xuICAgICAgICB0aGlzLmZpbHRlcmVkT3B0aW9ucyA9IHRoaXMuZm9ybUNvbnRyb2wudmFsdWVDaGFuZ2VzLnBpcGU8c3RyaW5nLCBUZXJtW10+KFxuICAgICAgICAgICAgc3RhcnRXaXRoKCcnKSxcbiAgICAgICAgICAgIG1hcCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyVmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdE9wdGlvbnMuZmlsdGVyKG9wdGlvbiA9PiBvcHRpb24uaWRlbnRpZmllci50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlclZhbHVlKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZ2V0X3Rlcm1zKG5vZGU6IFRlcm1Ob2RlKTogVGVybVtdIHtcbiAgICAgICAgbGV0IHJlc3VsdDogVGVybVtdID0gW107XG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50VGVybSkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9kZS50ZXJtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRUZXJtLmlkICE9PSBub2RlLnRlcm0uaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50VGVybS5wYXJlbnRfaWQgJiYgdGhpcy5jdXJyZW50VGVybS5wYXJlbnRfaWQgPT09IG5vZGUudGVybS5pZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFRlcm0gPSBub2RlLnRlcm07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9kZS50ZXJtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4ge1xuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdCh0aGlzLl9nZXRfdGVybXMoY2hpbGQpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBhZGRQYXJlbnQodmFsdWU6IFRlcm0pIHtcblxuICAgICAgICB0aGlzLnBhcmVudFRlcm0gPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5zZWxlY3RPcHRpb25zID0gdGhpcy5zZWxlY3RPcHRpb25zLmZpbHRlcihvcHRpb24gPT4gb3B0aW9uLmlkICE9PSB2YWx1ZS5pZCk7XG5cbiAgICAgICAgdGhpcy5mb3JtQ29udHJvbC5zZXRWYWx1ZSgnJyk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUZpbHRlcmVkT3B0aW9ucygpO1xuICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlucHV0SWQpLmJsdXIoKTtcblxuICAgICAgICAodGhpcy5jdXJyZW50VGVybSkgPyB0aGlzLmN1cnJlbnRUZXJtLnBhcmVudF9pZCA9IHRoaXMucGFyZW50VGVybS5pZCA6IHRoaXMucGFyZW50VGVybS5pZDtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZVRvSW50ZXJuYWxDb250cm9sKCk7XG4gICAgfVxuXG4gICAgcmVtb3ZlUGFyZW50KCkge1xuICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnMucHVzaCh0aGlzLnBhcmVudFRlcm0pO1xuICAgICAgICB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgICAgICAgdGhpcy5wYXJlbnRUZXJtID0gbnVsbDtcbiAgICAgICAgdGhpcy5zZXRWYWx1ZVRvSW50ZXJuYWxDb250cm9sKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRWYWx1ZVRvSW50ZXJuYWxDb250cm9sKCl7XG4gICAgICAgIGlmKCB0aGlzLnBhcmVudFRlcm0gPT0gbnVsbCl7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQudmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sLnNldFZhbHVlKG51bGwpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC52YWx1ZSA9IHRoaXMucGFyZW50VGVybS5pZDtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRlbnQudmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY29udGVudC5mb3JtQ29udHJvbC52YWxpZCl7XG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sLnNldEVycm9ycyhudWxsKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sLnNldEVycm9ycyh7cmVxdWllcmVkOnRydWV9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==