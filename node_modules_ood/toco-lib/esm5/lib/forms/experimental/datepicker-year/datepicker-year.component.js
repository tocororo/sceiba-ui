/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/datepicker-year/datepicker-year.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { InputControl } from '../../input/input.control';
import { Component, Input, forwardRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DateAdapter, MAT_DATE_FORMATS, MAT_DATE_LOCALE, MatDatepicker } from '@angular/material';
import { MomentDateAdapter } from '@angular/material-moment-adapter';
import moment from 'moment';
// const moment = _rollupMoment || _moment;
/** @type {?} */
export var YEAR_MODE_FORMATS = {
    parse: {
        dateInput: 'YYYY',
    },
    display: {
        dateInput: 'YYYY',
        monthYearLabel: 'MMM YYYY',
        dateA11yLabel: 'LL',
        monthYearA11yLabel: 'MMMM YYYY',
    },
};
var DatepickerYearComponent = /** @class */ (function (_super) {
    tslib_1.__extends(DatepickerYearComponent, _super);
    function DatepickerYearComponent() {
        var _this = _super.call(this) || this;
        /**
         * Component label
         */
        _this.label = '';
        _this.touchUi = false;
        // _inputCtrl: FormControl = new FormControl();
        // Function to call when the date changes.
        _this.onChange = (/**
         * @param {?} year
         * @return {?}
         */
        function (year) { });
        // Function to call when the input is touched (when a star is clicked).
        _this.onTouched = (/**
         * @return {?}
         */
        function () { });
        return _this;
    }
    Object.defineProperty(DatepickerYearComponent.prototype, "max", {
        get: /**
         * @return {?}
         */
        function () {
            return this._max ? this._max.year() : undefined;
        },
        set: /**
         * @param {?} max
         * @return {?}
         */
        function (max) {
            if (max) {
                /** @type {?} */
                var momentDate = typeof max === 'number' ? moment([max, 0, 1]) : moment(max);
                this._max = momentDate.isValid() ? momentDate : undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatepickerYearComponent.prototype, "min", {
        get: /**
         * @return {?}
         */
        function () {
            return this._min ? this._min.year() : undefined;
        },
        set: /**
         * @param {?} min
         * @return {?}
         */
        function (min) {
            if (min) {
                /** @type {?} */
                var momentDate = typeof min === 'number' ? moment([min, 0, 1]) : moment(min);
                this._min = momentDate.isValid() ? momentDate : undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatepickerYearComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.init('', '', false, true);
        // this.value = moment(this.value.toString()).format("YYYY")
        if (this.label == '') {
            this.label = this.content.label;
        }
        this.min = this.content.extraContent.minYear;
        this.max = this.content.extraContent.maxYear;
        console.log(this.content.extraContent, 'DATEPICKER YEAR EXTRA CONTENT....', this._min, this._max);
        this.writeValue(new Date(this.content.value));
    };
    /**
     * @param {?} date
     * @return {?}
     */
    DatepickerYearComponent.prototype.writeValue = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        if (date && this._isYearEnabled(date.getFullYear())) {
            /** @type {?} */
            var momentDate = moment(date);
            if (momentDate.isValid()) {
                this.content.formControl.setValue(moment(date), { emitEvent: false });
                this.content.value = moment(date).year;
                // this.content.formControl.setValue(this.content.value);
            }
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    DatepickerYearComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    DatepickerYearComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    // Allows Angular to disable the input.
    // Allows Angular to disable the input.
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    DatepickerYearComponent.prototype.setDisabledState = 
    // Allows Angular to disable the input.
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        isDisabled ? this._picker.disabled = true : this._picker.disabled = false;
        isDisabled ? this.content.formControl.disable() : this.content.formControl.enable();
    };
    /**
     * @param {?} chosenDate
     * @param {?} datepicker
     * @return {?}
     */
    DatepickerYearComponent.prototype._yearSelectedHandler = /**
     * @param {?} chosenDate
     * @param {?} datepicker
     * @return {?}
     */
    function (chosenDate, datepicker) {
        if (!this._isYearEnabled(chosenDate.year())) {
            datepicker.close();
            return;
        }
        this.content.formControl.setValue(chosenDate, { emitEvent: false });
        this.content.value = chosenDate.year;
        // this.content.formControl.setValue(this.content.value);
        this.onChange(chosenDate.toDate());
        this.onTouched();
        datepicker.close();
    };
    /**
     * @param {?} datepicker
     * @return {?}
     */
    DatepickerYearComponent.prototype._openDatepickerOnClick = /**
     * @param {?} datepicker
     * @return {?}
     */
    function (datepicker) {
        if (!datepicker.opened) {
            datepicker.open();
        }
    };
    /**
     * @param {?} datepicker
     * @return {?}
     */
    DatepickerYearComponent.prototype._openDatepickerOnFocus = /**
     * @param {?} datepicker
     * @return {?}
     */
    function (datepicker) {
        setTimeout((/**
         * @return {?}
         */
        function () {
            if (!datepicker.opened) {
                datepicker.open();
            }
        }));
    };
    /** Whether the given year is enabled. */
    /**
     * Whether the given year is enabled.
     * @private
     * @param {?} year
     * @return {?}
     */
    DatepickerYearComponent.prototype._isYearEnabled = /**
     * Whether the given year is enabled.
     * @private
     * @param {?} year
     * @return {?}
     */
    function (year) {
        // disable if the year is greater than maxDate lower than minDate
        if (year === undefined || year === null ||
            (this._max && year > this._max.year()) ||
            (this._min && year < this._min.year())) {
            return false;
        }
        return true;
    };
    DatepickerYearComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-datepicker-year',
                    template: "<mat-form-field style=\"width: 100%\">\n  <!-- <mat-label>{{ label }}</mat-label> -->\n  <input\n    matInput\n    [matDatepicker]=\"datepicker\"\n    [max]=\"_max\"\n    [min]=\"_min\"\n    [formControl]=\"content.formControl\"\n    (click)=\"_openDatepickerOnClick(datepicker)\"\n    (focus)=\"_openDatepickerOnFocus(datepicker)\"\n    readonly\n    placeholder=\"{{ content.label }}\"\n    required=\"{{ content.required }}\"\n  />\n\n  <mat-datepicker\n    #datepicker\n    [touchUi]=\"touchUi\"\n    startView=\"multi-year\"\n    (yearSelected)=\"_yearSelectedHandler($event, datepicker)\"\n    panelClass=\"year-picker\"\n  >\n  </mat-datepicker>\n</mat-form-field>\n",
                    providers: [
                        { provide: DateAdapter, useClass: MomentDateAdapter, deps: [MAT_DATE_LOCALE] },
                        { provide: MAT_DATE_FORMATS, useValue: YEAR_MODE_FORMATS },
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return DatepickerYearComponent; })),
                            multi: true,
                        },
                    ],
                    host: {
                        "[style.minWidth]": "content.minWidth",
                        "[style.width]": "content.width",
                    },
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    DatepickerYearComponent.ctorParameters = function () { return []; };
    DatepickerYearComponent.propDecorators = {
        label: [{ type: Input }],
        max: [{ type: Input }],
        min: [{ type: Input }],
        touchUi: [{ type: Input }],
        _picker: [{ type: ViewChild, args: [MatDatepicker, { static: true },] }]
    };
    return DatepickerYearComponent;
}(InputControl));
export { DatepickerYearComponent };
if (false) {
    /**
     * Component label
     * @type {?}
     */
    DatepickerYearComponent.prototype.label;
    /** @type {?} */
    DatepickerYearComponent.prototype._max;
    /** @type {?} */
    DatepickerYearComponent.prototype._min;
    /** @type {?} */
    DatepickerYearComponent.prototype.touchUi;
    /** @type {?} */
    DatepickerYearComponent.prototype._picker;
    /** @type {?} */
    DatepickerYearComponent.prototype.onChange;
    /** @type {?} */
    DatepickerYearComponent.prototype.onTouched;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci15ZWFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2Zvcm1zL2V4cGVyaW1lbnRhbC9kYXRlcGlja2VyLXllYXIvZGF0ZXBpY2tlci15ZWFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFekQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBNkIsTUFBTSxlQUFlLENBQUM7QUFDbkcsT0FBTyxFQUFlLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRXJFLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQzs7O0FBSzVCLE1BQU0sS0FBTyxpQkFBaUIsR0FBRztJQUMvQixLQUFLLEVBQUU7UUFDTCxTQUFTLEVBQUUsTUFBTTtLQUNsQjtJQUNELE9BQU8sRUFBRTtRQUNQLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLGNBQWMsRUFBRSxVQUFVO1FBQzFCLGFBQWEsRUFBRSxJQUFJO1FBQ25CLGtCQUFrQixFQUFFLFdBQVc7S0FDaEM7Q0FDRjtBQUVEO0lBa0I4QyxtREFBWTtJQXFEdkQ7UUFBQSxZQUFnQixpQkFBTyxTQUFHOzs7O1FBbERsQixXQUFLLEdBQUcsRUFBRSxDQUFDO1FBd0JYLGFBQU8sR0FBRyxLQUFLLENBQUM7OztRQU96QixjQUFROzs7O1FBQUcsVUFBQyxJQUFVLElBQU8sQ0FBQyxFQUFDOztRQUcvQixlQUFTOzs7UUFBRyxjQUFRLENBQUMsRUFBQzs7SUFnQkksQ0FBQztJQS9DM0Isc0JBQWEsd0NBQUc7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NEJBQ3RELEtBQUssRUFBRSxJQUFJO3lCQUNaO3FCQUNGO29CQUNELElBQUksRUFBRTt3QkFDSixrQkFBa0IsRUFBRSxrQkFBa0I7d0JBQ3RDLGVBQWUsRUFBRSxlQUFlO3FCQUNqQzs7aUJBQ0Y7Ozs7O3dCQUlFLEtBQUs7c0JBR0wsS0FBSztzQkFXTCxLQUFLOzBCQVVMLEtBQUs7MEJBRUwsU0FBUyxTQUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7O0lBMkY1Qyw4QkFBQztDQUFBLEFBMUlELENBa0I4QyxZQUFZLEdBd0h6RDtTQXhIWSx1QkFBdUI7Ozs7OztJQUdsQyx3Q0FBb0I7O0lBRXBCLHVDQUFhOztJQVdiLHVDQUFhOztJQVdiLDBDQUF5Qjs7SUFFekIsMENBQTJFOztJQUszRSwyQ0FBK0I7O0lBRy9CLDRDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0Q29udHJvbCB9IGZyb20gJy4uLy4uL2lucHV0L2lucHV0LmNvbnRyb2wnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBmb3J3YXJkUmVmLCBWaWV3Q2hpbGQsIFZpZXdFbmNhcHN1bGF0aW9uLCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBEYXRlQWRhcHRlciwgTUFUX0RBVEVfRk9STUFUUywgTUFUX0RBVEVfTE9DQUxFLCBNYXREYXRlcGlja2VyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgTW9tZW50RGF0ZUFkYXB0ZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC1tb21lbnQtYWRhcHRlcic7XG5cbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IGRlZmF1bHRGb3JtYXQgYXMgX3JvbGx1cE1vbWVudCwgTW9tZW50IH0gZnJvbSAnbW9tZW50Jztcbi8vIGNvbnN0IG1vbWVudCA9IF9yb2xsdXBNb21lbnQgfHwgX21vbWVudDtcblxuXG5leHBvcnQgY29uc3QgWUVBUl9NT0RFX0ZPUk1BVFMgPSB7XG4gIHBhcnNlOiB7XG4gICAgZGF0ZUlucHV0OiAnWVlZWScsXG4gIH0sXG4gIGRpc3BsYXk6IHtcbiAgICBkYXRlSW5wdXQ6ICdZWVlZJyxcbiAgICBtb250aFllYXJMYWJlbDogJ01NTSBZWVlZJyxcbiAgICBkYXRlQTExeUxhYmVsOiAnTEwnLFxuICAgIG1vbnRoWWVhckExMXlMYWJlbDogJ01NTU0gWVlZWScsXG4gIH0sXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0b2NvLWRhdGVwaWNrZXIteWVhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlcGlja2VyLXllYXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kYXRlcGlja2VyLXllYXIuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgeyBwcm92aWRlOiBEYXRlQWRhcHRlciwgdXNlQ2xhc3M6IE1vbWVudERhdGVBZGFwdGVyLCBkZXBzOiBbTUFUX0RBVEVfTE9DQUxFXSB9LFxuICAgIHsgcHJvdmlkZTogTUFUX0RBVEVfRk9STUFUUywgdXNlVmFsdWU6IFlFQVJfTU9ERV9GT1JNQVRTIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBEYXRlcGlja2VyWWVhckNvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZSxcbiAgICB9LFxuICBdLFxuICBob3N0OiB7XG4gICAgXCJbc3R5bGUubWluV2lkdGhdXCI6IFwiY29udGVudC5taW5XaWR0aFwiLFxuICAgIFwiW3N0eWxlLndpZHRoXVwiOiBcImNvbnRlbnQud2lkdGhcIixcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgRGF0ZXBpY2tlclllYXJDb21wb25lbnQgIGV4dGVuZHMgSW5wdXRDb250cm9sIGltcGxlbWVudHMgT25Jbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG5cbiAgLyoqIENvbXBvbmVudCBsYWJlbCAqL1xuICBASW5wdXQoKSBsYWJlbCA9ICcnO1xuXG4gIF9tYXg6IE1vbWVudDtcbiAgQElucHV0KCkgZ2V0IG1heCgpOiBudW1iZXIgfCBEYXRlIHtcbiAgICByZXR1cm4gdGhpcy5fbWF4ID8gdGhpcy5fbWF4LnllYXIoKSA6IHVuZGVmaW5lZDtcbiAgfVxuICBzZXQgbWF4KG1heDogbnVtYmVyIHwgRGF0ZSkge1xuICAgIGlmIChtYXgpIHtcbiAgICAgIGNvbnN0IG1vbWVudERhdGUgPSB0eXBlb2YgbWF4ID09PSAnbnVtYmVyJyA/IG1vbWVudChbbWF4LCAwLCAxXSkgOiBtb21lbnQobWF4KTtcbiAgICAgIHRoaXMuX21heCA9IG1vbWVudERhdGUuaXNWYWxpZCgpID8gbW9tZW50RGF0ZSA6IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBfbWluOiBNb21lbnQ7XG4gIEBJbnB1dCgpIGdldCBtaW4oKTogbnVtYmVyIHwgRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX21pbiA/IHRoaXMuX21pbi55ZWFyKCkgOiB1bmRlZmluZWQ7XG4gIH1cbiAgc2V0IG1pbihtaW46IG51bWJlciB8IERhdGUpIHtcbiAgICBpZiAobWluKSB7XG4gICAgICBjb25zdCBtb21lbnREYXRlID0gdHlwZW9mIG1pbiA9PT0gJ251bWJlcicgPyBtb21lbnQoW21pbiwgMCwgMV0pIDogbW9tZW50KG1pbik7XG4gICAgICB0aGlzLl9taW4gPSBtb21lbnREYXRlLmlzVmFsaWQoKSA/IG1vbWVudERhdGUgOiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgdG91Y2hVaSA9IGZhbHNlO1xuXG4gIEBWaWV3Q2hpbGQoTWF0RGF0ZXBpY2tlciwgeyBzdGF0aWM6IHRydWUgfSkgX3BpY2tlcjogTWF0RGF0ZXBpY2tlcjxNb21lbnQ+O1xuXG4gIC8vIF9pbnB1dEN0cmw6IEZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKCk7XG5cbiAgLy8gRnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSBkYXRlIGNoYW5nZXMuXG4gIG9uQ2hhbmdlID0gKHllYXI6IERhdGUpID0+IHsgfTtcblxuICAvLyBGdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGlucHV0IGlzIHRvdWNoZWQgKHdoZW4gYSBzdGFyIGlzIGNsaWNrZWQpLlxuICBvblRvdWNoZWQgPSAoKSA9PiB7IH07XG5cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmluaXQoJycsICcnLCBmYWxzZSwgdHJ1ZSk7XG4gICAgLy8gdGhpcy52YWx1ZSA9IG1vbWVudCh0aGlzLnZhbHVlLnRvU3RyaW5nKCkpLmZvcm1hdChcIllZWVlcIilcbiAgICBpZiAodGhpcy5sYWJlbCA9PSAnJykge1xuICAgICAgdGhpcy5sYWJlbCA9IHRoaXMuY29udGVudC5sYWJlbDtcbiAgICB9XG5cbiAgICB0aGlzLm1pbiA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQubWluWWVhcjtcbiAgICB0aGlzLm1heCA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQubWF4WWVhcjtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50LCAnREFURVBJQ0tFUiBZRUFSIEVYVFJBIENPTlRFTlQuLi4uJywgdGhpcy5fbWluLCB0aGlzLl9tYXgpXG5cbiAgICB0aGlzLndyaXRlVmFsdWUobmV3IERhdGUodGhpcy5jb250ZW50LnZhbHVlKSk7XG4gICB9XG4gICBjb25zdHJ1Y3RvcigpIHsgc3VwZXIoKTsgfVxuXG5cbiAgd3JpdGVWYWx1ZShkYXRlOiBEYXRlKTogdm9pZCB7XG4gICAgaWYgKGRhdGUgJiYgdGhpcy5faXNZZWFyRW5hYmxlZChkYXRlLmdldEZ1bGxZZWFyKCkpKSB7XG4gICAgICBjb25zdCBtb21lbnREYXRlID0gbW9tZW50KGRhdGUpO1xuICAgICAgaWYgKG1vbWVudERhdGUuaXNWYWxpZCgpKSB7XG4gICAgICAgIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZShtb21lbnQoZGF0ZSksIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gbW9tZW50KGRhdGUpLnllYXI7XG4gICAgICAgIC8vIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRlbnQudmFsdWUpO1xuXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIC8vIEFsbG93cyBBbmd1bGFyIHRvIGRpc2FibGUgdGhlIGlucHV0LlxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpc0Rpc2FibGVkID8gdGhpcy5fcGlja2VyLmRpc2FibGVkID0gdHJ1ZSA6IHRoaXMuX3BpY2tlci5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgaXNEaXNhYmxlZCA/IHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5kaXNhYmxlKCkgOiB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuZW5hYmxlKCk7XG4gIH1cblxuICBfeWVhclNlbGVjdGVkSGFuZGxlcihjaG9zZW5EYXRlOiBNb21lbnQsIGRhdGVwaWNrZXI6IE1hdERhdGVwaWNrZXI8TW9tZW50Pikge1xuICAgIGlmICghdGhpcy5faXNZZWFyRW5hYmxlZChjaG9zZW5EYXRlLnllYXIoKSkpIHtcbiAgICAgIGRhdGVwaWNrZXIuY2xvc2UoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUoY2hvc2VuRGF0ZSwgeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgIHRoaXMuY29udGVudC52YWx1ZSA9IGNob3NlbkRhdGUueWVhcjtcbiAgICAvLyB0aGlzLmNvbnRlbnQuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5jb250ZW50LnZhbHVlKTtcbiAgICB0aGlzLm9uQ2hhbmdlKGNob3NlbkRhdGUudG9EYXRlKCkpO1xuICAgIHRoaXMub25Ub3VjaGVkKCk7XG4gICAgZGF0ZXBpY2tlci5jbG9zZSgpO1xuICB9XG5cbiAgX29wZW5EYXRlcGlja2VyT25DbGljayhkYXRlcGlja2VyOiBNYXREYXRlcGlja2VyPE1vbWVudD4pIHtcbiAgICBpZiAoIWRhdGVwaWNrZXIub3BlbmVkKSB7XG4gICAgICBkYXRlcGlja2VyLm9wZW4oKTtcbiAgICB9XG4gIH1cblxuICBfb3BlbkRhdGVwaWNrZXJPbkZvY3VzKGRhdGVwaWNrZXI6IE1hdERhdGVwaWNrZXI8TW9tZW50Pikge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFkYXRlcGlja2VyLm9wZW5lZCkge1xuICAgICAgICBkYXRlcGlja2VyLm9wZW4oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBXaGV0aGVyIHRoZSBnaXZlbiB5ZWFyIGlzIGVuYWJsZWQuICovXG4gIHByaXZhdGUgX2lzWWVhckVuYWJsZWQoeWVhcjogbnVtYmVyKSB7XG4gICAgLy8gZGlzYWJsZSBpZiB0aGUgeWVhciBpcyBncmVhdGVyIHRoYW4gbWF4RGF0ZSBsb3dlciB0aGFuIG1pbkRhdGVcbiAgICBpZiAoeWVhciA9PT0gdW5kZWZpbmVkIHx8IHllYXIgPT09IG51bGwgfHxcbiAgICAgICh0aGlzLl9tYXggJiYgeWVhciA+IHRoaXMuX21heC55ZWFyKCkpIHx8XG4gICAgICAodGhpcy5fbWluICYmIHllYXIgPCB0aGlzLl9taW4ueWVhcigpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG4iXX0=