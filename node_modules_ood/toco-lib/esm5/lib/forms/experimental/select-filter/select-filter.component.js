/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/experimental/select-filter/select-filter.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component } from "@angular/core";
import { FormControl } from "@angular/forms";
import { map, startWith } from "rxjs/operators";
import { isArray } from "util";
import { InputControl } from '../../input/input.control';
/**
 * @record
 */
function SelectFilterComponentExtraContent() { }
if (false) {
    /** @type {?} */
    SelectFilterComponentExtraContent.prototype.multiple;
    /** @type {?} */
    SelectFilterComponentExtraContent.prototype.selectedTermsIds;
    /** @type {?} */
    SelectFilterComponentExtraContent.prototype.excludeTermsIds;
}
var SelectFilterComponent = /** @class */ (function (_super) {
    tslib_1.__extends(SelectFilterComponent, _super);
    function SelectFilterComponent() {
        var _this = _super.call(this) || this;
        //   internalControl = new FormControl();
        // internalControl = new FormControl();
        //this control is used by the chips,not necessary to expose it
        _this.chipsFormControl = new FormControl();
        _this.chipsList = [];
        _this.selectOptions = [];
        _this.terms = [];
        _this.loading = true;
        // selectedTermsIds = [];
        _this.searchText = "Seleccione las opciones";
        return _this;
    }
    /**
     * @return {?}
     */
    SelectFilterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.init('', '', false, true);
        // (this.content.parentFormSection as FormGroup).addControl(
        //   this.content.name,
        //   this.internalControl
        // );
        if (this.content.required) {
            this.content.formControl.setValidators((/**
             * @param {?} control
             * @return {?}
             */
            function (control) {
                return !_this.content.value || _this.content.value.length == 0
                    ? { requiredTerms: "No Terms Selected" }
                    : null;
            }));
        }
        this.inputId = this.content.label.trim().toLowerCase();
        if (this.content.extraContent) {
            this.extraContent = this.content.extraContent;
            // if (this.extraContent.multiple !== null) {
            //   this.multiple = this.extraContent.multiple;
            // }
            // if (this.extraContent.selectedTermsIds) {
            //   this.content.value = this.extraContent.selectedTermsIds;
            // } else {
            //   this.content.value = [];
            // }
            // already selected terms
            if (!this.extraContent.selectedTermsIds) {
                this.extraContent.selectedTermsIds = [];
            }
            // terms ids to exclude of the possible options.
            if (!this.extraContent.excludeTermsIds) {
                this.extraContent.excludeTermsIds = [];
            }
            this.content.value = [];
            if (this.content.extraContent.observable) {
                this.content.extraContent.observable.subscribe((
                // next
                // next
                /**
                 * @param {?} response
                 * @return {?}
                 */
                function (response) {
                    _this.selectOptions = _this.content.extraContent.getOptions(response);
                    _this.selectOptionsLoaded();
                }), (
                // error
                // error
                /**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    console.log(error);
                }), (
                // complete
                // complete
                /**
                 * @return {?}
                 */
                function () { }));
            }
            else {
                this.selectOptions = this.content.extraContent.getOptions();
                this.selectOptionsLoaded();
            }
            //   else if(this.extraContent.termID){
            //     this.service.getTermByUUID(this.extraContent.termID, this.extraContent.level)
            //     .subscribe(this.termsTreeObserver);
            // }
            // this._updateFilteredOptions();
        }
    };
    /**
     * @private
     * @return {?}
     */
    SelectFilterComponent.prototype.selectOptionsLoaded = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.selectOptions.forEach((/**
         * @param {?} option
         * @return {?}
         */
        function (option) {
            if (((/** @type {?} */ (_this.extraContent.selectedTermsIds))).some((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val === option.value; }))) {
                _this.addChips(option);
            }
            // if (this.extraContent.multiple) {
            //   try {
            //     const index = this.content.value.indexOf(option.value);
            //     if (index >= 0) {
            //       this.addChips(option);
            //     }
            //   } catch (error) {}
            // } else {
            //   if (option.value == this.content.value) {
            //     this.addChips(option);
            //   }
            // }
        }));
        if (this.extraContent.multiple &&
            (this.content.value == null ||
                this.content.value == undefined ||
                !isArray(this.content.value))) {
            this.content.value = [];
        }
        this._updateFilteredOptions();
        this.loading = false;
    };
    /**
     * @private
     * @return {?}
     */
    SelectFilterComponent.prototype.setValidation = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.content.formControl.valid) {
            this.chipsFormControl.setErrors(null);
        }
        else {
            this.chipsFormControl.setErrors({ requiered: true });
        }
    };
    /**
     * @private
     * @param {?} term
     * @return {?}
     */
    SelectFilterComponent.prototype.addTermToValue = /**
     * @private
     * @param {?} term
     * @return {?}
     */
    function (term) {
        if (this.extraContent.multiple) {
            this.content.value.unshift(term);
        }
        else {
            this.content.value = [term];
        }
        this.content.formControl.setValue(this.content.value);
        this.setValidation();
    };
    /**
     * @private
     * @param {?} term
     * @return {?}
     */
    SelectFilterComponent.prototype.removeTermFromValue = /**
     * @private
     * @param {?} term
     * @return {?}
     */
    function (term) {
        this.content.value = ((/** @type {?} */ (this.content.value))).filter((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.value !== term.value; }));
        this.content.formControl.setValue(this.content.value);
        this.setValidation();
    };
    /**
     * @private
     * @return {?}
     */
    SelectFilterComponent.prototype._updateFilteredOptions = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.filteredOptions = this.chipsFormControl.valueChanges.pipe(startWith(""), map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var filterValue = value ? value.toLowerCase() : "";
            console.log('************************************');
            console.log(_this.selectOptions);
            console.log('************************************');
            return _this.selectOptions.filter((/**
             * @param {?} option
             * @return {?}
             */
            function (option) {
                return option.label.toLowerCase().includes(filterValue);
            }));
        })));
    };
    /**
     * @param {?} value
     * @return {?}
     */
    SelectFilterComponent.prototype.addChips = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (this.extraContent.multiple) {
            this.chipsList.unshift(value);
        }
        else {
            // if not is multiple, then the element in the chipsList goes back to the options
            if (this.chipsList.length > 0) {
                this.selectOptions.push(this.chipsList[0]);
            }
            this.chipsList = [value];
        }
        this.addTermToValue(value);
        // console.log(this.selectOptions);
        this.selectOptions = this.selectOptions.filter((/**
         * @param {?} option
         * @return {?}
         */
        function (option) { return option.value !== value.value; }));
        // console.log(this.selectOptions);
        this.chipsFormControl.setValue("");
        // document.getElementById(this.inputId).blur();
        this._updateFilteredOptions();
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SelectFilterComponent.prototype.removeChip = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        // console.log(this.selectOptions);
        this.selectOptions.push(this.chipsList[index]);
        // console.log(this.selectOptions);
        this.removeTermFromValue(this.chipsList[index]);
        this.chipsList.splice(index, 1);
        this._updateFilteredOptions();
    };
    SelectFilterComponent.decorators = [
        { type: Component, args: [{
                    selector: "toco-select-filter",
                    template: "\n<mat-card>\n\n  <mat-progress-bar\n    mode=\"indeterminate\"\n    *ngIf=\"!selectOptions\">\n  </mat-progress-bar>\n\n  <mat-card-subtitle *ngIf=\"selectOptions\">\n    <mat-form-field style=\"width: 100%;\">\n\n      <mat-label> {{content.label}} <span *ngIf=\"content.required\">*</span></mat-label>\n      <input\n        matInput\n        id=\"'inputId-'{{content.name}}\"\n        type=\"text\"\n        [formControl]=\"chipsFormControl\"\n        [matAutocomplete]=\"auto\"\n          aria-label=\"Number\"\n      />\n\n      <mat-hint *ngIf=\"content.startHint\" [align]=\"'start'\">{{ content.startHint.label }}</mat-hint>\n      <mat-hint *ngIf=\"!content.startHint\" [align]=\"'start'\">{{ searchText }}</mat-hint>\n\n      <mat-autocomplete #auto=\"matAutocomplete\">\n        <mat-option *ngFor=\"let option of filteredOptions | async\" [value]=\"option.label\" (click)=\"addChips(option)\"\n          [title]=\"option.label\">\n          {{ option.label }}\n        </mat-option>\n      </mat-autocomplete>\n\n      <!-- <button mat-icon-button color=\"accent\" class=\"delete-filter\" (click)=\"remove_component()\">\n        <mat-icon>close</mat-icon>\n      </button> -->\n    </mat-form-field>\n  </mat-card-subtitle>\n\n  <mat-card-content *ngIf=\"!loading\">\n    <mat-chip-list class=\"mat-chip-list-stacked\" fxLayout=\"row\" fxLayoutAlign=\"start center\" style=\"margin-bottom: .5em\"\n      id=\"chiplist-{{content.name}}\">\n      <mat-chip *ngFor=\"let item of chipsList; let i=index\" (removed)=\"removeChip(i)\" [removable]=\"true\" style=\"width: 100%;height: 100%;\">\n        {{ item.label }}\n        <mat-icon matChipRemove>cancel</mat-icon>\n      </mat-chip>\n    </mat-chip-list>\n  </mat-card-content>\n\n</mat-card>\n",
                    host: {
                        "[style.minWidth]": "content.minWidth",
                        "[style.width]": "content.width",
                    },
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SelectFilterComponent.ctorParameters = function () { return []; };
    return SelectFilterComponent;
}(InputControl));
export { SelectFilterComponent };
if (false) {
    /** @type {?} */
    SelectFilterComponent.prototype.chipsFormControl;
    /** @type {?} */
    SelectFilterComponent.prototype.inputId;
    /** @type {?} */
    SelectFilterComponent.prototype.filteredOptions;
    /** @type {?} */
    SelectFilterComponent.prototype.chipsList;
    /** @type {?} */
    SelectFilterComponent.prototype.selectOptions;
    /** @type {?} */
    SelectFilterComponent.prototype.terms;
    /** @type {?} */
    SelectFilterComponent.prototype.loading;
    /** @type {?} */
    SelectFilterComponent.prototype.extraContent;
    /** @type {?} */
    SelectFilterComponent.prototype.searchText;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90b2NvLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9mb3Jtcy9leHBlcmltZW50YWwvc2VsZWN0LWZpbHRlci9zZWxlY3QtZmlsdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBS0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQW1CLFdBQVcsRUFBb0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUVoRixPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDOzs7O0FBS3pELGdEQUtDOzs7SUFKQyxxREFBa0I7O0lBQ2xCLDZEQUFxQjs7SUFDckIsNERBQW9COztBQU10QjtJQVMyQyxpREFBWTtJQXdCckQ7UUFBQSxZQUVFLGlCQUFPLFNBQ1I7Ozs7UUFwQkQsc0JBQWdCLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUdyQyxlQUFTLEdBQW1CLEVBQUUsQ0FBQztRQUMvQixtQkFBYSxHQUFtQixFQUFFLENBQUM7UUFFbkMsV0FBSyxHQUFtQixFQUFFLENBQUM7UUFFM0IsYUFBTyxHQUFHLElBQUksQ0FBQzs7UUFNZixnQkFBVSxHQUFHLHlCQUF5QixDQUFDOztJQU12QyxDQUFDOzs7O0lBRUQsd0NBQVE7OztJQUFSO1FBQUEsaUJBbUVDO1FBakVDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDL0IsNERBQTREO1FBQzVELHVCQUF1QjtRQUN2Qix5QkFBeUI7UUFDekIsS0FBSztRQUVMLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUU7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UUFDaEMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQzs7Z0JBNU5GLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsb0JBQW9CO29CQUM5QiwwdURBQTZDO29CQUU3QyxJQUFJLEVBQUU7d0JBQ0osa0JBQWtCLEVBQUUsa0JBQWtCO3dCQUN0QyxlQUFlLEVBQUUsZUFBZTtxQkFDakM7O2lCQUNGOzs7O0lBc05ELDRCQUFDO0NBQUEsQUE5TkQsQ0FTMkMsWUFBWSxHQXFOdEQ7U0FyTlkscUJBQXFCOzs7SUFPaEMsaURBQXFDOztJQUNyQyx3Q0FBZ0I7O0lBQ2hCLGdEQUE0Qzs7SUFDNUMsMENBQStCOztJQUMvQiw4Q0FBbUM7O0lBRW5DLHNDQUEyQjs7SUFFM0Isd0NBQWU7O0lBRWYsNkNBQWdEOztJQUloRCwyQ0FBdUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogICBDb3B5cmlnaHQgKGMpIDIwMjAgVW5pdmVyc2lkYWQgZGUgUGluYXIgZGVsIFLDrW8gXCJIZXJtYW5vcyBTYcOteiBNb250ZXMgZGUgT2NhXCJcbiAqICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sLCBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IG1hcCwgc3RhcnRXaXRoIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5pbXBvcnQgeyBpc0FycmF5IH0gZnJvbSBcInV0aWxcIjtcbmltcG9ydCB7IElucHV0Q29udHJvbCB9IGZyb20gJy4uLy4uL2lucHV0L2lucHV0LmNvbnRyb2wnO1xuaW1wb3J0IHsgU2VsZWN0T3B0aW9uIH0gZnJvbSBcIi4uLy4uL2lucHV0L3NlbGVjdC9zZWxlY3QtaW5wdXQuY29tcG9uZW50XCI7XG5cblxuXG5pbnRlcmZhY2UgU2VsZWN0RmlsdGVyQ29tcG9uZW50RXh0cmFDb250ZW50e1xuICBtdWx0aXBsZTogYm9vbGVhbjtcbiAgc2VsZWN0ZWRUZXJtc0lkczogW107XG4gIGV4Y2x1ZGVUZXJtc0lkczogW107XG5cbn1cblxuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJ0b2NvLXNlbGVjdC1maWx0ZXJcIixcbiAgdGVtcGxhdGVVcmw6IFwiLi9zZWxlY3QtZmlsdGVyLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9zZWxlY3QtZmlsdGVyLmNvbXBvbmVudC5zY3NzXCJdLFxuICBob3N0OiB7XG4gICAgXCJbc3R5bGUubWluV2lkdGhdXCI6IFwiY29udGVudC5taW5XaWR0aFwiLFxuICAgIFwiW3N0eWxlLndpZHRoXVwiOiBcImNvbnRlbnQud2lkdGhcIixcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgU2VsZWN0RmlsdGVyQ29tcG9uZW50IGV4dGVuZHMgSW5wdXRDb250cm9sXG4gIGltcGxlbWVudHMgT25Jbml0IHtcbiAgLy8gICBpbnRlcm5hbENvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAvLyBpbnRlcm5hbENvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAvL3RoaXMgY29udHJvbCBpcyB1c2VkIGJ5IHRoZSBjaGlwcyxub3QgbmVjZXNzYXJ5IHRvIGV4cG9zZSBpdFxuICBjaGlwc0Zvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKCk7XG4gIGlucHV0SWQ6IHN0cmluZztcbiAgZmlsdGVyZWRPcHRpb25zOiBPYnNlcnZhYmxlPFNlbGVjdE9wdGlvbltdPjtcbiAgY2hpcHNMaXN0OiBTZWxlY3RPcHRpb25bXSA9IFtdO1xuICBzZWxlY3RPcHRpb25zOiBTZWxlY3RPcHRpb25bXSA9IFtdO1xuXG4gIHRlcm1zOiBTZWxlY3RPcHRpb25bXSA9IFtdO1xuXG4gIGxvYWRpbmcgPSB0cnVlO1xuXG4gIGV4dHJhQ29udGVudDogU2VsZWN0RmlsdGVyQ29tcG9uZW50RXh0cmFDb250ZW50O1xuXG4gIC8vIHNlbGVjdGVkVGVybXNJZHMgPSBbXTtcblxuICBzZWFyY2hUZXh0ID0gXCJTZWxlY2Npb25lIGxhcyBvcGNpb25lc1wiO1xuXG5cbiAgY29uc3RydWN0b3IoKVxuICB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KClcbiAge1xuICAgIHRoaXMuaW5pdCgnJywgJycsIGZhbHNlLCB0cnVlKTtcbiAgICAvLyAodGhpcy5jb250ZW50LnBhcmVudEZvcm1TZWN0aW9uIGFzIEZvcm1Hcm91cCkuYWRkQ29udHJvbChcbiAgICAvLyAgIHRoaXMuY29udGVudC5uYW1lLFxuICAgIC8vICAgdGhpcy5pbnRlcm5hbENvbnRyb2xcbiAgICAvLyApO1xuXG4gICAgaWYgKHRoaXMuY29udGVudC5yZXF1aXJlZCkge1xuICAgICAgdGhpcy5jb250ZW50LmZvcm1Db250cm9sLnNldFZhbGlkYXRvcnMoXG4gICAgICAgIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCA9PiB7XG4gICAgICAgICAgcmV0dXJuICF0aGlzLmNvbnRlbnQudmFsdWUgfHwgdGhpcy5jb250ZW50LnZhbHVlLmxlbmd0aCA9PSAwXG4gICAgICAgICAgICA/IHsgcmVxdWlyZWRUZXJtczogXCJObyBUZXJtcyBTZWxlY3RlZFwiIH1cbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLmlucHV0SWQgPSB0aGlzLmNvbnRlbnQubGFiZWwudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQpIHtcbiAgICAgIHRoaXMuZXh0cmFDb250ZW50ID0gdGhpcy5jb250ZW50LmV4dHJhQ29udGVudDtcblxuICAgICAgLy8gaWYgKHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlICE9PSBudWxsKSB7XG4gICAgICAvLyAgIHRoaXMubXVsdGlwbGUgPSB0aGlzLmV4dHJhQ29udGVudC5tdWx0aXBsZTtcbiAgICAgIC8vIH1cbiAgICAgIC8vIGlmICh0aGlzLmV4dHJhQ29udGVudC5zZWxlY3RlZFRlcm1zSWRzKSB7XG4gICAgICAvLyAgIHRoaXMuY29udGVudC52YWx1ZSA9IHRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHM7XG4gICAgICAvLyB9IGVsc2Uge1xuICAgICAgLy8gICB0aGlzLmNvbnRlbnQudmFsdWUgPSBbXTtcbiAgICAgIC8vIH1cblxuICAgICAgLy8gYWxyZWFkeSBzZWxlY3RlZCB0ZXJtc1xuICAgICAgaWYgKCF0aGlzLmV4dHJhQ29udGVudC5zZWxlY3RlZFRlcm1zSWRzKSB7XG4gICAgICAgIHRoaXMuZXh0cmFDb250ZW50LnNlbGVjdGVkVGVybXNJZHMgPSBbXTtcbiAgICAgIH1cblxuICAgICAgLy8gdGVybXMgaWRzIHRvIGV4Y2x1ZGUgb2YgdGhlIHBvc3NpYmxlIG9wdGlvbnMuXG4gICAgICBpZiAoIXRoaXMuZXh0cmFDb250ZW50LmV4Y2x1ZGVUZXJtc0lkcykge1xuICAgICAgICB0aGlzLmV4dHJhQ29udGVudC5leGNsdWRlVGVybXNJZHMgPSBbXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29udGVudC52YWx1ZSA9IFtdO1xuXG4gICAgICBpZiAodGhpcy5jb250ZW50LmV4dHJhQ29udGVudC5vYnNlcnZhYmxlKSB7XG4gICAgICAgIHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQub2JzZXJ2YWJsZS5zdWJzY3JpYmUoXG4gICAgICAgICAgLy8gbmV4dFxuICAgICAgICAgIChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnMgPSB0aGlzLmNvbnRlbnQuZXh0cmFDb250ZW50LmdldE9wdGlvbnMocmVzcG9uc2UpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RPcHRpb25zTG9hZGVkKCk7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIC8vIGVycm9yXG4gICAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIGNvbXBsZXRlXG4gICAgICAgICAgKCkgPT4ge31cbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2VsZWN0T3B0aW9ucyA9IHRoaXMuY29udGVudC5leHRyYUNvbnRlbnQuZ2V0T3B0aW9ucygpO1xuICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnNMb2FkZWQoKTtcbiAgICAgIH1cbiAgICAvLyAgIGVsc2UgaWYodGhpcy5leHRyYUNvbnRlbnQudGVybUlEKXtcbiAgICAvLyAgICAgdGhpcy5zZXJ2aWNlLmdldFRlcm1CeVVVSUQodGhpcy5leHRyYUNvbnRlbnQudGVybUlELCB0aGlzLmV4dHJhQ29udGVudC5sZXZlbClcbiAgICAvLyAgICAgLnN1YnNjcmliZSh0aGlzLnRlcm1zVHJlZU9ic2VydmVyKTtcbiAgICAvLyB9XG4gICAgICAvLyB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgICB9XG4gIH1cblxuXG4gIHByaXZhdGUgc2VsZWN0T3B0aW9uc0xvYWRlZCgpIHtcbiAgICB0aGlzLnNlbGVjdE9wdGlvbnMuZm9yRWFjaCgob3B0aW9uKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgICh0aGlzLmV4dHJhQ29udGVudC5zZWxlY3RlZFRlcm1zSWRzIGFzIFtdKS5zb21lKFxuICAgICAgICAgIHZhbCA9PiB2YWwgPT09IG9wdGlvbi52YWx1ZVxuICAgICAgICApXG4gICAgICApe1xuICAgICAgICB0aGlzLmFkZENoaXBzKG9wdGlvbik7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmICh0aGlzLmV4dHJhQ29udGVudC5tdWx0aXBsZSkge1xuICAgICAgLy8gICB0cnkge1xuICAgICAgLy8gICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jb250ZW50LnZhbHVlLmluZGV4T2Yob3B0aW9uLnZhbHVlKTtcbiAgICAgIC8vICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgLy8gICAgICAgdGhpcy5hZGRDaGlwcyhvcHRpb24pO1xuICAgICAgLy8gICAgIH1cbiAgICAgIC8vICAgfSBjYXRjaCAoZXJyb3IpIHt9XG4gICAgICAvLyB9IGVsc2Uge1xuICAgICAgLy8gICBpZiAob3B0aW9uLnZhbHVlID09IHRoaXMuY29udGVudC52YWx1ZSkge1xuICAgICAgLy8gICAgIHRoaXMuYWRkQ2hpcHMob3B0aW9uKTtcbiAgICAgIC8vICAgfVxuICAgICAgLy8gfVxuICAgIH0pO1xuICAgIGlmIChcbiAgICAgIHRoaXMuZXh0cmFDb250ZW50Lm11bHRpcGxlICYmXG4gICAgICAodGhpcy5jb250ZW50LnZhbHVlID09IG51bGwgfHxcbiAgICAgICAgdGhpcy5jb250ZW50LnZhbHVlID09IHVuZGVmaW5lZCB8fFxuICAgICAgICAhaXNBcnJheSh0aGlzLmNvbnRlbnQudmFsdWUpKVxuICAgICkge1xuICAgICAgdGhpcy5jb250ZW50LnZhbHVlID0gW107XG4gICAgfVxuXG4gICAgdGhpcy5fdXBkYXRlRmlsdGVyZWRPcHRpb25zKCk7XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIHNldFZhbGlkYXRpb24oKSB7XG4gICAgaWYgKHRoaXMuY29udGVudC5mb3JtQ29udHJvbC52YWxpZCkge1xuICAgICAgdGhpcy5jaGlwc0Zvcm1Db250cm9sLnNldEVycm9ycyhudWxsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGlwc0Zvcm1Db250cm9sLnNldEVycm9ycyh7IHJlcXVpZXJlZDogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSBhZGRUZXJtVG9WYWx1ZSh0ZXJtOiBTZWxlY3RPcHRpb24pIHtcbiAgICBpZiAodGhpcy5leHRyYUNvbnRlbnQubXVsdGlwbGUpIHtcbiAgICAgIHRoaXMuY29udGVudC52YWx1ZS51bnNoaWZ0KHRlcm0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbnRlbnQudmFsdWUgPSBbdGVybV07XG4gICAgfVxuICAgIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRlbnQudmFsdWUpO1xuICAgIHRoaXMuc2V0VmFsaWRhdGlvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVUZXJtRnJvbVZhbHVlKHRlcm06IFNlbGVjdE9wdGlvbikge1xuICAgIHRoaXMuY29udGVudC52YWx1ZSA9ICh0aGlzLmNvbnRlbnQudmFsdWUgYXMgW10pLmZpbHRlcihcbiAgICAgIChlOiBTZWxlY3RPcHRpb24pID0+IGUudmFsdWUgIT09IHRlcm0udmFsdWVcbiAgICApO1xuICAgIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRlbnQudmFsdWUpO1xuICAgIHRoaXMuc2V0VmFsaWRhdGlvbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlRmlsdGVyZWRPcHRpb25zKCkge1xuICAgIHRoaXMuZmlsdGVyZWRPcHRpb25zID0gdGhpcy5jaGlwc0Zvcm1Db250cm9sLnZhbHVlQ2hhbmdlcy5waXBlPFxuICAgICAgc3RyaW5nLFxuICAgICAgU2VsZWN0T3B0aW9uW11cbiAgICA+KFxuICAgICAgc3RhcnRXaXRoKFwiXCIpLFxuICAgICAgbWFwKHZhbHVlID0+IHtcbiAgICAgICAgY29uc3QgZmlsdGVyVmFsdWUgPSB2YWx1ZSA/IHZhbHVlLnRvTG93ZXJDYXNlKCkgOiBcIlwiO1xuICAgICAgICBjb25zb2xlLmxvZygnKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqJylcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RPcHRpb25zKTtcbiAgICAgICAgY29uc29sZS5sb2coJyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKicpXG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0T3B0aW9ucy5maWx0ZXIob3B0aW9uID0+XG4gICAgICAgICAgb3B0aW9uLmxhYmVsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyVmFsdWUpXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuXG5cbiAgYWRkQ2hpcHModmFsdWU6IFNlbGVjdE9wdGlvbikge1xuICAgIGlmICh0aGlzLmV4dHJhQ29udGVudC5tdWx0aXBsZSkge1xuICAgICAgdGhpcy5jaGlwc0xpc3QudW5zaGlmdCh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGlmIG5vdCBpcyBtdWx0aXBsZSwgdGhlbiB0aGUgZWxlbWVudCBpbiB0aGUgY2hpcHNMaXN0IGdvZXMgYmFjayB0byB0aGUgb3B0aW9uc1xuICAgICAgaWYgKHRoaXMuY2hpcHNMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5zZWxlY3RPcHRpb25zLnB1c2godGhpcy5jaGlwc0xpc3RbMF0pO1xuICAgICAgfVxuICAgICAgdGhpcy5jaGlwc0xpc3QgPSBbdmFsdWVdO1xuICAgIH1cbiAgICB0aGlzLmFkZFRlcm1Ub1ZhbHVlKHZhbHVlKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdE9wdGlvbnMpO1xuICAgIHRoaXMuc2VsZWN0T3B0aW9ucyA9IHRoaXMuc2VsZWN0T3B0aW9ucy5maWx0ZXIoXG4gICAgICBvcHRpb24gPT4gb3B0aW9uLnZhbHVlICE9PSB2YWx1ZS52YWx1ZVxuICAgICk7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy5zZWxlY3RPcHRpb25zKTtcblxuICAgIHRoaXMuY2hpcHNGb3JtQ29udHJvbC5zZXRWYWx1ZShcIlwiKTtcbiAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlucHV0SWQpLmJsdXIoKTtcbiAgICB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgfVxuXG4gIHJlbW92ZUNoaXAoaW5kZXg6IG51bWJlcikge1xuICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0T3B0aW9ucyk7XG5cbiAgICB0aGlzLnNlbGVjdE9wdGlvbnMucHVzaCh0aGlzLmNoaXBzTGlzdFtpbmRleF0pO1xuICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0T3B0aW9ucyk7XG4gICAgdGhpcy5yZW1vdmVUZXJtRnJvbVZhbHVlKHRoaXMuY2hpcHNMaXN0W2luZGV4XSk7XG4gICAgdGhpcy5jaGlwc0xpc3Quc3BsaWNlKGluZGV4LCAxKTtcbiAgICB0aGlzLl91cGRhdGVGaWx0ZXJlZE9wdGlvbnMoKTtcbiAgfVxuXG59XG4iXX0=