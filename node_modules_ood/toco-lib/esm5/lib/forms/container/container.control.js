/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/container/container.control.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Input, ViewChild } from '@angular/core';
import { FormArray, FormGroup } from '@angular/forms';
import { GetViewContainerDirective } from '../../core/utils/get-view-container.directive';
import { FormFieldControl, cloneFormControl, cloneFormSection } from '../form-field.control';
/**
 * A base interface that represents the content of a `ContainerControl`.
 * @record
 */
export function ContainerContent() { }
if (false) {
    /**
     * Returns an array of controls that represents the `ContainerControl`'s child controls that are
     * stored in the `content.formSection`; that is, `content.containerControlChildren` and `content.formSection`
     * have the same length.
     * It is always set internally.
     * By default, its value is `[]`.
     * @type {?|undefined}
     */
    ContainerContent.prototype.containerControlChildren;
    /**
     * Returns the `FormSection` that tracks the value and validity state of the internal
     * child controls that contains this control.
     * Implementation notes:
     *  - Represents the `FormGroup` or `FormArray` that contains the child controls.
     *  - The `content.containerControlChildren` and `content.formSection` have the same length.
     *  - It must be specified; otherwise, an exception is thrown.
     * @type {?|undefined}
     */
    ContainerContent.prototype.formSection;
    /**
     * Returns an array of contents that represents the `ContainerControl`'s child controls that are
     * stored in the `ViewContainer`; that is, `content.formSectionContent` and container's `ViewContainer`
     * have the same length.
     * Implementation notes:
     *  - It must be specified, and must have at least one element; otherwise, an exception is thrown.
     *  - If the `content.formSection` field represents a `FormArray`, then the `name` field
     * of all elements in the `content.formSectionContent` array represents the position
     * in the array like string.
     * @type {?|undefined}
     */
    ContainerContent.prototype.formSectionContent;
    /**
     * Returns true if the container control has a dynamic length, that is, the `content.formSection` field
     * represents a `FormArray` and its length is not fixed; otherwise, false.
     * This field has sense only when the `content.formSection` field represents a `FormArray`.
     * By default, its value is `true`.
     * @type {?|undefined}
     */
    ContainerContent.prototype.isDynamic;
}
/**
 * Represents the base abstract class for a control that contains one or more controls.
 * @abstract
 */
var ContainerControl = /** @class */ (function (_super) {
    tslib_1.__extends(ContainerControl, _super);
    /**
     * Constructs a new instance of this class.
     */
    function ContainerControl() {
        var _this = _super.call(this) || this;
        _this._isFormArray = false;
        _this._formArrayPatternContent = [];
        _this._formArrayPatternValue = undefined;
        _this._formArrayLength = 0;
        return _this;
    }
    /**
     * Returns a `FormGroup` by default.
     * Its value is empty object, and does not have validators.
     */
    /**
     * Returns a `FormGroup` by default.
     * Its value is empty object, and does not have validators.
     * @return {?}
     */
    ContainerControl.getFormGroupByDefault = /**
     * Returns a `FormGroup` by default.
     * Its value is empty object, and does not have validators.
     * @return {?}
     */
    function () {
        return new FormGroup({}, []);
    };
    /**
     * Returns a `FormArray` by default.
     * Its value is empty array, and does not have validators.
     */
    /**
     * Returns a `FormArray` by default.
     * Its value is empty array, and does not have validators.
     * @return {?}
     */
    ContainerControl.getFormArrayByDefault = /**
     * Returns a `FormArray` by default.
     * Its value is empty array, and does not have validators.
     * @return {?}
     */
    function () {
        return new FormArray([], []);
    };
    /**
     * Initializes the `content` input property.
     * @param label The default label to use. It is used if the `content.label` is not specified.
     * @param placeholder It is NOT used here. Fix that.
     */
    /**
     * Initializes the `content` input property.
     * @protected
     * @param {?} label The default label to use. It is used if the `content.label` is not specified.
     * @param {?=} placeholder It is NOT used here. Fix that.
     * @return {?}
     */
    ContainerControl.prototype.init = /**
     * Initializes the `content` input property.
     * @protected
     * @param {?} label The default label to use. It is used if the `content.label` is not specified.
     * @param {?=} placeholder It is NOT used here. Fix that.
     * @return {?}
     */
    function (label, placeholder) {
        /* Sets the default values. */
        if (placeholder === void 0) { placeholder = ''; }
        _super.prototype.init.call(this, label, placeholder);
        if (this.content.formSection == undefined) {
            throw new Error("For the '" + this.content.name + "' control, the 'content.formSection' value can not be undefined; it must be a 'FormGroup' or 'FormArray' value.");
        }
        if ((this.content.formSectionContent == undefined) || (this.content.formSectionContent.length == 0)) {
            throw new Error("For the '" + this.content.name + "' control, the 'content.formSectionContent' array can not be undefined, and must have at least one element.");
        }
        this._isFormArray = this.content.formSection instanceof FormArray;
        if (this._isFormArray) {
            if (this.content.isDynamic == undefined)
                this.content.isDynamic = true; /* By default, its value is `true`. */
            if (this.content.required == undefined)
                this.content.required = false; /* By default, its value is `false`. */
        }
        else {
            if (this.content.isDynamic != undefined)
                throw new Error("For the '" + this.content.name + "' control, the 'content.isDynamic' value must not exist because the 'content.formSection' value is a 'FormGroup'.");
            if (this.content.required != undefined)
                throw new Error("For the '" + this.content.name + "' control, the 'content.required' value must not exist because the 'content.formSection' value is a 'FormGroup'.");
            if (this.content.value != undefined)
                throw new Error("For the '" + this.content.name + "' control, the 'content.value' value must not exist because the 'content.formSection' value is a 'FormGroup'.");
        }
        this._viewContainerRef = this._componentHost.viewContainerRef;
        this._componentFactoryResolver = this._componentHost.componentFactoryResolver;
        /* Initializes the `content.containerControlChildren`. */
        this.content.containerControlChildren = [];
        if (this._isFormArray) {
            if (this.content.value == undefined) {
                throw new Error("The '" + this.content.name + "' control is constructed dynamically using 'FormArray'. Its 'content.value' array can not be undefined.");
            }
            if ((this.content.value.length == 0) && (!this.content.isDynamic) && (this.content.required)) {
                throw new Error("The '" + this.content.name + "' control has not sense because its 'content.value' array length is zero, and its 'content.isDynamic' value is false, and its 'content.required' value is true.");
            }
            this.initFormSectionContentToFormArray();
        }
        else {
            /* Sets the parent control to its children. */
            this.setParentToChildren();
        }
        // let temp: string = (isAbbreviation) ? this.content.label : this.content.label.toLowerCase();
        // this.validationError_required = `The ${ temp } can not be empty.`;
        /************************** `mat-form-field` properties. **************************/
        // if (this.content.appearance == undefined) this.content.appearance = TextInputAppearance.standard;
        /***************************** `mat-hint` properties. *****************************/
        // if (alwaysHint && (this.content.startHint == undefined) && (this.content.endHint == undefined))
        // {
        //     this.content.startHint = new HintValue(HintPosition.start, `Write a valid ${ temp }.`);
        // }
        // else
        // {
        //     if (this.content.startHint != undefined) this.content.startHint.setDefaultValueIfUndefined_setPosition(HintPosition.start);
        //     if (this.content.endHint != undefined) this.content.endHint.setDefaultValueIfUndefined_setPosition(HintPosition.end);
        // }
        /* Adds this control as a child to the `content.parentFormSection`.
        It must be called at the end before calling `createChildComponents` method. */
        if (this.content.parentFormSection != undefined) {
            this.addAsChildControl(this, this.content.formSection);
        }
        /* Creates the child components. */
        this.createChildComponents(this.content.formSectionContent);
    };
    /**
     * Initializes the `content.formSectionContent` array correctly depending on the `content.value`.
     * In this case, `content.value` is an array. For each element in the `content.value`, a cloning
     * is done to the `_formArrayPatternContent` array, and it is added in the `content.formSectionContent`;
     * therefore one element is added in the `content.formSection` `FormArray`.
     */
    /**
     * Initializes the `content.formSectionContent` array correctly depending on the `content.value`.
     * In this case, `content.value` is an array. For each element in the `content.value`, a cloning
     * is done to the `_formArrayPatternContent` array, and it is added in the `content.formSectionContent`;
     * therefore one element is added in the `content.formSection` `FormArray`.
     * @protected
     * @return {?}
     */
    ContainerControl.prototype.initFormSectionContentToFormArray = /**
     * Initializes the `content.formSectionContent` array correctly depending on the `content.value`.
     * In this case, `content.value` is an array. For each element in the `content.value`, a cloning
     * is done to the `_formArrayPatternContent` array, and it is added in the `content.formSectionContent`;
     * therefore one element is added in the `content.formSection` `FormArray`.
     * @protected
     * @return {?}
     */
    function () {
        /* At this point, `content.formSectionContent` has at least one element. */
        var e_1, _a;
        /* Saves the pattern content, that is, `content.formSectionContent`.
        It is shared among controls. */
        this._formArrayPatternContent = this.content.formSectionContent;
        /* The `FormArray` is empty initially. */
        this.content.formSectionContent = [];
        /* Saves the pattern value, that is, creates the pattern value following the `_formArrayPatternContent` structure.
        The result value represents a copy of one value that can contain the `content.value` array, and
        sets all its properties/values of built-in type to `undefined`.
        It does not clone a value from the `content.value` array because the array can be empty.
        It creates in deep until the next `FormArray`, then the next `FormArray` creates in deep until the next `FormArray`, and so on.
        It is the first time that the `_formArrayPatternContent` is travelled, therefore the `createValueToUndefined` method does verifications. */
        this._formArrayPatternValue = this.createValueToUndefined();
        /* If the `content.required` field is true, then the container control must have one child control at least. */
        if ((this.content.required) && (this.content.value.length == 0)) {
            /* It can push the `_formArrayPatternValue` and does not push its clone because
            both values have the same properties and there is not problem. */
            this.content.value[0] = this._formArrayPatternValue;
        }
        try {
            /* The `FormArray` will contain one element for each element in the `content.value`. */
            for (var _b = tslib_1.__values(this.content.value), _c = _b.next(); !_c.done; _c = _b.next()) {
                var val = _c.value;
                this._initElemFormSectionContentToFormArray(val);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /**
     * Sets the parent control to its children.
     */
    /**
     * Sets the parent control to its children.
     * @protected
     * @return {?}
     */
    ContainerControl.prototype.setParentToChildren = /**
     * Sets the parent control to its children.
     * @protected
     * @return {?}
     */
    function () {
        this.content.formSectionContent.forEach(this.setParentToChild, this);
    };
    /**
     * Sets the parent control to one child.
     * @param ffc The child to set the parent control.
     */
    /**
     * Sets the parent control to one child.
     * @protected
     * @param {?} ffc The child to set the parent control.
     * @return {?}
     */
    ContainerControl.prototype.setParentToChild = /**
     * Sets the parent control to one child.
     * @protected
     * @param {?} ffc The child to set the parent control.
     * @return {?}
     */
    function (ffc) {
        /* Sets the parent `ContainerControl` to its children. */
        ffc.parentContainerControl = this;
        /* Sets the parent `FormSection` to its children if they have got nothing. */
        ffc.parentFormSection = this.content.formSection;
    };
    /**
     * Returns a new value that is created following the `_formArrayPatternContent` structure.
     * It also sets all its properties/values of built-in type to `undefined`.
     * It creates the value smartly depending on the type of content.
     * It creates in deep until the next `FormArray`, then the next `FormArray` creates in deep until the next `FormArray`, and so on.
     * It is the first time that the `_formArrayPatternContent` is travelled, therefore the `createValueToUndefined` method does verifications.
     */
    /**
     * Returns a new value that is created following the `_formArrayPatternContent` structure.
     * It also sets all its properties/values of built-in type to `undefined`.
     * It creates the value smartly depending on the type of content.
     * It creates in deep until the next `FormArray`, then the next `FormArray` creates in deep until the next `FormArray`, and so on.
     * It is the first time that the `_formArrayPatternContent` is travelled, therefore the `createValueToUndefined` method does verifications.
     * @protected
     * @return {?}
     */
    ContainerControl.prototype.createValueToUndefined = /**
     * Returns a new value that is created following the `_formArrayPatternContent` structure.
     * It also sets all its properties/values of built-in type to `undefined`.
     * It creates the value smartly depending on the type of content.
     * It creates in deep until the next `FormArray`, then the next `FormArray` creates in deep until the next `FormArray`, and so on.
     * It is the first time that the `_formArrayPatternContent` is travelled, therefore the `createValueToUndefined` method does verifications.
     * @protected
     * @return {?}
     */
    function () {
        var e_2, _a;
        /** @type {?} */
        var result;
        /* The `_formArrayPatternContent` array can have one element only with the `content.formSection` field. */
        /** @type {?} */
        var alreadyHasFormSection = false;
        try {
            for (var _b = tslib_1.__values(this._formArrayPatternContent), _c = _b.next(); !_c.done; _c = _b.next()) {
                var content = _c.value;
                if (content.formControl) {
                    if (alreadyHasFormSection)
                        throw new Error("For the '" + this.content.name + "' control, the 'content.formSectionContent' array can have one element only with the 'content.formControl' or 'content.formSection' field.");
                    alreadyHasFormSection = true;
                    result = undefined;
                }
                else if (content.formSection) {
                    if (alreadyHasFormSection)
                        throw new Error("For the '" + this.content.name + "' control, the 'content.formSectionContent' array can have one element only with the 'content.formControl' or 'content.formSection' field.");
                    alreadyHasFormSection = true;
                    result = this._createValueToUndefined(content);
                }
                /* The rest of `content`s do not contain a `value` field of interest. */
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        if (!alreadyHasFormSection)
            throw new Error("For the '" + this.content.name + "' control, the 'content.formSectionContent' array must have one element only among all with the 'content.formControl' or 'content.formSection' field.");
        return result;
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    ContainerControl.prototype._createValueToUndefined = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        var e_3, _a;
        if (target.formSection instanceof FormArray) {
            return [];
        }
        else {
            /** @type {?} */
            var result = {};
            try {
                for (var _b = tslib_1.__values(target.formSectionContent), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var content = _c.value;
                    if (content.formControl)
                        result[content.name] = undefined;
                    else if (content.formSection)
                        result[content.name] = this._createValueToUndefined(content);
                    /* The rest of `content`s do not contain a `value` field of interest. */
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_3) throw e_3.error; }
            }
            return result;
        }
    };
    /**
     * Initializes and returns a clone of the `_formArrayPatternContent` array correctly
     * depending on the specified `value`.
     * This clone is also added in the `content.formSectionContent` array.
     * @param value The initial `value` field of each content representing a `FormControl`.
     */
    /**
     * Initializes and returns a clone of the `_formArrayPatternContent` array correctly
     * depending on the specified `value`.
     * This clone is also added in the `content.formSectionContent` array.
     * @private
     * @param {?} value The initial `value` field of each content representing a `FormControl`.
     * @return {?}
     */
    ContainerControl.prototype._initElemFormSectionContentToFormArray = /**
     * Initializes and returns a clone of the `_formArrayPatternContent` array correctly
     * depending on the specified `value`.
     * This clone is also added in the `content.formSectionContent` array.
     * @private
     * @param {?} value The initial `value` field of each content representing a `FormControl`.
     * @return {?}
     */
    function (value) {
        var e_4, _a;
        /* The content array cloned. */
        /** @type {?} */
        var result = [];
        /** @type {?} */
        var refContent;
        try {
            for (var _b = tslib_1.__values(this._formArrayPatternContent), _c = _b.next(); !_c.done; _c = _b.next()) {
                var content = _c.value;
                /* Clones in deep until the next `FormArray`, then the next `FormArray` clones in deep until the next `FormArray`, and so on. */
                if (content.formSection instanceof FormArray) {
                    /* This `content.formSectionContent` will not be cloned because it belongs to a `FormArray` and it will be cloned when the `FormArray` is analyzed in the `ContainerControl` class. */
                    refContent = this._cloneContent(content, undefined /* It is not used in this case. */, false);
                    refContent.value = value;
                }
                else {
                    refContent = this._cloneContent(content, value, true);
                }
                /* Sets the parent control to its child. */
                this.setParentToChild(refContent);
                /* Overwrites some properties for the content cloned. */
                refContent.name = this._formArrayLength.toString(10); /* The element is added in the `FormArray` after the last position. */
                /* Overwrites some properties for the content cloned if it contains the `content.formControl` or `content.formSection` field. */
                if ((content.formControl) || (content.formSection)) {
                    // refContent.label = ((refContent.label == undefined) ? (refContent.name) : (refContent.label + refContent.name));
                    // refContent.ariaLabel = refContent.label;
                }
                /* Save the content cloned. */
                this.content.formSectionContent.push(refContent);
                result.push(refContent);
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_4) throw e_4.error; }
        }
        this._formArrayLength++;
        return result;
    };
    /**
     * Returns a new content that represents the clone of the specified content target.
     * It also sets the initial `value` field of each content representing a `FormControl`.
     * It clones the content smartly depending on the type of property.
     * It clones in deep until the next `FormArray`, then the next `FormArray` clones in deep until the next `FormArray`, and so on.
     * @param target The content object to clone.
     * @param value The initial `value` field of each content representing a `FormControl`.
     * @param canClone It is true if the function can clone the `formSectionContent` field; otherwise, false.
     */
    /**
     * Returns a new content that represents the clone of the specified content target.
     * It also sets the initial `value` field of each content representing a `FormControl`.
     * It clones the content smartly depending on the type of property.
     * It clones in deep until the next `FormArray`, then the next `FormArray` clones in deep until the next `FormArray`, and so on.
     * @private
     * @param {?} target The content object to clone.
     * @param {?} value The initial `value` field of each content representing a `FormControl`.
     * @param {?} canClone It is true if the function can clone the `formSectionContent` field; otherwise, false.
     * @return {?}
     */
    ContainerControl.prototype._cloneContent = /**
     * Returns a new content that represents the clone of the specified content target.
     * It also sets the initial `value` field of each content representing a `FormControl`.
     * It clones the content smartly depending on the type of property.
     * It clones in deep until the next `FormArray`, then the next `FormArray` clones in deep until the next `FormArray`, and so on.
     * @private
     * @param {?} target The content object to clone.
     * @param {?} value The initial `value` field of each content representing a `FormControl`.
     * @param {?} canClone It is true if the function can clone the `formSectionContent` field; otherwise, false.
     * @return {?}
     */
    function (target, value, canClone) {
        var e_5, _a;
        /* The content cloned. */
        /** @type {?} */
        var result = {};
        for (var prop in target) {
            switch (prop) {
                /* The `formControl` property special case. */
                case 'formControl':
                    {
                        result[prop] = cloneFormControl(target.formControl);
                        /* If this content (`result`) represents a `FormControl`, then the `value` field is initialized. */
                        result['value'] = value;
                        break;
                    }
                /* The `formSection` property special case. */
                case 'formSection':
                    {
                        result[prop] = cloneFormSection(target.formSection);
                        break;
                    }
                /* The `formSectionContent` property special case. */
                case 'formSectionContent':
                    {
                        if (canClone) /* Clones the `target.formSectionContent`. */ {
                            result[prop] = [];
                            try {
                                for (var _b = (e_5 = void 0, tslib_1.__values(target.formSectionContent)), _c = _b.next(); !_c.done; _c = _b.next()) {
                                    var content = _c.value;
                                    if (content.formSection instanceof FormArray) {
                                        content.value = value[content.name];
                                        /* This `content.formSectionContent` will not be cloned because it belongs to a `FormArray` and it will be cloned when the `FormArray` is analyzed in the `ContainerControl` class. */
                                        result[prop].push(this._cloneContent(content, undefined /* It is not used in this case. */, false));
                                        content.value = undefined;
                                    }
                                    else {
                                        result[prop].push(this._cloneContent(content, value[content.name], canClone));
                                    }
                                }
                            }
                            catch (e_5_1) { e_5 = { error: e_5_1 }; }
                            finally {
                                try {
                                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                                }
                                finally { if (e_5) throw e_5.error; }
                            }
                        }
                        else /* Takes the same `target.formSectionContent` reference because `target` is a `FormArray` and its `formSectionContent` will be taken like a pattern. */ {
                            result[prop] = target.formSectionContent;
                        }
                        break;
                    }
                /* Copies the property without problem. */
                default:
                    {
                        result[prop] = target[prop];
                        break;
                    }
            }
        }
        return result;
    };
    /**
     * Creates the child components.
     * @param componentsContent Components content array for creating the components.
     */
    /**
     * Creates the child components.
     * @protected
     * @param {?} componentsContent Components content array for creating the components.
     * @return {?}
     */
    ContainerControl.prototype.createChildComponents = /**
     * Creates the child components.
     * @protected
     * @param {?} componentsContent Components content array for creating the components.
     * @return {?}
     */
    function (componentsContent) {
        var e_6, _a;
        try {
            for (var componentsContent_1 = tslib_1.__values(componentsContent), componentsContent_1_1 = componentsContent_1.next(); !componentsContent_1_1.done; componentsContent_1_1 = componentsContent_1.next()) {
                var componentContent = componentsContent_1_1.value;
                /* Creates a child component. */
                this.createChildComponent(componentContent);
            }
        }
        catch (e_6_1) { e_6 = { error: e_6_1 }; }
        finally {
            try {
                if (componentsContent_1_1 && !componentsContent_1_1.done && (_a = componentsContent_1.return)) _a.call(componentsContent_1);
            }
            finally { if (e_6) throw e_6.error; }
        }
    };
    /**
     * Creates a child component.
     * @param componentContent Component content for creating the component.
     */
    /**
     * Creates a child component.
     * @protected
     * @param {?} componentContent Component content for creating the component.
     * @return {?}
     */
    ContainerControl.prototype.createChildComponent = /**
     * Creates a child component.
     * @protected
     * @param {?} componentContent Component content for creating the component.
     * @return {?}
     */
    function (componentContent) {
        this._cr = this._viewContainerRef.createComponent(this._componentFactoryResolver.resolveComponentFactory(componentContent.controlType));
        ((/** @type {?} */ (this._cr.instance))).content = componentContent;
    };
    /**
     * Initializes the control's value. It uses the `content.value` and it is already different of `undefined`.
     * It also checks if the specified `content.value` is correct. For internal use only.
     */
    /**
     * Initializes the control's value. It uses the `content.value` and it is already different of `undefined`.
     * It also checks if the specified `content.value` is correct. For internal use only.
     * @protected
     * @return {?}
     */
    ContainerControl.prototype.initValue = /**
     * Initializes the control's value. It uses the `content.value` and it is already different of `undefined`.
     * It also checks if the specified `content.value` is correct. For internal use only.
     * @protected
     * @return {?}
     */
    function () {
        /* It does not need to do something because the child controls are already initialized. */
        // /* In this way, checks if the specified `content.value` is correct. */
        // this.content.formControl.setValue(this.content.value);
        // /* Marks the control as `touched`. */
        // this.content.formControl.markAsTouched({
        //     onlySelf: true
        // });
    };
    Object.defineProperty(ContainerControl.prototype, "getInstance", {
        /**
         * Returns this instance.
         */
        get: /**
         * Returns this instance.
         * @return {?}
         */
        function () {
            return this;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "containerControlChildren", {
        /**
         * Returns an array of controls that represents the `ContainerControl`'s child controls.
         * It is always set internally.
         */
        get: /**
         * Returns an array of controls that represents the `ContainerControl`'s child controls.
         * It is always set internally.
         * @return {?}
         */
        function () {
            return this.content.containerControlChildren;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "formArrayPatternContent", {
        /**
         * If the `content.formSection` represents a `FormArray`, then this field returns
         * a pattern content that is `content.formSectionContent[0]` value; otherwise, returns `undefined`.
         * It is shared among controls.
         * It is used for adding a new element in the `content.formSectionContent`, that is,
         * for adding a new control in the `FormArray`.
         * By default, its value is `undefined`.
         */
        get: /**
         * If the `content.formSection` represents a `FormArray`, then this field returns
         * a pattern content that is `content.formSectionContent[0]` value; otherwise, returns `undefined`.
         * It is shared among controls.
         * It is used for adding a new element in the `content.formSectionContent`, that is,
         * for adding a new control in the `FormArray`.
         * By default, its value is `undefined`.
         * @return {?}
         */
        function () {
            return this._formArrayPatternContent;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "formArrayPatternValue", {
        /**
         * If the `content.formSection` represents a `FormArray`, then this field returns
         * a pattern value that is a clone of the `content.value[0]` value, and sets all
         * its properties/values of built-in type to `undefined`; otherwise, returns `undefined`.
         * It is used for adding a new element in the `content.formSectionContent`.
         * By default, its value is `undefined`.
         */
        get: /**
         * If the `content.formSection` represents a `FormArray`, then this field returns
         * a pattern value that is a clone of the `content.value[0]` value, and sets all
         * its properties/values of built-in type to `undefined`; otherwise, returns `undefined`.
         * It is used for adding a new element in the `content.formSectionContent`.
         * By default, its value is `undefined`.
         * @return {?}
         */
        function () {
            return this._formArrayPatternValue;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "isDynamic", {
        /**
         * Returns true if the container control has a dynamic length, that is, the `content.formSection` field
         * represents a `FormArray` and its length is not fixed; otherwise, false.
         * This property has sense only when the `content.formSection` field represents a `FormArray`.
         */
        get: /**
         * Returns true if the container control has a dynamic length, that is, the `content.formSection` field
         * represents a `FormArray` and its length is not fixed; otherwise, false.
         * This property has sense only when the `content.formSection` field represents a `FormArray`.
         * @return {?}
         */
        function () {
            return this.content.isDynamic;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "isFormArray", {
        /**
         * Returns true if the container control is a `FormArray`, that is, the `content.formSection` field
         * represents a `FormArray`; otherwise, false.
         */
        get: /**
         * Returns true if the container control is a `FormArray`, that is, the `content.formSection` field
         * represents a `FormArray`; otherwise, false.
         * @return {?}
         */
        function () {
            return this._isFormArray;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "isEmpty", {
        /**
         * Returns true if this container is empty; otherwise, false.
         */
        get: /**
         * Returns true if this container is empty; otherwise, false.
         * @return {?}
         */
        function () {
            return (this.content.formSectionContent.length == 0);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerControl.prototype, "canRemoveFromFormArray", {
        /**
         * Returns true if an element can be removed from the `content.formSection`; otherwise, false.
         * Use along with `removeFromFormArray` and `clearFormArray` methods.
         * The `content.formSection` must be an instance of `FormArray`.
         */
        get: /**
         * Returns true if an element can be removed from the `content.formSection`; otherwise, false.
         * Use along with `removeFromFormArray` and `clearFormArray` methods.
         * The `content.formSection` must be an instance of `FormArray`.
         * @return {?}
         */
        function () {
            /* The method uses the `_formArrayLength` instead of `content.formSection` because
            the first one field is updated first and it has the answer more accurate than the second one field. */
            if (this.content.required) {
                return (this._formArrayLength > 1);
            }
            else {
                return (this._formArrayLength != 0);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Adds an empty element at the end of the `content.formSectionContent`; therefore one element
     * is added at the end of the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     */
    /**
     * Adds an empty element at the end of the `content.formSectionContent`; therefore one element
     * is added at the end of the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @return {?}
     */
    ContainerControl.prototype.addToFormArray = /**
     * Adds an empty element at the end of the `content.formSectionContent`; therefore one element
     * is added at the end of the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @return {?}
     */
    function () {
        console.log('addToFormArray');
        if (this._isFormArray) {
            this.createChildComponents(this._initElemFormSectionContentToFormArray(this._formArrayPatternValue));
        }
        else {
            throw new Error("For the '" + this.content.name + "' control, the 'content.formSection' value must be an instance of 'FormArray'.");
        }
    };
    /**
     * Removes the element at the given `index` in the `content.formSectionContent`; therefore
     * the element at the given `index` is removed in the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @param index Index in the array to remove the element.
     */
    /**
     * Removes the element at the given `index` in the `content.formSectionContent`; therefore
     * the element at the given `index` is removed in the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @param {?} index Index in the array to remove the element.
     * @return {?}
     */
    ContainerControl.prototype.removeFromFormArray = /**
     * Removes the element at the given `index` in the `content.formSectionContent`; therefore
     * the element at the given `index` is removed in the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @param {?} index Index in the array to remove the element.
     * @return {?}
     */
    function (index) {
        console.log('removeFromFormArray', index);
        if (this._isFormArray) {
            //TODO: la variable `formArrayPatternContentLength` podría ser un campo de la clase. 
            /** @type {?} */
            var formArrayPatternContentLength = this._formArrayPatternContent.length;
            /** @type {?} */
            var i = void 0;
            /** @type {?} */
            var j = void 0;
            /** @type {?} */
            var k = void 0;
            this.content.containerControlChildren.splice(index, 1);
            this.content.formSectionContent.splice((index * formArrayPatternContentLength), formArrayPatternContentLength);
            ((/** @type {?} */ (this.content.formSection))).removeAt(index);
            for (i = formArrayPatternContentLength, j = index * formArrayPatternContentLength; i != 0; i--) {
                this._viewContainerRef.remove(j);
            }
            this._formArrayLength--;
            /* Updates the elements' index in the `content.formSectionContent` array from
            the specified `index` onwards. */
            for (k = (i = index * formArrayPatternContentLength) + formArrayPatternContentLength, j = this.content.formSectionContent.length; i < j; i++) {
                if (i == k) {
                    index++;
                    k += formArrayPatternContentLength;
                }
                this.content.formSectionContent[i].name = index.toString(10);
            }
        }
        else {
            throw new Error("For the '" + this.content.name + "' control, the 'content.formSection' value must be an instance of 'FormArray'.");
        }
    };
    /**
     * Removes all elements in the `content.formSectionContent`; therefore
     * all elements are removed in the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     */
    /**
     * Removes all elements in the `content.formSectionContent`; therefore
     * all elements are removed in the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @return {?}
     */
    ContainerControl.prototype.clearFormArray = /**
     * Removes all elements in the `content.formSectionContent`; therefore
     * all elements are removed in the `content.formSection` `FormArray`.
     * The `content.formSection` must be an instance of `FormArray`.
     * @return {?}
     */
    function () {
        console.log('clearFormArray');
        if (this._isFormArray) {
            this.content.containerControlChildren = [];
            this.content.formSectionContent = [];
            ((/** @type {?} */ (this.content.formSection))).clear();
            this._viewContainerRef.clear();
            this._formArrayLength = 0;
            if (this.content.required) {
                /* The `FormArray` always has one element at least. */
                this.addToFormArray();
            }
        }
        else {
            throw new Error("For the '" + this.content.name + "' control, the 'content.formSection' value must be an instance of 'FormArray'.");
        }
    };
    ContainerControl.propDecorators = {
        content: [{ type: Input }],
        _componentHost: [{ type: ViewChild, args: [GetViewContainerDirective, { static: true },] }]
    };
    return ContainerControl;
}(FormFieldControl));
export { ContainerControl };
if (false) {
    /**
     * Input field that contains the content of this class.
     * @type {?}
     */
    ContainerControl.prototype.content;
    /**
     * Returns the helper directive to mark valid insertion point in the `ContainerControl`'s template.
     * @type {?}
     * @protected
     */
    ContainerControl.prototype._componentHost;
    /**
     * Returns the view container of the element that will host the child components in the `ContainerControl`'s template.
     * This field can only be assigned in the `ContainerControl` class.
     * The `content.formSectionContent` and container's `_viewContainerRef` have the same length.
     * @type {?}
     * @protected
     */
    ContainerControl.prototype._viewContainerRef;
    /**
     * Returns the factory for a given component type.
     * This field can only be assigned in the `ContainerControl` class.
     * @type {?}
     * @protected
     */
    ContainerControl.prototype._componentFactoryResolver;
    /**
     * Returns the component created by a `ComponentFactory`.
     * For only internal use by the `createChildComponent` method.
     * @type {?}
     * @protected
     */
    ContainerControl.prototype._cr;
    /**
     * Returns true if the container control is a `FormArray`, that is, the `content.formSection` field
     * represents a `FormArray`; otherwise, false.
     * By default, its value is `false`.
     * @type {?}
     * @private
     */
    ContainerControl.prototype._isFormArray;
    /**
     * If the `content.formSection` represents a `FormArray`, then this field returns
     * a pattern content that is `content.formSectionContent` value; otherwise, returns `undefined`.
     * It is shared among controls.
     * It is used for adding a new element in the `content.formSectionContent`, that is,
     * for adding a new control in the `FormArray`.
     * By default, its value is `[]`.
     * @type {?}
     * @private
     */
    ContainerControl.prototype._formArrayPatternContent;
    /**
     * If the `content.formSection` represents a `FormArray`, then this field returns
     * a pattern value that is a copy of one value that can contain the `content.value` array, and sets all
     * its properties/values of built-in type to `undefined`; otherwise, returns `undefined`.
     * It is used for adding a new element in the `content.formSectionContent`, that is,
     * for adding a new control in the `FormArray`.
     * By default, its value is `undefined`.
     * @type {?}
     * @private
     */
    ContainerControl.prototype._formArrayPatternValue;
    /**
     * Returns the current `FormArray` length.
     * This field has sense only when the `content.formSection` field represents a `FormArray`.
     * By default, its value is `0`.
     * @type {?}
     * @private
     */
    ContainerControl.prototype._formArrayLength;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLmNvbnRyb2wuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90b2NvLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9mb3Jtcy9jb250YWluZXIvY29udGFpbmVyLmNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQU1BLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUE0RCxNQUFNLGVBQWUsQ0FBQztBQUMzRyxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR3RELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBRTFGLE9BQU8sRUFBaUMsZ0JBQWdCLEVBQUUsZ0JBQWdCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7Ozs7QUFLNUgsc0NBeURDOzs7Ozs7Ozs7O0lBaERHLG9EQUFpQzs7Ozs7Ozs7OztJQVlqQyx1Q0FBMEI7Ozs7Ozs7Ozs7OztJQVkxQiw4Q0FBbUM7Ozs7Ozs7O0lBVW5DLHFDQUFvQjs7Ozs7O0FBbUJ4QjtJQUErQyw0Q0FBZ0I7SUF5RjNEOztPQUVHO0lBQ0g7UUFBQSxZQUVJLGlCQUFPLFNBTVY7UUFKRyxLQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUMxQixLQUFJLENBQUMsd0JBQXdCLEdBQUcsRUFBRyxDQUFDO1FBQ3BDLEtBQUksQ0FBQyxzQkFBc0IsR0FBRyxTQUFTLENBQUM7UUFDeEMsS0FBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQzs7SUFDOUIsQ0FBQztJQWxHRDs7O09BR0c7Ozs7OztJQUNXLHNDQUFxQjs7Ozs7SUFBbkM7UUFFSSxPQUFPLElBQUksU0FBUyxDQUFDLEVBQUcsRUFBRSxFQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7OztPQUdHOzs7Ozs7SUFDVyxzQ0FBcUI7Ozs7O0lBQW5DO1FBRUksT0FBTyxJQUFJLFNBQVMsQ0FBQyxFQUFHLEVBQUUsRUFBRyxDQUFDLENBQUM7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QUFDLG1CQUFBLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFhLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNoRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDL0IsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQztZQUUxQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUN6QjtnQkFDSSxzREFBc0Q7Z0JBQ3RELElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQzthQUN6QjtTQUNKO2FBRUQ7WUFDSSxNQUFNLElBQUksS0FBSyxDQUFDLGNBQWEsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLG1GQUFpRixDQUFDLENBQUM7U0FDcEk7SUFDTCxDQUFDOzswQkFubkJBLEtBQUs7aUNBUUwsU0FBUyxTQUFDLHlCQUF5QixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs7SUE0bUIxRCx1QkFBQztDQUFBLEFBM29CRCxDQUErQyxnQkFBZ0IsR0Eyb0I5RDtTQTNvQnFCLGdCQUFnQjs7Ozs7O0lBdUJsQyxtQ0FDaUM7Ozs7OztJQU9qQywwQ0FDb0Q7Ozs7Ozs7O0lBT3BELDZDQUE4Qzs7Ozs7OztJQU05QyxxREFBOEQ7Ozs7Ozs7SUFNOUQsK0JBQWlDOzs7Ozs7OztJQVNqQyx3Q0FBOEI7Ozs7Ozs7Ozs7O0lBVTlCLG9EQUFnRDs7Ozs7Ozs7Ozs7SUFVaEQsa0RBQW9DOzs7Ozs7OztJQU9wQyw0Q0FBaUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogICBDb3B5cmlnaHQgKGMpIDIwMjAgVW5pdmVyc2lkYWQgZGUgUGluYXIgZGVsIFLDrW8gXCJIZXJtYW5vcyBTYcOteiBNb250ZXMgZGUgT2NhXCJcbiAqICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5cbmltcG9ydCB7IElucHV0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ29tcG9uZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQXJyYXksIEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgUGFyYW1zIH0gZnJvbSAnLi4vLi4vY29yZS91dGlscy9oZWxwZXJzJztcbmltcG9ydCB7IEdldFZpZXdDb250YWluZXJEaXJlY3RpdmUgfSBmcm9tICcuLi8uLi9jb3JlL3V0aWxzL2dldC12aWV3LWNvbnRhaW5lci5kaXJlY3RpdmUnO1xuXG5pbXBvcnQgeyBGb3JtU2VjdGlvbiwgRm9ybUZpZWxkQ29udGVudCwgRm9ybUZpZWxkQ29udHJvbCwgY2xvbmVGb3JtQ29udHJvbCwgY2xvbmVGb3JtU2VjdGlvbiB9IGZyb20gJy4uL2Zvcm0tZmllbGQuY29udHJvbCc7XG5cbi8qKlxuICogQSBiYXNlIGludGVyZmFjZSB0aGF0IHJlcHJlc2VudHMgdGhlIGNvbnRlbnQgb2YgYSBgQ29udGFpbmVyQ29udHJvbGAuIFxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbnRhaW5lckNvbnRlbnQgZXh0ZW5kcyBGb3JtRmllbGRDb250ZW50XG57XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBjb250cm9scyB0aGF0IHJlcHJlc2VudHMgdGhlIGBDb250YWluZXJDb250cm9sYCdzIGNoaWxkIGNvbnRyb2xzIHRoYXQgYXJlIFxuICAgICAqIHN0b3JlZCBpbiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gOyB0aGF0IGlzLCBgY29udGVudC5jb250YWluZXJDb250cm9sQ2hpbGRyZW5gIGFuZCBgY29udGVudC5mb3JtU2VjdGlvbmAgXG4gICAgICogaGF2ZSB0aGUgc2FtZSBsZW5ndGguIFxuICAgICAqIEl0IGlzIGFsd2F5cyBzZXQgaW50ZXJuYWxseS4gXG4gICAgICogQnkgZGVmYXVsdCwgaXRzIHZhbHVlIGlzIGBbXWAuIFxuICAgICAqL1xuICAgIGNvbnRhaW5lckNvbnRyb2xDaGlsZHJlbj86IGFueVtdO1xuXG5cblxuXHQvKipcblx0ICogUmV0dXJucyB0aGUgYEZvcm1TZWN0aW9uYCB0aGF0IHRyYWNrcyB0aGUgdmFsdWUgYW5kIHZhbGlkaXR5IHN0YXRlIG9mIHRoZSBpbnRlcm5hbCBcbiAgICAgKiBjaGlsZCBjb250cm9scyB0aGF0IGNvbnRhaW5zIHRoaXMgY29udHJvbC4gXG4gICAgICogSW1wbGVtZW50YXRpb24gbm90ZXM6IFxuICAgICAqICAtIFJlcHJlc2VudHMgdGhlIGBGb3JtR3JvdXBgIG9yIGBGb3JtQXJyYXlgIHRoYXQgY29udGFpbnMgdGhlIGNoaWxkIGNvbnRyb2xzLiBcbiAgICAgKiAgLSBUaGUgYGNvbnRlbnQuY29udGFpbmVyQ29udHJvbENoaWxkcmVuYCBhbmQgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGhhdmUgdGhlIHNhbWUgbGVuZ3RoLiBcbiAgICAgKiAgLSBJdCBtdXN0IGJlIHNwZWNpZmllZDsgb3RoZXJ3aXNlLCBhbiBleGNlcHRpb24gaXMgdGhyb3duLiBcblx0ICovXG4gICAgZm9ybVNlY3Rpb24/OiBGb3JtU2VjdGlvbjtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2YgY29udGVudHMgdGhhdCByZXByZXNlbnRzIHRoZSBgQ29udGFpbmVyQ29udHJvbGAncyBjaGlsZCBjb250cm9scyB0aGF0IGFyZSBcbiAgICAgKiBzdG9yZWQgaW4gdGhlIGBWaWV3Q29udGFpbmVyYDsgdGhhdCBpcywgYGNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50YCBhbmQgY29udGFpbmVyJ3MgYFZpZXdDb250YWluZXJgIFxuICAgICAqIGhhdmUgdGhlIHNhbWUgbGVuZ3RoLiBcbiAgICAgKiBJbXBsZW1lbnRhdGlvbiBub3RlczogXG4gICAgICogIC0gSXQgbXVzdCBiZSBzcGVjaWZpZWQsIGFuZCBtdXN0IGhhdmUgYXQgbGVhc3Qgb25lIGVsZW1lbnQ7IG90aGVyd2lzZSwgYW4gZXhjZXB0aW9uIGlzIHRocm93bi4gXG4gICAgICogIC0gSWYgdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCBmaWVsZCByZXByZXNlbnRzIGEgYEZvcm1BcnJheWAsIHRoZW4gdGhlIGBuYW1lYCBmaWVsZCBcbiAgICAgKiBvZiBhbGwgZWxlbWVudHMgaW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGAgYXJyYXkgcmVwcmVzZW50cyB0aGUgcG9zaXRpb24gXG4gICAgICogaW4gdGhlIGFycmF5IGxpa2Ugc3RyaW5nLiBcbiAgICAgKi9cbiAgICBmb3JtU2VjdGlvbkNvbnRlbnQ/OiBQYXJhbXM8YW55PltdO1xuXG5cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgY29udGFpbmVyIGNvbnRyb2wgaGFzIGEgZHluYW1pYyBsZW5ndGgsIHRoYXQgaXMsIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbmAgZmllbGQgXG4gICAgICogcmVwcmVzZW50cyBhIGBGb3JtQXJyYXlgIGFuZCBpdHMgbGVuZ3RoIGlzIG5vdCBmaXhlZDsgb3RoZXJ3aXNlLCBmYWxzZS4gXG4gICAgICogVGhpcyBmaWVsZCBoYXMgc2Vuc2Ugb25seSB3aGVuIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbmAgZmllbGQgcmVwcmVzZW50cyBhIGBGb3JtQXJyYXlgLiBcbiAgICAgKiBCeSBkZWZhdWx0LCBpdHMgdmFsdWUgaXMgYHRydWVgLiBcbiAgICAgKi9cbiAgICBpc0R5bmFtaWM/OiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogSW4gdGhpcyBjYXNlLCB0aGUgYGxhYmVsPzogc3RyaW5nYCBmaWVsZCBpbmhlcml0ZWQgZnJvbSBgRm9ybUZpZWxkQ29udGVudGAgaXMgaW50ZXJwcmV0ZWQgYXM6IFxuICAgICAqIFJldHVybnMgdGhlIGNvbnRyb2wncyB0aXRsZS4gXG4gICAgICogQnkgZGVmYXVsdCwgaXRzIHZhbHVlIGlzIGAnJ2AuIEVhY2ggY29udHJvbCBzZXRzIGl0cyBvd24gbGFiZWwgKHRpdGxlKS4gXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBJbiB0aGlzIGNhc2UsIHRoZSBgcmVxdWlyZWQ/OiBib29sZWFuYCBmaWVsZCBpbmhlcml0ZWQgZnJvbSBgRm9ybUZpZWxkQ29udGVudGAgaXMgaW50ZXJwcmV0ZWQgYXM6IFxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgY29udGFpbmVyIGNvbnRyb2wgbXVzdCBoYXZlIG9uZSBjaGlsZCBjb250cm9sIGF0IGxlYXN0OyBvdGhlcndpc2UsIGZhbHNlLiBcbiAgICAgKiBUaGlzIGZpZWxkIGhhcyBzZW5zZSBvbmx5IHdoZW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCBmaWVsZCByZXByZXNlbnRzIGEgYEZvcm1BcnJheWAuIFxuICAgICAqIEJ5IGRlZmF1bHQsIGl0cyB2YWx1ZSBpcyBgZmFsc2VgLiBcbiAgICAgKi9cbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBiYXNlIGFic3RyYWN0IGNsYXNzIGZvciBhIGNvbnRyb2wgdGhhdCBjb250YWlucyBvbmUgb3IgbW9yZSBjb250cm9scy4gXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb250YWluZXJDb250cm9sIGV4dGVuZHMgRm9ybUZpZWxkQ29udHJvbFxue1xuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBgRm9ybUdyb3VwYCBieSBkZWZhdWx0LiBcbiAgICAgKiBJdHMgdmFsdWUgaXMgZW1wdHkgb2JqZWN0LCBhbmQgZG9lcyBub3QgaGF2ZSB2YWxpZGF0b3JzLiBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGdldEZvcm1Hcm91cEJ5RGVmYXVsdCgpOiBGb3JtR3JvdXBcbiAgICB7XG4gICAgICAgIHJldHVybiBuZXcgRm9ybUdyb3VwKHsgfSwgWyBdKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgYEZvcm1BcnJheWAgYnkgZGVmYXVsdC4gXG4gICAgICogSXRzIHZhbHVlIGlzIGVtcHR5IGFycmF5LCBhbmQgZG9lcyBub3QgaGF2ZSB2YWxpZGF0b3JzLiBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGdldEZvcm1BcnJheUJ5RGVmYXVsdCgpOiBGb3JtQXJyYXlcbiAgICB7XG4gICAgICAgIHJldHVybiBuZXcgRm9ybUFycmF5KFsgXSwgWyBdKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnB1dCBmaWVsZCB0aGF0IGNvbnRhaW5zIHRoZSBjb250ZW50IG9mIHRoaXMgY2xhc3MuIFxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGNvbnRlbnQ6IENvbnRhaW5lckNvbnRlbnQ7XG5cblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaGVscGVyIGRpcmVjdGl2ZSB0byBtYXJrIHZhbGlkIGluc2VydGlvbiBwb2ludCBpbiB0aGUgYENvbnRhaW5lckNvbnRyb2xgJ3MgdGVtcGxhdGUuIFxuICAgICAqL1xuICAgIEBWaWV3Q2hpbGQoR2V0Vmlld0NvbnRhaW5lckRpcmVjdGl2ZSwgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBwcm90ZWN0ZWQgX2NvbXBvbmVudEhvc3Q6IEdldFZpZXdDb250YWluZXJEaXJlY3RpdmU7XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB2aWV3IGNvbnRhaW5lciBvZiB0aGUgZWxlbWVudCB0aGF0IHdpbGwgaG9zdCB0aGUgY2hpbGQgY29tcG9uZW50cyBpbiB0aGUgYENvbnRhaW5lckNvbnRyb2xgJ3MgdGVtcGxhdGUuIFxuICAgICAqIFRoaXMgZmllbGQgY2FuIG9ubHkgYmUgYXNzaWduZWQgaW4gdGhlIGBDb250YWluZXJDb250cm9sYCBjbGFzcy4gXG4gICAgICogVGhlIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGAgYW5kIGNvbnRhaW5lcidzIGBfdmlld0NvbnRhaW5lclJlZmAgaGF2ZSB0aGUgc2FtZSBsZW5ndGguIFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBfdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZjtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGZhY3RvcnkgZm9yIGEgZ2l2ZW4gY29tcG9uZW50IHR5cGUuIFxuICAgICAqIFRoaXMgZmllbGQgY2FuIG9ubHkgYmUgYXNzaWduZWQgaW4gdGhlIGBDb250YWluZXJDb250cm9sYCBjbGFzcy4gXG4gICAgICovXG4gICAgcHJvdGVjdGVkIF9jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGNvbXBvbmVudCBjcmVhdGVkIGJ5IGEgYENvbXBvbmVudEZhY3RvcnlgLiBcbiAgICAgKiBGb3Igb25seSBpbnRlcm5hbCB1c2UgYnkgdGhlIGBjcmVhdGVDaGlsZENvbXBvbmVudGAgbWV0aG9kLiBcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgX2NyOiBDb21wb25lbnRSZWY8YW55PjtcblxuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbnRhaW5lciBjb250cm9sIGlzIGEgYEZvcm1BcnJheWAsIHRoYXQgaXMsIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbmAgZmllbGQgXG4gICAgICogcmVwcmVzZW50cyBhIGBGb3JtQXJyYXlgOyBvdGhlcndpc2UsIGZhbHNlLiBcbiAgICAgKiBCeSBkZWZhdWx0LCBpdHMgdmFsdWUgaXMgYGZhbHNlYC4gXG4gICAgICovXG4gICAgcHJpdmF0ZSBfaXNGb3JtQXJyYXk6IGJvb2xlYW47XG5cbiAgICAvKipcbiAgICAgKiBJZiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIHJlcHJlc2VudHMgYSBgRm9ybUFycmF5YCwgdGhlbiB0aGlzIGZpZWxkIHJldHVybnMgXG4gICAgICogYSBwYXR0ZXJuIGNvbnRlbnQgdGhhdCBpcyBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgIHZhbHVlOyBvdGhlcndpc2UsIHJldHVybnMgYHVuZGVmaW5lZGAuIFxuICAgICAqIEl0IGlzIHNoYXJlZCBhbW9uZyBjb250cm9scy4gXG4gICAgICogSXQgaXMgdXNlZCBmb3IgYWRkaW5nIGEgbmV3IGVsZW1lbnQgaW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGAsIHRoYXQgaXMsIFxuICAgICAqIGZvciBhZGRpbmcgYSBuZXcgY29udHJvbCBpbiB0aGUgYEZvcm1BcnJheWAuIFxuICAgICAqIEJ5IGRlZmF1bHQsIGl0cyB2YWx1ZSBpcyBgW11gLiBcbiAgICAgKi9cbiAgICBwcml2YXRlIF9mb3JtQXJyYXlQYXR0ZXJuQ29udGVudDogUGFyYW1zPGFueT5bXTtcblxuICAgIC8qKlxuICAgICAqIElmIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbmAgcmVwcmVzZW50cyBhIGBGb3JtQXJyYXlgLCB0aGVuIHRoaXMgZmllbGQgcmV0dXJucyBcbiAgICAgKiBhIHBhdHRlcm4gdmFsdWUgdGhhdCBpcyBhIGNvcHkgb2Ygb25lIHZhbHVlIHRoYXQgY2FuIGNvbnRhaW4gdGhlIGBjb250ZW50LnZhbHVlYCBhcnJheSwgYW5kIHNldHMgYWxsIFxuICAgICAqIGl0cyBwcm9wZXJ0aWVzL3ZhbHVlcyBvZiBidWlsdC1pbiB0eXBlIHRvIGB1bmRlZmluZWRgOyBvdGhlcndpc2UsIHJldHVybnMgYHVuZGVmaW5lZGAuIFxuICAgICAqIEl0IGlzIHVzZWQgZm9yIGFkZGluZyBhIG5ldyBlbGVtZW50IGluIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgLCB0aGF0IGlzLCBcbiAgICAgKiBmb3IgYWRkaW5nIGEgbmV3IGNvbnRyb2wgaW4gdGhlIGBGb3JtQXJyYXlgLiBcbiAgICAgKiBCeSBkZWZhdWx0LCBpdHMgdmFsdWUgaXMgYHVuZGVmaW5lZGAuIFxuICAgICAqL1xuICAgIHByaXZhdGUgX2Zvcm1BcnJheVBhdHRlcm5WYWx1ZTogYW55O1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgY3VycmVudCBgRm9ybUFycmF5YCBsZW5ndGguIFxuICAgICAqIFRoaXMgZmllbGQgaGFzIHNlbnNlIG9ubHkgd2hlbiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGZpZWxkIHJlcHJlc2VudHMgYSBgRm9ybUFycmF5YC4gXG4gICAgICogQnkgZGVmYXVsdCwgaXRzIHZhbHVlIGlzIGAwYC4gXG4gICAgICovXG4gICAgcHJpdmF0ZSBfZm9ybUFycmF5TGVuZ3RoOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIGEgbmV3IGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuIFxuICAgICAqL1xuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpXG4gICAge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuX2lzRm9ybUFycmF5ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2Zvcm1BcnJheVBhdHRlcm5Db250ZW50ID0gWyBdO1xuICAgICAgICB0aGlzLl9mb3JtQXJyYXlQYXR0ZXJuVmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX2Zvcm1BcnJheUxlbmd0aCA9IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgdGhlIGBjb250ZW50YCBpbnB1dCBwcm9wZXJ0eS4gXG4gICAgICogQHBhcmFtIGxhYmVsIFRoZSBkZWZhdWx0IGxhYmVsIHRvIHVzZS4gSXQgaXMgdXNlZCBpZiB0aGUgYGNvbnRlbnQubGFiZWxgIGlzIG5vdCBzcGVjaWZpZWQuIFxuICAgICAqIEBwYXJhbSBwbGFjZWhvbGRlciBJdCBpcyBOT1QgdXNlZCBoZXJlLiBGaXggdGhhdC4gXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGluaXQobGFiZWw6IHN0cmluZywgcGxhY2Vob2xkZXI6IHN0cmluZyA9ICcnKTogdm9pZFxuICAgIHtcbiAgICAgICAgLyogU2V0cyB0aGUgZGVmYXVsdCB2YWx1ZXMuICovXG5cbiAgICAgICAgc3VwZXIuaW5pdChsYWJlbCwgcGxhY2Vob2xkZXIpO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQuZm9ybVNlY3Rpb24gPT0gdW5kZWZpbmVkKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZvciB0aGUgJyR7IHRoaXMuY29udGVudC5uYW1lIH0nIGNvbnRyb2wsIHRoZSAnY29udGVudC5mb3JtU2VjdGlvbicgdmFsdWUgY2FuIG5vdCBiZSB1bmRlZmluZWQ7IGl0IG11c3QgYmUgYSAnRm9ybUdyb3VwJyBvciAnRm9ybUFycmF5JyB2YWx1ZS5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgodGhpcy5jb250ZW50LmZvcm1TZWN0aW9uQ29udGVudCA9PSB1bmRlZmluZWQpIHx8ICh0aGlzLmNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50Lmxlbmd0aCA9PSAwKSlcbiAgICAgICAge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGb3IgdGhlICckeyB0aGlzLmNvbnRlbnQubmFtZSB9JyBjb250cm9sLCB0aGUgJ2NvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50JyBhcnJheSBjYW4gbm90IGJlIHVuZGVmaW5lZCwgYW5kIG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgZWxlbWVudC5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2lzRm9ybUFycmF5ID0gdGhpcy5jb250ZW50LmZvcm1TZWN0aW9uIGluc3RhbmNlb2YgRm9ybUFycmF5O1xuICAgICAgICBpZiAodGhpcy5faXNGb3JtQXJyYXkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnQuaXNEeW5hbWljID09IHVuZGVmaW5lZCkgdGhpcy5jb250ZW50LmlzRHluYW1pYyA9IHRydWU7ICAvKiBCeSBkZWZhdWx0LCBpdHMgdmFsdWUgaXMgYHRydWVgLiAqL1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudC5yZXF1aXJlZCA9PSB1bmRlZmluZWQpIHRoaXMuY29udGVudC5yZXF1aXJlZCA9IGZhbHNlOyAgIC8qIEJ5IGRlZmF1bHQsIGl0cyB2YWx1ZSBpcyBgZmFsc2VgLiAqL1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudC5pc0R5bmFtaWMgIT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoYEZvciB0aGUgJyR7IHRoaXMuY29udGVudC5uYW1lIH0nIGNvbnRyb2wsIHRoZSAnY29udGVudC5pc0R5bmFtaWMnIHZhbHVlIG11c3Qgbm90IGV4aXN0IGJlY2F1c2UgdGhlICdjb250ZW50LmZvcm1TZWN0aW9uJyB2YWx1ZSBpcyBhICdGb3JtR3JvdXAnLmApO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudC5yZXF1aXJlZCAhPSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcihgRm9yIHRoZSAnJHsgdGhpcy5jb250ZW50Lm5hbWUgfScgY29udHJvbCwgdGhlICdjb250ZW50LnJlcXVpcmVkJyB2YWx1ZSBtdXN0IG5vdCBleGlzdCBiZWNhdXNlIHRoZSAnY29udGVudC5mb3JtU2VjdGlvbicgdmFsdWUgaXMgYSAnRm9ybUdyb3VwJy5gKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnQudmFsdWUgIT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoYEZvciB0aGUgJyR7IHRoaXMuY29udGVudC5uYW1lIH0nIGNvbnRyb2wsIHRoZSAnY29udGVudC52YWx1ZScgdmFsdWUgbXVzdCBub3QgZXhpc3QgYmVjYXVzZSB0aGUgJ2NvbnRlbnQuZm9ybVNlY3Rpb24nIHZhbHVlIGlzIGEgJ0Zvcm1Hcm91cCcuYCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl92aWV3Q29udGFpbmVyUmVmID0gdGhpcy5fY29tcG9uZW50SG9zdC52aWV3Q29udGFpbmVyUmVmO1xuICAgICAgICB0aGlzLl9jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIgPSB0aGlzLl9jb21wb25lbnRIb3N0LmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjtcblxuICAgICAgICAvKiBJbml0aWFsaXplcyB0aGUgYGNvbnRlbnQuY29udGFpbmVyQ29udHJvbENoaWxkcmVuYC4gKi9cbiAgICAgICAgdGhpcy5jb250ZW50LmNvbnRhaW5lckNvbnRyb2xDaGlsZHJlbiA9IFsgXTtcblxuICAgICAgICBpZiAodGhpcy5faXNGb3JtQXJyYXkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnQudmFsdWUgPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICckeyB0aGlzLmNvbnRlbnQubmFtZSB9JyBjb250cm9sIGlzIGNvbnN0cnVjdGVkIGR5bmFtaWNhbGx5IHVzaW5nICdGb3JtQXJyYXknLiBJdHMgJ2NvbnRlbnQudmFsdWUnIGFycmF5IGNhbiBub3QgYmUgdW5kZWZpbmVkLmApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKHRoaXMuY29udGVudC52YWx1ZS5sZW5ndGggPT0gMCkgJiYgKCF0aGlzLmNvbnRlbnQuaXNEeW5hbWljKSAmJiAodGhpcy5jb250ZW50LnJlcXVpcmVkKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAnJHsgdGhpcy5jb250ZW50Lm5hbWUgfScgY29udHJvbCBoYXMgbm90IHNlbnNlIGJlY2F1c2UgaXRzICdjb250ZW50LnZhbHVlJyBhcnJheSBsZW5ndGggaXMgemVybywgYW5kIGl0cyAnY29udGVudC5pc0R5bmFtaWMnIHZhbHVlIGlzIGZhbHNlLCBhbmQgaXRzICdjb250ZW50LnJlcXVpcmVkJyB2YWx1ZSBpcyB0cnVlLmApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmluaXRGb3JtU2VjdGlvbkNvbnRlbnRUb0Zvcm1BcnJheSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgLyogU2V0cyB0aGUgcGFyZW50IGNvbnRyb2wgdG8gaXRzIGNoaWxkcmVuLiAqL1xuICAgICAgICAgICAgdGhpcy5zZXRQYXJlbnRUb0NoaWxkcmVuKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBsZXQgdGVtcDogc3RyaW5nID0gKGlzQWJicmV2aWF0aW9uKSA/IHRoaXMuY29udGVudC5sYWJlbCA6IHRoaXMuY29udGVudC5sYWJlbC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAvLyB0aGlzLnZhbGlkYXRpb25FcnJvcl9yZXF1aXJlZCA9IGBUaGUgJHsgdGVtcCB9IGNhbiBub3QgYmUgZW1wdHkuYDtcblxuICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKiogYG1hdC1mb3JtLWZpZWxkYCBwcm9wZXJ0aWVzLiAqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICAgICAgLy8gaWYgKHRoaXMuY29udGVudC5hcHBlYXJhbmNlID09IHVuZGVmaW5lZCkgdGhpcy5jb250ZW50LmFwcGVhcmFuY2UgPSBUZXh0SW5wdXRBcHBlYXJhbmNlLnN0YW5kYXJkO1xuXG4gICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBgbWF0LWhpbnRgIHByb3BlcnRpZXMuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgICAgICAvLyBpZiAoYWx3YXlzSGludCAmJiAodGhpcy5jb250ZW50LnN0YXJ0SGludCA9PSB1bmRlZmluZWQpICYmICh0aGlzLmNvbnRlbnQuZW5kSGludCA9PSB1bmRlZmluZWQpKVxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgICB0aGlzLmNvbnRlbnQuc3RhcnRIaW50ID0gbmV3IEhpbnRWYWx1ZShIaW50UG9zaXRpb24uc3RhcnQsIGBXcml0ZSBhIHZhbGlkICR7IHRlbXAgfS5gKTtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBlbHNlXG4gICAgICAgIC8vIHtcbiAgICAgICAgLy8gICAgIGlmICh0aGlzLmNvbnRlbnQuc3RhcnRIaW50ICE9IHVuZGVmaW5lZCkgdGhpcy5jb250ZW50LnN0YXJ0SGludC5zZXREZWZhdWx0VmFsdWVJZlVuZGVmaW5lZF9zZXRQb3NpdGlvbihIaW50UG9zaXRpb24uc3RhcnQpO1xuICAgICAgICAvLyAgICAgaWYgKHRoaXMuY29udGVudC5lbmRIaW50ICE9IHVuZGVmaW5lZCkgdGhpcy5jb250ZW50LmVuZEhpbnQuc2V0RGVmYXVsdFZhbHVlSWZVbmRlZmluZWRfc2V0UG9zaXRpb24oSGludFBvc2l0aW9uLmVuZCk7XG4gICAgICAgIC8vIH1cblxuICAgICAgICAvKiBBZGRzIHRoaXMgY29udHJvbCBhcyBhIGNoaWxkIHRvIHRoZSBgY29udGVudC5wYXJlbnRGb3JtU2VjdGlvbmAuIFxuICAgICAgICBJdCBtdXN0IGJlIGNhbGxlZCBhdCB0aGUgZW5kIGJlZm9yZSBjYWxsaW5nIGBjcmVhdGVDaGlsZENvbXBvbmVudHNgIG1ldGhvZC4gKi9cbiAgICAgICAgaWYgKHRoaXMuY29udGVudC5wYXJlbnRGb3JtU2VjdGlvbiAhPSB1bmRlZmluZWQpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuYWRkQXNDaGlsZENvbnRyb2wodGhpcywgdGhpcy5jb250ZW50LmZvcm1TZWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIENyZWF0ZXMgdGhlIGNoaWxkIGNvbXBvbmVudHMuICovXG4gICAgICAgIHRoaXMuY3JlYXRlQ2hpbGRDb21wb25lbnRzKHRoaXMuY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgIGFycmF5IGNvcnJlY3RseSBkZXBlbmRpbmcgb24gdGhlIGBjb250ZW50LnZhbHVlYC4gXG4gICAgICogSW4gdGhpcyBjYXNlLCBgY29udGVudC52YWx1ZWAgaXMgYW4gYXJyYXkuIEZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIGBjb250ZW50LnZhbHVlYCwgYSBjbG9uaW5nIFxuICAgICAqIGlzIGRvbmUgdG8gdGhlIGBfZm9ybUFycmF5UGF0dGVybkNvbnRlbnRgIGFycmF5LCBhbmQgaXQgaXMgYWRkZWQgaW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGA7IFxuICAgICAqIHRoZXJlZm9yZSBvbmUgZWxlbWVudCBpcyBhZGRlZCBpbiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGBGb3JtQXJyYXlgLiBcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgaW5pdEZvcm1TZWN0aW9uQ29udGVudFRvRm9ybUFycmF5KCk6IHZvaWRcbiAgICB7XG4gICAgICAgIC8qIEF0IHRoaXMgcG9pbnQsIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGAgaGFzIGF0IGxlYXN0IG9uZSBlbGVtZW50LiAqL1xuXG4gICAgICAgIC8qIFNhdmVzIHRoZSBwYXR0ZXJuIGNvbnRlbnQsIHRoYXQgaXMsIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGAuIFxuICAgICAgICBJdCBpcyBzaGFyZWQgYW1vbmcgY29udHJvbHMuICovXG4gICAgICAgIHRoaXMuX2Zvcm1BcnJheVBhdHRlcm5Db250ZW50ID0gdGhpcy5jb250ZW50LmZvcm1TZWN0aW9uQ29udGVudDtcbiAgICAgICAgLyogVGhlIGBGb3JtQXJyYXlgIGlzIGVtcHR5IGluaXRpYWxseS4gKi9cbiAgICAgICAgdGhpcy5jb250ZW50LmZvcm1TZWN0aW9uQ29udGVudCA9IFsgXTtcblxuICAgICAgICAvKiBTYXZlcyB0aGUgcGF0dGVybiB2YWx1ZSwgdGhhdCBpcywgY3JlYXRlcyB0aGUgcGF0dGVybiB2YWx1ZSBmb2xsb3dpbmcgdGhlIGBfZm9ybUFycmF5UGF0dGVybkNvbnRlbnRgIHN0cnVjdHVyZS4gXG4gICAgICAgIFRoZSByZXN1bHQgdmFsdWUgcmVwcmVzZW50cyBhIGNvcHkgb2Ygb25lIHZhbHVlIHRoYXQgY2FuIGNvbnRhaW4gdGhlIGBjb250ZW50LnZhbHVlYCBhcnJheSwgYW5kIFxuICAgICAgICBzZXRzIGFsbCBpdHMgcHJvcGVydGllcy92YWx1ZXMgb2YgYnVpbHQtaW4gdHlwZSB0byBgdW5kZWZpbmVkYC4gXG4gICAgICAgIEl0IGRvZXMgbm90IGNsb25lIGEgdmFsdWUgZnJvbSB0aGUgYGNvbnRlbnQudmFsdWVgIGFycmF5IGJlY2F1c2UgdGhlIGFycmF5IGNhbiBiZSBlbXB0eS4gXG4gICAgICAgIEl0IGNyZWF0ZXMgaW4gZGVlcCB1bnRpbCB0aGUgbmV4dCBgRm9ybUFycmF5YCwgdGhlbiB0aGUgbmV4dCBgRm9ybUFycmF5YCBjcmVhdGVzIGluIGRlZXAgdW50aWwgdGhlIG5leHQgYEZvcm1BcnJheWAsIGFuZCBzbyBvbi4gXG4gICAgICAgIEl0IGlzIHRoZSBmaXJzdCB0aW1lIHRoYXQgdGhlIGBfZm9ybUFycmF5UGF0dGVybkNvbnRlbnRgIGlzIHRyYXZlbGxlZCwgdGhlcmVmb3JlIHRoZSBgY3JlYXRlVmFsdWVUb1VuZGVmaW5lZGAgbWV0aG9kIGRvZXMgdmVyaWZpY2F0aW9ucy4gKi9cbiAgICAgICAgdGhpcy5fZm9ybUFycmF5UGF0dGVyblZhbHVlID0gdGhpcy5jcmVhdGVWYWx1ZVRvVW5kZWZpbmVkKCk7XG5cbiAgICAgICAgLyogSWYgdGhlIGBjb250ZW50LnJlcXVpcmVkYCBmaWVsZCBpcyB0cnVlLCB0aGVuIHRoZSBjb250YWluZXIgY29udHJvbCBtdXN0IGhhdmUgb25lIGNoaWxkIGNvbnRyb2wgYXQgbGVhc3QuICovXG4gICAgICAgIGlmICgodGhpcy5jb250ZW50LnJlcXVpcmVkKSAmJiAodGhpcy5jb250ZW50LnZhbHVlLmxlbmd0aCA9PSAwKSlcbiAgICAgICAge1xuICAgICAgICAgICAgLyogSXQgY2FuIHB1c2ggdGhlIGBfZm9ybUFycmF5UGF0dGVyblZhbHVlYCBhbmQgZG9lcyBub3QgcHVzaCBpdHMgY2xvbmUgYmVjYXVzZSBcbiAgICAgICAgICAgIGJvdGggdmFsdWVzIGhhdmUgdGhlIHNhbWUgcHJvcGVydGllcyBhbmQgdGhlcmUgaXMgbm90IHByb2JsZW0uICovXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQudmFsdWVbMF0gPSB0aGlzLl9mb3JtQXJyYXlQYXR0ZXJuVmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICAvKiBUaGUgYEZvcm1BcnJheWAgd2lsbCBjb250YWluIG9uZSBlbGVtZW50IGZvciBlYWNoIGVsZW1lbnQgaW4gdGhlIGBjb250ZW50LnZhbHVlYC4gKi9cbiAgICAgICAgZm9yKGxldCB2YWwgb2YgdGhpcy5jb250ZW50LnZhbHVlKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLl9pbml0RWxlbUZvcm1TZWN0aW9uQ29udGVudFRvRm9ybUFycmF5KHZhbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBwYXJlbnQgY29udHJvbCB0byBpdHMgY2hpbGRyZW4uIFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBzZXRQYXJlbnRUb0NoaWxkcmVuKCk6IHZvaWRcbiAgICB7XG4gICAgICAgIHRoaXMuY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnQuZm9yRWFjaCh0aGlzLnNldFBhcmVudFRvQ2hpbGQsIHRoaXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHBhcmVudCBjb250cm9sIHRvIG9uZSBjaGlsZC4gXG4gICAgICogQHBhcmFtIGZmYyBUaGUgY2hpbGQgdG8gc2V0IHRoZSBwYXJlbnQgY29udHJvbC4gXG4gICAgICovXG4gICAgcHJvdGVjdGVkIHNldFBhcmVudFRvQ2hpbGQoZmZjOiBGb3JtRmllbGRDb250ZW50KTogdm9pZFxuICAgIHtcbiAgICAgICAgLyogU2V0cyB0aGUgcGFyZW50IGBDb250YWluZXJDb250cm9sYCB0byBpdHMgY2hpbGRyZW4uICovXG4gICAgICAgIGZmYy5wYXJlbnRDb250YWluZXJDb250cm9sID0gdGhpcztcblxuICAgICAgICAvKiBTZXRzIHRoZSBwYXJlbnQgYEZvcm1TZWN0aW9uYCB0byBpdHMgY2hpbGRyZW4gaWYgdGhleSBoYXZlIGdvdCBub3RoaW5nLiAqL1xuICAgICAgICBmZmMucGFyZW50Rm9ybVNlY3Rpb24gPSB0aGlzLmNvbnRlbnQuZm9ybVNlY3Rpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIG5ldyB2YWx1ZSB0aGF0IGlzIGNyZWF0ZWQgZm9sbG93aW5nIHRoZSBgX2Zvcm1BcnJheVBhdHRlcm5Db250ZW50YCBzdHJ1Y3R1cmUuIFxuICAgICAqIEl0IGFsc28gc2V0cyBhbGwgaXRzIHByb3BlcnRpZXMvdmFsdWVzIG9mIGJ1aWx0LWluIHR5cGUgdG8gYHVuZGVmaW5lZGAuIFxuICAgICAqIEl0IGNyZWF0ZXMgdGhlIHZhbHVlIHNtYXJ0bHkgZGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mIGNvbnRlbnQuIFxuICAgICAqIEl0IGNyZWF0ZXMgaW4gZGVlcCB1bnRpbCB0aGUgbmV4dCBgRm9ybUFycmF5YCwgdGhlbiB0aGUgbmV4dCBgRm9ybUFycmF5YCBjcmVhdGVzIGluIGRlZXAgdW50aWwgdGhlIG5leHQgYEZvcm1BcnJheWAsIGFuZCBzbyBvbi4gXG4gICAgICogSXQgaXMgdGhlIGZpcnN0IHRpbWUgdGhhdCB0aGUgYF9mb3JtQXJyYXlQYXR0ZXJuQ29udGVudGAgaXMgdHJhdmVsbGVkLCB0aGVyZWZvcmUgdGhlIGBjcmVhdGVWYWx1ZVRvVW5kZWZpbmVkYCBtZXRob2QgZG9lcyB2ZXJpZmljYXRpb25zLiBcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgY3JlYXRlVmFsdWVUb1VuZGVmaW5lZCgpOiBhbnlcbiAgICB7XG4gICAgICAgIGxldCByZXN1bHQ6IGFueTtcbiAgICAgICAgLyogVGhlIGBfZm9ybUFycmF5UGF0dGVybkNvbnRlbnRgIGFycmF5IGNhbiBoYXZlIG9uZSBlbGVtZW50IG9ubHkgd2l0aCB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGZpZWxkLiAqL1xuICAgICAgICBsZXQgYWxyZWFkeUhhc0Zvcm1TZWN0aW9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAgICAgZm9yKGxldCBjb250ZW50IG9mIHRoaXMuX2Zvcm1BcnJheVBhdHRlcm5Db250ZW50KVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoY29udGVudC5mb3JtQ29udHJvbClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoYWxyZWFkeUhhc0Zvcm1TZWN0aW9uKSB0aHJvdyBuZXcgRXJyb3IoYEZvciB0aGUgJyR7IHRoaXMuY29udGVudC5uYW1lIH0nIGNvbnRyb2wsIHRoZSAnY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnQnIGFycmF5IGNhbiBoYXZlIG9uZSBlbGVtZW50IG9ubHkgd2l0aCB0aGUgJ2NvbnRlbnQuZm9ybUNvbnRyb2wnIG9yICdjb250ZW50LmZvcm1TZWN0aW9uJyBmaWVsZC5gKTtcblxuICAgICAgICAgICAgICAgIGFscmVhZHlIYXNGb3JtU2VjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29udGVudC5mb3JtU2VjdGlvbilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoYWxyZWFkeUhhc0Zvcm1TZWN0aW9uKSB0aHJvdyBuZXcgRXJyb3IoYEZvciB0aGUgJyR7IHRoaXMuY29udGVudC5uYW1lIH0nIGNvbnRyb2wsIHRoZSAnY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnQnIGFycmF5IGNhbiBoYXZlIG9uZSBlbGVtZW50IG9ubHkgd2l0aCB0aGUgJ2NvbnRlbnQuZm9ybUNvbnRyb2wnIG9yICdjb250ZW50LmZvcm1TZWN0aW9uJyBmaWVsZC5gKTtcblxuICAgICAgICAgICAgICAgIGFscmVhZHlIYXNGb3JtU2VjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5fY3JlYXRlVmFsdWVUb1VuZGVmaW5lZChjb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qIFRoZSByZXN0IG9mIGBjb250ZW50YHMgZG8gbm90IGNvbnRhaW4gYSBgdmFsdWVgIGZpZWxkIG9mIGludGVyZXN0LiAqL1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFhbHJlYWR5SGFzRm9ybVNlY3Rpb24pIHRocm93IG5ldyBFcnJvcihgRm9yIHRoZSAnJHsgdGhpcy5jb250ZW50Lm5hbWUgfScgY29udHJvbCwgdGhlICdjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudCcgYXJyYXkgbXVzdCBoYXZlIG9uZSBlbGVtZW50IG9ubHkgYW1vbmcgYWxsIHdpdGggdGhlICdjb250ZW50LmZvcm1Db250cm9sJyBvciAnY29udGVudC5mb3JtU2VjdGlvbicgZmllbGQuYCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfY3JlYXRlVmFsdWVUb1VuZGVmaW5lZCh0YXJnZXQ6IFBhcmFtczxhbnk+KTogYW55XG4gICAge1xuICAgICAgICBpZiAodGFyZ2V0LmZvcm1TZWN0aW9uIGluc3RhbmNlb2YgRm9ybUFycmF5KVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gWyBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgbGV0IHJlc3VsdDogYW55ID0geyB9O1xuXG4gICAgICAgICAgICBmb3IobGV0IGNvbnRlbnQgb2YgdGFyZ2V0LmZvcm1TZWN0aW9uQ29udGVudClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiAoY29udGVudC5mb3JtQ29udHJvbCkgcmVzdWx0W2NvbnRlbnQubmFtZV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udGVudC5mb3JtU2VjdGlvbikgcmVzdWx0W2NvbnRlbnQubmFtZV0gPSB0aGlzLl9jcmVhdGVWYWx1ZVRvVW5kZWZpbmVkKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIC8qIFRoZSByZXN0IG9mIGBjb250ZW50YHMgZG8gbm90IGNvbnRhaW4gYSBgdmFsdWVgIGZpZWxkIG9mIGludGVyZXN0LiAqL1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgYW5kIHJldHVybnMgYSBjbG9uZSBvZiB0aGUgYF9mb3JtQXJyYXlQYXR0ZXJuQ29udGVudGAgYXJyYXkgY29ycmVjdGx5IFxuICAgICAqIGRlcGVuZGluZyBvbiB0aGUgc3BlY2lmaWVkIGB2YWx1ZWAuIFxuICAgICAqIFRoaXMgY2xvbmUgaXMgYWxzbyBhZGRlZCBpbiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50YCBhcnJheS4gXG4gICAgICogQHBhcmFtIHZhbHVlIFRoZSBpbml0aWFsIGB2YWx1ZWAgZmllbGQgb2YgZWFjaCBjb250ZW50IHJlcHJlc2VudGluZyBhIGBGb3JtQ29udHJvbGAuIFxuICAgICAqL1xuICAgIHByaXZhdGUgX2luaXRFbGVtRm9ybVNlY3Rpb25Db250ZW50VG9Gb3JtQXJyYXkodmFsdWU6IGFueSk6IFBhcmFtczxhbnk+W11cbiAgICB7XG4gICAgICAgIC8qIFRoZSBjb250ZW50IGFycmF5IGNsb25lZC4gKi9cbiAgICAgICAgbGV0IHJlc3VsdDogUGFyYW1zPGFueT5bXSA9IFsgXTtcbiAgICAgICAgbGV0IHJlZkNvbnRlbnQ6IFBhcmFtczxhbnk+O1xuXG4gICAgICAgIGZvcihsZXQgY29udGVudCBvZiB0aGlzLl9mb3JtQXJyYXlQYXR0ZXJuQ29udGVudClcbiAgICAgICAge1xuICAgICAgICAgICAgLyogQ2xvbmVzIGluIGRlZXAgdW50aWwgdGhlIG5leHQgYEZvcm1BcnJheWAsIHRoZW4gdGhlIG5leHQgYEZvcm1BcnJheWAgY2xvbmVzIGluIGRlZXAgdW50aWwgdGhlIG5leHQgYEZvcm1BcnJheWAsIGFuZCBzbyBvbi4gKi9cbiAgICAgICAgICAgIGlmIChjb250ZW50LmZvcm1TZWN0aW9uIGluc3RhbmNlb2YgRm9ybUFycmF5KVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8qIFRoaXMgYGNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50YCB3aWxsIG5vdCBiZSBjbG9uZWQgYmVjYXVzZSBpdCBiZWxvbmdzIHRvIGEgYEZvcm1BcnJheWAgYW5kIGl0IHdpbGwgYmUgY2xvbmVkIHdoZW4gdGhlIGBGb3JtQXJyYXlgIGlzIGFuYWx5emVkIGluIHRoZSBgQ29udGFpbmVyQ29udHJvbGAgY2xhc3MuICovXG4gICAgICAgICAgICAgICAgcmVmQ29udGVudCA9IHRoaXMuX2Nsb25lQ29udGVudChjb250ZW50LCB1bmRlZmluZWQvKiBJdCBpcyBub3QgdXNlZCBpbiB0aGlzIGNhc2UuICovLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmVmQ29udGVudC52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJlZkNvbnRlbnQgPSB0aGlzLl9jbG9uZUNvbnRlbnQoY29udGVudCwgdmFsdWUsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBTZXRzIHRoZSBwYXJlbnQgY29udHJvbCB0byBpdHMgY2hpbGQuICovXG4gICAgICAgICAgICB0aGlzLnNldFBhcmVudFRvQ2hpbGQocmVmQ29udGVudCk7XG5cbiAgICAgICAgICAgIC8qIE92ZXJ3cml0ZXMgc29tZSBwcm9wZXJ0aWVzIGZvciB0aGUgY29udGVudCBjbG9uZWQuICovXG4gICAgICAgICAgICByZWZDb250ZW50Lm5hbWUgPSB0aGlzLl9mb3JtQXJyYXlMZW5ndGgudG9TdHJpbmcoMTApOyAgLyogVGhlIGVsZW1lbnQgaXMgYWRkZWQgaW4gdGhlIGBGb3JtQXJyYXlgIGFmdGVyIHRoZSBsYXN0IHBvc2l0aW9uLiAqL1xuICAgICAgICAgICAgLyogT3ZlcndyaXRlcyBzb21lIHByb3BlcnRpZXMgZm9yIHRoZSBjb250ZW50IGNsb25lZCBpZiBpdCBjb250YWlucyB0aGUgYGNvbnRlbnQuZm9ybUNvbnRyb2xgIG9yIGBjb250ZW50LmZvcm1TZWN0aW9uYCBmaWVsZC4gKi9cbiAgICAgICAgICAgIGlmICgoY29udGVudC5mb3JtQ29udHJvbCkgfHwgKGNvbnRlbnQuZm9ybVNlY3Rpb24pKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8vIHJlZkNvbnRlbnQubGFiZWwgPSAoKHJlZkNvbnRlbnQubGFiZWwgPT0gdW5kZWZpbmVkKSA/IChyZWZDb250ZW50Lm5hbWUpIDogKHJlZkNvbnRlbnQubGFiZWwgKyByZWZDb250ZW50Lm5hbWUpKTtcbiAgICAgICAgICAgICAgICAvLyByZWZDb250ZW50LmFyaWFMYWJlbCA9IHJlZkNvbnRlbnQubGFiZWw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qIFNhdmUgdGhlIGNvbnRlbnQgY2xvbmVkLiAqL1xuICAgICAgICAgICAgdGhpcy5jb250ZW50LmZvcm1TZWN0aW9uQ29udGVudC5wdXNoKHJlZkNvbnRlbnQpO1xuICAgICAgICAgICAgcmVzdWx0LnB1c2gocmVmQ29udGVudCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9mb3JtQXJyYXlMZW5ndGgrKztcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgbmV3IGNvbnRlbnQgdGhhdCByZXByZXNlbnRzIHRoZSBjbG9uZSBvZiB0aGUgc3BlY2lmaWVkIGNvbnRlbnQgdGFyZ2V0LiBcbiAgICAgKiBJdCBhbHNvIHNldHMgdGhlIGluaXRpYWwgYHZhbHVlYCBmaWVsZCBvZiBlYWNoIGNvbnRlbnQgcmVwcmVzZW50aW5nIGEgYEZvcm1Db250cm9sYC4gXG4gICAgICogSXQgY2xvbmVzIHRoZSBjb250ZW50IHNtYXJ0bHkgZGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mIHByb3BlcnR5LiBcbiAgICAgKiBJdCBjbG9uZXMgaW4gZGVlcCB1bnRpbCB0aGUgbmV4dCBgRm9ybUFycmF5YCwgdGhlbiB0aGUgbmV4dCBgRm9ybUFycmF5YCBjbG9uZXMgaW4gZGVlcCB1bnRpbCB0aGUgbmV4dCBgRm9ybUFycmF5YCwgYW5kIHNvIG9uLiBcbiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSBjb250ZW50IG9iamVjdCB0byBjbG9uZS4gXG4gICAgICogQHBhcmFtIHZhbHVlIFRoZSBpbml0aWFsIGB2YWx1ZWAgZmllbGQgb2YgZWFjaCBjb250ZW50IHJlcHJlc2VudGluZyBhIGBGb3JtQ29udHJvbGAuIFxuICAgICAqIEBwYXJhbSBjYW5DbG9uZSBJdCBpcyB0cnVlIGlmIHRoZSBmdW5jdGlvbiBjYW4gY2xvbmUgdGhlIGBmb3JtU2VjdGlvbkNvbnRlbnRgIGZpZWxkOyBvdGhlcndpc2UsIGZhbHNlLiBcbiAgICAgKi9cbiAgICBwcml2YXRlIF9jbG9uZUNvbnRlbnQodGFyZ2V0OiBQYXJhbXM8YW55PiwgdmFsdWU6IGFueSwgY2FuQ2xvbmU6IGJvb2xlYW4pOiBhbnlcbiAgICB7XG4gICAgICAgIC8qIFRoZSBjb250ZW50IGNsb25lZC4gKi9cbiAgICAgICAgbGV0IHJlc3VsdDogYW55ID0geyB9O1xuXG4gICAgICAgIGZvcihsZXQgcHJvcCBpbiB0YXJnZXQpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHN3aXRjaChwcm9wKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8qIFRoZSBgZm9ybUNvbnRyb2xgIHByb3BlcnR5IHNwZWNpYWwgY2FzZS4gKi9cbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtQ29udHJvbCc6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSBjbG9uZUZvcm1Db250cm9sKHRhcmdldC5mb3JtQ29udHJvbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLyogSWYgdGhpcyBjb250ZW50IChgcmVzdWx0YCkgcmVwcmVzZW50cyBhIGBGb3JtQ29udHJvbGAsIHRoZW4gdGhlIGB2YWx1ZWAgZmllbGQgaXMgaW5pdGlhbGl6ZWQuICovXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFsndmFsdWUnXSA9IHZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qIFRoZSBgZm9ybVNlY3Rpb25gIHByb3BlcnR5IHNwZWNpYWwgY2FzZS4gKi9cbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtU2VjdGlvbic6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSBjbG9uZUZvcm1TZWN0aW9uKHRhcmdldC5mb3JtU2VjdGlvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyogVGhlIGBmb3JtU2VjdGlvbkNvbnRlbnRgIHByb3BlcnR5IHNwZWNpYWwgY2FzZS4gKi9cbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtU2VjdGlvbkNvbnRlbnQnOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbkNsb25lKSAgLyogQ2xvbmVzIHRoZSBgdGFyZ2V0LmZvcm1TZWN0aW9uQ29udGVudGAuICovXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXSA9IFsgXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBjb250ZW50IG9mIHRhcmdldC5mb3JtU2VjdGlvbkNvbnRlbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQuZm9ybVNlY3Rpb24gaW5zdGFuY2VvZiBGb3JtQXJyYXkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LnZhbHVlID0gdmFsdWVbY29udGVudC5uYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogVGhpcyBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgIHdpbGwgbm90IGJlIGNsb25lZCBiZWNhdXNlIGl0IGJlbG9uZ3MgdG8gYSBgRm9ybUFycmF5YCBhbmQgaXQgd2lsbCBiZSBjbG9uZWQgd2hlbiB0aGUgYEZvcm1BcnJheWAgaXMgYW5hbHl6ZWQgaW4gdGhlIGBDb250YWluZXJDb250cm9sYCBjbGFzcy4gKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdLnB1c2godGhpcy5fY2xvbmVDb250ZW50KGNvbnRlbnQsIHVuZGVmaW5lZC8qIEl0IGlzIG5vdCB1c2VkIGluIHRoaXMgY2FzZS4gKi8sIGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXS5wdXNoKHRoaXMuX2Nsb25lQ29udGVudChjb250ZW50LCB2YWx1ZVtjb250ZW50Lm5hbWVdLCBjYW5DbG9uZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlICAvKiBUYWtlcyB0aGUgc2FtZSBgdGFyZ2V0LmZvcm1TZWN0aW9uQ29udGVudGAgcmVmZXJlbmNlIGJlY2F1c2UgYHRhcmdldGAgaXMgYSBgRm9ybUFycmF5YCBhbmQgaXRzIGBmb3JtU2VjdGlvbkNvbnRlbnRgIHdpbGwgYmUgdGFrZW4gbGlrZSBhIHBhdHRlcm4uICovXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXSA9IHRhcmdldC5mb3JtU2VjdGlvbkNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKiBDb3BpZXMgdGhlIHByb3BlcnR5IHdpdGhvdXQgcHJvYmxlbS4gKi9cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0gdGFyZ2V0W3Byb3BdO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyB0aGUgY2hpbGQgY29tcG9uZW50cy4gXG4gICAgICogQHBhcmFtIGNvbXBvbmVudHNDb250ZW50IENvbXBvbmVudHMgY29udGVudCBhcnJheSBmb3IgY3JlYXRpbmcgdGhlIGNvbXBvbmVudHMuIFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBjcmVhdGVDaGlsZENvbXBvbmVudHMoY29tcG9uZW50c0NvbnRlbnQ6IFBhcmFtczxhbnk+W10pOiB2b2lkXG4gICAge1xuICAgICAgICBmb3IgKGxldCBjb21wb25lbnRDb250ZW50IG9mIGNvbXBvbmVudHNDb250ZW50KVxuICAgICAgICB7XG4gICAgICAgICAgICAvKiBDcmVhdGVzIGEgY2hpbGQgY29tcG9uZW50LiAqL1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVDaGlsZENvbXBvbmVudChjb21wb25lbnRDb250ZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBjaGlsZCBjb21wb25lbnQuIFxuICAgICAqIEBwYXJhbSBjb21wb25lbnRDb250ZW50IENvbXBvbmVudCBjb250ZW50IGZvciBjcmVhdGluZyB0aGUgY29tcG9uZW50LiBcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgY3JlYXRlQ2hpbGRDb21wb25lbnQoY29tcG9uZW50Q29udGVudDogUGFyYW1zPGFueT4pOiB2b2lkXG4gICAge1xuICAgICAgICB0aGlzLl9jciA9IHRoaXMuX3ZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KFxuICAgICAgICAgICAgdGhpcy5fY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudENvbnRlbnQuY29udHJvbFR5cGUpXG4gICAgICAgICk7XG4gICAgICAgICh0aGlzLl9jci5pbnN0YW5jZSBhcyBGb3JtRmllbGRDb250cm9sKS5jb250ZW50ID0gY29tcG9uZW50Q29udGVudDtcbiAgICB9XG5cblx0LyoqXG5cdCAqIEluaXRpYWxpemVzIHRoZSBjb250cm9sJ3MgdmFsdWUuIEl0IHVzZXMgdGhlIGBjb250ZW50LnZhbHVlYCBhbmQgaXQgaXMgYWxyZWFkeSBkaWZmZXJlbnQgb2YgYHVuZGVmaW5lZGAuIFxuICAgICAqIEl0IGFsc28gY2hlY2tzIGlmIHRoZSBzcGVjaWZpZWQgYGNvbnRlbnQudmFsdWVgIGlzIGNvcnJlY3QuIEZvciBpbnRlcm5hbCB1c2Ugb25seS4gXG5cdCAqL1xuXHRwcm90ZWN0ZWQgaW5pdFZhbHVlKCk6IHZvaWRcblx0e1xuICAgICAgICAvKiBJdCBkb2VzIG5vdCBuZWVkIHRvIGRvIHNvbWV0aGluZyBiZWNhdXNlIHRoZSBjaGlsZCBjb250cm9scyBhcmUgYWxyZWFkeSBpbml0aWFsaXplZC4gKi9cblxuICAgICAgICAvLyAvKiBJbiB0aGlzIHdheSwgY2hlY2tzIGlmIHRoZSBzcGVjaWZpZWQgYGNvbnRlbnQudmFsdWVgIGlzIGNvcnJlY3QuICovXG4gICAgICAgIC8vIHRoaXMuY29udGVudC5mb3JtQ29udHJvbC5zZXRWYWx1ZSh0aGlzLmNvbnRlbnQudmFsdWUpO1xuXG4gICAgICAgIC8vIC8qIE1hcmtzIHRoZSBjb250cm9sIGFzIGB0b3VjaGVkYC4gKi9cbiAgICAgICAgLy8gdGhpcy5jb250ZW50LmZvcm1Db250cm9sLm1hcmtBc1RvdWNoZWQoe1xuICAgICAgICAvLyAgICAgb25seVNlbGY6IHRydWVcbiAgICAgICAgLy8gfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGlzIGluc3RhbmNlLiBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IGdldEluc3RhbmNlKCk6IENvbnRhaW5lckNvbnRyb2xcbiAgICB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2YgY29udHJvbHMgdGhhdCByZXByZXNlbnRzIHRoZSBgQ29udGFpbmVyQ29udHJvbGAncyBjaGlsZCBjb250cm9scy4gXG4gICAgICogSXQgaXMgYWx3YXlzIHNldCBpbnRlcm5hbGx5LiBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IGNvbnRhaW5lckNvbnRyb2xDaGlsZHJlbigpOiBhbnlbXVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudC5jb250YWluZXJDb250cm9sQ2hpbGRyZW47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCByZXByZXNlbnRzIGEgYEZvcm1BcnJheWAsIHRoZW4gdGhpcyBmaWVsZCByZXR1cm5zIFxuICAgICAqIGEgcGF0dGVybiBjb250ZW50IHRoYXQgaXMgYGNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50WzBdYCB2YWx1ZTsgb3RoZXJ3aXNlLCByZXR1cm5zIGB1bmRlZmluZWRgLiBcbiAgICAgKiBJdCBpcyBzaGFyZWQgYW1vbmcgY29udHJvbHMuIFxuICAgICAqIEl0IGlzIHVzZWQgZm9yIGFkZGluZyBhIG5ldyBlbGVtZW50IGluIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgLCB0aGF0IGlzLCBcbiAgICAgKiBmb3IgYWRkaW5nIGEgbmV3IGNvbnRyb2wgaW4gdGhlIGBGb3JtQXJyYXlgLiBcbiAgICAgKiBCeSBkZWZhdWx0LCBpdHMgdmFsdWUgaXMgYHVuZGVmaW5lZGAuIFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgZm9ybUFycmF5UGF0dGVybkNvbnRlbnQoKTogYW55XG4gICAge1xuICAgICAgICByZXR1cm4gdGhpcy5fZm9ybUFycmF5UGF0dGVybkNvbnRlbnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSWYgdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCByZXByZXNlbnRzIGEgYEZvcm1BcnJheWAsIHRoZW4gdGhpcyBmaWVsZCByZXR1cm5zIFxuICAgICAqIGEgcGF0dGVybiB2YWx1ZSB0aGF0IGlzIGEgY2xvbmUgb2YgdGhlIGBjb250ZW50LnZhbHVlWzBdYCB2YWx1ZSwgYW5kIHNldHMgYWxsIFxuICAgICAqIGl0cyBwcm9wZXJ0aWVzL3ZhbHVlcyBvZiBidWlsdC1pbiB0eXBlIHRvIGB1bmRlZmluZWRgOyBvdGhlcndpc2UsIHJldHVybnMgYHVuZGVmaW5lZGAuIFxuICAgICAqIEl0IGlzIHVzZWQgZm9yIGFkZGluZyBhIG5ldyBlbGVtZW50IGluIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgLiBcbiAgICAgKiBCeSBkZWZhdWx0LCBpdHMgdmFsdWUgaXMgYHVuZGVmaW5lZGAuIFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgZm9ybUFycmF5UGF0dGVyblZhbHVlKCk6IGFueVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1BcnJheVBhdHRlcm5WYWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbnRhaW5lciBjb250cm9sIGhhcyBhIGR5bmFtaWMgbGVuZ3RoLCB0aGF0IGlzLCB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGZpZWxkIFxuICAgICAqIHJlcHJlc2VudHMgYSBgRm9ybUFycmF5YCBhbmQgaXRzIGxlbmd0aCBpcyBub3QgZml4ZWQ7IG90aGVyd2lzZSwgZmFsc2UuIFxuICAgICAqIFRoaXMgcHJvcGVydHkgaGFzIHNlbnNlIG9ubHkgd2hlbiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGZpZWxkIHJlcHJlc2VudHMgYSBgRm9ybUFycmF5YC4gXG4gICAgICovXG4gICAgcHVibGljIGdldCBpc0R5bmFtaWMoKTogYm9vbGVhblxuICAgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudC5pc0R5bmFtaWM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250YWluZXIgY29udHJvbCBpcyBhIGBGb3JtQXJyYXlgLCB0aGF0IGlzLCB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIGZpZWxkIFxuICAgICAqIHJlcHJlc2VudHMgYSBgRm9ybUFycmF5YDsgb3RoZXJ3aXNlLCBmYWxzZS4gXG4gICAgICovXG4gICAgcHVibGljIGdldCBpc0Zvcm1BcnJheSgpOiBib29sZWFuXG4gICAge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNGb3JtQXJyYXk7XG4gICAgfVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBjb250YWluZXIgaXMgZW1wdHk7IG90aGVyd2lzZSwgZmFsc2UuIFxuXHQgKi9cblx0cHVibGljIGdldCBpc0VtcHR5KCk6IGJvb2xlYW5cblx0e1xuXHRcdHJldHVybiAodGhpcy5jb250ZW50LmZvcm1TZWN0aW9uQ29udGVudC5sZW5ndGggPT0gMCk7XG4gICAgfVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRydWUgaWYgYW4gZWxlbWVudCBjYW4gYmUgcmVtb3ZlZCBmcm9tIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbmA7IG90aGVyd2lzZSwgZmFsc2UuIFxuICAgICAqIFVzZSBhbG9uZyB3aXRoIGByZW1vdmVGcm9tRm9ybUFycmF5YCBhbmQgYGNsZWFyRm9ybUFycmF5YCBtZXRob2RzLiBcbiAgICAgKiBUaGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25gIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgYEZvcm1BcnJheWAuIFxuXHQgKi9cblx0cHVibGljIGdldCBjYW5SZW1vdmVGcm9tRm9ybUFycmF5KCk6IGJvb2xlYW5cblx0e1xuICAgICAgICAvKiBUaGUgbWV0aG9kIHVzZXMgdGhlIGBfZm9ybUFycmF5TGVuZ3RoYCBpbnN0ZWFkIG9mIGBjb250ZW50LmZvcm1TZWN0aW9uYCBiZWNhdXNlIFxuICAgICAgICB0aGUgZmlyc3Qgb25lIGZpZWxkIGlzIHVwZGF0ZWQgZmlyc3QgYW5kIGl0IGhhcyB0aGUgYW5zd2VyIG1vcmUgYWNjdXJhdGUgdGhhbiB0aGUgc2Vjb25kIG9uZSBmaWVsZC4gKi9cblxuICAgICAgICBpZiAodGhpcy5jb250ZW50LnJlcXVpcmVkKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gKHRoaXMuX2Zvcm1BcnJheUxlbmd0aCA+IDEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mb3JtQXJyYXlMZW5ndGggIT0gMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGFuIGVtcHR5IGVsZW1lbnQgYXQgdGhlIGVuZCBvZiB0aGUgYGNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50YDsgdGhlcmVmb3JlIG9uZSBlbGVtZW50IFxuICAgICAqIGlzIGFkZGVkIGF0IHRoZSBlbmQgb2YgdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCBgRm9ybUFycmF5YC4gXG4gICAgICogVGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIGBGb3JtQXJyYXlgLiBcbiAgICAgKi9cblx0cHVibGljIGFkZFRvRm9ybUFycmF5KCk6IHZvaWRcblx0e1xuICAgICAgICBjb25zb2xlLmxvZygnYWRkVG9Gb3JtQXJyYXknKTtcblxuICAgICAgICBpZiAodGhpcy5faXNGb3JtQXJyYXkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2hpbGRDb21wb25lbnRzKFxuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRFbGVtRm9ybVNlY3Rpb25Db250ZW50VG9Gb3JtQXJyYXkodGhpcy5fZm9ybUFycmF5UGF0dGVyblZhbHVlKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRm9yIHRoZSAnJHsgdGhpcy5jb250ZW50Lm5hbWUgfScgY29udHJvbCwgdGhlICdjb250ZW50LmZvcm1TZWN0aW9uJyB2YWx1ZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mICdGb3JtQXJyYXknLmApO1xuICAgICAgICB9XG5cdH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIGVsZW1lbnQgYXQgdGhlIGdpdmVuIGBpbmRleGAgaW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGA7IHRoZXJlZm9yZSBcbiAgICAgKiB0aGUgZWxlbWVudCBhdCB0aGUgZ2l2ZW4gYGluZGV4YCBpcyByZW1vdmVkIGluIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbmAgYEZvcm1BcnJheWAuIFxuICAgICAqIFRoZSBgY29udGVudC5mb3JtU2VjdGlvbmAgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBgRm9ybUFycmF5YC4gXG4gICAgICogQHBhcmFtIGluZGV4IEluZGV4IGluIHRoZSBhcnJheSB0byByZW1vdmUgdGhlIGVsZW1lbnQuIFxuICAgICAqL1xuXHRwdWJsaWMgcmVtb3ZlRnJvbUZvcm1BcnJheShpbmRleDogbnVtYmVyKTogdm9pZFxuXHR7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVGcm9tRm9ybUFycmF5JywgaW5kZXgpO1xuXG4gICAgICAgIGlmICh0aGlzLl9pc0Zvcm1BcnJheSlcbiAgICAgICAge1xuICAgICAgICAgICAgLy9UT0RPOiBsYSB2YXJpYWJsZSBgZm9ybUFycmF5UGF0dGVybkNvbnRlbnRMZW5ndGhgIHBvZHLDrWEgc2VyIHVuIGNhbXBvIGRlIGxhIGNsYXNlLiBcbiAgICAgICAgICAgIGxldCBmb3JtQXJyYXlQYXR0ZXJuQ29udGVudExlbmd0aDogbnVtYmVyID0gdGhpcy5fZm9ybUFycmF5UGF0dGVybkNvbnRlbnQubGVuZ3RoO1xuICAgICAgICAgICAgbGV0IGk6IG51bWJlciwgajogbnVtYmVyLCBrOiBudW1iZXI7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGVudC5jb250YWluZXJDb250cm9sQ2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnQuc3BsaWNlKChpbmRleCAqIGZvcm1BcnJheVBhdHRlcm5Db250ZW50TGVuZ3RoKSwgZm9ybUFycmF5UGF0dGVybkNvbnRlbnRMZW5ndGgpO1xuICAgICAgICAgICAgKHRoaXMuY29udGVudC5mb3JtU2VjdGlvbiBhcyBGb3JtQXJyYXkpLnJlbW92ZUF0KGluZGV4KTtcbiAgICAgICAgICAgIGZvciAoaSA9IGZvcm1BcnJheVBhdHRlcm5Db250ZW50TGVuZ3RoLCBqID0gaW5kZXggKiBmb3JtQXJyYXlQYXR0ZXJuQ29udGVudExlbmd0aDsgaSAhPSAwOyBpLS0pXG4gICAgICAgICAgICB7IHRoaXMuX3ZpZXdDb250YWluZXJSZWYucmVtb3ZlKGopOyB9XG4gICAgICAgICAgICB0aGlzLl9mb3JtQXJyYXlMZW5ndGgtLTtcblxuICAgICAgICAgICAgLyogVXBkYXRlcyB0aGUgZWxlbWVudHMnIGluZGV4IGluIHRoZSBgY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRgIGFycmF5IGZyb20gXG4gICAgICAgICAgICB0aGUgc3BlY2lmaWVkIGBpbmRleGAgb253YXJkcy4gKi9cbiAgICAgICAgICAgIGZvciAoayA9IChpID0gaW5kZXggKiBmb3JtQXJyYXlQYXR0ZXJuQ29udGVudExlbmd0aCkgKyBmb3JtQXJyYXlQYXR0ZXJuQ29udGVudExlbmd0aCwgaiA9IHRoaXMuY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnQubGVuZ3RoOyBpIDwgajsgaSsrKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmIChpID09IGspIHsgaW5kZXgrKzsgayArPSBmb3JtQXJyYXlQYXR0ZXJuQ29udGVudExlbmd0aDsgfVxuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5mb3JtU2VjdGlvbkNvbnRlbnRbaV0ubmFtZSA9IGluZGV4LnRvU3RyaW5nKDEwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRm9yIHRoZSAnJHsgdGhpcy5jb250ZW50Lm5hbWUgfScgY29udHJvbCwgdGhlICdjb250ZW50LmZvcm1TZWN0aW9uJyB2YWx1ZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mICdGb3JtQXJyYXknLmApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbGwgZWxlbWVudHMgaW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uQ29udGVudGA7IHRoZXJlZm9yZSBcbiAgICAgKiBhbGwgZWxlbWVudHMgYXJlIHJlbW92ZWQgaW4gdGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCBgRm9ybUFycmF5YC4gXG4gICAgICogVGhlIGBjb250ZW50LmZvcm1TZWN0aW9uYCBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIGBGb3JtQXJyYXlgLiBcbiAgICAgKi9cblx0cHVibGljIGNsZWFyRm9ybUFycmF5KCk6IHZvaWRcblx0e1xuICAgICAgICBjb25zb2xlLmxvZygnY2xlYXJGb3JtQXJyYXknKTtcblxuICAgICAgICBpZiAodGhpcy5faXNGb3JtQXJyYXkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5jb250YWluZXJDb250cm9sQ2hpbGRyZW4gPSBbIF07XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuZm9ybVNlY3Rpb25Db250ZW50ID0gWyBdO1xuICAgICAgICAgICAgKHRoaXMuY29udGVudC5mb3JtU2VjdGlvbiBhcyBGb3JtQXJyYXkpLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLl92aWV3Q29udGFpbmVyUmVmLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLl9mb3JtQXJyYXlMZW5ndGggPSAwO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5jb250ZW50LnJlcXVpcmVkKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8qIFRoZSBgRm9ybUFycmF5YCBhbHdheXMgaGFzIG9uZSBlbGVtZW50IGF0IGxlYXN0LiAqL1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkVG9Gb3JtQXJyYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRm9yIHRoZSAnJHsgdGhpcy5jb250ZW50Lm5hbWUgfScgY29udHJvbCwgdGhlICdjb250ZW50LmZvcm1TZWN0aW9uJyB2YWx1ZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mICdGb3JtQXJyYXknLmApO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19