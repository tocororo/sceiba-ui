/**
 * @fileoverview added by tsickle
 * Generated from: lib/taxonomy/vocabularies/vocabularies.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Inject, Output, EventEmitter } from '@angular/core';
import { of } from 'rxjs';
import { catchError, finalize, startWith, map } from 'rxjs/operators';
import { FormControl, FormBuilder } from '@angular/forms';
import { MatDialog, MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';
import { MatSnackBar } from '@angular/material/snack-bar';
import { MessageHandler, StatusCode } from '../../core/public-api';
import { Vocabulary } from '../../entities/public-api';
import { FormFieldType, HintValue, HintPosition } from '../../forms/public-api';
import { TaxonomyService } from '../../backend/public-api';
import { OAuthStorage } from 'angular-oauth2-oidc';
var VocabularyDialogComponent = /** @class */ (function () {
    function VocabularyDialogComponent(service, _formBuilder, dialogRef, _snackBar, data) {
        this.service = service;
        this._formBuilder = _formBuilder;
        this.dialogRef = dialogRef;
        this._snackBar = _snackBar;
        this.data = data;
        this.actionLabel = 'Aceptar';
        this.hasService = false;
        if (data.accept) {
            this.accept = data.accept;
            this.hasService = true;
            this.vocab = new Vocabulary();
            if (data.vocab === null) {
                this.vocab.isNew = true;
            }
            else {
                this.vocab.deepcopy(data.vocab);
                this.actionLabel = 'Actualizar';
            }
        }
    }
    /**
     * @return {?}
     */
    VocabularyDialogComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.hasService) {
            this.formGroup = this._formBuilder.group({});
            this.panels = [
                {
                    title: this.vocab.isNew ? 'Nuevo Vocabulario' : 'Editar Vocabulario',
                    description: '',
                    iconName: '',
                    formSection: this.formGroup,
                    formSectionContent: [
                        {
                            name: 'name',
                            label: 'Identificador',
                            type: FormFieldType.identifier,
                            required: true,
                            width: '100%',
                            value: this.vocab.name,
                            startHint: new HintValue(HintPosition.start, 'Un identificador es una secuencia de letras')
                        },
                        {
                            name: 'human_name',
                            label: 'Nombre',
                            type: FormFieldType.text,
                            required: false,
                            width: '100%',
                            value: this.vocab.human_name,
                            startHint: new HintValue(HintPosition.start, '')
                        },
                        {
                            name: 'description',
                            label: 'Descripción',
                            type: FormFieldType.textarea,
                            required: false,
                            width: '100%',
                            value: this.vocab.description,
                            startHint: new HintValue(HintPosition.start, '')
                        }
                    ]
                }
            ];
            this.action = {
                doit: (/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (_this.formGroup.valid) {
                        _this.vocab.name = _this.formGroup.value['name'];
                        _this.vocab.human_name = _this.formGroup.value['human_name'];
                        _this.vocab.description = _this.formGroup.value['description'];
                        _this.accept(_this.vocab);
                    }
                    else {
                        /** @type {?} */
                        var m = new MessageHandler(_this._snackBar);
                        m.showMessage(StatusCode.OK, 'El identificador no es válido.');
                    }
                })
            };
        }
    };
    /**
     * @return {?}
     */
    VocabularyDialogComponent.prototype.onNoClick = /**
     * @return {?}
     */
    function () {
        this.dialogRef.close();
    };
    /**
     * @return {?}
     */
    VocabularyDialogComponent.prototype.acceptAction = /**
     * @return {?}
     */
    function () {
    };
    VocabularyDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-vocabulary-dialog',
                    template: "<form *ngIf=\"hasService\">\n    <toco-form-container\n        [panelsContent]=\"panels\"\n        [formGroup]=\"formGroup\"\n        [useAccordion]=\"false\"\n        [action]=\"action\"\n        [actionLabel]=\"actionLabel\"\n    ></toco-form-container>\n\n\n    <!-- <div>\n        <button mat-raised-button color=\"primary\" (click)=\"acceptAction()\">{{actionLabel}}</button>\n    </div> -->\n</form>\n\n<h2 *ngIf=\"!hasService\"> No Service</h2>\n"
                }] }
    ];
    /** @nocollapse */
    VocabularyDialogComponent.ctorParameters = function () { return [
        { type: TaxonomyService },
        { type: FormBuilder },
        { type: MatDialogRef },
        { type: MatSnackBar },
        { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    return VocabularyDialogComponent;
}());
export { VocabularyDialogComponent };
if (false) {
    /** @type {?} */
    VocabularyDialogComponent.prototype.panels;
    /** @type {?} */
    VocabularyDialogComponent.prototype.formGroup;
    /** @type {?} */
    VocabularyDialogComponent.prototype.action;
    /** @type {?} */
    VocabularyDialogComponent.prototype.actionLabel;
    /** @type {?} */
    VocabularyDialogComponent.prototype.hasService;
    /** @type {?} */
    VocabularyDialogComponent.prototype.vocab;
    /** @type {?} */
    VocabularyDialogComponent.prototype.accept;
    /**
     * @type {?}
     * @private
     */
    VocabularyDialogComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    VocabularyDialogComponent.prototype._formBuilder;
    /** @type {?} */
    VocabularyDialogComponent.prototype.dialogRef;
    /** @type {?} */
    VocabularyDialogComponent.prototype._snackBar;
    /** @type {?} */
    VocabularyDialogComponent.prototype.data;
}
var VocabulariesComponent = /** @class */ (function () {
    function VocabulariesComponent(service, oautheStorage, dialog, _snackBar) {
        var _this = this;
        this.service = service;
        this.oautheStorage = oautheStorage;
        this.dialog = dialog;
        this._snackBar = _snackBar;
        this.vocabulariesChangeObserver = {
            next: (/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                _this.dialog.closeAll();
                _this.loadVocabularies();
                /** @type {?} */
                var voc = new Vocabulary();
                voc.deepcopy(result.data.vocabulary);
                _this.selectVocab(voc);
                /** @type {?} */
                var m = new MessageHandler(_this._snackBar);
                m.showMessage(StatusCode.OK, result.message);
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                console.log('error: ' + err + '.');
            }),
            complete: (/**
             * @return {?}
             */
            function () {
                console.log('complete.');
            })
        };
        this.vocabCtrl = new FormControl();
        this.selectedVocab = new EventEmitter();
        this.currentVocab = null;
        this.vocabularies = [];
        this.loading = false;
        this.emiterShowTerms = new EventEmitter();
    }
    /**
     * @return {?}
     */
    VocabulariesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.getAuthenticatedUserPermissions();
        this.loadVocabularies();
    };
    /**
     * @return {?}
     */
    VocabulariesComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} item
     * @return {?}
     */
    VocabulariesComponent.prototype.selectVocab = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.currentVocab = item;
    };
    /**
     * @return {?}
     */
    VocabulariesComponent.prototype.loadVocabularies = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading = true;
        this.service.getVocabularies().pipe(catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            /** @type {?} */
            var m = new MessageHandler(_this._snackBar);
            m.showMessage(StatusCode.serverError, err.message);
            // TODO: Maybe you must set a better return.
            return of(null);
        })), finalize((/**
         * @return {?}
         */
        function () { return _this.loading = false; })))
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response) {
                _this.vocabularies = response.data.vocabularies;
                _this.filteredVocabularies = _this.vocabCtrl.valueChanges
                    .pipe(startWith(''), map((/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) {
                    return _this.vocabularies.filter((/**
                     * @param {?} vocab
                     * @return {?}
                     */
                    function (vocab) { return vocab.name.toLowerCase().includes(value.toLowerCase()); }));
                })));
            }
            else {
                _this.vocabularies = [];
            }
        }));
    };
    /**
     * @return {?}
     */
    VocabulariesComponent.prototype.newVocab = /**
     * @return {?}
     */
    function () {
        this.openVocabDialog(null);
    };
    /**
     * @param {?} vocab
     * @return {?}
     */
    VocabulariesComponent.prototype.editVocab = /**
     * @param {?} vocab
     * @return {?}
     */
    function (vocab) {
        this.openVocabDialog(vocab);
    };
    /**
     * @private
     * @param {?} vocab
     * @return {?}
     */
    VocabulariesComponent.prototype.openVocabDialog = /**
     * @private
     * @param {?} vocab
     * @return {?}
     */
    function (vocab) {
        var _this = this;
        /** @type {?} */
        var dialogRef = this.dialog.open(VocabularyDialogComponent, {
            data: {
                vocab: vocab,
                accept: (/**
                 * @param {?} voc
                 * @return {?}
                 */
                function (voc) {
                    _this.dialog.closeAll();
                    if (voc.isNew) {
                        _this.service.newVocabulary(voc).pipe().subscribe(_this.vocabulariesChangeObserver);
                    }
                    else {
                        _this.service.editVocabulary(voc).pipe().subscribe(_this.vocabulariesChangeObserver);
                    }
                })
            }
        });
        dialogRef.afterClosed().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            console.log('dialog closed');
        }));
    };
    /**
     * @param {?} vocab
     * @return {?}
     */
    VocabulariesComponent.prototype.deleteVocab = /**
     * @param {?} vocab
     * @return {?}
     */
    function (vocab) {
    };
    /**
     * @return {?}
     */
    VocabulariesComponent.prototype.onSelectionChange = /**
     * @return {?}
     */
    function () {
        this.selectedVocab.emit(this.currentVocab);
    };
    /**
     * @return {?}
     */
    VocabulariesComponent.prototype.getAuthenticatedUserPermissions = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.service.getCurrentUserPermissions().pipe(catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            /** @type {?} */
            var m = new MessageHandler(_this._snackBar);
            m.showMessage(StatusCode.serverError, err.message);
            // TODO: Maybe you must set a better return.
            return of(null);
        })))
            .subscribe((/**
         * @param {?} request
         * @return {?}
         */
        function (request) {
            if (request.status == 'success') {
                /** @type {?} */
                var permJson = JSON.stringify(request.data.permissions.actions);
                _this.oautheStorage.setItem('user_permissions', permJson);
            }
        }));
    };
    /**
     * @param {?} permission
     * @param {?=} id
     * @return {?}
     */
    VocabulariesComponent.prototype.hasPermission = /**
     * @param {?} permission
     * @param {?=} id
     * @return {?}
     */
    function (permission, id) {
        /** @type {?} */
        var userPermission = JSON.parse(this.oautheStorage.getItem('user_permissions'));
        if (!userPermission) {
            return false;
        }
        switch (permission) {
            case 'add':
                if (userPermission.taxonomy_full_editor_actions === null)
                    return true;
                return false;
            case 'edit':
                if (userPermission.taxonomy_full_editor_actions === null)
                    return true;
                if (userPermission.vocabulary_editor_actions) {
                    /** @type {?} */
                    var arr = userPermission.vocabulary_editor_actions;
                    if (arr.includes(id)) {
                        return true;
                    }
                }
                else if (userPermission.taxonomy_full_editor_actions) {
                    return true;
                }
                return false;
            default:
                return false;
        }
    };
    VocabulariesComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-vocabularies',
                    template: "<mat-card>\n  <mat-card-header>\n    <mat-card-title>\n      <div fxLayout=\"row\" fxLayoutAlign=\"space-between none\">\n        Vocabularios\n        <button *ngIf=\"hasPermission('add')\" mat-icon-button (click)=\"newVocab()\" matTooltip=\"Adicionar Vocabulario\">\n          <mat-icon>library_add</mat-icon>\n        </button>\n      </div>\n    </mat-card-title>\n  </mat-card-header>\n  <mat-card-content [style.overflow]=\"'auto'\" [style.height]=\"'25em'\">\n    <mat-spinner *ngIf=\"loading; else elseTemplate\"></mat-spinner>\n    <ng-template #elseTemplate>\n\n\n      <mat-form-field [ngStyle]=\"{'width': '100%'}\">\n        <mat-label>Vocabularios</mat-label>\n        <mat-select\n          [(value)]=\"currentVocab\"\n          (selectionChange)=\"onSelectionChange()\"\n        >\n          <mat-option *ngFor=\"let option of vocabularies\" [value]=\"option\">\n            {{option.human_name}}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n      \n\n      <!-- <mat-form-field>\n        <input matInput placeholder=\"Vocabularios\" aria-label=\"Vocabularios\" [matAutocomplete]=\"auto\"\n          [formControl]=\"vocabCtrl\">\n        <mat-autocomplete #auto=\"matAutocomplete\">\n          <mat-option *ngFor=\"let item of filteredVocabularies | async\" [value]=\"item.human_name\" (click)=selectVocab(item) (keydown.enter)=selectVocab(item)>\n            {{item.human_name}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field> -->\n\n\n      <mat-card *ngIf=\"currentVocab\">\n        <mat-card-header>\n          <mat-card-title></mat-card-title>\n          <mat-card-subtitle>\n              <strong>Identificador: </strong> {{ currentVocab.name }}\n              </mat-card-subtitle>\n        </mat-card-header>\n        <mat-card-content>\n            <strong>Nombre: </strong> {{ currentVocab.human_name }}\n          <p> <strong> Descripci\u00F3n: </strong> </p>\n          <div class=\"e2e-inner-html-bound  text-align-justify\" [innerHTML]=\"currentVocab.description\"></div>\n\n        </mat-card-content>\n        <mat-card-actions>\n          <button mat-flat-button *ngIf=\"hasPermission('edit', currentVocab.id)\" (click)=\"editVocab(currentVocab)\">Editar \n            <mat-icon>edit</mat-icon>\n          </button>\n        </mat-card-actions>\n      </mat-card>\n      \n    </ng-template>\n  </mat-card-content>\n</mat-card>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    VocabulariesComponent.ctorParameters = function () { return [
        { type: TaxonomyService },
        { type: OAuthStorage },
        { type: MatDialog },
        { type: MatSnackBar }
    ]; };
    VocabulariesComponent.propDecorators = {
        selectedVocab: [{ type: Output }],
        emiterShowTerms: [{ type: Output }]
    };
    return VocabulariesComponent;
}());
export { VocabulariesComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype.vocabulariesChangeObserver;
    /** @type {?} */
    VocabulariesComponent.prototype.vocabCtrl;
    /** @type {?} */
    VocabulariesComponent.prototype.filteredVocabularies;
    /** @type {?} */
    VocabulariesComponent.prototype.selectedVocab;
    /** @type {?} */
    VocabulariesComponent.prototype.currentVocab;
    /** @type {?} */
    VocabulariesComponent.prototype.vocabularies;
    /** @type {?} */
    VocabulariesComponent.prototype.loading;
    /** @type {?} */
    VocabulariesComponent.prototype.emiterShowTerms;
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype.oautheStorage;
    /** @type {?} */
    VocabulariesComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    VocabulariesComponent.prototype._snackBar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidm9jYWJ1bGFyaWVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3RheG9ub215L3ZvY2FidWxhcmllcy92b2NhYnVsYXJpZXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsTUFBTSxFQUFhLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzRixPQUFPLEVBQUUsRUFBRSxFQUErQixNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEUsT0FBTyxFQUFFLFdBQVcsRUFBYSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFMUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQVksTUFBTSx1QkFBdUIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUE2QyxhQUFhLEVBQXVCLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVoSixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBSW5EO0lBY0ksbUNBQ1ksT0FBd0IsRUFDeEIsWUFBeUIsRUFDMUIsU0FBK0MsRUFDL0MsU0FBc0IsRUFDRyxJQUFTO1FBSmpDLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLGlCQUFZLEdBQVosWUFBWSxDQUFhO1FBQzFCLGNBQVMsR0FB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b21wb25lbnQsIE9uSW5pdCwgSW5qZWN0LCBPdXRwdXQsIE9uRGVzdHJveSwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IG9mLCBQYXJ0aWFsT2JzZXJ2ZXIsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIGZpbmFsaXplLCBzdGFydFdpdGgsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTWF0RGlhbG9nLCBNYXREaWFsb2dSZWYsIE1BVF9ESUFMT0dfREFUQSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5pbXBvcnQgeyBNYXRTbmFja0JhciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NuYWNrLWJhcic7XG5cbmltcG9ydCB7IE1lc3NhZ2VIYW5kbGVyLCBTdGF0dXNDb2RlLCBSZXNwb25zZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBWb2NhYnVsYXJ5IH0gZnJvbSAnLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBGb3JtQ29udGFpbmVyQ29tcG9uZW50LCBQYW5lbENvbnRlbnRfRGVwciwgRm9ybUZpZWxkVHlwZSwgRm9ybUNvbnRhaW5lckFjdGlvbiwgSGludFZhbHVlLCBIaW50UG9zaXRpb24gfSBmcm9tICcuLi8uLi9mb3Jtcy9wdWJsaWMtYXBpJztcblxuaW1wb3J0IHsgVGF4b25vbXlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vYmFja2VuZC9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE9BdXRoU3RvcmFnZSB9IGZyb20gJ2FuZ3VsYXItb2F1dGgyLW9pZGMnO1xuXG5cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0b2NvLXZvY2FidWxhcnktZGlhbG9nJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdm9jYWJ1bGFyeS1kaWFsb2cuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgVm9jYWJ1bGFyeURpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBwdWJsaWMgcGFuZWxzOiBQYW5lbENvbnRlbnRfRGVwcltdO1xuICAgIHB1YmxpYyBmb3JtR3JvdXA6IEZvcm1Hcm91cDtcbiAgICBwdWJsaWMgYWN0aW9uOiBGb3JtQ29udGFpbmVyQWN0aW9uO1xuICAgIHB1YmxpYyBhY3Rpb25MYWJlbCA9ICdBY2VwdGFyJztcbiAgICBwdWJsaWMgaGFzU2VydmljZSA9IGZhbHNlO1xuICAgIHZvY2FiOiBWb2NhYnVsYXJ5O1xuICAgIGFjY2VwdDtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHNlcnZpY2U6IFRheG9ub215U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBfZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgICAgICBwdWJsaWMgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8Rm9ybUNvbnRhaW5lckNvbXBvbmVudD4sXG4gICAgICAgIHB1YmxpYyBfc25hY2tCYXI6IE1hdFNuYWNrQmFyLFxuICAgICAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgcHVibGljIGRhdGE6IGFueSkge1xuXG4gICAgICAgIGlmIChkYXRhLmFjY2VwdCkge1xuICAgICAgICAgICAgdGhpcy5hY2NlcHQgPSBkYXRhLmFjY2VwdDtcbiAgICAgICAgICAgIHRoaXMuaGFzU2VydmljZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnZvY2FiID0gbmV3IFZvY2FidWxhcnkoKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnZvY2FiID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52b2NhYi5pc05ldyA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudm9jYWIuZGVlcGNvcHkoZGF0YS52b2NhYik7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb25MYWJlbCA9ICdBY3R1YWxpemFyJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmhhc1NlcnZpY2UpIHtcblxuICAgICAgICAgICAgdGhpcy5mb3JtR3JvdXAgPSB0aGlzLl9mb3JtQnVpbGRlci5ncm91cCh7fSk7XG4gICAgICAgICAgICB0aGlzLnBhbmVscyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnZvY2FiLmlzTmV3ID8gJ051ZXZvIFZvY2FidWxhcmlvJyA6ICdFZGl0YXIgVm9jYWJ1bGFyaW8nLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgICAgICAgICAgIGljb25OYW1lOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybVNlY3Rpb246IHRoaXMuZm9ybUdyb3VwLFxuICAgICAgICAgICAgICAgICAgICBmb3JtU2VjdGlvbkNvbnRlbnQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdJZGVudGlmaWNhZG9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLmlkZW50aWZpZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52b2NhYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SGludDogbmV3IEhpbnRWYWx1ZShIaW50UG9zaXRpb24uc3RhcnQsICdVbiBpZGVudGlmaWNhZG9yIGVzIHVuYSBzZWN1ZW5jaWEgZGUgbGV0cmFzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2h1bWFuX25hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTm9tYnJlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBGb3JtRmllbGRUeXBlLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudm9jYWIuaHVtYW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydEhpbnQ6IG5ldyBIaW50VmFsdWUoSGludFBvc2l0aW9uLnN0YXJ0LCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0Rlc2NyaXBjacOzbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogRm9ybUZpZWxkVHlwZS50ZXh0YXJlYSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52b2NhYi5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydEhpbnQ6IG5ldyBIaW50VmFsdWUoSGludFBvc2l0aW9uLnN0YXJ0LCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB0aGlzLmFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICBkb2l0OiAoZGF0YTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvcm1Hcm91cC52YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52b2NhYi5uYW1lID0gdGhpcy5mb3JtR3JvdXAudmFsdWVbJ25hbWUnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudm9jYWIuaHVtYW5fbmFtZSA9IHRoaXMuZm9ybUdyb3VwLnZhbHVlWydodW1hbl9uYW1lJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZvY2FiLmRlc2NyaXB0aW9uID0gdGhpcy5mb3JtR3JvdXAudmFsdWVbJ2Rlc2NyaXB0aW9uJ107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjZXB0KHRoaXMudm9jYWIpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5PSywgJ0VsIGlkZW50aWZpY2Fkb3Igbm8gZXMgdsOhbGlkby4nKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbk5vQ2xpY2soKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgfVxuXG4gICAgYWNjZXB0QWN0aW9uKCkge1xuXG5cbiAgICB9XG59XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndG9jby12b2NhYnVsYXJpZXMnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi92b2NhYnVsYXJpZXMuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3ZvY2FidWxhcmllcy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFZvY2FidWxhcmllc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIHByaXZhdGUgdm9jYWJ1bGFyaWVzQ2hhbmdlT2JzZXJ2ZXI6IFBhcnRpYWxPYnNlcnZlcjxSZXNwb25zZTxhbnk+PiA9IHtcbiAgICAgICAgbmV4dDogKHJlc3VsdDogUmVzcG9uc2U8YW55PikgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICAgICAgICAgIHRoaXMubG9hZFZvY2FidWxhcmllcygpO1xuICAgICAgICAgICAgY29uc3Qgdm9jID0gbmV3IFZvY2FidWxhcnkoKTtcbiAgICAgICAgICAgIHZvYy5kZWVwY29weShyZXN1bHQuZGF0YS52b2NhYnVsYXJ5KTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Vm9jYWIodm9jKTtcbiAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLk9LLCByZXN1bHQubWVzc2FnZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXJyb3I6IChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yOiAnICsgZXJyICsgJy4nKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvbXBsZXRlLicpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyB2b2NhYkN0cmwgPSBuZXcgRm9ybUNvbnRyb2woKTtcbiAgICBwdWJsaWMgZmlsdGVyZWRWb2NhYnVsYXJpZXM6IE9ic2VydmFibGU8Vm9jYWJ1bGFyeVtdPjtcblxuICAgIEBPdXRwdXQoKVxuICAgIHB1YmxpYyBzZWxlY3RlZFZvY2FiOiBFdmVudEVtaXR0ZXI8Vm9jYWJ1bGFyeT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBwdWJsaWMgY3VycmVudFZvY2FiOiBWb2NhYnVsYXJ5ID0gbnVsbDtcblxuICAgIHB1YmxpYyB2b2NhYnVsYXJpZXM6IFZvY2FidWxhcnlbXSA9IFtdO1xuXG4gICAgbG9hZGluZyA9IGZhbHNlO1xuXG4gICAgQE91dHB1dCgpIGVtaXRlclNob3dUZXJtczogRXZlbnRFbWl0dGVyPFZvY2FidWxhcnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2aWNlOiBUYXhvbm9teVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgb2F1dGhlU3RvcmFnZTogT0F1dGhTdG9yYWdlLFxuICAgICAgICBwdWJsaWMgZGlhbG9nOiBNYXREaWFsb2csXG4gICAgICAgIHByaXZhdGUgX3NuYWNrQmFyOiBNYXRTbmFja0JhcikgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5nZXRBdXRoZW50aWNhdGVkVXNlclBlcm1pc3Npb25zKCk7XG4gICAgICAgIHRoaXMubG9hZFZvY2FidWxhcmllcygpO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIH1cblxuICAgIHNlbGVjdFZvY2FiKGl0ZW06IFZvY2FidWxhcnkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50Vm9jYWIgPSBpdGVtO1xuICAgIH1cblxuICAgIGxvYWRWb2NhYnVsYXJpZXMoKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRWb2NhYnVsYXJpZXMoKS5waXBlKFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IE1heWJlIHlvdSBtdXN0IHNldCBhIGJldHRlciByZXR1cm4uXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBmaW5hbGl6ZSgoKSA9PiB0aGlzLmxvYWRpbmcgPSBmYWxzZSlcbiAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudm9jYWJ1bGFyaWVzID0gcmVzcG9uc2UuZGF0YS52b2NhYnVsYXJpZXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRWb2NhYnVsYXJpZXMgPSB0aGlzLnZvY2FiQ3RybC52YWx1ZUNoYW5nZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlPHN0cmluZywgVm9jYWJ1bGFyeVtdPihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFdpdGgoJycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZvY2FidWxhcmllcy5maWx0ZXIodm9jYWIgPT4gdm9jYWIubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlLnRvTG93ZXJDYXNlKCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZvY2FidWxhcmllcyA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5ld1ZvY2FiKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm9wZW5Wb2NhYkRpYWxvZyhudWxsKTtcbiAgICB9XG5cbiAgICBlZGl0Vm9jYWIodm9jYWI6IGFueSkge1xuICAgICAgICB0aGlzLm9wZW5Wb2NhYkRpYWxvZyh2b2NhYik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvcGVuVm9jYWJEaWFsb2codm9jYWI6IFZvY2FidWxhcnkpIHtcblxuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFZvY2FidWxhcnlEaWFsb2dDb21wb25lbnQsIHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB2b2NhYjogdm9jYWIsXG4gICAgICAgICAgICAgICAgYWNjZXB0OiAodm9jOiBWb2NhYnVsYXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlQWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2b2MuaXNOZXcpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLm5ld1ZvY2FidWxhcnkodm9jKS5waXBlKCkuc3Vic2NyaWJlKHRoaXMudm9jYWJ1bGFyaWVzQ2hhbmdlT2JzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmVkaXRWb2NhYnVsYXJ5KHZvYykucGlwZSgpLnN1YnNjcmliZSh0aGlzLnZvY2FidWxhcmllc0NoYW5nZU9ic2VydmVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGRpYWxvZ1JlZi5hZnRlckNsb3NlZCgpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RpYWxvZyBjbG9zZWQnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZGVsZXRlVm9jYWIodm9jYWI6IFZvY2FidWxhcnkpIHtcbiAgICB9XG5cbiAgICBvblNlbGVjdGlvbkNoYW5nZSgpe1xuICAgICAgICB0aGlzLnNlbGVjdGVkVm9jYWIuZW1pdCh0aGlzLmN1cnJlbnRWb2NhYik7XG4gICAgfVxuXG4gICAgZ2V0QXV0aGVudGljYXRlZFVzZXJQZXJtaXNzaW9ucygpIHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLmdldEN1cnJlbnRVc2VyUGVybWlzc2lvbnMoKS5waXBlKFxuICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IE1heWJlIHlvdSBtdXN0IHNldCBhIGJldHRlciByZXR1cm4uXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXF1ZXN0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwZXJtSnNvbiA9IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuZGF0YS5wZXJtaXNzaW9ucy5hY3Rpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYXV0aGVTdG9yYWdlLnNldEl0ZW0oJ3VzZXJfcGVybWlzc2lvbnMnLCBwZXJtSnNvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaGFzUGVybWlzc2lvbihwZXJtaXNzaW9uOiBzdHJpbmcsIGlkPzogc3RyaW5nKTogYm9vbGVhbiB7XG5cbiAgICAgICAgY29uc3QgdXNlclBlcm1pc3Npb24gPSBKU09OLnBhcnNlKHRoaXMub2F1dGhlU3RvcmFnZS5nZXRJdGVtKCd1c2VyX3Blcm1pc3Npb25zJykpO1xuICAgICAgICBpZiAoIXVzZXJQZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChwZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgICAgICAgIGlmICh1c2VyUGVybWlzc2lvbi50YXhvbm9teV9mdWxsX2VkaXRvcl9hY3Rpb25zID09PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgY2FzZSAnZWRpdCc6XG4gICAgICAgICAgICAgICAgaWYgKHVzZXJQZXJtaXNzaW9uLnRheG9ub215X2Z1bGxfZWRpdG9yX2FjdGlvbnMgPT09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJQZXJtaXNzaW9uLnZvY2FidWxhcnlfZWRpdG9yX2FjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyOiBBcnJheTxzdHJpbmc+ID0gdXNlclBlcm1pc3Npb24udm9jYWJ1bGFyeV9lZGl0b3JfYWN0aW9ucztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJyLmluY2x1ZGVzKGlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVzZXJQZXJtaXNzaW9uLnRheG9ub215X2Z1bGxfZWRpdG9yX2FjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==