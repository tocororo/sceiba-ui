/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/catalog-filters/catalog-filters.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component, ComponentFactoryResolver } from '@angular/core';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { MatSnackBar } from '@angular/material';
import { FilterItem } from '../../filters/public-api';
import { BooleanFilterComponent } from '../../filters/public-api';
import { FilterContainerService } from '../../filters/public-api';
import { FilterContainerComponent } from '../../filters/public-api';
import { MessageHandler, StatusCode } from '../../core/public-api';
import { CatalogService, TaxonomyService } from '../../backend/public-api';
import { Environment } from '../../core/env';
import { VocabulariesInmutableNames } from '../../entities/public-api';
var CatalogFiltersComponent = /** @class */ (function (_super) {
    tslib_1.__extends(CatalogFiltersComponent, _super);
    function CatalogFiltersComponent(componentFactoryResolver, childrenService, service, taxonomyService, _snackBar, env) {
        var _this = _super.call(this, componentFactoryResolver, childrenService) || this;
        _this.componentFactoryResolver = componentFactoryResolver;
        _this.childrenService = childrenService;
        _this.service = service;
        _this.taxonomyService = taxonomyService;
        _this._snackBar = _snackBar;
        _this.env = env;
        return _this;
    }
    /**
     * @return {?}
     */
    CatalogFiltersComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        this.addOperator();
        // tslint:disable-next-line: no-use-before-declare
        default_filters.forEach((/**
         * @param {?} filter
         * @return {?}
         */
        function (filter) {
            _this.filters_data.push(filter);
        }));
        this.service.getJournalsVocab().pipe(catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            /** @type {?} */
            var m = new MessageHandler(_this._snackBar);
            m.showMessage(StatusCode.serverError, error.message);
            return of(null);
        })))
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response) {
                response.data.vocabularies.forEach((/**
                 * @param {?} vocab
                 * @return {?}
                 */
                function (vocab) {
                    if (VocabulariesInmutableNames.CUBAN_INTITUTIONS === vocab.id
                        && _this.env.topOrganizationPID !== '') {
                        console.log(_this.env.topOrganizationPID);
                        _this.taxonomyService.getTermByUUID(_this.env.topOrganizationPID).subscribe((/**
                         * @param {?} termsResponse
                         * @return {?}
                         */
                        function (termsResponse) {
                            _this.filters_data.push({
                                index: _this.filters_data.length,
                                field: 'terms',
                                type: 'tree',
                                placeholder: vocab.human_name,
                                name: vocab.human_name,
                                idVocab: vocab.id,
                                selectOptions: termsResponse.data.term_node.children,
                                is_enabled: true
                            });
                        }));
                    }
                    else {
                        _this.service.getTerminosByVocab(vocab.id).subscribe((/**
                         * @param {?} termsResponse
                         * @return {?}
                         */
                        function (termsResponse) {
                            _this.filters_data.push({
                                index: _this.filters_data.length,
                                field: 'terms',
                                type: 'select-autocomplete',
                                placeholder: vocab.human_name,
                                name: vocab.human_name,
                                idVocab: vocab.id,
                                selectOptions: termsResponse.data.terms,
                                is_enabled: true
                            });
                        }));
                    }
                }));
            }
            else {
                /** @type {?} */
                var m = new MessageHandler(_this._snackBar);
                m.showMessage(StatusCode.serverError, "No puedo cargar los vocabularios");
            }
        }));
    };
    /**
     * @return {?}
     */
    CatalogFiltersComponent.prototype.addOperator = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var f = new FilterItem(BooleanFilterComponent, { field: 'op', value: true, name: ['AND', 'OR'], is_enabled: false, index: -1 });
        // this.current_filters.push(f);
        /** @type {?} */
        var componentFactory = this.componentFactoryResolver.resolveComponentFactory(f.component);
        /** @type {?} */
        var viewContainerRef = this.adHost.viewContainerRef;
        // viewContainerRef.clear();
        /** @type {?} */
        var componentRef = viewContainerRef.createComponent(componentFactory);
        ((/** @type {?} */ (componentRef.instance))).data = f.data;
    };
    CatalogFiltersComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-catalog-filters-container',
                    template: "<!-- <div fxLayout=\"row wrap\" fxLayoutAlign=\"start center\" fxLayoutAlign.xs=\"center center\" fxLayoutGap=\"1em\" fxLayoutGap.xs=\"0\"> -->\n\n  <ng-template toco-Filter></ng-template>\n\n<!-- </div> -->\n\n<button mat-icon-button [matMenuTriggerFor]=\"menu\">\n    <mat-icon>add</mat-icon>\n</button>\n  <mat-menu #menu=\"matMenu\" >\n    <ng-container *ngFor=\"let item of filters_data,let i=index\">\n        <ng-container *ngIf=\"item.is_enabled\">\n          <button mat-menu-item (click)=\"addFilter(i)\">\n            {{item.name}}\n          </button>\n        </ng-container>\n    </ng-container>\n    \n\n    \n  </mat-menu>",
                    styles: [".width-100{width:100%}.mat-menu-item{height:37px}"]
                }] }
    ];
    /** @nocollapse */
    CatalogFiltersComponent.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: FilterContainerService },
        { type: CatalogService },
        { type: TaxonomyService },
        { type: MatSnackBar },
        { type: Environment }
    ]; };
    return CatalogFiltersComponent;
}(FilterContainerComponent));
export { CatalogFiltersComponent };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    CatalogFiltersComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @protected
     */
    CatalogFiltersComponent.prototype.childrenService;
    /**
     * @type {?}
     * @protected
     */
    CatalogFiltersComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    CatalogFiltersComponent.prototype.taxonomyService;
    /**
     * @type {?}
     * @private
     */
    CatalogFiltersComponent.prototype._snackBar;
    /**
     * @type {?}
     * @private
     */
    CatalogFiltersComponent.prototype.env;
}
/** @type {?} */
var default_filters = [
    {
        index: 0,
        field: 'title',
        type: 'search',
        placeholder: 'Título',
        name: 'Título',
        is_enabled: true
    },
    {
        index: 1,
        field: 'issn',
        type: 'text',
        placeholder: 'ISSN',
        name: 'ISSN',
        is_enabled: true
    } /*,
        {
            index: 2,
            field: 'e_issn',
            type: 'text',
            placeholder: 'eISSN',
            name: 'eISSN',
            is_enabled: true
        },
        {
            index: 3,
            field: 'i_issn',
            type: 'text',
            placeholder: 'iISSN',
            name: 'iISSN',
            is_enabled: true
        }*/,
    {
        index: 2,
        field: 'rnps',
        type: 'number',
        placeholder: 'RNPS',
        name: 'RNPS',
        is_enabled: true
    } /*,
        {
            index: 5,
            field: 'term',
            type: 'select',
            placeholder: 'Términos',
            name: 'Términos',
            is_enabled: true
        } */
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2F0YWxvZy1maWx0ZXJzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3NvdXJjZXMvY2F0YWxvZy1maWx0ZXJzL2NhdGFsb2ctZmlsdGVycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQU1BLE9BQU8sRUFBRSxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEUsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBR2hELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsY0FBYyxFQUFFLFVBQVUsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRW5FLE9BQU8sRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0UsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXZFO0lBSzZDLG1EQUF3QjtJQUVuRSxpQ0FBc0Isd0JBQWtELEVBQzVELGVBQXVDLEVBQ3ZDLE9BQXVCLEVBQ3pCLGVBQWdDLEVBQ2hDLFNBQXNCLEVBQ3RCLEdBQWdCO1FBTDFCLFlBTUUsa0JBQU0sd0JBQXdCLEVBQUUsZUFBZSxDQUFDLFNBQ2pEO1FBUHFCLDhCQUF3QixHQUF4Qix3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QXdCOzs7SUE2RXRCLGVBQWUsR0FDbkI7SUFDRTtRQUNFLEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLE9BQU87UUFDZCxJQUFJLEVBQUUsUUFBUTtRQUNkLFdBQVcsRUFBRSxRQUFRO1FBQ3JCLElBQUksRUFBRSxRQUFRO1FBQ2QsVUFBVSxFQUFFLElBQUk7S0FDakI7SUFDRDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJLEVBQUUsTUFBTTtRQUNaLFdBQVcsRUFBRSxNQUFNO1FBQ25CLElBQUksRUFBRSxNQUFNO1FBQ1osVUFBVSxFQUFFLElBQUk7S0FDakIsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7OztXQWdCTTtJQUNQO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFDUixLQUFLLEVBQUUsTUFBTTtRQUNiLElBQUksRUFBRSxRQUFRO1FBQ2QsV0FBVyxFQUFFLE1BQU07UUFDbkIsSUFBSSxFQUFFLE1BQU07UUFDWixVQUFVLEVBQUUsSUFBSTtLQUNqQixDQUFBOzs7Ozs7OztZQVFPO0NBQ1QiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogICBDb3B5cmlnaHQgKGMpIDIwMjAgVW5pdmVyc2lkYWQgZGUgUGluYXIgZGVsIFLDrW8gXCJIZXJtYW5vcyBTYcOteiBNb250ZXMgZGUgT2NhXCJcbiAqICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5cbmltcG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5pbXBvcnQgeyBGaWx0ZXJDb21wb25lbnQgfSBmcm9tICcuLi8uLi9maWx0ZXJzL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgRmlsdGVySXRlbSB9IGZyb20gJy4uLy4uL2ZpbHRlcnMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBCb29sZWFuRmlsdGVyQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZmlsdGVycy9wdWJsaWMtYXBpJztcbmltcG9ydCB7IEZpbHRlckNvbnRhaW5lclNlcnZpY2UgfSBmcm9tICcuLi8uLi9maWx0ZXJzL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgRmlsdGVyQ29udGFpbmVyQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZmlsdGVycy9wdWJsaWMtYXBpJztcbmltcG9ydCB7IE1lc3NhZ2VIYW5kbGVyLCBTdGF0dXNDb2RlIH0gZnJvbSAnLi4vLi4vY29yZS9wdWJsaWMtYXBpJztcblxuaW1wb3J0IHsgQ2F0YWxvZ1NlcnZpY2UsIFRheG9ub215U2VydmljZSB9IGZyb20gJy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJy4uLy4uL2NvcmUvZW52JztcbmltcG9ydCB7IFZvY2FidWxhcmllc0lubXV0YWJsZU5hbWVzIH0gZnJvbSAnLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RvY28tY2F0YWxvZy1maWx0ZXJzLWNvbnRhaW5lcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9jYXRhbG9nLWZpbHRlcnMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jYXRhbG9nLWZpbHRlcnMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDYXRhbG9nRmlsdGVyc0NvbXBvbmVudCBleHRlbmRzIEZpbHRlckNvbnRhaW5lckNvbXBvbmVudCB7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByb3RlY3RlZCBjaGlsZHJlblNlcnZpY2U6IEZpbHRlckNvbnRhaW5lclNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHNlcnZpY2U6IENhdGFsb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgdGF4b25vbXlTZXJ2aWNlOiBUYXhvbm9teVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBfc25hY2tCYXI6IE1hdFNuYWNrQmFyLFxuICAgIHByaXZhdGUgZW52OiBFbnZpcm9ubWVudCkge1xuICAgIHN1cGVyKGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgY2hpbGRyZW5TZXJ2aWNlKVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcblxuICAgIHRoaXMuYWRkT3BlcmF0b3IoKTtcblxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tdXNlLWJlZm9yZS1kZWNsYXJlXG4gICAgZGVmYXVsdF9maWx0ZXJzLmZvckVhY2goZmlsdGVyID0+IHtcbiAgICAgIHRoaXMuZmlsdGVyc19kYXRhLnB1c2goZmlsdGVyKTtcbiAgICB9KTtcblxuICAgIHRoaXMuc2VydmljZS5nZXRKb3VybmFsc1ZvY2FiKCkucGlwZShcbiAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLnNlcnZlckVycm9yLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgfSlcbiAgICApXG4gICAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgcmVzcG9uc2UuZGF0YS52b2NhYnVsYXJpZXMuZm9yRWFjaCh2b2NhYiA9PiB7XG4gICAgICAgICAgICBpZiAoVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXMuQ1VCQU5fSU5USVRVVElPTlMgPT09IHZvY2FiLmlkXG4gICAgICAgICAgICAgICYmIHRoaXMuZW52LnRvcE9yZ2FuaXphdGlvblBJRCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5lbnYudG9wT3JnYW5pemF0aW9uUElEKTtcbiAgICAgICAgICAgICAgdGhpcy50YXhvbm9teVNlcnZpY2UuZ2V0VGVybUJ5VVVJRCh0aGlzLmVudi50b3BPcmdhbml6YXRpb25QSUQpLnN1YnNjcmliZSh0ZXJtc1Jlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcnNfZGF0YS5wdXNoKFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpbmRleDogdGhpcy5maWx0ZXJzX2RhdGEubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3Rlcm1zJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RyZWUnLFxuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogdm9jYWIuaHVtYW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdm9jYWIuaHVtYW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgaWRWb2NhYjogdm9jYWIuaWQsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdE9wdGlvbnM6IHRlcm1zUmVzcG9uc2UuZGF0YS50ZXJtX25vZGUuY2hpbGRyZW4sXG4gICAgICAgICAgICAgICAgICAgIGlzX2VuYWJsZWQ6IHRydWVcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuc2VydmljZS5nZXRUZXJtaW5vc0J5Vm9jYWIodm9jYWIuaWQpLnN1YnNjcmliZSh0ZXJtc1Jlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcnNfZGF0YS5wdXNoKFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpbmRleDogdGhpcy5maWx0ZXJzX2RhdGEubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3Rlcm1zJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NlbGVjdC1hdXRvY29tcGxldGUnLFxuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogdm9jYWIuaHVtYW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdm9jYWIuaHVtYW5fbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgaWRWb2NhYjogdm9jYWIuaWQsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdE9wdGlvbnM6IHRlcm1zUmVzcG9uc2UuZGF0YS50ZXJtcyxcbiAgICAgICAgICAgICAgICAgICAgaXNfZW5hYmxlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICBtLnNob3dNZXNzYWdlKFN0YXR1c0NvZGUuc2VydmVyRXJyb3IsIFwiTm8gcHVlZG8gY2FyZ2FyIGxvcyB2b2NhYnVsYXJpb3NcIik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgYWRkT3BlcmF0b3IoKSB7XG4gICAgY29uc3QgZiA9IG5ldyBGaWx0ZXJJdGVtKEJvb2xlYW5GaWx0ZXJDb21wb25lbnQsIHsgZmllbGQ6ICdvcCcsIHZhbHVlOiB0cnVlLCBuYW1lOiBbJ0FORCcsICdPUiddLCBpc19lbmFibGVkOiBmYWxzZSwgaW5kZXg6IC0xIH0pO1xuICAgIC8vIHRoaXMuY3VycmVudF9maWx0ZXJzLnB1c2goZik7XG4gICAgY29uc3QgY29tcG9uZW50RmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGYuY29tcG9uZW50KTtcbiAgICBjb25zdCB2aWV3Q29udGFpbmVyUmVmID0gdGhpcy5hZEhvc3Qudmlld0NvbnRhaW5lclJlZjtcbiAgICAvLyB2aWV3Q29udGFpbmVyUmVmLmNsZWFyKCk7XG4gICAgY29uc3QgY29tcG9uZW50UmVmID0gdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XG4gICAgKDxGaWx0ZXJDb21wb25lbnQ+Y29tcG9uZW50UmVmLmluc3RhbmNlKS5kYXRhID0gZi5kYXRhO1xuICB9XG5cbn1cblxuY29uc3QgZGVmYXVsdF9maWx0ZXJzID1cbiAgW1xuICAgIHtcbiAgICAgIGluZGV4OiAwLFxuICAgICAgZmllbGQ6ICd0aXRsZScsXG4gICAgICB0eXBlOiAnc2VhcmNoJyxcbiAgICAgIHBsYWNlaG9sZGVyOiAnVMOtdHVsbycsXG4gICAgICBuYW1lOiAnVMOtdHVsbycsXG4gICAgICBpc19lbmFibGVkOiB0cnVlXG4gICAgfSxcbiAgICB7XG4gICAgICBpbmRleDogMSxcbiAgICAgIGZpZWxkOiAnaXNzbicsXG4gICAgICB0eXBlOiAndGV4dCcsXG4gICAgICBwbGFjZWhvbGRlcjogJ0lTU04nLFxuICAgICAgbmFtZTogJ0lTU04nLFxuICAgICAgaXNfZW5hYmxlZDogdHJ1ZVxuICAgIH0vKixcbiAgICAgICAge1xuICAgICAgICAgICAgaW5kZXg6IDIsXG4gICAgICAgICAgICBmaWVsZDogJ2VfaXNzbicsXG4gICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogJ2VJU1NOJyxcbiAgICAgICAgICAgIG5hbWU6ICdlSVNTTicsXG4gICAgICAgICAgICBpc19lbmFibGVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGluZGV4OiAzLFxuICAgICAgICAgICAgZmllbGQ6ICdpX2lzc24nLFxuICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdpSVNTTicsXG4gICAgICAgICAgICBuYW1lOiAnaUlTU04nLFxuICAgICAgICAgICAgaXNfZW5hYmxlZDogdHJ1ZVxuICAgICAgICB9Ki8sXG4gICAge1xuICAgICAgaW5kZXg6IDIsXG4gICAgICBmaWVsZDogJ3JucHMnLFxuICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICBwbGFjZWhvbGRlcjogJ1JOUFMnLFxuICAgICAgbmFtZTogJ1JOUFMnLFxuICAgICAgaXNfZW5hYmxlZDogdHJ1ZVxuICAgIH0vKixcbiAgICAgICAge1xuICAgICAgICAgICAgaW5kZXg6IDUsXG4gICAgICAgICAgICBmaWVsZDogJ3Rlcm0nLFxuICAgICAgICAgICAgdHlwZTogJ3NlbGVjdCcsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogJ1TDqXJtaW5vcycsXG4gICAgICAgICAgICBuYW1lOiAnVMOpcm1pbm9zJyxcbiAgICAgICAgICAgIGlzX2VuYWJsZWQ6IHRydWVcbiAgICAgICAgfSAqL1xuICBdO1xuIl19