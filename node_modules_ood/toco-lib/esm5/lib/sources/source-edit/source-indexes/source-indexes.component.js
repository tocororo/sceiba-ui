/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/source-edit/source-indexes/source-indexes.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Inject } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { MatDialog, MAT_DIALOG_DATA } from '@angular/material';
import { TaxonomyService } from '../../../backend/public-api';
import { SourceData, SourceClasification, VocabulariesInmutableNames } from '../../../entities/public-api';
import { InputTextComponent, FormFieldType, SelectComponent, InputUrlComponent, HintValue, HintPosition } from '../../../forms/public-api';
var SourceIndexesComponent = /** @class */ (function () {
    function SourceIndexesComponent(dialog, service) {
        this.dialog = dialog;
        this.service = service;
        this.editable = true;
        /*
            el arbol entero de los indexes
            el primer nivel se considera que es una clasificacion del index, por ejemplo
                {
                  "children": {...}
                  "term": {
                    "clasified_ids": [],
                    "class_ids": [],
                    "data": null,
                    "description": "WoS / Scopus",
                    "id": 4355,
                    "name": "http://miar.ub.edu/databases/GRUPO/G",
                    "parent_id": null,
                    "uuid": "a4aae8a2-b65d-4313-b666-5ef4170fc549",
                    "vocabulary_id": "INDEXES"
                  }
                }
            en el segundo nivel (children) estan los indices(bases de datos) que realmente clasifican a las fuentes
          */
        this.databases = null;
        /*
            cada elemento de este array tiene:
            dbclass, que es un termino del primer nivel de databases,
            dblist, son las clasificaciones de las fuentes con los correspondientes datos,
              los terminos correspondientes de los elementos de dblist son hijos de dbclass en databses
          */
        this.selectedDatabases = null;
    }
    /**
     * @return {?}
     */
    SourceIndexesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.service.getTermsTreeByVocab(VocabulariesInmutableNames.INDEXES, 1).subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response.data.tree.term_node) {
                _this.databases = response.data.tree.term_node;
                _this.initIndexes();
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.log('ERROR: ' + err + '.');
        }), (/**
         * @return {?}
         */
        function () {
        }));
    };
    /**
     * @return {?}
     */
    SourceIndexesComponent.prototype.initIndexes = /**
     * @return {?}
     */
    function () {
        this.selectedDatabases = new Array(this.databases.length);
        this._setSelectedDatabses();
        this._setIndexesToSource();
        console.log('******* complete process');
    };
    /**
     * divide los source.classifications que son de INDEXES
     * en el arreglo selectedDatabases, cuyos elementos tienen
     * dbclass, que es el primer nivel
     * dblist, que son los SourceClassification seleccionados e hijos de dbclass
     */
    /**
     * divide los source.classifications que son de INDEXES
     * en el arreglo selectedDatabases, cuyos elementos tienen
     * dbclass, que es el primer nivel
     * dblist, que son los SourceClassification seleccionados e hijos de dbclass
     * @private
     * @return {?}
     */
    SourceIndexesComponent.prototype._setSelectedDatabses = /**
     * divide los source.classifications que son de INDEXES
     * en el arreglo selectedDatabases, cuyos elementos tienen
     * dbclass, que es el primer nivel
     * dblist, que son los SourceClassification seleccionados e hijos de dbclass
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        var _loop_1 = function (i) {
            this_1.selectedDatabases[i] = {
                dbclass: this_1.databases[i].term,
                dblist: this_1.sourceData.classifications.filter((/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) {
                    return value.vocabulary == VocabulariesInmutableNames.INDEXES &&
                        _this.databases[i].children.find((/**
                         * @param {?} db
                         * @return {?}
                         */
                        function (db) { return db.term.uuid == value.id; })) != undefined;
                }))
            };
        };
        var this_1 = this;
        for (var i = 0; i < this.databases.length; i++) {
            _loop_1(i);
        }
        for (var i = 0; i < this.databases.length; i++) {
            for (var k = 0; k < this.selectedDatabases[i].dblist.length; k++) {
                /** @type {?} */
                var element = this.selectedDatabases[i].dblist[k];
                if (!this.selectedDatabases[i].dblist[k].data) {
                    this.selectedDatabases[i].dblist[k].data = {};
                }
                if (!this.selectedDatabases[i].dblist[k].data['url']) {
                    this.selectedDatabases[i].dblist[k].data['url'] = '';
                }
                if (!this.selectedDatabases[i].dblist[k].data['initial_cover']) {
                    this.selectedDatabases[i].dblist[k].data['initial_cover'] = '';
                }
                if (!this.selectedDatabases[i].dblist[k].data['end_cover']) {
                    this.selectedDatabases[i].dblist[k].data['end_cover'] = '';
                }
            }
        }
    };
    /**
     * mantiene la lista sourceData.classification bien formada en relacion con lo que hay en selectedDatabases
     */
    /**
     * mantiene la lista sourceData.classification bien formada en relacion con lo que hay en selectedDatabases
     * @private
     * @return {?}
     */
    SourceIndexesComponent.prototype._setIndexesToSource = /**
     * mantiene la lista sourceData.classification bien formada en relacion con lo que hay en selectedDatabases
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // filtra las clasificaciones que no sean indexes
        this.sourceData.classifications = this.sourceData.classifications.filter((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return value.vocabulary != VocabulariesInmutableNames.INDEXES; }));
        this.selectedDatabases.forEach((/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            // por cada elemento en selectedDatabases, si tiene algun elemento en dblist
            // entonces dbclass y dblist tambien son parte de sourceData.classifications
            if (element.dblist.length > 0) {
                /** @type {?} */
                var parent_1 = new SourceClasification();
                parent_1.id = element.dbclass.uuid;
                parent_1.description = element.dbclass.description;
                parent_1.vocabulary = element.dbclass.vocabulary_id;
                _this.sourceData.classifications.push(parent_1);
                _this.sourceData.classifications = _this.sourceData.classifications.concat(element.dblist);
            }
        }));
        console.log(this.sourceData);
    };
    /**
     * @param {?} dbclassIndex
     * @return {?}
     */
    SourceIndexesComponent.prototype.addIndexAction = /**
     * @param {?} dbclassIndex
     * @return {?}
     */
    function (dbclassIndex) {
        var _this = this;
        /** @type {?} */
        var dbclass = this.selectedDatabases[dbclassIndex].dbclass;
        /** @type {?} */
        var options = this.databases[dbclassIndex].children.filter((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            return _this.selectedDatabases[dbclassIndex].dblist.find((/**
             * @param {?} db
             * @return {?}
             */
            function (db) { return db.id == value.term.uuid; })) == undefined;
        }));
        if (options.length > 0) {
            this.dialog.open(SourceEditAddIndexComponent, {
                data: {
                    dbclass: this.selectedDatabases[dbclassIndex].dbclass,
                    options: options,
                    editing: null,
                    addIndex: (/**
                     * @param {?} result
                     * @return {?}
                     */
                    function (result) {
                        _this.dialog.closeAll();
                        _this.selectedDatabases[dbclassIndex].dblist = _this.selectedDatabases[dbclassIndex].dblist.filter((/**
                         * @param {?} value
                         * @return {?}
                         */
                        function (value) { return value.id != result.id; }));
                        _this.selectedDatabases[dbclassIndex].dblist.push(result);
                        _this._setIndexesToSource();
                    }),
                },
            });
        }
    };
    /**
     * @param {?} dbclassIndex
     * @param {?} editing
     * @return {?}
     */
    SourceIndexesComponent.prototype.editIndexAction = /**
     * @param {?} dbclassIndex
     * @param {?} editing
     * @return {?}
     */
    function (dbclassIndex, editing) {
        var _this = this;
        /** @type {?} */
        var dbclass = this.selectedDatabases[dbclassIndex].dbclass;
        if (editing) {
            // this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter(
            //   value => value.id != editing.id
            // );
            /** @type {?} */
            var options = this.databases[dbclassIndex].children.filter((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                return _this.selectedDatabases[dbclassIndex].dblist.find((/**
                 * @param {?} db
                 * @return {?}
                 */
                function (db) { return db.id == value.term.uuid; })) == undefined ||
                    value.term.uuid == editing.id;
            }));
            if (options.length > 0 || editing) {
                this.dialog.open(SourceEditAddIndexComponent, {
                    data: {
                        dbclass: this.selectedDatabases[dbclassIndex].dbclass,
                        options: options,
                        editing: editing,
                        addIndex: (/**
                         * @param {?} result
                         * @return {?}
                         */
                        function (result) {
                            _this.dialog.closeAll();
                            // console.log('----------------------------',this.selectedDatabases[dbclassIndex].dblist);
                            /** @type {?} */
                            var newSelected = [];
                            _this.selectedDatabases[dbclassIndex].dblist.forEach((/**
                             * @param {?} element
                             * @return {?}
                             */
                            function (element) {
                                if (element.id != result.id && element.id != editing.id) {
                                    newSelected.push(element);
                                }
                            }));
                            _this.selectedDatabases[dbclassIndex].dblist = newSelected;
                            // this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter(
                            //   value => (value.id == result.id && value.id == editing.id));
                            // console.log('++++++++++++++++++++++',this.selectedDatabases[dbclassIndex].dblist);
                            _this.selectedDatabases[dbclassIndex].dblist.push(result);
                            // console.log('*********************',this.selectedDatabases[dbclassIndex].dblist);
                            _this._setIndexesToSource();
                        }),
                    },
                });
            }
        }
    };
    /**
     * @param {?} dbclassIndex
     * @param {?} toDelete
     * @return {?}
     */
    SourceIndexesComponent.prototype.deleteIndexAction = /**
     * @param {?} dbclassIndex
     * @param {?} toDelete
     * @return {?}
     */
    function (dbclassIndex, toDelete) {
        // console.log('DELETE', toDelete);
        this.selectedDatabases[dbclassIndex].dblist = this.selectedDatabases[dbclassIndex].dblist.filter((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return value.id != toDelete.id; }));
        this._setIndexesToSource();
    };
    SourceIndexesComponent.decorators = [
        { type: Component, args: [{
                    selector: "toco-source-indexes",
                    template: "<mat-progress-bar\n  *ngIf=\"!selectedDatabases\"\n  mode=\"indeterminate\"\n></mat-progress-bar>\n\n<mat-accordion *ngIf=\"selectedDatabases\">\n  <mat-expansion-panel\n    *ngFor=\"let clasification of selectedDatabases; let classIndex = index\"\n  >\n    <mat-expansion-panel-header>\n      {{ clasification.dbclass.description }} ({{clasification.dblist.length}})\n    </mat-expansion-panel-header>\n    <mat-action-row *ngIf=\"editable\">\n      <button\n          mat-icon-button\n          aria-label=\"Adicionar\"\n          matTooltip=\"Adicionar\"\n          (click)=\"addIndexAction(classIndex)\"\n        >\n          <mat-icon>add</mat-icon>\n        </button>\n    </mat-action-row>\n    <mat-card *ngFor=\"let db of clasification.dblist; let dbIndex = index\">\n      <mat-card-header>\n        <mat-card-title><mat-label>{{ db.description }}</mat-label></mat-card-title>\n        <mat-card-subtitle>\n          <mat-label style=\"font-weight: bold;\">URL: </mat-label>\n          {{ db.data[\"url\"] }}\n        </mat-card-subtitle>\n      </mat-card-header>\n      <mat-card-content>\n          <mat-label style=\"font-weight: bold;\">Cobertura: </mat-label>\n          <mat-label>\n            {{ db.data[\"initial_cover\"] }} - {{ db.data[\"end_cover\"] }}\n          </mat-label>\n      </mat-card-content>\n      <mat-card-actions *ngIf=\"editable\">\n        <button\n          mat-icon-button\n          aria-label=\"Editar\"\n          matTooltip=\"Editar\"\n          (click)=\"editIndexAction(classIndex, db)\"\n        >\n          <mat-icon>edit</mat-icon>\n        </button>\n        <button\n          mat-icon-button\n          aria-label=\"Eliminar\"\n          matTooltip=\"Eliminar\"\n          (click)=\"deleteIndexAction(classIndex, db)\"\n        >\n          <mat-icon>delete</mat-icon>\n        </button>\n      </mat-card-actions>\n    </mat-card>\n  </mat-expansion-panel>\n</mat-accordion>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SourceIndexesComponent.ctorParameters = function () { return [
        { type: MatDialog },
        { type: TaxonomyService }
    ]; };
    SourceIndexesComponent.propDecorators = {
        sourceData: [{ type: Input }],
        editable: [{ type: Input }]
    };
    return SourceIndexesComponent;
}());
export { SourceIndexesComponent };
if (false) {
    /** @type {?} */
    SourceIndexesComponent.prototype.sourceData;
    /** @type {?} */
    SourceIndexesComponent.prototype.editable;
    /** @type {?} */
    SourceIndexesComponent.prototype.databases;
    /** @type {?} */
    SourceIndexesComponent.prototype.selectedDatabases;
    /** @type {?} */
    SourceIndexesComponent.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    SourceIndexesComponent.prototype.service;
}
var SourceEditAddIndexComponent = /** @class */ (function () {
    function SourceEditAddIndexComponent(service, _formBuilder, data) {
        // console.log(data);
        this.service = service;
        this._formBuilder = _formBuilder;
        this.data = data;
        this.indexPanel = null;
        this.editing = null;
        this.dbclass = data.dbclass;
        this.options = data.options;
        if (data.editing) {
            this.editing = data.editing;
        }
        this.addIndex = data.addIndex;
    }
    /**
     * @return {?}
     */
    SourceEditAddIndexComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.indexFormGroup = this._formBuilder.group({});
        if (this.dbclass) {
            this.indexPanel = [
                {
                    title: (this.editing) ? 'Editar' : 'Adicionar',
                    description: '',
                    iconName: '',
                    formSection: this.indexFormGroup,
                    formSectionContent: [
                        {
                            formControl: InputTextComponent.getFormControlByDefault(),
                            name: 'indexes',
                            label: this.dbclass.description,
                            type: FormFieldType.select_expr,
                            controlType: SelectComponent,
                            required: true,
                            width: '100%',
                            value: (this.editing) ? this.editing.id : null,
                            extraContent: {
                                multiple: false,
                                getOptions: (/**
                                 * @param {?} response
                                 * @return {?}
                                 */
                                function (response) {
                                    /** @type {?} */
                                    var opts = [];
                                    _this.options.forEach((/**
                                     * @param {?} node
                                     * @return {?}
                                     */
                                    function (node) {
                                        opts.push({
                                            value: node.term.uuid,
                                            label: node.term.description,
                                        });
                                    }));
                                    return opts;
                                }),
                                selectionChange: (/**
                                 * @param {?} value
                                 * @return {?}
                                 */
                                function (value) {
                                    console.log(value);
                                })
                            }
                        },
                        {
                            formControl: InputUrlComponent.getFormControlByDefault(),
                            name: 'url',
                            label: 'URL',
                            type: FormFieldType.url,
                            controlType: InputUrlComponent,
                            required: false,
                            startHint: new HintValue(HintPosition.start, 'URL de la revista en el Ã­ndice.'),
                            width: '100%',
                            value: (this.editing) ? [this.editing.data['url']] : '',
                        },
                        {
                            formControl: InputTextComponent.getFormControlByDefault(),
                            name: 'initial_cover',
                            label: 'Cobertura inicio',
                            type: FormFieldType.text,
                            controlType: InputTextComponent,
                            required: false,
                            startHint: new HintValue(HintPosition.start, ''),
                            width: '45%',
                            value: (this.editing) ? [this.editing.data['initial_cover']] : '',
                        },
                        {
                            formControl: InputTextComponent.getFormControlByDefault(),
                            name: 'end_cover',
                            label: 'Cobertura',
                            type: FormFieldType.text,
                            controlType: InputTextComponent,
                            required: false,
                            startHint: new HintValue(HintPosition.start, ''),
                            width: '45%',
                            value: (this.editing) ? [this.editing.data['end_cover']] : '',
                        },
                    ],
                },
            ];
        }
        this.addIndexAction = {
            doit: (/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                if (_this.indexFormGroup.valid) {
                    /** @type {?} */
                    var result = new SourceClasification();
                    // console.log(this.indexFormGroup);
                    if (_this.indexFormGroup.controls['indexes'].value) {
                        /** @type {?} */
                        var node = _this.options.find((/**
                         * @param {?} value
                         * @return {?}
                         */
                        function (value) { return value.term.uuid == _this.indexFormGroup.controls['indexes'].value; }));
                        if (node) {
                            result.vocabulary = node.term.vocabulary_id;
                            result.description = node.term.description;
                            result.id = node.term.uuid;
                            result.data = {
                                url: _this.indexFormGroup.controls['url'].value,
                                initial_cover: _this.indexFormGroup.controls['initial_cover'].value,
                                end_cover: _this.indexFormGroup.controls['end_cover'].value,
                            };
                            _this.addIndex(result);
                        }
                    }
                }
            }),
        };
    };
    SourceEditAddIndexComponent.decorators = [
        { type: Component, args: [{
                    selector: "toco-source-addindex",
                    template: "\n    <toco-form-container\n      #indexPanelContainer\n      [panelsContent]=\"indexPanel\"\n      [useAccordion]=\"false\"\n      fxLayout=\"row\"\n      [formGroup]=\"indexFormGroup\"\n      [action]=\"addIndexAction\"\n      [actionLabel]=\"'OK'\"\n      [deleteValuesAfterAction]=\"false\"\n    ></toco-form-container>\n  ",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SourceEditAddIndexComponent.ctorParameters = function () { return [
        { type: TaxonomyService },
        { type: FormBuilder },
        { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    return SourceEditAddIndexComponent;
}());
export { SourceEditAddIndexComponent };
if (false) {
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.indexPanel;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.indexFormGroup;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.addIndexAction;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.dbclass;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.options;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.editing;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.addIndex;
    /**
     * @type {?}
     * @private
     */
    SourceEditAddIndexComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    SourceEditAddIndexComponent.prototype._formBuilder;
    /** @type {?} */
    SourceEditAddIndexComponent.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlLWluZGV4ZXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvc291cmNlcy9zb3VyY2UtZWRpdC9zb3VyY2UtaW5kZXhlcy9zb3VyY2UtaW5kZXhlcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakUsT0FBTyxFQUFhLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzlELE9BQU8sRUFBRSxVQUFVLEVBQWtCLG1CQUFtQixFQUFFLDBCQUEwQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDM0gsT0FBTyxFQUEwQyxrQkFBa0IsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFnQixpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFHak07SUF5Q0UsZ0NBQW1CLE1BQWlCLEVBQVUsT0FBd0I7UUFBbkQsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBL0IvRCxhQUFRLEdBQVksSUFBSSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztRQXFCaEMsY0FBUyxHQUFlLElBQUksQ0FBQzs7Ozs7OztRQVE3QixzQkFBaUIsR0FBNEQsSUFBSSxDQUFDO0lBRVIsQ0FBQzs7OztJQUczRSx5Q0FBUTs7O0lBQVI7UUFBQSxpQkFpQkM7UUFoQkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQywwQkFBMEIsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUzs7OztRQUMvRSxVQUFDLFFBQVE7WUFDUCxJ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QUksQ0FBQyxhQUFhLENBQUM7NEJBQzVDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7NEJBQzNDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7NEJBQzNCLE1BQU0sQ0FBQyxJQUFJLEdBQUc7Z0NBQ1osR0FBRyxFQUFFLEtBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUs7Z0NBQzlDLGFBQWEsRUFBRSxLQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxLQUFLO2dDQUNsRSxTQUFTLEVBQUUsS0FBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSzs2QkFDM0QsQ0FBQzs0QkFDRixLQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO3lCQUN2QjtxQkFDRjtpQkFDRjtZQUVILENBQUMsQ0FBQTtTQUNGLENBQUM7SUFDSixDQUFDOztnQkFsSkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxzQkFBc0I7b0JBRWhDLFFBQVEsRUFBRSx5VUFXVDs7aUJBQ0Y7Ozs7Z0JBeE9RLGVBQWU7Z0JBRkosV0FBVztnREF5UDFCLE1BQU0sU0FBQyxlQUFlOztJQXFIM0Isa0NBQUM7Q0FBQSxBQW5KRCxJQW1KQztTQW5JWSwyQkFBMkI7OztJQUN0QyxpREFBdUM7O0lBQ3ZDLHFEQUEwQjs7SUFFMUIscURBQW9DOztJQUVwQyw4Q0FBYzs7SUFDZCw4Q0FBb0I7O0lBQ3BCLDhDQUFvQzs7SUFDcEMsK0NBQVM7Ozs7O0lBR1AsOENBQWdDOzs7OztJQUNoQyxtREFBaUM7O0lBQ2pDLDJDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTWF0RGlhbG9nLCBNQVRfRElBTE9HX0RBVEEgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQgeyBUYXhvbm9teVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9iYWNrZW5kL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgU291cmNlRGF0YSwgVGVybU5vZGUsIFRlcm0sIFNvdXJjZUNsYXNpZmljYXRpb24sIFZvY2FidWxhcmllc0lubXV0YWJsZU5hbWVzIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBQYW5lbENvbnRlbnRfRGVwciwgRm9ybUNvbnRhaW5lckFjdGlvbiwgSW5wdXRUZXh0Q29tcG9uZW50LCBGb3JtRmllbGRUeXBlLCBTZWxlY3RDb21wb25lbnQsIFNlbGVjdE9wdGlvbiwgSW5wdXRVcmxDb21wb25lbnQsIEhpbnRWYWx1ZSwgSGludFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vLi4vZm9ybXMvcHVibGljLWFwaSc7XG5cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInRvY28tc291cmNlLWluZGV4ZXNcIixcbiAgdGVtcGxhdGVVcmw6ICcuL3NvdXJjZS1pbmRleGVzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc291cmNlLWluZGV4ZXMuY29tcG9uZW50LnNjc3MnXSxcbn0pXG5leHBvcnQgY2xhc3MgU291cmNlSW5kZXhlc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNvdXJjZURhdGE6IFNvdXJjZURhdGE7XG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBlZGl0YWJsZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgLypcbiAgICBlbCBhcmJvbCBlbnRlcm8gZGUgbG9zIGluZGV4ZXNcbiAgICBlbCBwcmltZXIgbml2ZWwgc2UgY29uc2lkZXJhIHF1ZSBlcyB1bmEgY2xhc2lmaWNhY2lvbiBkZWwgaW5kZXgsIHBvciBlamVtcGxvXG4gICAgICAgIHtcbiAgICAgICAgICBcImNoaWxkcmVuXCI6IHsuLi59XG4gICAgICAgICAgXCJ0ZXJtXCI6IHtcbiAgICAgICAgICAgIFwiY2xhc2lmaWVkX2lkc1wiOiBbXSxcbiAgICAgICAgICAgIFwiY2xhc3NfaWRzXCI6IFtdLFxuICAgICAgICAgICAgXCJkYXRhXCI6IG51bGwsXG4gICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiV29TIC8gU2NvcHVzXCIsXG4gICAgICAgICAgICBcImlkXCI6IDQzNTUsXG4gICAgICAgICAgICBcIm5hbWVcIjogXCJodHRwOi8vbWlhci51Yi5lZHUvZGF0YWJhc2VzL0dSVVBPL0dcIixcbiAgICAgICAgICAgIFwicGFyZW50X2lkXCI6IG51bGwsXG4gICAgICAgICAgICBcInV1aWRcIjogXCJhNGFhZThhMi1iNjVkLTQzMTMtYjY2Ni01ZWY0MTcwZmM1NDlcIixcbiAgICAgICAgICAgIFwidm9jYWJ1bGFyeV9pZFwiOiBcIklOREVYRVNcIlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIGVuIGVsIHNlZ3VuZG8gbml2ZWwgKGNoaWxkcmVuKSBlc3RhbiBsb3MgaW5kaWNlcyhiYXNlcyBkZSBkYXRvcykgcXVlIHJlYWxtZW50ZSBjbGFzaWZpY2FuIGEgbGFzIGZ1ZW50ZXNcbiAgKi9cbiAgZGF0YWJhc2VzOiBUZXJtTm9kZVtdID0gbnVsbDtcblxuICAvKlxuICAgIGNhZGEgZWxlbWVudG8gZGUgZXN0ZSBhcnJheSB0aWVuZTpcbiAgICBkYmNsYXNzLCBxdWUgZXMgdW4gdGVybWlubyBkZWwgcHJpbWVyIG5pdmVsIGRlIGRhdGFiYXNlcyxcbiAgICBkYmxpc3QsIHNvbiBsYXMgY2xhc2lmaWNhY2lvbmVzIGRlIGxhcyBmdWVudGVzIGNvbiBsb3MgY29ycmVzcG9uZGllbnRlcyBkYXRvcyxcbiAgICAgIGxvcyB0ZXJtaW5vcyBjb3JyZXNwb25kaWVudGVzIGRlIGxvcyBlbGVtZW50b3MgZGUgZGJsaXN0IHNvbiBoaWpvcyBkZSBkYmNsYXNzIGVuIGRhdGFic2VzXG4gICovXG4gIHNlbGVjdGVkRGF0YWJhc2VzOiBBcnJheTx7IGRiY2xhc3M6IFRlcm0sIGRibGlzdDogU291cmNlQ2xhc2lmaWNhdGlvbltdIH0+ID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgZGlhbG9nOiBNYXREaWFsb2csIHByaXZhdGUgc2VydmljZTogVGF4b25vbXlTZXJ2aWNlKSB7IH1cblxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc2VydmljZS5nZXRUZXJtc1RyZWVCeVZvY2FiKFZvY2FidWxhcmllc0lubXV0YWJsZU5hbWVzLklOREVYRVMsIDEpLnN1YnNjcmliZShcbiAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS50cmVlLnRlcm1fbm9kZSkge1xuICAgICAgICAgIHRoaXMuZGF0YWJhc2VzID0gcmVzcG9uc2UuZGF0YS50cmVlLnRlcm1fbm9kZTtcbiAgICAgICAgICB0aGlzLmluaXRJbmRleGVzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgJ0VSUk9SOiAnICsgZXJyICsgJy4nXG4gICAgICAgICk7XG4gICAgICB9LFxuXG4gICAgICAoKSA9PiB7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBpbml0SW5kZXhlcygpe1xuXG4gICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlcyA9IG5ldyBBcnJheSh0aGlzLmRhdGFiYXNlcy5sZW5ndGgpO1xuICAgIHRoaXMuX3NldFNlbGVjdGVkRGF0YWJzZXMoKTtcbiAgICB0aGlzLl9zZXRJbmRleGVzVG9Tb3VyY2UoKTtcbiAgICBjb25zb2xlLmxvZygnKioqKioqKiBjb21wbGV0ZSBwcm9jZXNzJyk7XG4gIH1cblxuICAvKipcbiAgICogZGl2aWRlIGxvcyBzb3VyY2UuY2xhc3NpZmljYXRpb25zIHF1ZSBzb24gZGUgSU5ERVhFU1xuICAgKiBlbiBlbCBhcnJlZ2xvIHNlbGVjdGVkRGF0YWJhc2VzLCBjdXlvcyBlbGVtZW50b3MgdGllbmVuXG4gICAqIGRiY2xhc3MsIHF1ZSBlcyBlbCBwcmltZXIgbml2ZWxcbiAgICogZGJsaXN0LCBxdWUgc29uIGxvcyBTb3VyY2VDbGFzc2lmaWNhdGlvbiBzZWxlY2Npb25hZG9zIGUgaGlqb3MgZGUgZGJjbGFzc1xuICAgKi9cbiAgcHJpdmF0ZSBfc2V0U2VsZWN0ZWREYXRhYnNlcygpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZGF0YWJhc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldID0ge1xuICAgICAgICBkYmNsYXNzOiB0aGlzLmRhdGFiYXNlc1tpXS50ZXJtLFxuICAgICAgICBkYmxpc3Q6IHRoaXMuc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbnMuZmlsdGVyKFxuICAgICAgICAgIHZhbHVlID0+XG4gICAgICAgICAgICB2YWx1ZS52b2NhYnVsYXJ5ID09IFZvY2FidWxhcmllc0lubXV0YWJsZU5hbWVzLklOREVYRVMgJiZcbiAgICAgICAgICAgIHRoaXMuZGF0YWJhc2VzW2ldLmNoaWxkcmVuLmZpbmQoZGIgPT4gZGIudGVybS51dWlkID09IHZhbHVlLmlkKSAhPSB1bmRlZmluZWRcbiAgICAgICAgKVxuICAgICAgfTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRhdGFiYXNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdC5sZW5ndGg7IGsrKykge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba107XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba10uZGF0YSl7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba10uZGF0YSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba10uZGF0YVsndXJsJ10pe1xuICAgICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbaV0uZGJsaXN0W2tdLmRhdGFbJ3VybCddPScnO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba10uZGF0YVsnaW5pdGlhbF9jb3ZlciddKXtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhWydpbml0aWFsX2NvdmVyJ109Jyc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2ldLmRibGlzdFtrXS5kYXRhWydlbmRfY292ZXInXSl7XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tpXS5kYmxpc3Rba10uZGF0YVsnZW5kX2NvdmVyJ109Jyc7XG4gICAgICAgIH1cblxuICAgICAgfVxuXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIG1hbnRpZW5lIGxhIGxpc3RhIHNvdXJjZURhdGEuY2xhc3NpZmljYXRpb24gYmllbiBmb3JtYWRhIGVuIHJlbGFjaW9uIGNvbiBsbyBxdWUgaGF5IGVuIHNlbGVjdGVkRGF0YWJhc2VzXG4gICAqL1xuICBwcml2YXRlIF9zZXRJbmRleGVzVG9Tb3VyY2UoKSB7XG4gICAgLy8gZmlsdHJhIGxhcyBjbGFzaWZpY2FjaW9uZXMgcXVlIG5vIHNlYW4gaW5kZXhlc1xuICAgIHRoaXMuc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbnMgPSB0aGlzLnNvdXJjZURhdGEuY2xhc3NpZmljYXRpb25zLmZpbHRlcihcbiAgICAgIHZhbHVlID0+IHZhbHVlLnZvY2FidWxhcnkgIT0gVm9jYWJ1bGFyaWVzSW5tdXRhYmxlTmFtZXMuSU5ERVhFU1xuICAgICk7XG5cblxuICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIC8vIHBvciBjYWRhIGVsZW1lbnRvIGVuIHNlbGVjdGVkRGF0YWJhc2VzLCBzaSB0aWVuZSBhbGd1biBlbGVtZW50byBlbiBkYmxpc3RcbiAgICAgIC8vIGVudG9uY2VzIGRiY2xhc3MgeSBkYmxpc3QgdGFtYmllbiBzb24gcGFydGUgZGUgc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbnNcbiAgICAgIGlmIChlbGVtZW50LmRibGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IG5ldyBTb3VyY2VDbGFzaWZpY2F0aW9uKCk7XG4gICAgICAgIHBhcmVudC5pZCA9IGVsZW1lbnQuZGJjbGFzcy51dWlkO1xuICAgICAgICBwYXJlbnQuZGVzY3JpcHRpb24gPSBlbGVtZW50LmRiY2xhc3MuZGVzY3JpcHRpb247XG4gICAgICAgIHBhcmVudC52b2NhYnVsYXJ5ID0gZWxlbWVudC5kYmNsYXNzLnZvY2FidWxhcnlfaWQ7XG4gICAgICAgIHRoaXMuc291cmNlRGF0YS5jbGFzc2lmaWNhdGlvbnMucHVzaChwYXJlbnQpO1xuICAgICAgICB0aGlzLnNvdXJjZURhdGEuY2xhc3NpZmljYXRpb25zID0gdGhpcy5zb3VyY2VEYXRhLmNsYXNzaWZpY2F0aW9ucy5jb25jYXQoZWxlbWVudC5kYmxpc3QpO1xuXG4gICAgICB9XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2codGhpcy5zb3VyY2VEYXRhKTtcblxuICB9XG5cbiAgcHVibGljIGFkZEluZGV4QWN0aW9uKGRiY2xhc3NJbmRleDogbnVtYmVyKSB7XG4gICAgY29uc3QgZGJjbGFzcyA9IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmNsYXNzO1xuICAgIGNvbnN0IG9wdGlvbnM6IFRlcm1Ob2RlW10gPSB0aGlzLmRhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmNoaWxkcmVuLmZpbHRlcihcbiAgICAgIHZhbHVlID0+XG4gICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QuZmluZChkYiA9PiBkYi5pZCA9PSB2YWx1ZS50ZXJtLnV1aWQpID09IHVuZGVmaW5lZFxuICAgICk7XG4gICAgaWYgKG9wdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5kaWFsb2cub3BlbihTb3VyY2VFZGl0QWRkSW5kZXhDb21wb25lbnQsIHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGRiY2xhc3M6IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmNsYXNzLFxuICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgICAgICAgZWRpdGluZzogbnVsbCxcbiAgICAgICAgICBhZGRJbmRleDogKHJlc3VsdDogU291cmNlQ2xhc2lmaWNhdGlvbikgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QgPSB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0LmZpbHRlcihcbiAgICAgICAgICAgICAgdmFsdWUgPT4gdmFsdWUuaWQgIT0gcmVzdWx0LmlkKTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgdGhpcy5fc2V0SW5kZXhlc1RvU291cmNlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICB9XG5cbiAgcHVibGljIGVkaXRJbmRleEFjdGlvbihkYmNsYXNzSW5kZXg6IG51bWJlciwgZWRpdGluZzogU291cmNlQ2xhc2lmaWNhdGlvbikge1xuICAgIGNvbnN0IGRiY2xhc3MgPSB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJjbGFzcztcbiAgICBpZiAoZWRpdGluZykge1xuICAgICAgLy8gdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdCA9IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QuZmlsdGVyKFxuICAgICAgLy8gICB2YWx1ZSA9PiB2YWx1ZS5pZCAhPSBlZGl0aW5nLmlkXG4gICAgICAvLyApO1xuXG4gICAgICBjb25zdCBvcHRpb25zOiBUZXJtTm9kZVtdID0gdGhpcy5kYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5jaGlsZHJlbi5maWx0ZXIoXG4gICAgICAgIHZhbHVlID0+XG4gICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5maW5kKGRiID0+IGRiLmlkID09IHZhbHVlLnRlcm0udXVpZCkgPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICAgdmFsdWUudGVybS51dWlkID09IGVkaXRpbmcuaWRcbiAgICAgICk7XG4gICAgICBpZiAob3B0aW9ucy5sZW5ndGggPiAwIHx8IGVkaXRpbmcpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cub3BlbihTb3VyY2VFZGl0QWRkSW5kZXhDb21wb25lbnQsIHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBkYmNsYXNzOiB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJjbGFzcyxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgICAgICAgICBlZGl0aW5nOiBlZGl0aW5nLFxuICAgICAgICAgICAgYWRkSW5kZXg6IChyZXN1bHQ6IFNvdXJjZUNsYXNpZmljYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nLHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QpO1xuXG4gICAgICAgICAgICAgIGNvbnN0IG5ld1NlbGVjdGVkID0gW107XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5pZCAhPSByZXN1bHQuaWQgJiYgZWxlbWVudC5pZCAhPSBlZGl0aW5nLmlkKXtcbiAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkLnB1c2goZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdCA9IG5ld1NlbGVjdGVkO1xuICAgICAgICAgICAgICAvLyB0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0ID0gdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdC5maWx0ZXIoXG4gICAgICAgICAgICAgIC8vICAgdmFsdWUgPT4gKHZhbHVlLmlkID09IHJlc3VsdC5pZCAmJiB2YWx1ZS5pZCA9PSBlZGl0aW5nLmlkKSk7XG5cbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJysrKysrKysrKysrKysrKysrKysrKysnLHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QpO1xuXG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnKioqKioqKioqKioqKioqKioqKioqJyx0aGlzLnNlbGVjdGVkRGF0YWJhc2VzW2RiY2xhc3NJbmRleF0uZGJsaXN0KTtcbiAgICAgICAgICAgICAgdGhpcy5fc2V0SW5kZXhlc1RvU291cmNlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBkZWxldGVJbmRleEFjdGlvbihkYmNsYXNzSW5kZXg6IG51bWJlciwgdG9EZWxldGU6IFNvdXJjZUNsYXNpZmljYXRpb24pIHtcbiAgICAvLyBjb25zb2xlLmxvZygnREVMRVRFJywgdG9EZWxldGUpO1xuXG4gICAgdGhpcy5zZWxlY3RlZERhdGFiYXNlc1tkYmNsYXNzSW5kZXhdLmRibGlzdCA9IHRoaXMuc2VsZWN0ZWREYXRhYmFzZXNbZGJjbGFzc0luZGV4XS5kYmxpc3QuZmlsdGVyKHZhbHVlID0+IHZhbHVlLmlkICE9IHRvRGVsZXRlLmlkKTtcbiAgICB0aGlzLl9zZXRJbmRleGVzVG9Tb3VyY2UoKTtcbiAgfVxufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwidG9jby1zb3VyY2UtYWRkaW5kZXhcIixcbiAgc3R5bGVVcmxzOiBbJy4vc291cmNlLWluZGV4ZXMuY29tcG9uZW50LnNjc3MnXSxcbiAgdGVtcGxhdGU6IGBcbiAgICA8dG9jby1mb3JtLWNvbnRhaW5lclxuICAgICAgI2luZGV4UGFuZWxDb250YWluZXJcbiAgICAgIFtwYW5lbHNDb250ZW50XT1cImluZGV4UGFuZWxcIlxuICAgICAgW3VzZUFjY29yZGlvbl09XCJmYWxzZVwiXG4gICAgICBmeExheW91dD1cInJvd1wiXG4gICAgICBbZm9ybUdyb3VwXT1cImluZGV4Rm9ybUdyb3VwXCJcbiAgICAgIFthY3Rpb25dPVwiYWRkSW5kZXhBY3Rpb25cIlxuICAgICAgW2FjdGlvbkxhYmVsXT1cIidPSydcIlxuICAgICAgW2RlbGV0ZVZhbHVlc0FmdGVyQWN0aW9uXT1cImZhbHNlXCJcbiAgICA+PC90b2NvLWZvcm0tY29udGFpbmVyPlxuICBgLFxufSlcbmV4cG9ydCBjbGFzcyBTb3VyY2VFZGl0QWRkSW5kZXhDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBpbmRleFBhbmVsOiBQYW5lbENvbnRlbnRfRGVwcltdID0gbnVsbDtcbiAgaW5kZXhGb3JtR3JvdXA6IEZvcm1Hcm91cDtcblxuICBhZGRJbmRleEFjdGlvbjogRm9ybUNvbnRhaW5lckFjdGlvbjtcblxuICBkYmNsYXNzOiBUZXJtO1xuICBvcHRpb25zOiBUZXJtTm9kZVtdO1xuICBlZGl0aW5nOiBTb3VyY2VDbGFzaWZpY2F0aW9uID0gbnVsbDtcbiAgYWRkSW5kZXg7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBzZXJ2aWNlOiBUYXhvbm9teVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBfZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgIEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBwdWJsaWMgZGF0YTogYW55XG4gICkge1xuICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgdGhpcy5kYmNsYXNzID0gZGF0YS5kYmNsYXNzO1xuICAgIHRoaXMub3B0aW9ucyA9IGRhdGEub3B0aW9ucztcbiAgICBpZiAoZGF0YS5lZGl0aW5nKSB7XG4gICAgICB0aGlzLmVkaXRpbmcgPSBkYXRhLmVkaXRpbmc7XG4gICAgfVxuICAgIHRoaXMuYWRkSW5kZXggPSBkYXRhLmFkZEluZGV4O1xuXG5cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuaW5kZXhGb3JtR3JvdXAgPSB0aGlzLl9mb3JtQnVpbGRlci5ncm91cCh7fSk7XG4gICAgaWYgKHRoaXMuZGJjbGFzcykge1xuICAgICAgdGhpcy5pbmRleFBhbmVsID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6ICh0aGlzLmVkaXRpbmcpID8gJ0VkaXRhcicgOiAnQWRpY2lvbmFyJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgaWNvbk5hbWU6ICcnLFxuICAgICAgICAgIGZvcm1TZWN0aW9uOiB0aGlzLmluZGV4Rm9ybUdyb3VwLFxuICAgICAgICAgIGZvcm1TZWN0aW9uQ29udGVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmb3JtQ29udHJvbDogSW5wdXRUZXh0Q29tcG9uZW50LmdldEZvcm1Db250cm9sQnlEZWZhdWx0KCksXG4gICAgICAgICAgICAgIG5hbWU6ICdpbmRleGVzJyxcbiAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuZGJjbGFzcy5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgdHlwZTogRm9ybUZpZWxkVHlwZS5zZWxlY3RfZXhwcixcbiAgICAgICAgICAgICAgY29udHJvbFR5cGU6IFNlbGVjdENvbXBvbmVudCxcbiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgIHZhbHVlOiAodGhpcy5lZGl0aW5nKSA/IHRoaXMuZWRpdGluZy5pZCA6IG51bGwsXG4gICAgICAgICAgICAgIGV4dHJhQ29udGVudDoge1xuICAgICAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBnZXRPcHRpb25zOiAocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0czogU2VsZWN0T3B0aW9uW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChub2RlOiBUZXJtTm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvcHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBub2RlLnRlcm0udXVpZCxcbiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbm9kZS50ZXJtLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdHM7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25DaGFuZ2U6ICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZm9ybUNvbnRyb2w6IElucHV0VXJsQ29tcG9uZW50LmdldEZvcm1Db250cm9sQnlEZWZhdWx0KCksXG4gICAgICAgICAgICAgIG5hbWU6ICd1cmwnLFxuICAgICAgICAgICAgICBsYWJlbDogJ1VSTCcsXG4gICAgICAgICAgICAgIHR5cGU6IEZvcm1GaWVsZFR5cGUudXJsLFxuICAgICAgICAgICAgICBjb250cm9sVHlwZTogSW5wdXRVcmxDb21wb25lbnQsXG4gICAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgc3RhcnRIaW50OiBuZXcgSGludFZhbHVlKFxuICAgICAgICAgICAgICAgIEhpbnRQb3NpdGlvbi5zdGFydCxcbiAgICAgICAgICAgICAgICAnVVJMIGRlIGxhIHJldmlzdGEgZW4gZWwgw61uZGljZS4nXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgIHZhbHVlOiAodGhpcy5lZGl0aW5nKSA/IFt0aGlzLmVkaXRpbmcuZGF0YVsndXJsJ11dIDogJycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmb3JtQ29udHJvbDogSW5wdXRUZXh0Q29tcG9uZW50LmdldEZvcm1Db250cm9sQnlEZWZhdWx0KCksXG4gICAgICAgICAgICAgIG5hbWU6ICdpbml0aWFsX2NvdmVyJyxcbiAgICAgICAgICAgICAgbGFiZWw6ICdDb2JlcnR1cmEgaW5pY2lvJyxcbiAgICAgICAgICAgICAgdHlwZTogRm9ybUZpZWxkVHlwZS50ZXh0LFxuICAgICAgICAgICAgICBjb250cm9sVHlwZTogSW5wdXRUZXh0Q29tcG9uZW50LFxuICAgICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICAgIHN0YXJ0SGludDogbmV3IEhpbnRWYWx1ZShIaW50UG9zaXRpb24uc3RhcnQsICcnKSxcbiAgICAgICAgICAgICAgd2lkdGg6ICc0NSUnLFxuICAgICAgICAgICAgICB2YWx1ZTogKHRoaXMuZWRpdGluZykgPyBbdGhpcy5lZGl0aW5nLmRhdGFbJ2luaXRpYWxfY292ZXInXV0gOiAnJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGZvcm1Db250cm9sOiBJbnB1dFRleHRDb21wb25lbnQuZ2V0Rm9ybUNvbnRyb2xCeURlZmF1bHQoKSxcbiAgICAgICAgICAgICAgbmFtZTogJ2VuZF9jb3ZlcicsXG4gICAgICAgICAgICAgIGxhYmVsOiAnQ29iZXJ0dXJhJyxcbiAgICAgICAgICAgICAgdHlwZTogRm9ybUZpZWxkVHlwZS50ZXh0LFxuICAgICAgICAgICAgICBjb250cm9sVHlwZTogSW5wdXRUZXh0Q29tcG9uZW50LFxuICAgICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICAgIHN0YXJ0SGludDogbmV3IEhpbnRWYWx1ZShIaW50UG9zaXRpb24uc3RhcnQsICcnKSxcbiAgICAgICAgICAgICAgd2lkdGg6ICc0NSUnLFxuICAgICAgICAgICAgICB2YWx1ZTogKHRoaXMuZWRpdGluZykgPyBbdGhpcy5lZGl0aW5nLmRhdGFbJ2VuZF9jb3ZlciddXSA6ICcnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXTtcbiAgICB9XG5cblxuICAgIHRoaXMuYWRkSW5kZXhBY3Rpb24gPSB7XG4gICAgICBkb2l0OiAoZGF0YTogYW55KSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmluZGV4Rm9ybUdyb3VwLnZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFNvdXJjZUNsYXNpZmljYXRpb24oKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmluZGV4Rm9ybUdyb3VwKTtcblxuICAgICAgICAgIGlmICh0aGlzLmluZGV4Rm9ybUdyb3VwLmNvbnRyb2xzWydpbmRleGVzJ10udmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm9wdGlvbnMuZmluZCh2YWx1ZSA9PiB2YWx1ZS50ZXJtLnV1aWQgPT0gdGhpcy5pbmRleEZvcm1Hcm91cC5jb250cm9sc1snaW5kZXhlcyddLnZhbHVlKTtcbiAgICAgICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgICAgIHJlc3VsdC52b2NhYnVsYXJ5ID0gbm9kZS50ZXJtLnZvY2FidWxhcnlfaWQ7XG4gICAgICAgICAgICAgIHJlc3VsdC5kZXNjcmlwdGlvbiA9IG5vZGUudGVybS5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgcmVzdWx0LmlkID0gbm9kZS50ZXJtLnV1aWQ7XG4gICAgICAgICAgICAgIHJlc3VsdC5kYXRhID0ge1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5pbmRleEZvcm1Hcm91cC5jb250cm9sc1sndXJsJ10udmFsdWUsXG4gICAgICAgICAgICAgICAgaW5pdGlhbF9jb3ZlcjogdGhpcy5pbmRleEZvcm1Hcm91cC5jb250cm9sc1snaW5pdGlhbF9jb3ZlciddLnZhbHVlLFxuICAgICAgICAgICAgICAgIGVuZF9jb3ZlcjogdGhpcy5pbmRleEZvcm1Hcm91cC5jb250cm9sc1snZW5kX2NvdmVyJ10udmFsdWUsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHRoaXMuYWRkSW5kZXgocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG4iXX0=