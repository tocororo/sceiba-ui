/**
 * @fileoverview added by tsickle
 * Generated from: lib/sources/sources-list/sources-list.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Component, ViewChild } from '@angular/core';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { merge, of as observableOf } from 'rxjs';
import { startWith, switchMap, map, catchError } from 'rxjs/operators';
import { MatPaginator } from '@angular/material/paginator';
import { MatTableDataSource } from '@angular/material/table';
import { MetadataService } from '../../core/public-api';
import { Journal, JournalData, ISSN } from '../../entities/public-api';
import { FiltersService } from '../../filters/public-api';
import { Environment } from '../../core/env';
import { CatalogService } from '../../backend/public-api';
import { CatalogFiltersComponent } from '../catalog-filters/catalog-filters.component';
var SourcesListComponent = /** @class */ (function () {
    function SourcesListComponent(service, metadata, filterService, env) {
        this.service = service;
        this.metadata = metadata;
        this.filterService = filterService;
        this.env = env;
        this.journalList = [];
        this.loading = true;
        this.dataSource = new MatTableDataSource();
        this.columnsToDisplay = ['title', 'rnps', 'p-issn'];
        this.length = 0;
        this.pageSize = 5;
        this.pageSizeOptions = [5, 10, 15, 20];
        this.sceibaHost = '';
        this.layoutPosition = [
            {
                name: 'Derecha',
                layout: 'row-reverse',
                aling: 'center baseline',
                width: '22'
            },
            {
                name: 'Izquierda',
                layout: 'row',
                aling: 'center baseline',
                width: '22'
            },
            {
                name: 'Arriba',
                layout: 'column',
                aling: 'center center',
                width: '90'
            },
            {
                name: 'Abajo',
                layout: 'column-reverse',
                aling: 'center center',
                width: '90'
            }
        ];
        this.currentlayout = this.layoutPosition[1];
        this.sceibaHost = env.sceibaHost + '/catalog';
    }
    /**
     * @return {?}
     */
    SourcesListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.metadata.setStandardMeta("Catálogo de Revistas Científicas", "", "");
        this.paginator.firstPage();
        this.paginator.pageSize = 5;
        this.service.getJournalsCount().subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            _this.length = response.data.count;
        }));
        this.fetchJournalData();
        this.filterService.paramsChanged.subscribe((/**
         * @param {?} params
         * @return {?}
         */
        function (params) {
            _this.params = params;
            _this.fetchJournalData();
        }));
    };
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    /**
     * @return {?}
     */
    SourcesListComponent.prototype.fetchJournalData = 
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading = true;
        // this.dataSource.data = this.service.getJournalsPage(this.count, this.page);
        /** @type {?} */
        var arr = new Array();
        merge().pipe(startWith({}), switchMap((/**
         * @return {?}
         */
        function () {
            _this.loading = true;
            return (/** @type {?} */ (_this.service)).getJournalsPage(_this.paginator.pageSize, _this.paginator.pageIndex, _this.params);
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            // Flip flag to show that loading has finished.
            _this.loading = false;
            // this.isRateLimitReached = false;
            // this.resultsLength = response.total_count;
            _this.length = response.data.sources.count;
            response.data.sources.data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                /** @type {?} */
                var j = new Journal();
                j.id = item.id;
                j.uuid = item.uuid;
                /** @type {?} */
                var info = new JournalData();
                info.url = item.data != null ? item.data.url : '';
                info.title = item.name;
                info.subtitle = item.subtitle;
                info.shortname = item.shortname;
                /** @type {?} */
                var issn = new ISSN();
                issn.e = item.data != null ? item.data.issn.e : '';
                issn.l = item.data != null ? item.data.issn.l : '';
                issn.p = item.data != null ? item.data.issn.p : '';
                info.issn = issn;
                info.rnps = item.data != null ? item.data.rnps : '';
                info.logo = item.data != null ? item.data.logo : '';
                info.purpose = item.purpose;
                info.description = item.data != null ? item.data.description : '';
                j.data = info;
                arr.push(j);
            }));
            return arr;
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.loading = false;
            console.log('ERRORRR ' + error);
            // Catch if the GitHub API has reached its rate limit. Return empty data.
            // this.isRateLimitReached = true;
            return observableOf([]);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) { return _this.dataSource.data = data; }));
    };
    /**
     * @return {?}
     */
    SourcesListComponent.prototype.onScrollUp = /**
     * @return {?}
     */
    function () {
        // console.log("scrolled up!!");
    };
    /**
     * @return {?}
     */
    SourcesListComponent.prototype.isEmpty = /**
     * @return {?}
     */
    function () {
        if (this.journalList.length == 0) {
            this.loading = false;
            return true;
        }
        return false;
    };
    /**
     * @return {?}
     */
    SourcesListComponent.prototype.isLoading = /**
     * @return {?}
     */
    function () {
        return this.loading;
    };
    /**
     * @return {?}
     */
    SourcesListComponent.prototype.openme = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var a = navigator.userAgent.match(/Android/i);
        /** @type {?} */
        var b = navigator.userAgent.match(/BlackBerry/i);
        /** @type {?} */
        var apple = navigator.userAgent.match(/iPhone|iPad|iPod/i);
        /** @type {?} */
        var o = navigator.userAgent.match(/Opera Mini/i);
        /** @type {?} */
        var i = navigator.userAgent.match(/IEMobile/i);
        if (a != null || b != null || apple != null || o != null || i != null) {
            return false;
        }
        return true;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    SourcesListComponent.prototype.changeLayoutPosition = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.currentlayout = this.layoutPosition[index];
    };
    SourcesListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-sources-list',
                    template: "<!-- <div infiniteScroll [infiniteScrollDistance]=\"0\" [infiniteScrollUpDistance]=\"0.5\" [infiniteScrollThrottle]=\"10\" (scrolled)=\"onScrollDown()\"\n  (scrolledUp)=\"onScrollUp()\"> -->\n\n\n    <!-- <toco-page-header [info]=\"['Cat\u00E1logo de Revistas Cient\u00EDficas Cubanas']\">\n    </toco-page-header> -->\n    <div fxLayoutAlign=\"end center\" fxLayout=\"row\">\n      <button mat-icon-button [matMenuTriggerFor]=\"menu\">\n        <mat-icon>view_quilt</mat-icon>\n      </button>\n      <mat-menu #menu=\"matMenu\">\n        <button mat-menu-item (click)=\"changeLayoutPosition(0)\">\n          <mat-icon>arrow_forward</mat-icon>\n          <span>{{layoutPosition[0].name}}</span>\n        </button>\n        <button mat-menu-item (click)=\"changeLayoutPosition(1)\">\n          <mat-icon>arrow_back</mat-icon>\n          <span>{{layoutPosition[1].name}}</span>\n        </button>\n        <button mat-menu-item (click)=\"changeLayoutPosition(2)\">\n          <mat-icon>arrow_upward</mat-icon>\n          <span>{{layoutPosition[2].name}}</span>\n        </button>\n        <button mat-menu-item (click)=\"changeLayoutPosition(3)\">\n          <mat-icon>arrow_downward</mat-icon>\n          <span>{{layoutPosition[3].name}}</span>\n        </button>\n      </mat-menu>\n    </div>\n\n\n    <div fxLayout=\"{{currentlayout.layout}}\" fxLayout.xs=\"column nowrap\" fxLayoutAlign=\"{{currentlayout.aling}}\">\n\n      <toco-catalog-filters-container fxLayout=\"row wrap\" fxLayout.xs=\"column wrap\" fxFlex=\"{{currentlayout.width}}\" fxLayoutAlign=\"start center\" fxLayoutAlign.xs=\"center center\"\n        fxLayoutGap=\"1em\" class=\"width-90 back-grey mat-elevation-z8\">\n      </toco-catalog-filters-container>\n\n\n\n      <div class=\"mat-elevation-z8 width-90 margin1em\">\n        <table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows>\n          <ng-container matColumnDef=\"title\">\n            <th mat-header-cell *matHeaderCellDef>Titulo</th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.data.title}} </td>\n          </ng-container>\n          <ng-container matColumnDef=\"rnps\">\n            <th mat-header-cell *matHeaderCellDef>RNPS</th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.data.rnps}} </td>\n          </ng-container>\n          <ng-container matColumnDef=\"p-issn\">\n            <th mat-header-cell *matHeaderCellDef>P-ISSN</th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.data.issn.p}} </td>\n          </ng-container>\n\n          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n          <ng-container matColumnDef=\"expandedDetail\">\n            <td mat-cell *matCellDef=\"let element\" [attr.colspan]=\"columnsToDisplay.length\">\n              <div class=\"example-element-detail\" [@detailExpand]=\"element == expandedElement ? 'expanded' : 'collapsed'\">\n                <div class=\"example-element-description e2e-inner-html-bound\" [innerHTML]=\"element.data.description\"></div>\n\n              </div>\n            </td>\n          </ng-container>\n\n          <tr mat-header-row *matHeaderRowDef=\"columnsToDisplay\"></tr>\n          <tr mat-row *matRowDef=\"let element; columns: columnsToDisplay;\" class=\"example-element-row\" [class.example-expanded-row]=\"expandedElement === element\"\n            (click)=\"expandedElement = element\">\n          </tr>\n          <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"example-detail-row\"></tr>\n        </table>\n        <mat-paginator [length]=\"length\"\n              [pageSize]=\"pageSize\"\n              [pageSizeOptions]=\"pageSizeOptions\"\n              (page)=\"fetchJournalData()\">\n        </mat-paginator>\n      </div>\n\n      <mat-card *ngIf=\"!isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n        <mat-spinner></mat-spinner>\n        <!--<mat-progress-bar mode=\"indeterminate\"></mat-progress-bar>-->\n      </mat-card>\n\n      <!-- <mat-card *ngIf=\"isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n        <h1>No hay Informaci\u00F3n para Mostrar</h1>\n      </mat-card> -->\n    </div>\n\n    <!--\n      </mat-drawer-content>\n\n\n\n    </mat-drawer-container> -->\n\n<!-- </div> -->\n",
                    animations: [
                        trigger('detailExpand', [
                            state('collapsed', style({ height: '0px', minHeight: '0', display: 'none' })),
                            state('expanded', style({ height: '*' })),
                            transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                        ]),
                    ],
                    styles: [".width-card{width:30%;min-width:240px;margin-left:24px;margin-top:24px}.card-float-left{float:left}.center-spinner{width:90.5%;min-width:240px;margin-left:24px;margin-right:24px;margin-top:24px}.back-grey{background:rgba(0,0,0,.01);margin:1.5em 1em;padding:1em;min-width:18em}.width-90{width:90%}.width-93{width:93.5%}table{width:90%}.margin1em{margin:1em}.menu-pull-right{flex:1 1 auto}table.mat-table{width:100%}tr.example-detail-row{height:0}tr.example-element-row:not(.example-expanded-row):hover{background:#f5f5f5}tr.example-element-row:not(.example-expanded-row):active{background:#efefef}.example-element-row td{border-bottom-width:0}.example-element-detail{overflow:hidden;display:flex}.example-element-diagram{min-width:80px;border:2px solid #000;padding:8px;font-weight:lighter;margin:8px 0;height:104px}.example-element-symbol{font-weight:700;font-size:40px;line-height:normal}.example-element-description{padding:16px}.example-element-description-attribution{opacity:.5}"]
                }] }
    ];
    /** @nocollapse */
    SourcesListComponent.ctorParameters = function () { return [
        { type: CatalogService },
        { type: MetadataService },
        { type: FiltersService },
        { type: Environment }
    ]; };
    SourcesListComponent.propDecorators = {
        paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }],
        filter_component: [{ type: ViewChild, args: [CatalogFiltersComponent, { static: true },] }]
    };
    return SourcesListComponent;
}());
export { SourcesListComponent };
if (false) {
    /** @type {?} */
    SourcesListComponent.prototype.journalList;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.loading;
    /** @type {?} */
    SourcesListComponent.prototype.dataSource;
    /** @type {?} */
    SourcesListComponent.prototype.columnsToDisplay;
    /** @type {?} */
    SourcesListComponent.prototype.expandedElement;
    /** @type {?} */
    SourcesListComponent.prototype.length;
    /** @type {?} */
    SourcesListComponent.prototype.pageSize;
    /** @type {?} */
    SourcesListComponent.prototype.pageSizeOptions;
    /** @type {?} */
    SourcesListComponent.prototype.pageEvent;
    /** @type {?} */
    SourcesListComponent.prototype.params;
    /** @type {?} */
    SourcesListComponent.prototype.sceibaHost;
    /** @type {?} */
    SourcesListComponent.prototype.layoutPosition;
    /** @type {?} */
    SourcesListComponent.prototype.currentlayout;
    /** @type {?} */
    SourcesListComponent.prototype.paginator;
    /** @type {?} */
    SourcesListComponent.prototype.filter_component;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.metadata;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    SourcesListComponent.prototype.env;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic291cmNlcy1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL3NvdXJjZXMvc291cmNlcy1saXN0L3NvdXJjZXMtbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBTUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNqRixPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxZQUFZLEVBQWEsTUFBTSw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUU3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkUsT0FBTyxFQUFpQixjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUV6RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBRXZGO0lBcURJLDhCQUFvQixPQUF1QixFQUFVLFFBQXlCLEVBQVUsYUFBNkIsRUFBVSxHQUFnQjtRQUEzSCxZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUFV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eEIsZ0RBQzBDOzs7OztJQVI5Qix1Q0FBK0I7Ozs7O0lBQUUsd0NBQWlDOzs7OztJQUFFLDZDQUFxQzs7Ozs7SUFBRSxtQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogICBDb3B5cmlnaHQgKGMpIDIwMjAgVW5pdmVyc2lkYWQgZGUgUGluYXIgZGVsIFLDrW8gXCJIZXJtYW5vcyBTYcOteiBNb250ZXMgZGUgT2NhXCJcbiAqICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGFuaW1hdGUsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgdHJpZ2dlciB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgbWVyZ2UsIG9mIGFzIG9ic2VydmFibGVPZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIG1hcCwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hdFBhZ2luYXRvciwgUGFnZUV2ZW50IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvcGFnaW5hdG9yJztcbmltcG9ydCB7IE1hdFRhYmxlRGF0YVNvdXJjZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3RhYmxlJztcblxuaW1wb3J0IHsgTWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29yZS9wdWJsaWMtYXBpJztcbmltcG9ydCB7IEpvdXJuYWwsIEpvdXJuYWxEYXRhLCBJU1NOIH0gZnJvbSAnLi4vLi4vZW50aXRpZXMvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBGaWx0ZXJIdHRwTWFwLCBGaWx0ZXJzU2VydmljZSB9IGZyb20gJy4uLy4uL2ZpbHRlcnMvcHVibGljLWFwaSc7XG5cbmltcG9ydCB7IEVudmlyb25tZW50IH0gZnJvbSAnLi4vLi4vY29yZS9lbnYnO1xuXG5pbXBvcnQgeyBDYXRhbG9nU2VydmljZSB9IGZyb20gJy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBDYXRhbG9nRmlsdGVyc0NvbXBvbmVudCB9IGZyb20gJy4uL2NhdGFsb2ctZmlsdGVycy9jYXRhbG9nLWZpbHRlcnMuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0b2NvLXNvdXJjZXMtbGlzdCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3NvdXJjZXMtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vc291cmNlcy1saXN0LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgYW5pbWF0aW9uczogW1xuICAgICAgICB0cmlnZ2VyKCdkZXRhaWxFeHBhbmQnLCBbXG4gICAgICAgICAgICBzdGF0ZSgnY29sbGFwc2VkJywgc3R5bGUoeyBoZWlnaHQ6ICcwcHgnLCBtaW5IZWlnaHQ6ICcwJywgZGlzcGxheTogJ25vbmUnIH0pKSxcbiAgICAgICAgICAgIHN0YXRlKCdleHBhbmRlZCcsIHN0eWxlKHsgaGVpZ2h0OiAnKicgfSkpLFxuICAgICAgICAgICAgdHJhbnNpdGlvbignZXhwYW5kZWQgPD0+IGNvbGxhcHNlZCcsIGFuaW1hdGUoJzIyNW1zIGN1YmljLWJlemllcigwLjQsIDAuMCwgMC4yLCAxKScpKSxcbiAgICAgICAgXSksXG4gICAgXSxcbn0pXG5leHBvcnQgY2xhc3MgU291cmNlc0xpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXRcbntcbiAgICBqb3VybmFsTGlzdDogSm91cm5hbFtdID0gW107XG4gICAgcHJpdmF0ZSBsb2FkaW5nID0gdHJ1ZTtcbiAgICBkYXRhU291cmNlID0gbmV3IE1hdFRhYmxlRGF0YVNvdXJjZTxKb3VybmFsPigpO1xuICAgIGNvbHVtbnNUb0Rpc3BsYXkgPSBbJ3RpdGxlJywgJ3JucHMnLCAncC1pc3NuJ107XG4gICAgZXhwYW5kZWRFbGVtZW50OiBKb3VybmFsO1xuICAgIGxlbmd0aCA9IDA7XG4gICAgcGFnZVNpemUgPSA1O1xuICAgIHBhZ2VTaXplT3B0aW9uczogbnVtYmVyW10gPSBbNSwgMTAsIDE1LCAyMF07XG4gICAgcGFnZUV2ZW50OiBQYWdlRXZlbnQ7XG4gICAgcGFyYW1zOiBBcnJheTxGaWx0ZXJIdHRwTWFwPjtcbiAgICBzY2VpYmFIb3N0ID0gJyc7XG4gICAgbGF5b3V0UG9zaXRpb24gPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdEZXJlY2hhJyxcbiAgICAgICAgICAgIGxheW91dDogJ3Jvdy1yZXZlcnNlJyxcbiAgICAgICAgICAgIGFsaW5nOiAnY2VudGVyIGJhc2VsaW5lJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMjInXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdJenF1aWVyZGEnLFxuICAgICAgICAgICAgbGF5b3V0OiAncm93JyxcbiAgICAgICAgICAgIGFsaW5nOiAnY2VudGVyIGJhc2VsaW5lJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMjInXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdBcnJpYmEnLFxuICAgICAgICAgICAgbGF5b3V0OiAnY29sdW1uJyxcbiAgICAgICAgICAgIGFsaW5nOiAnY2VudGVyIGNlbnRlcicsXG4gICAgICAgICAgICB3aWR0aDogJzkwJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnQWJham8nLFxuICAgICAgICAgICAgbGF5b3V0OiAnY29sdW1uLXJldmVyc2UnLFxuICAgICAgICAgICAgYWxpbmc6ICdjZW50ZXIgY2VudGVyJyxcbiAgICAgICAgICAgIHdpZHRoOiAnOTAnXG4gICAgICAgIH1cbiAgICBdO1xuICAgIGN1cnJlbnRsYXlvdXQgPSB0aGlzLmxheW91dFBvc2l0aW9uWzFdO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2aWNlOiBDYXRhbG9nU2VydmljZSwgcHJpdmF0ZSBtZXRhZGF0YTogTWV0YWRhdGFTZXJ2aWNlLCBwcml2YXRlIGZpbHRlclNlcnZpY2U6IEZpbHRlcnNTZXJ2aWNlLCBwcml2YXRlIGVudjogRW52aXJvbm1lbnQpIHtcbiAgICAgICAgdGhpcy5zY2VpYmFIb3N0ID0gZW52LnNjZWliYUhvc3QgKyAnL2NhdGFsb2cnO1xuICAgIH1cblxuICAgIEBWaWV3Q2hpbGQoTWF0UGFnaW5hdG9yLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIHBhZ2luYXRvcjogTWF0UGFnaW5hdG9yO1xuXG4gICAgQFZpZXdDaGlsZChDYXRhbG9nRmlsdGVyc0NvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBmaWx0ZXJfY29tcG9uZW50OiBDYXRhbG9nRmlsdGVyc0NvbXBvbmVudDtcblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLm1ldGFkYXRhLnNldFN0YW5kYXJkTWV0YShcIkNhdMOhbG9nbyBkZSBSZXZpc3RhcyBDaWVudMOtZmljYXNcIiwgXCJcIiwgXCJcIik7XG4gICAgICAgIHRoaXMucGFnaW5hdG9yLmZpcnN0UGFnZSgpO1xuICAgICAgICB0aGlzLnBhZ2luYXRvci5wYWdlU2l6ZSA9IDU7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXRKb3VybmFsc0NvdW50KCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gcmVzcG9uc2UuZGF0YS5jb3VudDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmV0Y2hKb3VybmFsRGF0YSgpO1xuICAgICAgICB0aGlzLmZpbHRlclNlcnZpY2UucGFyYW1zQ2hhbmdlZC5zdWJzY3JpYmUocGFyYW1zID0+IHtcbiAgICAgICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgICAgICAgICAgdGhpcy5mZXRjaEpvdXJuYWxEYXRhKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIG9uUGFnaW5hdG9yQ2hhbmdlZCgpe1xuICAgIC8vICAgdGhpcy5maWx0ZXJTZXJ2aWNlLmNoYW5nZUZpbHRlcignY291bnQnLHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplLCBmYWxzZSk7XG4gICAgLy8gICB0aGlzLmZpbHRlclNlcnZpY2UuY2hhbmdlRmlsdGVyKCdwYWdlJyx0aGlzLnBhZ2luYXRvci5wYWdlSW5kZXgpO1xuICAgIC8vIH1cblxuICAgIGZldGNoSm91cm5hbERhdGEoKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMuZGF0YVNvdXJjZS5kYXRhID0gdGhpcy5zZXJ2aWNlLmdldEpvdXJuYWxzUGFnZSh0aGlzLmNvdW50LCB0aGlzLnBhZ2UpO1xuICAgICAgICBjb25zdCBhcnIgPSBuZXcgQXJyYXk8Sm91cm5hbD4oKTtcblxuICAgICAgICBtZXJnZSgpLnBpcGUoXG4gICAgICAgICAgICBzdGFydFdpdGgoe30pLFxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlIS5nZXRKb3VybmFsc1BhZ2UodGhpcy5wYWdpbmF0b3IucGFnZVNpemUsIHRoaXMucGFnaW5hdG9yLnBhZ2VJbmRleCwgdGhpcy5wYXJhbXMpO1xuICAgICAgICB9KSxcbiAgICAgICAgbWFwKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIC8vIEZsaXAgZmxhZyB0byBzaG93IHRoYXQgbG9hZGluZyBoYXMgZmluaXNoZWQuXG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIC8vIHRoaXMuaXNSYXRlTGltaXRSZWFjaGVkID0gZmFsc2U7XG4gICAgICAgICAgICAvLyB0aGlzLnJlc3VsdHNMZW5ndGggPSByZXNwb25zZS50b3RhbF9jb3VudDtcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gcmVzcG9uc2UuZGF0YS5zb3VyY2VzLmNvdW50O1xuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5zb3VyY2VzLmRhdGEuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBqID0gbmV3IEpvdXJuYWwoKTtcbiAgICAgICAgICAgICAgICBqLmlkID0gaXRlbS5pZDtcbiAgICAgICAgICAgICAgICBqLnV1aWQgPSBpdGVtLnV1aWQ7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IG5ldyBKb3VybmFsRGF0YSgpO1xuICAgICAgICAgICAgICAgIGluZm8udXJsID0gaXRlbS5kYXRhICE9IG51bGwgPyBpdGVtLmRhdGEudXJsIDogJyc7XG4gICAgICAgICAgICAgICAgaW5mby50aXRsZSA9IGl0ZW0ubmFtZTtcbiAgICAgICAgICAgICAgICBpbmZvLnN1YnRpdGxlID0gaXRlbS5zdWJ0aXRsZTtcbiAgICAgICAgICAgICAgICBpbmZvLnNob3J0bmFtZSA9IGl0ZW0uc2hvcnRuYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzc24gPSBuZXcgSVNTTigpO1xuICAgICAgICAgICAgICAgIGlzc24uZSA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLmlzc24uZSA6ICcnO1xuICAgICAgICAgICAgICAgIGlzc24ubCA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLmlzc24ubCA6ICcnO1xuICAgICAgICAgICAgICAgIGlzc24ucCA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLmlzc24ucCA6ICcnO1xuICAgICAgICAgICAgICAgIGluZm8uaXNzbiA9IGlzc247XG4gICAgICAgICAgICAgICAgaW5mby5ybnBzID0gaXRlbS5kYXRhICE9IG51bGwgPyBpdGVtLmRhdGEucm5wcyA6ICcnO1xuICAgICAgICAgICAgICAgIGluZm8ubG9nbyA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLmxvZ28gOiAnJztcbiAgICAgICAgICAgICAgICBpbmZvLnB1cnBvc2UgPSBpdGVtLnB1cnBvc2U7XG4gICAgICAgICAgICAgICAgaW5mby5kZXNjcmlwdGlvbiA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhLmRlc2NyaXB0aW9uIDogJyc7XG4gICAgICAgICAgICAgICAgai5kYXRhID0gaW5mbztcbiAgICAgICAgICAgICAgICBhcnIucHVzaChqKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFycjtcbiAgICAgICAgfSksXG4gICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRVJST1JSUiAnICsgZXJyb3IpO1xuICAgICAgICAgICAgLy8gQ2F0Y2ggaWYgdGhlIEdpdEh1YiBBUEkgaGFzIHJlYWNoZWQgaXRzIHJhdGUgbGltaXQuIFJldHVybiBlbXB0eSBkYXRhLlxuICAgICAgICAgICAgLy8gdGhpcy5pc1JhdGVMaW1pdFJlYWNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIG9ic2VydmFibGVPZihbXSk7XG4gICAgICAgIH0pXG4gICAgICAgICkuc3Vic2NyaWJlKGRhdGEgPT4gdGhpcy5kYXRhU291cmNlLmRhdGEgPSBkYXRhKTtcbiAgICB9XG5cbiAgICBvblNjcm9sbFVwKCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNjcm9sbGVkIHVwISFcIik7XG4gICAgfVxuXG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgaWYgKHRoaXMuam91cm5hbExpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlzTG9hZGluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGluZztcbiAgICB9XG5cbiAgICBvcGVubWUoKTogYm9vbGVhblxuICAgIHtcbiAgICAgICAgY29uc3QgYSA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0FuZHJvaWQvaSk7XG4gICAgICAgIGNvbnN0IGIgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9CbGFja0JlcnJ5L2kpO1xuICAgICAgICBjb25zdCBhcHBsZSA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQaG9uZXxpUGFkfGlQb2QvaSk7XG4gICAgICAgIGNvbnN0IG8gPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9PcGVyYSBNaW5pL2kpO1xuICAgICAgICBjb25zdCBpID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvSUVNb2JpbGUvaSk7XG5cbiAgICAgICAgaWYgKGEgIT0gbnVsbCB8fCBiICE9IG51bGwgfHwgYXBwbGUgIT0gbnVsbCB8fCBvICE9IG51bGwgfHwgaSAhPSBudWxsKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgY2hhbmdlTGF5b3V0UG9zaXRpb24oaW5kZXg6IG51bWJlcilcbiAgICB7XG4gICAgICAgIHRoaXMuY3VycmVudGxheW91dCA9IHRoaXMubGF5b3V0UG9zaXRpb25baW5kZXhdO1xuICAgIH1cbn1cbiJdfQ==