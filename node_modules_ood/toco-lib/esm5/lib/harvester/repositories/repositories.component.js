/**
 * @fileoverview added by tsickle
 * Generated from: lib/harvester/repositories/repositories.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild } from '@angular/core';
import { animate, state, style, transition, trigger } from '@angular/animations';
import { merge, of as observableOf } from 'rxjs';
import { startWith, switchMap, map, catchError } from 'rxjs/operators';
import { MatPaginator } from '@angular/material/paginator';
import { MatTableDataSource } from '@angular/material/table';
import { CatalogService } from '../../backend/public-api';
import { MetadataService } from '../../core/public-api';
import { Journal, JournalData, ISSN } from '../../entities/public-api';
import { FiltersService } from '../../filters/public-api';
import { Environment } from '../../core/env';
import { HarvesterFiltersComponent } from '../harvester-filters/harvester-filters.component';
var RepositoriesComponent = /** @class */ (function () {
    function RepositoriesComponent(service, metadata, filterService, env) {
        this.service = service;
        this.metadata = metadata;
        this.filterService = filterService;
        this.env = env;
        this.journalList = [];
        this.loading = true;
        this.dataSource = new MatTableDataSource();
        this.columnsToDisplay = ['title'];
        this.length = 0;
        this.pageSize = 5;
        this.pageSizeOptions = [5, 10, 20, 40, 60, 80, 100];
        this.sceibaHost = '';
        this.currentlayout = {
            name: 'Izquierda',
            layout: 'row',
            aling: 'center baseline',
            width: '22'
        };
        this.sceibaHost = env.sceibaHost + "/catalog";
    }
    /**
     * @return {?}
     */
    RepositoriesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.metadata.setStandardMeta("Catálogo de Revistas Científicas", "", "");
        this.paginator.firstPage();
        this.paginator.pageSize = this.pageSize;
        this.service.getJournalsCount().subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            _this.length = response.data.count;
        }));
        this.fetchJournalData();
        this.filterService.paramsChanged.subscribe((/**
         * @param {?} params
         * @return {?}
         */
        function (params) {
            _this.params = params;
            _this.fetchJournalData();
        }));
    };
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    /**
     * @return {?}
     */
    RepositoriesComponent.prototype.fetchJournalData = 
    // onPaginatorChanged(){
    //   this.filterService.changeFilter('count',this.paginator.pageSize, false);
    //   this.filterService.changeFilter('page',this.paginator.pageIndex);
    // }
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.loading = true;
        //this.dataSource.data = this.service.getJournalsPage(this.count, this.page);
        /** @type {?} */
        var arr = new Array();
        merge().pipe(startWith({}), switchMap((/**
         * @return {?}
         */
        function () {
            _this.loading = true;
            return (/** @type {?} */ (_this.service)).getJournalsPage(_this.paginator.pageSize, _this.paginator.pageIndex, _this.params);
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            // Flip flag to show that loading has finished.
            _this.loading = false;
            // this.isRateLimitReached = false;
            // this.resultsLength = response.total_count;
            _this.length = response.data.sources.count;
            response.data.sources.data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                /** @type {?} */
                var j = new Journal();
                j.id = item.id;
                j.uuid = item.uuid;
                j.source_type = item.source_type;
                // j.harvest_type = item.harvest_type;
                j.data.oaiurl = item.harvest_endpoint;
                /** @type {?} */
                var info = new JournalData();
                info.url = item.data != null ? item.data.url : "";
                info.title = item.name;
                info.subtitle = item.subtitle;
                info.shortname = item.shortname;
                /** @type {?} */
                var issn = new ISSN();
                issn.e = item.data != null ? item.data.issn.e : "";
                issn.l = item.data != null ? item.data.issn.l : "";
                issn.p = item.data != null ? item.data.issn.p : "";
                info.issn = issn;
                info.rnps = item.data != null ? item.data.rnps : "";
                info.logo = item.data != null ? item.data.logo : "";
                info.purpose = item.purpose;
                info.description = item.data != null ? item.data.description : "";
                j.data = info;
                arr.push(j);
            }));
            return arr;
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.loading = false;
            console.log("ERRORRR  " + error);
            // Catch if the GitHub API has reached its rate limit. Return empty data.
            // this.isRateLimitReached = true;
            return observableOf([]);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) { return _this.dataSource.data = data; }));
    };
    /**
     * @return {?}
     */
    RepositoriesComponent.prototype.onScrollUp = /**
     * @return {?}
     */
    function () {
        // console.log("scrolled up!!");
    };
    /**
     * @return {?}
     */
    RepositoriesComponent.prototype.isEmpty = /**
     * @return {?}
     */
    function () {
        if (this.journalList.length == 0) {
            this.loading = false;
            return true;
        }
        return false;
    };
    /**
     * @return {?}
     */
    RepositoriesComponent.prototype.isLoading = /**
     * @return {?}
     */
    function () {
        return this.loading;
    };
    /**
     * @return {?}
     */
    RepositoriesComponent.prototype.currentJournals = /**
     * @return {?}
     */
    function () {
        console.log(this.dataSource.data);
    };
    RepositoriesComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-repositories',
                    template: "<div fxLayout=\"{{currentlayout.layout}}\" fxLayout.xs=\"column nowrap\" fxLayoutAlign=\"{{currentlayout.aling}}\">\n  <button mat-raised-button (click)=\"currentJournals()\">Print Current Fournals</button>\n  <button mat-raised-button (click)=\"currentJournals()\">Print Current Fournals</button>\n  <button mat-raised-button (click)=\"currentJournals()\">Print Current Fournals</button>\n</div>\n\n\n<div fxLayout=\"{{currentlayout.layout}}\" fxLayout.xs=\"column nowrap\" fxLayoutAlign=\"{{currentlayout.aling}}\">\n\n  <toco-harvester-filters-container fxLayout=\"row wrap\" fxLayout.xs=\"column wrap\" fxFlex=\"{{currentlayout.width}}\" fxLayoutAlign=\"start center\" fxLayoutAlign.xs=\"center center\"\n    fxLayoutGap=\"1em\" class=\"width-90 back-grey mat-elevation-z8\">\n  </toco-harvester-filters-container>\n\n  <div class=\"mat-elevation-z8 width-90 margin1em\">\n    <table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows>\n      <ng-container matColumnDef=\"title\">\n        <th mat-header-cell *matHeaderCellDef>Titulo</th>\n        <td mat-cell *matCellDef=\"let element\"> {{element.data.title}} </td>\n      </ng-container>\n      <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n      <ng-container matColumnDef=\"expandedDetail\">\n        <td mat-cell *matCellDef=\"let element\" [attr.colspan]=\"columnsToDisplay.length\">\n          <div class=\"example-element-detail\" [@detailExpand]=\"element == expandedElement ? 'expanded' : 'collapsed'\">\n              <toco-harvester-repository\n              [repostitory]=\"element\"></toco-harvester-repository>\n          </div>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"columnsToDisplay\"></tr>\n      <tr mat-row *matRowDef=\"let element; columns: columnsToDisplay;\" class=\"example-element-row\" [class.example-expanded-row]=\"expandedElement === element\"\n        (click)=\"expandedElement = element\">\n      </tr>\n      <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"example-detail-row\"></tr>\n    </table>\n    <mat-paginator [length]=\"length\"\n          [pageSize]=\"pageSize\"\n          [pageSizeOptions]=\"pageSizeOptions\"\n          (page)=\"fetchJournalData()\">\n    </mat-paginator>\n  </div>\n\n  <mat-card *ngIf=\"!isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n    <mat-spinner></mat-spinner>\n    <!--<mat-progress-bar mode=\"indeterminate\"></mat-progress-bar>-->\n  </mat-card>\n\n  <!-- <mat-card *ngIf=\"isEmpty()\" class=\"center-spinner\" fxLayout=\"row\" fxLayoutAlign=\"center center\" fxLayoutGap=\"gappx\">\n    <h1>No hay Informaci\u00F3n para Mostrar</h1>\n  </mat-card> -->\n</div>\n\n",
                    animations: [
                        trigger('detailExpand', [
                            state('collapsed', style({ height: '0px', minHeight: '0', display: 'none' })),
                            state('expanded', style({ height: '*' })),
                            transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                        ]),
                    ],
                    styles: [".width-card{width:30%;min-width:240px;margin-left:24px;margin-top:24px}.card-float-left{float:left}.center-spinner{width:90.5%;min-width:240px;margin-left:24px;margin-right:24px;margin-top:24px}.back-grey{background:rgba(0,0,0,.01);margin:1.5em 1em;padding:1em;min-width:18em}.width-90{width:90%}.width-93{width:93.5%}table{width:90%}.margin1em{margin:1em}.menu-pull-right{flex:1 1 auto}table.mat-table{width:100%}tr.example-detail-row{height:0}tr.example-element-row:not(.example-expanded-row):hover{background:#f5f5f5}tr.example-element-row:not(.example-expanded-row):active{background:#efefef}.example-element-row td{border-bottom-width:0}.example-element-detail{overflow:hidden;display:flex}.example-element-diagram{min-width:80px;border:2px solid #000;padding:8px;font-weight:lighter;margin:8px 0;height:104px}.example-element-symbol{font-weight:700;font-size:40px;line-height:normal}.example-element-description{padding:16px}.example-element-description-attribution{opacity:.5}"]
                }] }
    ];
    /** @nocollapse */
    RepositoriesComponent.ctorParameters = function () { return [
        { type: CatalogService },
        { type: MetadataService },
        { type: FiltersService },
        { type: Environment }
    ]; };
    RepositoriesComponent.propDecorators = {
        paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }],
        filter_component: [{ type: ViewChild, args: [HarvesterFiltersComponent, { static: true },] }]
    };
    return RepositoriesComponent;
}());
export { RepositoriesComponent };
if (false) {
    /** @type {?} */
    RepositoriesComponent.prototype.journalList;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.loading;
    /** @type {?} */
    RepositoriesComponent.prototype.dataSource;
    /** @type {?} */
    RepositoriesComponent.prototype.columnsToDisplay;
    /** @type {?} */
    RepositoriesComponent.prototype.expandedElement;
    /** @type {?} */
    RepositoriesComponent.prototype.length;
    /** @type {?} */
    RepositoriesComponent.prototype.pageSize;
    /** @type {?} */
    RepositoriesComponent.prototype.pageSizeOptions;
    /** @type {?} */
    RepositoriesComponent.prototype.pageEvent;
    /** @type {?} */
    RepositoriesComponent.prototype.params;
    /** @type {?} */
    RepositoriesComponent.prototype.sceibaHost;
    /** @type {?} */
    RepositoriesComponent.prototype.currentlayout;
    /** @type {?} */
    RepositoriesComponent.prototype.paginator;
    /** @type {?} */
    RepositoriesComponent.prototype.filter_component;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.metadata;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    RepositoriesComponent.prototype.env;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yaWVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2hhcnZlc3Rlci9yZXBvc2l0b3JpZXMvcmVwb3NpdG9yaWVzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDL0UsT0FBTyxFQUFDLEtBQUssRUFBQyxFQUFFLElBQUksWUFBWSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQzlDLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2RSxPQUFPLEVBQUUsWUFBWSxFQUFhLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFN0QsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RSxPQUFPLEVBQWlCLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXpFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU3QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUU3RjtJQWlDSSwrQkFBb0IsT0FBdUIsRUFDL0IsUUFBeUIsRUFDekIsYUFBOEIsRUFDOUIsR0FBZ0I7UUFIUixZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUMv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RTlCLDRDQUE0Qjs7Ozs7SUFDNUIsd0NBQWdDOztJQUNoQywyQ0FBK0M7O0lBQy9DLGlEQUE2Qjs7SUFDN0IsZ0RBQXlCOztJQUN6Qix1Q0FBVzs7SUFDWCx5Q0FBYTs7SUFDYixnREFBeUQ7O0lBQ3pELDBDQUFxQjs7SUFDckIsdUNBQTZCOztJQUU3QiwyQ0FBZTs7SUFDZiw4Q0FLQzs7SUFVRCwwQ0FDd0I7O0lBRXhCLGlEQUM2Qzs7Ozs7SUFaakMsd0NBQStCOzs7OztJQUN2Qyx5Q0FBaUM7Ozs7O0lBQ2pDLDhDQUFzQzs7Ozs7SUFDdEMsb0NBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge2FuaW1hdGUsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgdHJpZ2dlcn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQge21lcmdlLG9mIGFzIG9ic2VydmFibGVPZn0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzdGFydFdpdGgsIHN3aXRjaE1hcCwgbWFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgTWF0UGFnaW5hdG9yLCBQYWdlRXZlbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9wYWdpbmF0b3InO1xuaW1wb3J0IHsgTWF0VGFibGVEYXRhU291cmNlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvdGFibGUnO1xuXG5pbXBvcnQgeyBDYXRhbG9nU2VydmljZSB9IGZyb20gJy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBNZXRhZGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi9jb3JlL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgSm91cm5hbCwgSm91cm5hbERhdGEsIElTU04gfSBmcm9tICcuLi8uLi9lbnRpdGllcy9wdWJsaWMtYXBpJztcbmltcG9ydCB7IEZpbHRlckh0dHBNYXAsIEZpbHRlcnNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZmlsdGVycy9wdWJsaWMtYXBpJztcblxuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tICcuLi8uLi9jb3JlL2Vudic7XG5cbmltcG9ydCB7IEhhcnZlc3RlckZpbHRlcnNDb21wb25lbnQgfSBmcm9tICcuLi9oYXJ2ZXN0ZXItZmlsdGVycy9oYXJ2ZXN0ZXItZmlsdGVycy5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RvY28tcmVwb3NpdG9yaWVzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcmVwb3NpdG9yaWVzLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9yZXBvc2l0b3JpZXMuY29tcG9uZW50LnNjc3MnXSxcbiAgICBhbmltYXRpb25zOiBbXG4gICAgICAgIHRyaWdnZXIoJ2RldGFpbEV4cGFuZCcsIFtcbiAgICAgICAgICAgIHN0YXRlKCdjb2xsYXBzZWQnLCBzdHlsZSh7aGVpZ2h0OiAnMHB4JywgbWluSGVpZ2h0OiAnMCcsIGRpc3BsYXk6ICdub25lJ30pKSxcbiAgICAgICAgICAgIHN0YXRlKCdleHBhbmRlZCcsIHN0eWxlKHtoZWlnaHQ6ICcqJ30pKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ2V4cGFuZGVkIDw9PiBjb2xsYXBzZWQnLCBhbmltYXRlKCcyMjVtcyBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDAuMiwgMSknKSksXG4gICAgICAgIF0pLFxuICAgIF0sXG59KVxuZXhwb3J0IGNsYXNzIFJlcG9zaXRvcmllc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBqb3VybmFsTGlzdDogSm91cm5hbFtdID0gW107XG4gICAgcHJpdmF0ZSBsb2FkaW5nOiBib29sZWFuID0gdHJ1ZTtcbiAgICBkYXRhU291cmNlID0gbmV3IE1hdFRhYmxlRGF0YVNvdXJjZTxKb3VybmFsPigpO1xuICAgIGNvbHVtbnNUb0Rpc3BsYXkgPSBbJ3RpdGxlJ107XG4gICAgZXhwYW5kZWRFbGVtZW50OiBKb3VybmFsO1xuICAgIGxlbmd0aCA9IDA7XG4gICAgcGFnZVNpemUgPSA1O1xuICAgIHBhZ2VTaXplT3B0aW9uczogbnVtYmVyW10gPSBbNSwgMTAsIDIwLCA0MCwgNjAsIDgwLCAxMDBdO1xuICAgIHBhZ2VFdmVudDogUGFnZUV2ZW50O1xuICAgIHBhcmFtczogQXJyYXk8RmlsdGVySHR0cE1hcD47XG5cbiAgICBzY2VpYmFIb3N0ID0gJydcbiAgICBjdXJyZW50bGF5b3V0ID0ge1xuICAgICAgICBuYW1lOiAnSXpxdWllcmRhJyxcbiAgICAgICAgbGF5b3V0OiAncm93JyxcbiAgICAgICAgYWxpbmc6ICdjZW50ZXIgYmFzZWxpbmUnLFxuICAgICAgICB3aWR0aDogICcyMidcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNlcnZpY2U6IENhdGFsb2dTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIG1ldGFkYXRhOiBNZXRhZGF0YVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZmlsdGVyU2VydmljZSA6IEZpbHRlcnNTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGVudjogRW52aXJvbm1lbnQpXG4gICAge1xuICAgICAgICB0aGlzLnNjZWliYUhvc3QgPSBlbnYuc2NlaWJhSG9zdCArIFwiL2NhdGFsb2dcIlxuICAgIH1cblxuICAgIEBWaWV3Q2hpbGQoTWF0UGFnaW5hdG9yLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIHBhZ2luYXRvcjogTWF0UGFnaW5hdG9yO1xuXG4gICAgQFZpZXdDaGlsZChIYXJ2ZXN0ZXJGaWx0ZXJzQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIGZpbHRlcl9jb21wb25lbnQgOiBIYXJ2ZXN0ZXJGaWx0ZXJzQ29tcG9uZW50O1xuXG4gICAgbmdPbkluaXQoKSB7XG5cbiAgICAgICAgdGhpcy5tZXRhZGF0YS5zZXRTdGFuZGFyZE1ldGEoXCJDYXTDoWxvZ28gZGUgUmV2aXN0YXMgQ2llbnTDrWZpY2FzXCIsIFwiXCIsIFwiXCIpO1xuICAgICAgICB0aGlzLnBhZ2luYXRvci5maXJzdFBhZ2UoKTtcbiAgICAgICAgdGhpcy5wYWdpbmF0b3IucGFnZVNpemUgPSB0aGlzLnBhZ2VTaXplO1xuICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Sm91cm5hbHNDb3VudCgpLnN1YnNjcmliZShyZXNwb25zZSA9PntcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gcmVzcG9uc2UuZGF0YS5jb3VudDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmV0Y2hKb3VybmFsRGF0YSgpO1xuXG4gICAgICAgIHRoaXMuZmlsdGVyU2VydmljZS5wYXJhbXNDaGFuZ2VkLnN1YnNjcmliZShwYXJhbXMgPT57XG4gICAgICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hKb3VybmFsRGF0YSgpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8vIG9uUGFnaW5hdG9yQ2hhbmdlZCgpe1xuICAgIC8vICAgdGhpcy5maWx0ZXJTZXJ2aWNlLmNoYW5nZUZpbHRlcignY291bnQnLHRoaXMucGFnaW5hdG9yLnBhZ2VTaXplLCBmYWxzZSk7XG4gICAgLy8gICB0aGlzLmZpbHRlclNlcnZpY2UuY2hhbmdlRmlsdGVyKCdwYWdlJyx0aGlzLnBhZ2luYXRvci5wYWdlSW5kZXgpO1xuICAgIC8vIH1cblxuICAgIGZldGNoSm91cm5hbERhdGEoKSB7XG4gICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgICAgIC8vdGhpcy5kYXRhU291cmNlLmRhdGEgPSB0aGlzLnNlcnZpY2UuZ2V0Sm91cm5hbHNQYWdlKHRoaXMuY291bnQsIHRoaXMucGFnZSk7XG4gICAgICAgIGxldCBhcnIgPSBuZXcgQXJyYXk8Sm91cm5hbD4oKTtcbiAgICAgICAgbWVyZ2UoKS5waXBlKFxuICAgICAgICAgICAgc3RhcnRXaXRoKHt9KSxcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlIS5nZXRKb3VybmFsc1BhZ2UodGhpcy5wYWdpbmF0b3IucGFnZVNpemUsIHRoaXMucGFnaW5hdG9yLnBhZ2VJbmRleCwgdGhpcy5wYXJhbXMpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBtYXAocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEZsaXAgZmxhZyB0byBzaG93IHRoYXQgbG9hZGluZyBoYXMgZmluaXNoZWQuXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5pc1JhdGVMaW1pdFJlYWNoZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnJlc3VsdHNMZW5ndGggPSByZXNwb25zZS50b3RhbF9jb3VudDtcbiAgICAgICAgICAgICAgICB0aGlzLmxlbmd0aCA9IHJlc3BvbnNlLmRhdGEuc291cmNlcy5jb3VudFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuc291cmNlcy5kYXRhLmZvckVhY2goaXRlbSA9PntcbiAgICAgICAgICAgICAgICAgICAgbGV0IGogPSBuZXcgSm91cm5hbCgpO1xuICAgICAgICAgICAgICAgICAgICBqLmlkID0gaXRlbS5pZDtcbiAgICAgICAgICAgICAgICAgICAgai51dWlkID0gaXRlbS51dWlkO1xuICAgICAgICAgICAgICAgICAgICBqLnNvdXJjZV90eXBlID0gaXRlbS5zb3VyY2VfdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gai5oYXJ2ZXN0X3R5cGUgPSBpdGVtLmhhcnZlc3RfdHlwZTtcbiAgICAgICAgICAgICAgICAgICAgai5kYXRhLm9haXVybCA9IGl0ZW0uaGFydmVzdF9lbmRwb2ludDtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5mbyA9IG5ldyBKb3VybmFsRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby51cmwgPSBpdGVtLmRhdGEhPSBudWxsID8gaXRlbS5kYXRhLnVybDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8udGl0bGUgPSBpdGVtLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnN1YnRpdGxlID0gaXRlbS5zdWJ0aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uc2hvcnRuYW1lICA9IGl0ZW0uc2hvcnRuYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpc3NuID0gbmV3IElTU04oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc3NuLmUgPSBpdGVtLmRhdGEhPSBudWxsID8gaXRlbS5kYXRhLmlzc24uZSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNzbi5sID0gaXRlbS5kYXRhIT0gbnVsbCA/IGl0ZW0uZGF0YS5pc3NuLmwgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzc24ucCA9IGl0ZW0uZGF0YSE9IG51bGwgPyBpdGVtLmRhdGEuaXNzbi5wIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uaXNzbiA9IGlzc247XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLnJucHMgPSBpdGVtLmRhdGEhPSBudWxsID8gaXRlbS5kYXRhLnJucHMgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5sb2dvID0gaXRlbS5kYXRhIT0gbnVsbCA/IGl0ZW0uZGF0YS5sb2dvIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8ucHVycG9zZSAgPSBpdGVtLnB1cnBvc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmRlc2NyaXB0aW9uICA9IGl0ZW0uZGF0YSE9IG51bGwgPyBpdGVtLmRhdGEuZGVzY3JpcHRpb24gOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBqLmRhdGEgPSBpbmZvO1xuICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChqKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVSUk9SUlIgIFwiK2Vycm9yKVxuICAgICAgICAgICAgICAgIC8vIENhdGNoIGlmIHRoZSBHaXRIdWIgQVBJIGhhcyByZWFjaGVkIGl0cyByYXRlIGxpbWl0LiBSZXR1cm4gZW1wdHkgZGF0YS5cbiAgICAgICAgICAgICAgICAvLyB0aGlzLmlzUmF0ZUxpbWl0UmVhY2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmFibGVPZihbXSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApLnN1YnNjcmliZShkYXRhID0+IHRoaXMuZGF0YVNvdXJjZS5kYXRhID0gZGF0YSk7XG5cbiAgICB9XG5cbiAgICBvblNjcm9sbFVwKCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNjcm9sbGVkIHVwISFcIik7XG4gICAgfVxuXG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgaWYgKHRoaXMuam91cm5hbExpc3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlzTG9hZGluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGluZztcbiAgICB9XG5cbiAgICBjdXJyZW50Sm91cm5hbHMoKXtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5kYXRhU291cmNlLmRhdGEpXG4gICAgfVxufVxuIl19