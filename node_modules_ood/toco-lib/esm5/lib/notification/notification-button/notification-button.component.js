/**
 * @fileoverview added by tsickle
 * Generated from: lib/notification/notification-button/notification-button.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { of as observableOf, timer } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { MatSnackBar } from '@angular/material';
import moment from 'moment';
import { NotificationService } from '../../backend/public-api';
import { MessageHandler, StatusCode } from '../../core/public-api';
import { OAuthStorage } from 'angular-oauth2-oidc';
var NotificationButtonComponent = /** @class */ (function () {
    function NotificationButtonComponent(service, _snackBar, oauthStorage) {
        var _this = this;
        this.service = service;
        this._snackBar = _snackBar;
        this.oauthStorage = oauthStorage;
        this.count = 0;
        this.moment = moment;
        this.timerSuscription = null;
        this.timerObserver = {
            next: (/**
             * @param {?} _
             * @return {?}
             */
            function (_) {
                // if (this.oauthStorage.getItem('access_token')){
                _this.service.getNotificationsList(5, 0).pipe(catchError((/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    /** @type {?} */
                    var m = new MessageHandler(_this._snackBar);
                    m.showMessage(StatusCode.serverError, error.message);
                    return observableOf(null);
                })))
                    .subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                function (response) {
                    if (response && response.status === "success") {
                        _this.count = response.data.total_not_view;
                        /** @type {?} */
                        var arr = response.data.notifications
                            .map((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return (tslib_1.__assign({}, n, { classification: {
                                label: n.classification,
                                color: n.classification === 'INFO' ? '#2196F3' : n.classification === 'ALERT' ? '#FF5722' : '#d32f2f'
                            } })); }))
                            .filter((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return !n.viewed; }));
                        _this.notifications = arr;
                    }
                    else if (response) {
                        /** @type {?} */
                        var m = new MessageHandler(_this._snackBar);
                        m.showMessage(StatusCode.serverError, response.message);
                    }
                    else {
                        /** @type {?} */
                        var m = new MessageHandler(_this._snackBar);
                        m.showMessage(StatusCode.serverError, 'Notificaciones no encontradas');
                    }
                }));
                // }
            }),
            error: (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                console.log('The observable got an error notification: ' + err + '.');
            }),
            complete: (/**
             * @return {?}
             */
            function () {
                console.log('The observable got a complete notification.');
            })
        };
    }
    /**
     * @return {?}
     */
    NotificationButtonComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // Emits, one every second (90000ms), starting after 0 seconds
        this.timerSuscription = timer(0, 900000).subscribe(this.timerObserver);
        if (this.color == undefined)
            this.color = "primary";
        if (this.buttonType == undefined)
            this.buttonType = "mat-mini-fab";
    };
    /**
     * @return {?}
     */
    NotificationButtonComponent.prototype.notificationsCount = /**
     * @return {?}
     */
    function () {
        if (this.count == 0)
            return '';
        if (this.count > 10)
            return '+10';
        return this.count;
    };
    NotificationButtonComponent.decorators = [
        { type: Component, args: [{
                    selector: 'toco-notification-button',
                    template: "<ng-container [ngSwitch]=\"buttonType\">\n\n    <button *ngSwitchCase=\"'mat-icon-button'\" mat-icon-button [matBadge]=\"notificationsCount()\" matBadgeColor=\"accent\" [matMenuTriggerFor]=\"notificationsMenu\" matTooltip=\"Notificaciones\">\n        <mat-icon>notifications</mat-icon>\n    </button>\n\n    <button *ngSwitchCase=\"'mat-button'\" mat-button color=\"{{color}}\" [matBadge]=\"notificationsCount()\" matBadgeColor=\"accent\" [matMenuTriggerFor]=\"notificationsMenu\" matTooltip=\"Notificaciones\">\n        <mat-icon>notifications</mat-icon>\n    </button>\n\n    <button *ngSwitchDefault mat-mini-fab color=\"{{color}}\" [matBadge]=\"notificationsCount()\" matBadgeColor=\"accent\" [matMenuTriggerFor]=\"notificationsMenu\" matTooltip=\"Notificaciones\">\n        <mat-icon>notifications</mat-icon>\n    </button>\n</ng-container>\n\n<mat-menu #notificationsMenu=\"matMenu\" style=\"max-width: 400px !important;\">\n  <button class=\"notification-item\" mat-menu-item *ngFor=\"let notification of notifications\">\n    <div class=\"notification-container\" [ngStyle]=\"{'border-left-color': notification.classification.color}\">\n      <div class=\"notification-header\">\n        <span>{{notification.emiter.name}} {{notification.emiter.lastname}}</span>\n        <span>{{moment(notification.createdAt).startOf('day').fromNow()}}</span>\n      </div>\n      <span class=\"notification-description\">\n        {{(notification.description.length>135) ?\n          (notification.description | slice:0:135)+' ...'\n          :(notification.description)\n        }}\n      </span>\n    </div>\n  </button>\n  <div *ngIf=\"count === 0\" class=\"empty-notifications-container\">\n    <mat-icon class=\"empty-notifications-icon\">notifications</mat-icon>\n    <h1 style=\"color: gray; font-size: 25px\">SIN NOTIFICACIONES</h1>\n  </div>\n    <mat-divider></mat-divider>\n    <a [routerLink]=\"['/notifications']\" style=\"text-decoration: none;\">\n        <button mat-menu-item style=\"text-align: center;\" color=\"accent\">\n            Ver todas\n        </button>\n    </a>\n</mat-menu>\n",
                    styles: [".notification-item{height:100%;border-bottom:1px solid #f5f5f5;padding-left:0}.notification-container{display:flex;flex-direction:column;justify-content:flex-start;padding-left:10px;padding-bottom:10px;border-left:10px solid}.notification-header{display:flex;justify-content:space-between;margin-bottom:-5px;font-size:12px;color:gray}.notification-description{line-height:20px;white-space:pre-wrap;font-size:15px}.empty-notifications-container{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:30px}.empty-notifications-icon{color:grey;font-size:4.5em;height:70px;width:70px}::ng-deep.mat-menu-panel{max-width:400px!important}"]
                }] }
    ];
    /** @nocollapse */
    NotificationButtonComponent.ctorParameters = function () { return [
        { type: NotificationService },
        { type: MatSnackBar },
        { type: OAuthStorage }
    ]; };
    NotificationButtonComponent.propDecorators = {
        color: [{ type: Input }],
        buttonType: [{ type: Input }]
    };
    return NotificationButtonComponent;
}());
export { NotificationButtonComponent };
if (false) {
    /** @type {?} */
    NotificationButtonComponent.prototype.color;
    /** @type {?} */
    NotificationButtonComponent.prototype.buttonType;
    /** @type {?} */
    NotificationButtonComponent.prototype.count;
    /** @type {?} */
    NotificationButtonComponent.prototype.notifications;
    /** @type {?} */
    NotificationButtonComponent.prototype.moment;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.timerSuscription;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.timerObserver;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype._snackBar;
    /**
     * @type {?}
     * @private
     */
    NotificationButtonComponent.prototype.oauthStorage;
}
var UserNotification = /** @class */ (function () {
    function UserNotification() {
    }
    return UserNotification;
}());
if (false) {
    /** @type {?} */
    UserNotification.prototype.id;
    /** @type {?} */
    UserNotification.prototype.name;
    /** @type {?} */
    UserNotification.prototype.lastname;
    /** @type {?} */
    UserNotification.prototype.email;
}
var NotificationInfo = /** @class */ (function () {
    function NotificationInfo() {
    }
    return NotificationInfo;
}());
export { NotificationInfo };
if (false) {
    /** @type {?} */
    NotificationInfo.prototype.classification;
    /** @type {?} */
    NotificationInfo.prototype.receiver_id;
    /** @type {?} */
    NotificationInfo.prototype.viewed;
    /** @type {?} */
    NotificationInfo.prototype.viewed_date;
    /** @type {?} */
    NotificationInfo.prototype.description;
    /** @type {?} */
    NotificationInfo.prototype.createdAt;
    /** @type {?} */
    NotificationInfo.prototype.emiter;
    /** @type {?} */
    NotificationInfo.prototype.app;
    /** @type {?} */
    NotificationInfo.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly90b2NvLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLWJ1dHRvbi9ub3RpZmljYXRpb24tYnV0dG9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsRUFBRSxJQUFJLFlBQVksRUFBRSxLQUFLLEVBQWlDLE1BQU0sTUFBTSxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDaEQsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRW5EO0lBMERJLHFDQUFvQixPQUE0QixFQUFVLFNBQXNCLEVBQVUsWUFBMEI7UUFBcEgsaUJBQXlIO1FBQXJHLFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBYTtRQUFVLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBL0M3RyxVQUFLLEdBQVcsQ0FBQyxDQUFDO1FBRWxCLFdBQU0sR0FBUSxNQUFNLENBQUM7UUFFcEIscUJBQWdCLEdBQWlCLElBQUksQ0FBQztRQUN0QyxrQkFBYSxHQUE0QjtZQUM3QyxJQUFJOzs7O1lBQUUsVUFBQyxDQUFDO2dCQUVKLGtEQUFrRDtnQkFDOUMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUN2QyxVQUFVOzs7O2dCQUFDLFVBQUEsS0FBSzs7d0JBQ04sQ0FBQyxHQUFHLElBQUksY0FBYyxDQUFDLEtBQUksQ0FBQyxTQUFTLENBQUM7b0JBQzVDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3JELE9BQU8sWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM5QixDQUFDLEVBQUMsQ0FDTDtxQkFDQSxTQUFTOzs7O2dCQUFDLFVBQUEsUUFBUTtvQkFDZixJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLFNBQVMsRUFBQzt3QkFDMUMsS0FBSSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQzs7NEJBQ3BDLEdBQUcsR0FBdUIsUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhOzZCQUN4RCxHQUFHOzs7O3dCQUFFLFVBQUEsQ0FBQyxJQUFJLE9BQUEsc0JBQUssQ0FBQyxJQUFFLGNBQWMsRUFBRTtnQ0FDakMsS0FBSyxFQUFFLENBQUMsQ0FBQyxjQUFjO2dDQUN2QixLQUFLLEVBQUUsQ0FBQyxDQUFDLGNBQWMsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUzs2QkFDdEcsSUFBRSxFQUhRLENBR1IsRUFBQzs2QkFDRCxNQUFNOzs7O3dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFULENBQVMsRUFBQzt3QkFDM0IsS0FBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUM7cUJBQzVCO3lCQUNJLElBQUcsUUFBUSxFQUFDOzs0QkFDUCxDQUFDLEdBQUcsSUFBSSxjQUFjLENBQUMsS0FBSSxDQUFDLFNBQVMsQ0FBQzt3QkFDNUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztxQkFDM0Q7eUJBQU07OzRCQUNHLENBQUMsR0FBRyxJQUFJLGNBQWMsQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDO3dCQUM1QyxDQUFDLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsK0JBQStCLENBQUMsQ0FBQztxQkFDMUU7Z0JBQ0wsQ0FBQyxFQUFDLENBQUM7Z0JBQ1AsSUFBSTtZQUNSLENBQUMsQ0FBQTtZQUVELEtBQUs7Ozs7WUFBRSxVQUFDLEdBQVE7Z0JBQ1osT0FBTyxDQUFDLEdBQUcsQ0FBQyw0Q0FBNEMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDMUUsQ0FBQyxDQUFBO1lBRUQsUUFBUTs7O1lBQUU7Z0JBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1lBQy9ELENBQUMsQ0FBQTtTQUNKLENBQUM7SUFFc0gsQ0FBQzs7OztJQUV6SCw4Q0FBUTs7O0lBQVI7UUFDSSw4REFBOEQ7UUFDOUQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUV2RSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksU0FBUztZQUFFLElBQUksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO1FBRXBELElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxTQUFTO1lBQUUsSUFBSSxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUM7SUFDdkUsQ0FBQzs7OztJQUVELHdEQUFrQjs7O0lBQWxCO1FBQ0UsSUFBRyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUM7WUFDaEIsT0FBTyxFQUFFLENBQUM7UUFDWixJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRTtZQUNiLE9BQU8sS0FBSyxDQUFDO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDOztnQkEzRUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSwwQkFBMEI7b0JBQ3BDLGlrRUFBbUQ7O2lCQUV0RDs7OztnQkFSUSxtQkFBbUI7Z0JBRm5CLFdBQVc7Z0JBSVgsWUFBWTs7O3dCQVNoQixLQUFLOzZCQUVMLEtBQUs7O0lBb0VWLGtDQUFDO0NBQUEsQUE3RUQsSUE2RUM7U0F4RVksMkJBQTJCOzs7SUFFcEMsNENBQThCOztJQUU5QixpREFBbUM7O0lBRW5DLDRDQUF5Qjs7SUFDekIsb0RBQThDOztJQUM5Qyw2Q0FBNEI7Ozs7O0lBRTVCLHVEQUE4Qzs7Ozs7SUFDOUMsb0RBd0NFOzs7OztJQUVVLDhDQUFvQzs7Ozs7SUFBRSxnREFBOEI7Ozs7O0lBQUUsbURBQWtDOztBQXFCeEg7SUFBQTtJQUtBLENBQUM7SUFBRCx1QkFBQztBQUFELENBQUMsQUFMRCxJQUtDOzs7SUFKQyw4QkFBVzs7SUFDWCxnQ0FBYTs7SUFDYixvQ0FBaUI7O0lBQ2pCLGlDQUFjOztBQUdoQjtJQUFBO0lBVUEsQ0FBQztJQUFELHVCQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7Ozs7SUFUQywwQ0FBaUQ7O0lBQ2pELHVDQUE4Qjs7SUFDOUIsa0NBQWdCOztJQUNoQix1Q0FBb0I7O0lBQ3BCLHVDQUFvQjs7SUFDcEIscUNBQWtCOztJQUNsQixrQ0FBeUI7O0lBQ3pCLCtCQUFZOztJQUNaLGdDQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBvZiBhcyBvYnNlcnZhYmxlT2YsIHRpbWVyLCBTdWJzY3JpcHRpb24sIFBhcnRpYWxPYnNlcnZlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hdFNuYWNrQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL2JhY2tlbmQvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBNZXNzYWdlSGFuZGxlciwgU3RhdHVzQ29kZSB9IGZyb20gJy4uLy4uL2NvcmUvcHVibGljLWFwaSc7XG5pbXBvcnQgeyBPQXV0aFN0b3JhZ2UgfSBmcm9tICdhbmd1bGFyLW9hdXRoMi1vaWRjJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0b2NvLW5vdGlmaWNhdGlvbi1idXR0b24nLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9ub3RpZmljYXRpb24tYnV0dG9uLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9ub3RpZmljYXRpb24tYnV0dG9uLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uQnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIEBJbnB1dCgpIHB1YmxpYyBjb2xvcjogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgcHVibGljIGJ1dHRvblR5cGU6IHN0cmluZztcblxuICAgIHB1YmxpYyBjb3VudDogbnVtYmVyID0gMDtcbiAgICBwdWJsaWMgbm90aWZpY2F0aW9uczogQXJyYXk8Tm90aWZpY2F0aW9uSW5mbz47XG4gICAgcHVibGljIG1vbWVudDogYW55ID0gbW9tZW50O1xuXG4gICAgcHJpdmF0ZSB0aW1lclN1c2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIHByaXZhdGUgdGltZXJPYnNlcnZlcjogUGFydGlhbE9ic2VydmVyPG51bWJlcj4gPSB7XG4gICAgICAgIG5leHQ6IChfKSA9PiB7XG5cbiAgICAgICAgICAgIC8vIGlmICh0aGlzLm9hdXRoU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKSl7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmdldE5vdGlmaWNhdGlvbnNMaXN0KDUsMCkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZU9mKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gXCJzdWNjZXNzXCIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb3VudCA9IHJlc3BvbnNlLmRhdGEudG90YWxfbm90X3ZpZXc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnI6IE5vdGlmaWNhdGlvbkluZm9bXSA9IHJlc3BvbnNlLmRhdGEubm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBuID0+ICh7Li4ubiwgY2xhc3NpZmljYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogbi5jbGFzc2lmaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogbi5jbGFzc2lmaWNhdGlvbiA9PT0gJ0lORk8nID8gJyMyMTk2RjMnIDogbi5jbGFzc2lmaWNhdGlvbiA9PT0gJ0FMRVJUJyA/ICcjRkY1NzIyJyA6ICcjZDMyZjJmJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9fSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihuID0+ICFuLnZpZXdlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSBhcnI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IE1lc3NhZ2VIYW5kbGVyKHRoaXMuX3NuYWNrQmFyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgJ05vdGlmaWNhY2lvbmVzIG5vIGVuY29udHJhZGFzJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfSxcblxuICAgICAgICBlcnJvcjogKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVGhlIG9ic2VydmFibGUgZ290IGFuIGVycm9yIG5vdGlmaWNhdGlvbjogJyArIGVyciArICcuJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUaGUgb2JzZXJ2YWJsZSBnb3QgYSBjb21wbGV0ZSBub3RpZmljYXRpb24uJyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlLCBwcml2YXRlIF9zbmFja0JhcjogTWF0U25hY2tCYXIsIHByaXZhdGUgb2F1dGhTdG9yYWdlOiBPQXV0aFN0b3JhZ2UpIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIC8vIEVtaXRzLCBvbmUgZXZlcnkgc2Vjb25kICg5MDAwMG1zKSwgc3RhcnRpbmcgYWZ0ZXIgMCBzZWNvbmRzXG4gICAgICAgIHRoaXMudGltZXJTdXNjcmlwdGlvbiA9IHRpbWVyKDAsIDkwMDAwMCkuc3Vic2NyaWJlKHRoaXMudGltZXJPYnNlcnZlcik7XG5cbiAgICAgICAgaWYgKHRoaXMuY29sb3IgPT0gdW5kZWZpbmVkKSB0aGlzLmNvbG9yID0gXCJwcmltYXJ5XCI7XG5cbiAgICAgICAgaWYgKHRoaXMuYnV0dG9uVHlwZSA9PSB1bmRlZmluZWQpIHRoaXMuYnV0dG9uVHlwZSA9IFwibWF0LW1pbmktZmFiXCI7XG4gICAgfVxuXG4gICAgbm90aWZpY2F0aW9uc0NvdW50KCl7XG4gICAgICBpZih0aGlzLmNvdW50ID09IDApXG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIGlmICh0aGlzLmNvdW50ID4gMTApXG4gICAgICAgICAgICByZXR1cm4gJysxMCc7XG4gICAgICAgIHJldHVybiB0aGlzLmNvdW50O1xuICAgIH1cblxufVxuXG5jbGFzcyAgVXNlck5vdGlmaWNhdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgbGFzdG5hbWU6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvbkluZm8ge1xuICBjbGFzc2lmaWNhdGlvbjogeyBsYWJlbDogc3RyaW5nLCBjb2xvcjogc3RyaW5nIH07XG4gIHJlY2VpdmVyX2lkOiBVc2VyTm90aWZpY2F0aW9uO1xuICB2aWV3ZWQ6IGJvb2xlYW47XG4gIHZpZXdlZF9kYXRlOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xuICBlbWl0ZXI6IFVzZXJOb3RpZmljYXRpb247XG4gIGFwcDogc3RyaW5nO1xuICBkYXRhOiB7fTtcbn1cbiJdfQ==