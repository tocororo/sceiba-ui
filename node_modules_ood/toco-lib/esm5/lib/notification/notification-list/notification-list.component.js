/**
 * @fileoverview added by tsickle
 * Generated from: lib/notification/notification-list/notification-list.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { MatTableDataSource, MatPaginator, MatSnackBar } from '@angular/material';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import moment from 'moment';
import { NotificationService } from '../../backend/public-api';
import { MessageHandler, StatusCode } from '../../core/public-api';
var NotificationListComponent = /** @class */ (function () {
    function NotificationListComponent(service, _snackBar) {
        this.service = service;
        this._snackBar = _snackBar;
        this.dataSource = new MatTableDataSource();
        this.columnsToDisplay = ['action', 'description', 'classification', 'emiter', 'emiterEmail', 'createdAt'];
        this.columnsLabels = ['', 'Descripción', 'Clasificación', 'Emisor', 'Correo del emisor', 'Creada'];
        this.moment = moment;
        this.pageSizeOptions = [5, 10, 15, 20];
    }
    /**
     * @return {?}
     */
    NotificationListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.paginator.firstPage();
        this.paginator.pageSize = 5;
        this.getNotificationsListData();
    };
    /**
     * @return {?}
     */
    NotificationListComponent.prototype.getNotificationsListData = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.service.getNotificationsList(this.paginator.pageSize, this.paginator.pageIndex)
            .pipe(catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            /** @type {?} */
            var m = new MessageHandler(_this._snackBar);
            m.showMessage(StatusCode.serverError, error.message);
            return of(null);
        })))
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response) {
                _this.paginator.length = response.data.total_not_view;
                /** @type {?} */
                var arr = response.data.notifications
                    .map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return (tslib_1.__assign({}, n, { classification: {
                        label: n.classification,
                        color: n.classification === 'INFO' ? '#2196F3' : n.classification === 'ALERT' ? '#FF5722' : '#d32f2f'
                    } })); }));
                _this.dataSource.data = arr;
            }
            else {
                _this.paginator.length = 0;
                _this.dataSource.data = null;
            }
        }));
    };
    /**
     * @param {?} id
     * @return {?}
     */
    NotificationListComponent.prototype.setnotificationViewed = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        console.log(id);
        if (id) {
            this.service.setNotificationViewed(id)
                .pipe(catchError((/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                /** @type {?} */
                var m = new MessageHandler(_this._snackBar);
                m.showMessage(StatusCode.serverError, error.message);
                return of(null);
            })))
                .subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                if (response.status === 'success') {
                    _this.getNotificationsListData();
                    /** @type {?} */
                    var m = new MessageHandler(_this._snackBar);
                    m.showMessage(StatusCode.OK, 'La notificación fue marcada como leída');
                }
                else {
                    /** @type {?} */
                    var m = new MessageHandler(_this._snackBar);
                    m.showMessage(StatusCode.serverError, response.message);
                }
            }));
        }
    };
    NotificationListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-notification-list',
                    template: "<div [ngStyle]=\"{padding: '2em 1em 0 1em', overflow: 'auto'}\">\n    <table mat-table [dataSource]=\"dataSource\" multiTemplateDataRows>\n        <ng-container matColumnDef=\"{{column}}\" *ngFor=\"let column of columnsToDisplay; let i = index\">\n            <th [id]=\"column+'-th'\" mat-header-cell *matHeaderCellDef> {{columnsLabels[i]}} </th>\n            <td class=\"element-row-header\"\n                mat-cell *matCellDef=\"let element\"\n                [id]=\"column+'-td'\"\n                [class.expanded-row]=\"column === 'description' && expandedElement === element\" (click)=\"expandedElement = element\"\n                [ngStyle]=\"{'font-weight': !element.viewed ? 'bold' : '0', width: column === 'action' ? '50px' : 'inherit'}\"\n            >\n              <ng-container *ngIf=\"column === 'action'\">\n                <button mat-icon-button *ngIf=\"!element.viewed\" color=\"primary\" (click)=\"setnotificationViewed(element.id)\" matTooltip=\"Marcar como visto\">\n                  <mat-icon class=\"mat-16\">visibility</mat-icon>\n                </button>\n                <button mat-icon-button *ngIf=\"element.viewed\" disabled color=\"primary\" (click)=\"setnotificationViewed(element.id)\" matTooltip=\"Visto\">\n                  <mat-icon class=\"mat-16\">viewed</mat-icon>\n                </button>\n              </ng-container>\n\n              <span *ngIf=\"column === 'createdAt' \" > {{moment(element[column]).format('ll')}} </span>\n              <div class=\"element-tag\" [ngStyle]=\"{'background-color': element['classification'].color}\" *ngIf=\"column === 'classification'\" > {{element[column].label}} </div>\n              <span *ngIf=\"column === 'emiter'\" > {{element[column].name}} {{element[column].lastname}} </span>\n              <span *ngIf=\"column === 'emiterEmail'\" > {{element['emiter'].email}} </span>\n              <div  *ngIf=\"column === 'description'\" class=\"element-description-header\" >\n                <mat-icon class=\"mat-16\" color=\"primary\" >{{expandedElement === element ? 'expand_more' : 'chevron_right'}}</mat-icon>\n                {{(element[column].length && element[column].length>70) ?\n                   (element[column] | slice:0:70)+' ...'\n                   :(element[column])\n                }}\n              </div>\n            </td>\n            <td mat-cell *matCellDef=\"let element\">\n            </td>\n        </ng-container>\n\n        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n        <ng-container matColumnDef=\"expandedDetail\">\n            <td mat-cell *matCellDef=\"let element\" [attr.colspan]=\"columnsToDisplay.length\">\n                <div class=\"element-detail\" fxLayout=\"row wrap\" fxLayoutAlign=\"space-between center\"  fxLayoutGap=\"15px\" [@detailExpand]=\"element == expandedElement ? 'expanded' : 'collapsed'\">\n\n                    <div class=\"element-description\">\n                        {{element.description}}\n                    </div>\n\n                </div>\n            </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"columnsToDisplay\"></tr>\n        <tr mat-row *matRowDef=\"let element; columns: columnsToDisplay;\" class=\"element-row\"\n            >\n        </tr>\n        <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"detail-row\"></tr>\n    </table>\n    <div *ngIf=\"paginator.length === 0\" class=\"empty-notifications-container\">\n      <mat-icon class=\"empty-notifications-icon\">notifications</mat-icon>\n      <h1 style=\"color: grey;\">SIN NOTIFICACIONES</h1>\n    </div>\n    <mat-paginator [length]=\"paginator.length\" [pageSize]=\"paginator.pageSize\" [pageSizeOptions]=\"pageSizeOptions\" (page)=\"getNotificationsListData()\">\n    </mat-paginator>\n</div>\n",
                    animations: [
                        trigger('detailExpand', [
                            state('collapsed', style({ height: '0px', minHeight: '0' })),
                            state('expanded', style({ height: '*' })),
                            transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                        ]),
                    ],
                    styles: ["table{width:100%}tr.detail-row{height:0}tr.element-row:not(.expanded-row):hover{background:#f4f4f4}tr.element-row:not(.expanded-row):active{background:#efefef}.element-row td{border-bottom-width:0}.element-detail{overflow:hidden;display:flex;background-color:#f4f4f4;border-radius:10px 10px 0 0}.element-tag{display:flex;justify-content:center;padding:6px;border-radius:15px;width:60%}.element-description-header{display:flex;align-items:center;cursor:pointer;padding:10px 25px 10px 10px}.element-description{padding:16px}.element-description-attribution{opacity:.5}.empty-notifications-container{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:30px}.empty-notifications-icon{color:grey;font-size:6em;height:100px;width:100px}@media only screen and (max-width:768px){#description-th{padding-left:34px!important}#emiter-td,#emiter-th{display:none!important}#createdAt-th,#emiterEmail-td,#emiterEmail-th{padding-left:20px!important}#createdAt-td{min-width:120px!important;padding-left:20px!important}}"]
                }] }
    ];
    /** @nocollapse */
    NotificationListComponent.ctorParameters = function () { return [
        { type: NotificationService },
        { type: MatSnackBar }
    ]; };
    NotificationListComponent.propDecorators = {
        paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }]
    };
    return NotificationListComponent;
}());
export { NotificationListComponent };
if (false) {
    /** @type {?} */
    NotificationListComponent.prototype.dataSource;
    /** @type {?} */
    NotificationListComponent.prototype.columnsToDisplay;
    /** @type {?} */
    NotificationListComponent.prototype.columnsLabels;
    /** @type {?} */
    NotificationListComponent.prototype.expandedElement;
    /** @type {?} */
    NotificationListComponent.prototype.moment;
    /** @type {?} */
    NotificationListComponent.prototype.pageSizeOptions;
    /** @type {?} */
    NotificationListComponent.prototype.paginator;
    /**
     * @type {?}
     * @private
     */
    NotificationListComponent.prototype.service;
    /**
     * @type {?}
     * @private
     */
    NotificationListComponent.prototype._snackBar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG9jby1saWIvIiwic291cmNlcyI6WyJsaWIvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1saXN0L25vdGlmaWNhdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RCxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFvQixNQUFNLG1CQUFtQixDQUFDO0FBQ3BHLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUM1QixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsY0FBYyxFQUFFLFVBQVUsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBSW5FO0lBeUJJLG1DQUFvQixPQUE0QixFQUFVLFNBQXNCO1FBQTVELFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBQVUsY0FBUyxHQUFULFNBQVMsQ0FBYTtRQVZoRixlQUFVLEdBQUcsSUFBSSxrQkFBa0IsRUFBb0IsQ0FBQztRQUN4RCxxQkFBZ0IsR0FBRyxDQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxXQUFXLENBQUUsQ0FBQztRQUN0RyxrQkFBYSxHQUFHLENBQUMsRUFBRSxFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUFFLG1CQUFtQixFQUFFLFFBQVEs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Q0FBQyxFQUFFLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztpQkFDeEU7cUJBQU07O3dCQUNDLENBQUMsR0FBRyxJQUFJLGNBQWMsQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDO29CQUM1QyxDQUFDLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUN6RDtZQUNILENBQUMsRUFDRixDQUFDO1NBQ0w7SUFDTCxDQUFDOztnQkFoRkosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSx1QkFBdUI7b0JBQ2pDLGl5SEFBaUQ7b0JBRWpELFVBQVUsRUFBRTt3QkFDUixPQUFPLENBQUMsY0FBYyxFQUFFOzRCQUNwQixLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7NEJBQzVELEtBQUssQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7NEJBQ3pDLFVBQVUsQ0FBQyx3QkFBd0IsRUFBRSxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQzt5QkFDeEYsQ0FBQztxQkFDTDs7aUJBQ0o7Ozs7Z0JBaEJRLG1CQUFtQjtnQkFKZSxXQUFXOzs7NEJBZ0NqRCxTQUFTLFNBQUMsWUFBWSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs7SUEwRDdDLGdDQUFDO0NBQUEsQUFqRkQsSUFpRkM7U0FwRVkseUJBQXlCOzs7SUFFbEMsK0NBQXdEOztJQUN4RCxxREFBc0c7O0lBQ3RHLGtEQUE4Rjs7SUFDOUYsb0RBQThCOztJQUM5QiwyQ0FBNEI7O0lBRTVCLG9EQUE0Qzs7SUFFNUMsOENBQW1FOzs7OztJQUV2RCw0Q0FBb0M7Ozs7O0lBQUUsOENBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdHJpZ2dlciwgc3RhdGUsIHN0eWxlLCB0cmFuc2l0aW9uLCBhbmltYXRlIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBNYXRUYWJsZURhdGFTb3VyY2UsIE1hdFBhZ2luYXRvciwgTWF0U25hY2tCYXIsIE1hdFBhZ2luYXRvckludGwgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9iYWNrZW5kL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgTWVzc2FnZUhhbmRsZXIsIFN0YXR1c0NvZGUgfSBmcm9tICcuLi8uLi9jb3JlL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uSW5mbyB9IGZyb20gJy4uL25vdGlmaWNhdGlvbi1idXR0b24vbm90aWZpY2F0aW9uLWJ1dHRvbi5jb21wb25lbnQnO1xuXG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbGliLW5vdGlmaWNhdGlvbi1saXN0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbm90aWZpY2F0aW9uLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL25vdGlmaWNhdGlvbi1saXN0LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgYW5pbWF0aW9uczogW1xuICAgICAgICB0cmlnZ2VyKCdkZXRhaWxFeHBhbmQnLCBbXG4gICAgICAgICAgICBzdGF0ZSgnY29sbGFwc2VkJywgc3R5bGUoeyBoZWlnaHQ6ICcwcHgnLCBtaW5IZWlnaHQ6ICcwJyB9KSksXG4gICAgICAgICAgICBzdGF0ZSgnZXhwYW5kZWQnLCBzdHlsZSh7IGhlaWdodDogJyonIH0pKSxcbiAgICAgICAgICAgIHRyYW5zaXRpb24oJ2V4cGFuZGVkIDw9PiBjb2xsYXBzZWQnLCBhbmltYXRlKCcyMjVtcyBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDAuMiwgMSknKSksXG4gICAgICAgIF0pLFxuICAgIF1cbn0pXG5cbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25MaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIGRhdGFTb3VyY2UgPSBuZXcgTWF0VGFibGVEYXRhU291cmNlPE5vdGlmaWNhdGlvbkluZm8+KCk7XG4gICAgY29sdW1uc1RvRGlzcGxheSA9IFsnYWN0aW9uJywgJ2Rlc2NyaXB0aW9uJywgJ2NsYXNzaWZpY2F0aW9uJywgJ2VtaXRlcicsICdlbWl0ZXJFbWFpbCcsICdjcmVhdGVkQXQnIF07XG4gICAgY29sdW1uc0xhYmVscyA9IFsnJywgJ0Rlc2NyaXBjacOzbicsICdDbGFzaWZpY2FjacOzbicsICdFbWlzb3InLCAnQ29ycmVvIGRlbCBlbWlzb3InLCAnQ3JlYWRhJ107XG4gICAgZXhwYW5kZWRFbGVtZW50OiBOb3RpZmljYXRpb247XG4gICAgcHVibGljIG1vbWVudDogYW55ID0gbW9tZW50O1xuXG4gICAgcGFnZVNpemVPcHRpb25zOiBudW1iZXJbXSA9IFs1LCAxMCwgMTUsIDIwXTtcblxuICAgIEBWaWV3Q2hpbGQoTWF0UGFnaW5hdG9yLCB7IHN0YXRpYzogdHJ1ZSB9KSBwYWdpbmF0b3I6IE1hdFBhZ2luYXRvcjtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc2VydmljZTogTm90aWZpY2F0aW9uU2VydmljZSwgcHJpdmF0ZSBfc25hY2tCYXI6IE1hdFNuYWNrQmFyKSB7IH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnBhZ2luYXRvci5maXJzdFBhZ2UoKTtcbiAgICAgICAgdGhpcy5wYWdpbmF0b3IucGFnZVNpemUgPSA1O1xuICAgICAgICB0aGlzLmdldE5vdGlmaWNhdGlvbnNMaXN0RGF0YSgpO1xuICAgIH1cbiAgICBnZXROb3RpZmljYXRpb25zTGlzdERhdGEoKSB7XG4gICAgICAgIHRoaXMuc2VydmljZS5nZXROb3RpZmljYXRpb25zTGlzdCh0aGlzLnBhZ2luYXRvci5wYWdlU2l6ZSwgdGhpcy5wYWdpbmF0b3IucGFnZUluZGV4KVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgICAgICBtLnNob3dNZXNzYWdlKFN0YXR1c0NvZGUuc2VydmVyRXJyb3IsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2luYXRvci5sZW5ndGggPSByZXNwb25zZS5kYXRhLnRvdGFsX25vdF92aWV3O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnI6IE5vdGlmaWNhdGlvbkluZm9bXSA9IHJlc3BvbnNlLmRhdGEubm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgICAgICAgICAubWFwKCBuID0+ICh7Li4ubiwgY2xhc3NpZmljYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBuLmNsYXNzaWZpY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IG4uY2xhc3NpZmljYXRpb24gPT09ICdJTkZPJyA/ICcjMjE5NkYzJyA6IG4uY2xhc3NpZmljYXRpb24gPT09ICdBTEVSVCcgPyAnI0ZGNTcyMicgOiAnI2QzMmYyZidcbiAgICAgICAgICAgICAgICAgICAgICB9fSkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2UuZGF0YSA9IGFycjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2luYXRvci5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2UuZGF0YSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0bm90aWZpY2F0aW9uVmlld2VkKGlkOiBudW1iZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coaWQpO1xuICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICB0aGlzLnNlcnZpY2Uuc2V0Tm90aWZpY2F0aW9uVmlld2VkKGlkKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgIG0uc2hvd01lc3NhZ2UoU3RhdHVzQ29kZS5zZXJ2ZXJFcnJvciwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLmdldE5vdGlmaWNhdGlvbnNMaXN0RGF0YSgpO1xuICAgICAgICAgICAgICAgICAgY29uc3QgbSA9IG5ldyBNZXNzYWdlSGFuZGxlcih0aGlzLl9zbmFja0Jhcik7XG4gICAgICAgICAgICAgICAgICBtLnNob3dNZXNzYWdlKFN0YXR1c0NvZGUuT0ssICdMYSBub3RpZmljYWNpw7NuIGZ1ZSBtYXJjYWRhIGNvbW8gbGXDrWRhJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVzc2FnZUhhbmRsZXIodGhpcy5fc25hY2tCYXIpO1xuICAgICAgICAgICAgICAgICAgbS5zaG93TWVzc2FnZShTdGF0dXNDb2RlLnNlcnZlckVycm9yLCByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=