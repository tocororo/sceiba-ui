/**
 * @fileoverview added by tsickle
 * Generated from: lib/backend/taxonomy.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 *   Copyright (c) 2020 Universidad de Pinar del Río "Hermanos Saíz Montes de Oca"
 *   All rights reserved.
 */
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { OAuthStorage } from 'angular-oauth2-oidc';
import { Environment } from '../core/public-api';
// TODO: Poner todos los tipos de datos de retorno de Response.
// No puede haber en ningun servicio del backend un Response<any>
var TaxonomyService = /** @class */ (function () {
    function TaxonomyService(env, http, oauthStorage) {
        this.env = env;
        this.http = http;
        this.oauthStorage = oauthStorage;
        this.prefix = 'vocabularies';
        this.httpOptions = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json',
            })
        };
        this.token = '';
        this.token = this.oauthStorage.getItem('access_token');
    }
    /**
     * @param {?} id
     * @return {?}
     */
    TaxonomyService.prototype.getVocabulary = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        /** @type {?} */
        var req = this.env.sceibaApi + this.prefix + '/vocabulary/' + id;
        return this.http.get(req);
    };
    /**
     * @param {?} ids
     * @return {?}
     */
    TaxonomyService.prototype.getTermListByIDs = /**
     * @param {?} ids
     * @return {?}
     */
    function (ids) {
        /** @type {?} */
        var p = '';
        ids.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return p = p + n.toString(10) + ','; }));
        p = p.substring(0, p.length - 1);
        /** @type {?} */
        var params = new HttpParams();
        /** @type {?} */
        var options = {
            params: params.set('ids', p)
        };
        /** @type {?} */
        var req = this.env.sceibaApi + this.prefix + '/term/inlist';
        return this.http.get(req, options);
    };
    /**
     * @param {?} termID
     * @param {?=} level
     * @return {?}
     */
    TaxonomyService.prototype.getTermByID = /**
     * @param {?} termID
     * @param {?=} level
     * @return {?}
     */
    function (termID, level) {
        if (level === void 0) { level = 10; }
        /** @type {?} */
        var params = new HttpParams();
        /** @type {?} */
        var options = {
            params: params.set('level', level.toString(10))
        };
        /** @type {?} */
        var req = this.env.sceibaApi + this.prefix + '/term/id/' + termID;
        return this.http.get(req, options);
    };
    /**
     * @param {?} termUUID
     * @param {?=} level
     * @return {?}
     */
    TaxonomyService.prototype.getTermByUUID = /**
     * @param {?} termUUID
     * @param {?=} level
     * @return {?}
     */
    function (termUUID, level) {
        if (level === void 0) { level = 10; }
        /** @type {?} */
        var params = new HttpParams();
        /** @type {?} */
        var options = {
            params: params.set('level', level.toString(10))
        };
        /** @type {?} */
        var req = this.env.sceibaApi + this.prefix + '/term/' + termUUID;
        return this.http.get(req, options);
    };
    /**
     * @param {?} vocabId
     * @param {?=} level
     * @return {?}
     */
    TaxonomyService.prototype.getTermsTreeByVocab = /**
     * @param {?} vocabId
     * @param {?=} level
     * @return {?}
     */
    function (vocabId, level) {
        if (level === void 0) { level = 10; }
        /** @type {?} */
        var params = new HttpParams();
        /** @type {?} */
        var options = {
            params: params.set('level', level.toString(10))
        };
        /** @type {?} */
        var req = this.env.sceibaApi + this.prefix + '/term/tree/' + vocabId;
        return this.http.get(req, options);
    };
    /**
     * @param {?} vocab
     * @return {?}
     */
    TaxonomyService.prototype.newVocabulary = /**
     * @param {?} vocab
     * @return {?}
     */
    function (vocab) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/vocabulary/new', vocab.entitystringify(), this.httpOptions);
    };
    /**
     * @param {?} vocab
     * @return {?}
     */
    TaxonomyService.prototype.editVocabulary = /**
     * @param {?} vocab
     * @return {?}
     */
    function (vocab) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/vocabulary/edit/' + vocab.id, vocab.entitystringify(), this.httpOptions);
    };
    /**
     * @return {?}
     */
    TaxonomyService.prototype.getVocabularies = /**
     * @return {?}
     */
    function () {
        return this.http.get(this.env.sceibaApi + this.prefix + '/vocabulary/list');
    };
    /**
     * @param {?} term
     * @return {?}
     */
    TaxonomyService.prototype.newTerm = /**
     * @param {?} term
     * @return {?}
     */
    function (term) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/term/new', term.entitystringify(), this.httpOptions);
    };
    /**
     * @param {?} term
     * @return {?}
     */
    TaxonomyService.prototype.editTerm = /**
     * @param {?} term
     * @return {?}
     */
    function (term) {
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.post(this.env.sceibaApi + this.prefix + '/term/edit/' + term.uuid, term.entitystringify(), this.httpOptions);
    };
    /**
     * @return {?}
     */
    TaxonomyService.prototype.getCurrentUserPermissions = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var req = this.env.sceibaApi + this.prefix + '/user/permissions';
        this.httpOptions.headers = this.httpOptions.headers.set('Authorization', 'Bearer ' + this.token);
        return this.http.get(req, this.httpOptions);
    };
    TaxonomyService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    TaxonomyService.ctorParameters = function () { return [
        { type: Environment },
        { type: HttpClient },
        { type: OAuthStorage }
    ]; };
    return TaxonomyService;
}());
export { TaxonomyService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.prefix;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.httpOptions;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.token;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.env;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    TaxonomyService.prototype.oauthStorage;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGF4b25vbXkuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3RvY28tbGliLyIsInNvdXJjZXMiOlsibGliL2JhY2tlbmQvdGF4b25vbXkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFNQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTNFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUduRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7OztBQVFqRDtJQWFFLHlCQUFvQixHQUFnQixFQUFVLElBQWdCLEVBQVUsWUFBMEI7UUFBOUUsUUFBRyxHQUFILEdBQUcsQ0FBYTtRQUFVLFNBQUksR0FBSixJQUFJLENBQVk7UUFBVSxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQVYxRixXQUFNLEdBQUcsY0FBYyxDQUFDO1FBRXhCLGdCQUFXLEdBQUc7WUFDcEIsT0FBTyxFQUFFLElBQUksV0FBVyxDQUN0QjtnQkFDRSxjQUFjLEVBQUUsa0JBQWtCO2FBQ25DLENBQUM7U0FDTCxDQUFDO1FBQ00sVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUdqQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7Ozs7O0lBRUQsdUNBQWE7Ozs7SUFBYixVQUFjLEVBQUU7O1lBQ1YsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsY0FBYyxHQUFHLEVBQUU7UUFDaEUsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBZ0IsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7Ozs7SUFFRCwwQ0FBZ0I7Ozs7SUFBaEIsVUFB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ZSBQaW5hciBkZWwgUsOtbyBcIkhlcm1hbm9zIFNhw616IE1vbnRlcyBkZSBPY2FcIlxuICogICBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICovXG5cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBQYXJ0aWFsT2JzZXJ2ZXIsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE9BdXRoU3RvcmFnZSB9IGZyb20gJ2FuZ3VsYXItb2F1dGgyLW9pZGMnO1xuXG5cbmltcG9ydCB7IEVudmlyb25tZW50IH0gZnJvbSAnLi4vY29yZS9wdWJsaWMtYXBpJztcblxuaW1wb3J0IHsgUmVzcG9uc2UgfSBmcm9tICcuLi9jb3JlL3B1YmxpYy1hcGknO1xuaW1wb3J0IHsgVm9jYWJ1bGFyeSwgVGVybSB9IGZyb20gJy4uL2VudGl0aWVzL3B1YmxpYy1hcGknO1xuXG4vLyBUT0RPOiBQb25lciB0b2RvcyBsb3MgdGlwb3MgZGUgZGF0b3MgZGUgcmV0b3JubyBkZSBSZXNwb25zZS5cbi8vIE5vIHB1ZWRlIGhhYmVyIGVuIG5pbmd1biBzZXJ2aWNpbyBkZWwgYmFja2VuZCB1biBSZXNwb25zZTxhbnk+XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBUYXhvbm9teVNlcnZpY2Uge1xuXG4gIHByaXZhdGUgcHJlZml4ID0gJ3ZvY2FidWxhcmllcyc7XG5cbiAgcHJpdmF0ZSBodHRwT3B0aW9ucyA9IHtcbiAgICBoZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoXG4gICAgICB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9KVxuICB9O1xuICBwcml2YXRlIHRva2VuID0gJyc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbnY6IEVudmlyb25tZW50LCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIHByaXZhdGUgb2F1dGhTdG9yYWdlOiBPQXV0aFN0b3JhZ2UpIHtcbiAgICB0aGlzLnRva2VuID0gdGhpcy5vYXV0aFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7XG4gIH1cblxuICBnZXRWb2NhYnVsYXJ5KGlkKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgbGV0IHJlcSA9IHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgJy92b2NhYnVsYXJ5LycgKyBpZDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+PihyZXEpO1xuICB9XG5cbiAgZ2V0VGVybUxpc3RCeUlEcyhpZHM6IG51bWJlcltdKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgbGV0IHAgPSAnJztcbiAgICBpZHMuZm9yRWFjaChuID0+IHAgPSBwICsgbi50b1N0cmluZygxMCkgKyAnLCcpO1xuICAgIHAgPSBwLnN1YnN0cmluZygwLCBwLmxlbmd0aCAtIDEpO1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcy5zZXQoJ2lkcycsIHApXG4gICAgfTtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdGVybS9pbmxpc3QnO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSwgb3B0aW9ucyk7XG4gIH1cblxuICBnZXRUZXJtQnlJRCh0ZXJtSUQsIGxldmVsPTEwKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIHBhcmFtczogcGFyYW1zLnNldCgnbGV2ZWwnLCBsZXZlbC50b1N0cmluZygxMCkpXG4gICAgfTtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdGVybS9pZC8nICsgdGVybUlEO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSwgb3B0aW9ucyk7XG4gIH1cblxuICBnZXRUZXJtQnlVVUlEKHRlcm1VVUlELCBsZXZlbD0xMCk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBwYXJhbXM6IHBhcmFtcy5zZXQoJ2xldmVsJywgbGV2ZWwudG9TdHJpbmcoMTApKVxuICAgIH07XG4gICAgY29uc3QgcmVxID0gdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3Rlcm0vJyArIHRlcm1VVUlEO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSwgb3B0aW9ucyk7XG4gIH1cblxuICBnZXRUZXJtc1RyZWVCeVZvY2FiKHZvY2FiSWQsIGxldmVsPTEwKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIHBhcmFtczogcGFyYW1zLnNldCgnbGV2ZWwnLCBsZXZlbC50b1N0cmluZygxMCkpXG4gICAgfTtcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdGVybS90cmVlLycgKyB2b2NhYklkO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSwgb3B0aW9ucyk7XG4gIH1cblxuICBuZXdWb2NhYnVsYXJ5KHZvY2FiOiBWb2NhYnVsYXJ5KTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PiB7XG4gICAgdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzID0gdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIHRoaXMudG9rZW4pO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxSZXNwb25zZTxhbnk+PihcbiAgICAgIHRoaXMuZW52LnNjZWliYUFwaSArIHRoaXMucHJlZml4ICsgJy92b2NhYnVsYXJ5L25ldycsXG4gICAgICB2b2NhYi5lbnRpdHlzdHJpbmdpZnkoKVxuICAgICAgLFxuICAgICAgdGhpcy5odHRwT3B0aW9ucyk7XG4gIH1cblxuICBlZGl0Vm9jYWJ1bGFyeSh2b2NhYjogVm9jYWJ1bGFyeSk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycyA9IHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyB0aGlzLnRva2VuKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UmVzcG9uc2U8YW55Pj4oXG4gICAgICB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdm9jYWJ1bGFyeS9lZGl0LycgKyB2b2NhYi5pZCxcbiAgICAgIHZvY2FiLmVudGl0eXN0cmluZ2lmeSgpXG4gICAgICAsXG4gICAgICB0aGlzLmh0dHBPcHRpb25zKTtcbiAgfVxuXG4gIGdldFZvY2FidWxhcmllcygpOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZXNwb25zZTxhbnk+Pih0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdm9jYWJ1bGFyeS9saXN0Jyk7XG4gIH1cblxuICBuZXdUZXJtKHRlcm06IFRlcm0pOiBPYnNlcnZhYmxlPFJlc3BvbnNlPGFueT4+IHtcbiAgICB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMgPSB0aGlzLmh0dHBPcHRpb25zLmhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0JlYXJlciAnICsgdGhpcy50b2tlbik7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PFJlc3BvbnNlPGFueT4+KFxuICAgICAgdGhpcy5lbnYuc2NlaWJhQXBpICsgdGhpcy5wcmVmaXggKyAnL3Rlcm0vbmV3JyxcbiAgICAgIHRlcm0uZW50aXR5c3RyaW5naWZ5KClcbiAgICAgICxcbiAgICAgIHRoaXMuaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgZWRpdFRlcm0odGVybTogVGVybSk6IE9ic2VydmFibGU8UmVzcG9uc2U8YW55Pj4ge1xuICAgIHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycyA9IHRoaXMuaHR0cE9wdGlvbnMuaGVhZGVycy5zZXQoJ0F1dGhvcml6YXRpb24nLCAnQmVhcmVyICcgKyB0aGlzLnRva2VuKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UmVzcG9uc2U8YW55Pj4oXG4gICAgICB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdGVybS9lZGl0LycgKyB0ZXJtLnV1aWQsXG4gICAgICB0ZXJtLmVudGl0eXN0cmluZ2lmeSgpXG4gICAgICAsXG4gICAgICB0aGlzLmh0dHBPcHRpb25zKTtcbiAgfVxuXG4gIGdldEN1cnJlbnRVc2VyUGVybWlzc2lvbnMoKTogT2JzZXJ2YWJsZTxSZXNwb25zZTxhbnk+PntcbiAgICBjb25zdCByZXEgPSB0aGlzLmVudi5zY2VpYmFBcGkgKyB0aGlzLnByZWZpeCArICcvdXNlci9wZXJtaXNzaW9ucyc7XG4gICAgdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzID0gdGhpcy5odHRwT3B0aW9ucy5oZWFkZXJzLnNldCgnQXV0aG9yaXphdGlvbicsICdCZWFyZXIgJyArIHRoaXMudG9rZW4pO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlc3BvbnNlPGFueT4+KHJlcSwgdGhpcy5odHRwT3B0aW9ucyk7XG4gIH1cbn1cbiJdfQ==